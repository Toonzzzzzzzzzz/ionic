{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreNetwork } from '@services/network';\nimport { CoreFilepool } from '@services/filepool';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CorePluginFileDelegate } from '@services/plugin-file-delegate';\nimport { CoreConstants } from '@/core/constants';\nimport { CoreEvents } from '@singletons/events';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreH5P } from '@features/h5p/services/h5p';\nimport { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nfunction CoreH5PPlayerComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"ion-button\", 3);\n    i0.ɵɵlistener(\"click\", function CoreH5PPlayerComponent_div_0_Template_ion_button_click_1_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.play($event));\n    });\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"ion-icon\", 4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 5)(5, \"core-download-refresh\", 6);\n    i0.ɵɵlistener(\"action\", function CoreH5PPlayerComponent_div_0_Template_core_download_refresh_action_5_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.download());\n    });\n    i0.ɵɵpipe(6, \"async\");\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(2, 5, \"core.h5p.play\"));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"status\", ctx_r0.state)(\"enabled\", i0.ɵɵpipeBind1(6, 7, ctx_r0.canDownload$))(\"loading\", i0.ɵɵpipeBind1(7, 9, ctx_r0.calculating$))(\"canTrustDownload\", true);\n  }\n}\nfunction CoreH5PPlayerComponent_core_h5p_iframe_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-h5p-iframe\", 7);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"fileUrl\", ctx_r1.urlParams.url)(\"displayOptions\", ctx_r1.displayOptions)(\"onlinePlayerUrl\", ctx_r1.src);\n  }\n}\n/**\n * Component to render an H5P package.\n */\nexport class CoreH5PPlayerComponent {\n  constructor(elementRef) {\n    this.elementRef = elementRef;\n    this.showPackage = false;\n    this.canDownload$ = new BehaviorSubject(false);\n    this.calculating$ = new BehaviorSubject(true);\n    this.urlParams = {};\n    this.logger = CoreLogger.getInstance('CoreH5PPlayerComponent');\n    this.site = CoreSites.getRequiredCurrentSite();\n    this.siteId = this.site.getId();\n    this.siteCanDownload = this.site.canDownloadFiles() && !CoreH5P.isOfflineDisabledInSite();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    this.checkCanDownload();\n  }\n  /**\n   * Detect changes on input properties.\n   */\n  ngOnChanges(changes) {\n    // If it's already playing there's no need to check if it can be downloaded.\n    if (changes.src && !this.showPackage) {\n      this.checkCanDownload();\n    }\n  }\n  /**\n   * Play the H5P.\n   *\n   * @param e Event.\n   */\n  play(e) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      e.preventDefault();\n      e.stopPropagation();\n      _this.displayOptions = CoreH5P.h5pPlayer.getDisplayOptionsFromUrlParams(_this.urlParams);\n      _this.showPackage = true;\n      if (!_this.canDownload$.getValue() || _this.state != CoreConstants.OUTDATED && _this.state != CoreConstants.NOT_DOWNLOADED) {\n        return;\n      }\n      // Download the package in background if the size is low.\n      try {\n        yield _this.attemptDownloadInBg();\n      } catch (error) {\n        _this.logger.error('Error downloading H5P in background', error);\n      }\n    })();\n  }\n  /**\n   * Download the package.\n   *\n   * @returns Promise resolved when done.\n   */\n  download() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (!CoreNetwork.isOnline()) {\n        CoreDomUtils.showErrorModal('core.networkerrormsg', true);\n        return;\n      }\n      try {\n        // Get the file size and ask the user to confirm.\n        const size = yield CorePluginFileDelegate.getFileSize({\n          fileurl: _this2.urlParams.url\n        }, _this2.siteId);\n        yield CoreDomUtils.confirmDownloadSize({\n          size: size,\n          total: true\n        });\n        // User confirmed, add to the queue.\n        yield CoreFilepool.addToQueueByUrl(_this2.siteId, _this2.urlParams.url, _this2.component, _this2.componentId);\n      } catch (error) {\n        if (CoreDomUtils.isCanceledError(error)) {\n          // User cancelled, stop.\n          return;\n        }\n        CoreDomUtils.showErrorModalDefault(error, 'core.errordownloading', true);\n        _this2.calculateState();\n      }\n    })();\n  }\n  /**\n   * Download the H5P in background if the size is low.\n   *\n   * @returns Promise resolved when done.\n   */\n  attemptDownloadInBg() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.urlParams || !_this3.src || !_this3.siteCanDownload || !CoreH5P.canGetTrustedH5PFileInSite() || !CoreNetwork.isOnline()) {\n        return;\n      }\n      // Get the file size.\n      const size = yield CorePluginFileDelegate.getFileSize({\n        fileurl: _this3.urlParams.url\n      }, _this3.siteId);\n      if (CoreFilepool.shouldDownload(size)) {\n        // Download the file in background.\n        CoreFilepool.addToQueueByUrl(_this3.siteId, _this3.urlParams.url, _this3.component, _this3.componentId);\n      }\n    })();\n  }\n  /**\n   * Check if the package can be downloaded.\n   *\n   * @returns Promise resolved when done.\n   */\n  checkCanDownload() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      _this4.observer && _this4.observer.off();\n      _this4.urlParams = CoreUrlUtils.extractUrlParams(_this4.src || '');\n      if (_this4.src && _this4.siteCanDownload && CoreH5P.canGetTrustedH5PFileInSite() && _this4.site.containsUrl(_this4.src)) {\n        _this4.calculateState();\n        // Listen for changes in the state.\n        try {\n          const eventName = yield CoreFilepool.getFileEventNameByUrl(_this4.siteId, _this4.urlParams.url);\n          _this4.observer = CoreEvents.on(eventName, () => {\n            _this4.calculateState();\n          });\n        } catch (error) {\n          // An error probably means the file cannot be downloaded or we cannot check it (offline).\n        }\n      } else {\n        _this4.calculating$.next(false);\n        _this4.canDownload$.next(false);\n      }\n    })();\n  }\n  /**\n   * Calculate state of the file.\n   *\n   * @returns Promise resolved when done.\n   */\n  calculateState() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      _this5.calculating$.next(true);\n      // Get the status of the file.\n      try {\n        const state = yield CoreFilepool.getFileStateByUrl(_this5.siteId, _this5.urlParams.url);\n        _this5.canDownload$.next(true);\n        _this5.state = state;\n      } catch (error) {\n        _this5.canDownload$.next(false);\n      } finally {\n        _this5.calculating$.next(false);\n      }\n    })();\n  }\n  /**\n   * Component destroyed.\n   */\n  ngOnDestroy() {\n    var _this$observer;\n    (_this$observer = this.observer) === null || _this$observer === void 0 || _this$observer.off();\n  }\n}\n_class = CoreH5PPlayerComponent;\n_class.ɵfac = function CoreH5PPlayerComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i0.ElementRef));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"core-h5p-player\"]],\n  inputs: {\n    src: \"src\",\n    component: \"component\",\n    componentId: \"componentId\"\n  },\n  features: [i0.ɵɵNgOnChangesFeature],\n  decls: 2,\n  vars: 2,\n  consts: [[\"class\", \"core-h5p-placeholder\", 4, \"ngIf\"], [3, \"fileUrl\", \"displayOptions\", \"onlinePlayerUrl\", 4, \"ngIf\"], [1, \"core-h5p-placeholder\"], [\"fill\", \"clear\", 1, \"core-h5p-placeholder-play-button\", 3, \"click\"], [\"name\", \"far-circle-play\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [1, \"core-h5p-placeholder-download-container\"], [3, \"status\", \"enabled\", \"loading\", \"canTrustDownload\", \"action\"], [3, \"fileUrl\", \"displayOptions\", \"onlinePlayerUrl\"]],\n  template: function CoreH5PPlayerComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, CoreH5PPlayerComponent_div_0_Template, 8, 11, \"div\", 0);\n      i0.ɵɵtemplate(1, CoreH5PPlayerComponent_core_h5p_iframe_1_Template, 1, 3, \"core-h5p-iframe\", 1);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", !ctx.showPackage && ctx.urlParams);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.showPackage);\n    }\n  },\n  styles: [\"[_nghost-%COMP%] {\\n  --core-h5p-placeholder-bg-color: var(--gray-300);\\n  --core-h5p-placeholder-text-color: var(--ion-text-color);\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%] {\\n  position: relative;\\n  width: 100%;\\n  height: 230px;\\n  background: url(\\\"/assets/img/icons/h5p.svg\\\") center top 25px/100px auto no-repeat var(--core-h5p-placeholder-bg-color);\\n  color: var(--core-h5p-placeholder-text-color);\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:not([color=success]) {\\n  color: var(--core-h5p-placeholder-text-color);\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-play-button[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-spinner[_ngcontent-%COMP%] {\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-play-button[_ngcontent-%COMP%] {\\n  font-size: 30px;\\n  min-height: 50px;\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-download-container[_ngcontent-%COMP%] {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-download-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%] {\\n  margin-right: 0.75em;\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   .core-h5p-placeholder-download-container[_ngcontent-%COMP%]   core-download-refresh[_ngcontent-%COMP%]    > ion-icon[_ngcontent-%COMP%] {\\n  margin: 0.4rem 0.2rem;\\n  padding: 0 0.5em;\\n  line-height: 0.67;\\n}\\n[_nghost-%COMP%]   .core-h5p-placeholder[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%] {\\n  stroke: var(--core-h5p-placeholder-text-color);\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb3JlL2ZlYXR1cmVzL2g1cC9jb21wb25lbnRzL2g1cC1wbGF5ZXIvaDVwLXBsYXllci5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksZ0RBQUE7RUFDQSx3REFBQTtBQUNKO0FBQ0k7RUFDSSxrQkFBQTtFQUNBLFdBQUE7RUFDQSxhQUFBO0VBQ0Esc0hBQUE7RUFDQSw2Q0FBQTtBQUNSO0FBQ1E7RUFDSSw2Q0FBQTtBQUNaO0FBRVE7RUFDSSxrQkFBQTtFQUNBLFFBQUE7RUFDQSxTQUFBO0VBQ0EsZ0NBQUE7QUFBWjtBQUdRO0VBQ0ksZUFBQTtFQUNBLGdCQUFBO0FBRFo7QUFJUTtFQUNJLGtCQUFBO0VBQ0EsTUFBQTtFQUNBLFFBQUE7QUFGWjtBQUlZO0VBQ0ksb0JBQUE7QUFGaEI7QUFLWTtFQUNJLHFCQUFBO0VBQ0EsZ0JBQUE7RUFDQSxpQkFBQTtBQUhoQjtBQU9RO0VBQ0ksOENBQUE7QUFMWiIsInNvdXJjZXNDb250ZW50IjpbIjpob3N0IHtcbiAgICAtLWNvcmUtaDVwLXBsYWNlaG9sZGVyLWJnLWNvbG9yOiB2YXIoLS1ncmF5LTMwMCk7XG4gICAgLS1jb3JlLWg1cC1wbGFjZWhvbGRlci10ZXh0LWNvbG9yOiB2YXIoLS1pb24tdGV4dC1jb2xvcik7XG5cbiAgICAuY29yZS1oNXAtcGxhY2Vob2xkZXIge1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDIzMHB4O1xuICAgICAgICBiYWNrZ3JvdW5kOiB1cmwoJy9hc3NldHMvaW1nL2ljb25zL2g1cC5zdmcnKSBjZW50ZXIgdG9wIDI1cHggLyAxMDBweCBhdXRvIG5vLXJlcGVhdCB2YXIoLS1jb3JlLWg1cC1wbGFjZWhvbGRlci1iZy1jb2xvcik7XG4gICAgICAgIGNvbG9yOiB2YXIoLS1jb3JlLWg1cC1wbGFjZWhvbGRlci10ZXh0LWNvbG9yKTtcblxuICAgICAgICAuaWNvbjpub3QoW2NvbG9yPVwic3VjY2Vzc1wiXSkge1xuICAgICAgICAgICAgY29sb3I6IHZhcigtLWNvcmUtaDVwLXBsYWNlaG9sZGVyLXRleHQtY29sb3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLmNvcmUtaDVwLXBsYWNlaG9sZGVyLXBsYXktYnV0dG9uLCAuY29yZS1oNXAtcGxhY2Vob2xkZXItc3Bpbm5lciB7XG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgICB0b3A6IDUwJTtcbiAgICAgICAgICAgIGxlZnQ6IDUwJTtcbiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLmNvcmUtaDVwLXBsYWNlaG9sZGVyLXBsYXktYnV0dG9uIHtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMzBweDtcbiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDUwcHg7XG4gICAgICAgIH1cblxuICAgICAgICAuY29yZS1oNXAtcGxhY2Vob2xkZXItZG93bmxvYWQtY29udGFpbmVyIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgICAgIHRvcDogMDtcbiAgICAgICAgICAgIHJpZ2h0OiAwO1xuXG4gICAgICAgICAgICBpb24tc3Bpbm5lciB7XG4gICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAwLjc1ZW07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvcmUtZG93bmxvYWQtcmVmcmVzaCA+IGlvbi1pY29uIHtcbiAgICAgICAgICAgICAgICBtYXJnaW46IDAuNHJlbSAwLjJyZW07XG4gICAgICAgICAgICAgICAgcGFkZGluZzogMCAwLjVlbTtcbiAgICAgICAgICAgICAgICBsaW5lLWhlaWdodDogLjY3O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaW9uLXNwaW5uZXIgY2lyY2xlIHtcbiAgICAgICAgICAgIHN0cm9rZTogdmFyKC0tY29yZS1oNXAtcGxhY2Vob2xkZXItdGV4dC1jb2xvcik7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"names":["CoreNetwork","CoreFilepool","CoreSites","CoreDomUtils","CoreUrlUtils","CorePluginFileDelegate","CoreConstants","CoreEvents","CoreLogger","CoreH5P","BehaviorSubject","i0","ɵɵelementStart","ɵɵlistener","CoreH5PPlayerComponent_div_0_Template_ion_button_click_1_listener","$event","ɵɵrestoreView","_r3","ctx_r2","ɵɵnextContext","ɵɵresetView","play","ɵɵelement","ɵɵelementEnd","CoreH5PPlayerComponent_div_0_Template_core_download_refresh_action_5_listener","ctx_r4","download","ɵɵadvance","ɵɵattribute","ɵɵpipeBind1","ɵɵproperty","ctx_r0","state","canDownload$","calculating$","ctx_r1","urlParams","url","displayOptions","src","CoreH5PPlayerComponent","constructor","elementRef","showPackage","logger","getInstance","site","getRequiredCurrentSite","siteId","getId","siteCanDownload","canDownloadFiles","isOfflineDisabledInSite","ngOnInit","checkCanDownload","ngOnChanges","changes","e","_this","_asyncToGenerator","preventDefault","stopPropagation","h5pPlayer","getDisplayOptionsFromUrlParams","getValue","OUTDATED","NOT_DOWNLOADED","attemptDownloadInBg","error","_this2","isOnline","showErrorModal","size","getFileSize","fileurl","confirmDownloadSize","total","addToQueueByUrl","component","componentId","isCanceledError","showErrorModalDefault","calculateState","_this3","canGetTrustedH5PFileInSite","shouldDownload","_this4","observer","off","extractUrlParams","containsUrl","eventName","getFileEventNameByUrl","on","next","_this5","getFileStateByUrl","ngOnDestroy","_this$observer","ɵɵdirectiveInject","ElementRef","selectors","inputs","features","ɵɵNgOnChangesFeature","decls","vars","consts","template","CoreH5PPlayerComponent_Template","rf","ctx","ɵɵtemplate","CoreH5PPlayerComponent_div_0_Template","CoreH5PPlayerComponent_core_h5p_iframe_1_Template"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/h5p/components/h5p-player/h5p-player.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/h5p/components/h5p-player/core-h5p-player.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, Input, ElementRef, OnInit, OnDestroy, OnChanges, SimpleChange } from '@angular/core';\n\nimport { CoreNetwork } from '@services/network';\nimport { CoreFilepool } from '@services/filepool';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CorePluginFileDelegate } from '@services/plugin-file-delegate';\nimport { CoreConstants } from '@/core/constants';\nimport { CoreSite } from '@classes/sites/site';\nimport { CoreEvents, CoreEventObserver } from '@singletons/events';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreH5P } from '@features/h5p/services/h5p';\nimport { CoreH5PDisplayOptions } from '../../classes/core';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * Component to render an H5P package.\n */\n@Component({\n    selector: 'core-h5p-player',\n    templateUrl: 'core-h5p-player.html',\n    styleUrls: ['h5p-player.scss'],\n})\nexport class CoreH5PPlayerComponent implements OnInit, OnChanges, OnDestroy {\n\n    @Input() src?: string; // The URL of the player to display the H5P package.\n    @Input() component?: string; // Component.\n    @Input() componentId?: string | number; // Component ID to use in conjunction with the component.\n\n    showPackage = false;\n    state?: string;\n    canDownload$ = new BehaviorSubject(false);\n    calculating$ = new BehaviorSubject(true);\n    displayOptions?: CoreH5PDisplayOptions;\n    urlParams: {[name: string]: string} = {};\n\n    protected site: CoreSite;\n    protected siteId: string;\n    protected siteCanDownload: boolean;\n    protected observer?: CoreEventObserver;\n    protected logger: CoreLogger;\n\n    constructor(\n        public elementRef: ElementRef,\n    ) {\n\n        this.logger = CoreLogger.getInstance('CoreH5PPlayerComponent');\n        this.site = CoreSites.getRequiredCurrentSite();\n        this.siteId = this.site.getId();\n        this.siteCanDownload = this.site.canDownloadFiles() && !CoreH5P.isOfflineDisabledInSite();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        this.checkCanDownload();\n    }\n\n    /**\n     * Detect changes on input properties.\n     */\n    ngOnChanges(changes: {[name: string]: SimpleChange}): void {\n        // If it's already playing there's no need to check if it can be downloaded.\n        if (changes.src && !this.showPackage) {\n            this.checkCanDownload();\n        }\n    }\n\n    /**\n     * Play the H5P.\n     *\n     * @param e Event.\n     */\n    async play(e: MouseEvent): Promise<void> {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.displayOptions = CoreH5P.h5pPlayer.getDisplayOptionsFromUrlParams(this.urlParams);\n        this.showPackage = true;\n\n        if (!this.canDownload$.getValue() || (this.state != CoreConstants.OUTDATED && this.state != CoreConstants.NOT_DOWNLOADED)) {\n            return;\n        }\n\n        // Download the package in background if the size is low.\n        try {\n            await this.attemptDownloadInBg();\n        } catch (error) {\n            this.logger.error('Error downloading H5P in background', error);\n        }\n    }\n\n    /**\n     * Download the package.\n     *\n     * @returns Promise resolved when done.\n     */\n    async download(): Promise<void> {\n        if (!CoreNetwork.isOnline()) {\n            CoreDomUtils.showErrorModal('core.networkerrormsg', true);\n\n            return;\n        }\n\n        try {\n            // Get the file size and ask the user to confirm.\n            const size = await CorePluginFileDelegate.getFileSize({ fileurl: this.urlParams.url }, this.siteId);\n\n            await CoreDomUtils.confirmDownloadSize({ size: size, total: true });\n\n            // User confirmed, add to the queue.\n            await CoreFilepool.addToQueueByUrl(this.siteId, this.urlParams.url, this.component, this.componentId);\n\n        } catch (error) {\n            if (CoreDomUtils.isCanceledError(error)) {\n                // User cancelled, stop.\n                return;\n            }\n\n            CoreDomUtils.showErrorModalDefault(error, 'core.errordownloading', true);\n            this.calculateState();\n        }\n    }\n\n    /**\n     * Download the H5P in background if the size is low.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async attemptDownloadInBg(): Promise<void> {\n        if (!this.urlParams || !this.src || !this.siteCanDownload || !CoreH5P.canGetTrustedH5PFileInSite() ||\n                !CoreNetwork.isOnline()) {\n            return;\n        }\n\n        // Get the file size.\n        const size = await CorePluginFileDelegate.getFileSize({ fileurl: this.urlParams.url }, this.siteId);\n\n        if (CoreFilepool.shouldDownload(size)) {\n            // Download the file in background.\n            CoreFilepool.addToQueueByUrl(this.siteId, this.urlParams.url, this.component, this.componentId);\n        }\n    }\n\n    /**\n     * Check if the package can be downloaded.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async checkCanDownload(): Promise<void> {\n        this.observer && this.observer.off();\n        this.urlParams = CoreUrlUtils.extractUrlParams(this.src || '');\n\n        if (this.src && this.siteCanDownload && CoreH5P.canGetTrustedH5PFileInSite() && this.site.containsUrl(this.src)) {\n            this.calculateState();\n\n            // Listen for changes in the state.\n            try {\n                const eventName = await CoreFilepool.getFileEventNameByUrl(this.siteId, this.urlParams.url);\n\n                this.observer = CoreEvents.on(eventName, () => {\n                    this.calculateState();\n                });\n            } catch (error) {\n                // An error probably means the file cannot be downloaded or we cannot check it (offline).\n            }\n\n        } else {\n            this.calculating$.next(false);\n            this.canDownload$.next(false);\n        }\n\n    }\n\n    /**\n     * Calculate state of the file.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async calculateState(): Promise<void> {\n        this.calculating$.next(true);\n\n        // Get the status of the file.\n        try {\n            const state = await CoreFilepool.getFileStateByUrl(this.siteId, this.urlParams.url);\n\n            this.canDownload$.next(true);\n            this.state = state;\n        } catch (error) {\n            this.canDownload$.next(false);\n        } finally {\n            this.calculating$.next(false);\n        }\n    }\n\n    /**\n     * Component destroyed.\n     */\n    ngOnDestroy(): void {\n        this.observer?.off();\n    }\n\n}\n","<div *ngIf=\"!showPackage && urlParams\" class=\"core-h5p-placeholder\">\n    <ion-button class=\"core-h5p-placeholder-play-button\" fill=\"clear\" (click)=\"play($event)\"\n        [attr.aria-label]=\"'core.h5p.play' | translate\">\n        <ion-icon name=\"far-circle-play\" slot=\"icon-only\" aria-hidden=\"true\" />\n    </ion-button>\n\n    <div class=\"core-h5p-placeholder-download-container\">\n        <core-download-refresh [status]=\"state\" [enabled]=\"canDownload$ | async\" [loading]=\"calculating$ | async\" [canTrustDownload]=\"true\"\n            (action)=\"download()\" />\n    </div>\n</div>\n\n<core-h5p-iframe *ngIf=\"showPackage\" [fileUrl]=\"urlParams!.url\" [displayOptions]=\"displayOptions\" [onlinePlayerUrl]=\"src\" />\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}