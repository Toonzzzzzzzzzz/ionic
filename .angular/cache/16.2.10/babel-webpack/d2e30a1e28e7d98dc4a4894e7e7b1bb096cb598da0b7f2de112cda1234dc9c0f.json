{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreConstants } from '@/core/constants';\nimport { CoreCourse, CoreCourseProvider } from '@features/course/services/course';\nimport { CoreCourseHelper } from '@features/course/services/course-helper';\nimport { CoreCourseModulePrefetchDelegate } from '@features/course/services/module-prefetch-delegate';\nimport { CoreCourses } from '@features/courses/services/courses';\nimport { CoreSettingsHelper } from '@features/settings/services/settings-helper';\nimport { CoreSiteHome } from '@features/sitehome/services/sitehome';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { Translate } from '@singletons';\nimport { CoreArray } from '@singletons/array';\nimport { CoreEvents } from '@singletons/events';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../core/components/loading/loading\";\nimport * as i3 from \"../../../../core/directives/fa-icon\";\nimport * as i4 from \"../../../../core/directives/format-text\";\nimport * as i5 from \"../../../../core/directives/content\";\nimport * as i6 from \"../../../../core/directives/update-non-reactive-attributes\";\nimport * as i7 from \"@ionic/angular\";\nimport * as i8 from \"../../../../core/pipes/bytes-to-size\";\nimport * as i9 from \"@ngx-translate/core\";\nfunction AddonStorageManagerCoursesStoragePage_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 1, \"addon.storagemanager.alldata\"));\n  }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-badge\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"coreBytesToSize\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, ctx_r3.spaceUsage.spaceUsage));\n  }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_card_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-item\", 13)(2, \"ion-label\")(3, \"p\", 14);\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template, 3, 3, \"ion-badge\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function AddonStorageManagerCoursesStoragePage_ion_card_12_Template_ion_button_click_7_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.deleteSiteStorage($event));\n    });\n    i0.ɵɵpipe(8, \"translate\");\n    i0.ɵɵelement(9, \"ion-icon\", 17);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 4, \"addon.storagemanager.totalspaceusage\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.spaceUsage.spaceUsage);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hidden\", ctx_r1.spaceUsage.spaceUsage + ctx_r1.spaceUsage.cacheEntries <= 0);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(8, 6, \"addon.storagemanager.deleteallsitedata\"));\n  }\n}\nfunction AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"core.downloading\"), \" \");\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    name: a0\n  };\n};\nfunction AddonStorageManagerCoursesStoragePage_ion_item_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 18);\n    i0.ɵɵlistener(\"click\", function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_item_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const course_r6 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.openCourse(course_r6.id, course_r6.title));\n    });\n    i0.ɵɵelementStart(1, \"ion-label\", 19)(2, \"p\", 8);\n    i0.ɵɵelement(3, \"core-format-text\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template, 3, 3, \"p\", 21);\n    i0.ɵɵelementStart(5, \"ion-badge\", 9);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"coreBytesToSize\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"ion-button\", 10);\n    i0.ɵɵlistener(\"click\", function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_button_click_8_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const course_r6 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.deleteCourse($event, course_r6));\n    });\n    i0.ɵɵelement(9, \"ion-icon\", 22);\n    i0.ɵɵpipe(10, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const course_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"detail\", true);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"text\", course_r6.title)(\"contextInstanceId\", course_r6.id)(\"adaptImg\", false);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", course_r6.isDownloading);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(7, 8, course_r6.totalSize), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", course_r6.isDownloading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind2(10, 10, \"addon.storagemanager.deletedatafrom\", i0.ɵɵpureFunction1(13, _c0, course_r6.title)));\n  }\n}\n/**\n * Page that displays downloaded courses and allows the user to delete them.\n */\nexport class AddonStorageManagerCoursesStoragePage {\n  constructor() {\n    this.userCourses = [];\n    this.downloadedCourses = [];\n    this.completelyDownloadedCourses = [];\n    this.totalSize = 0;\n    this.loaded = false;\n    this.spaceUsage = {\n      cacheEntries: 0,\n      spaceUsage: 0\n    };\n    this.siteId = CoreSites.getCurrentSiteId();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.userCourses = yield CoreCourses.getUserCourses();\n      _this.courseStatusObserver = CoreEvents.on(CoreEvents.COURSE_STATUS_CHANGED, ({\n        courseId,\n        status\n      }) => _this.onCourseUpdated(courseId, status));\n      const downloadedCourseIds = yield CoreCourse.getDownloadedCourseIds();\n      const downloadedCourses = yield Promise.all(_this.userCourses.filter(course => downloadedCourseIds.indexOf(course.id) !== -1).map(course => _this.getDownloadedCourse(course)));\n      const siteHomeEnabled = yield CoreSiteHome.isAvailable(_this.siteId);\n      if (siteHomeEnabled) {\n        const siteHomeId = CoreSites.getCurrentSiteHomeId();\n        const size = yield _this.calculateDownloadedCourseSize(siteHomeId);\n        if (size > 0) {\n          const status = yield CoreCourse.getCourseStatus(siteHomeId);\n          downloadedCourses.push({\n            id: siteHomeId,\n            title: Translate.instant('core.sitehome.sitehome'),\n            totalSize: size,\n            isDownloading: status === CoreConstants.DOWNLOADING\n          });\n        }\n      }\n      _this.spaceUsage = yield CoreSettingsHelper.getSiteSpaceUsage(_this.siteId);\n      _this.setDownloadedCourses(downloadedCourses);\n      _this.loaded = true;\n    })();\n  }\n  /**\n   * Component destroyed.\n   */\n  ngOnDestroy() {\n    var _this$courseStatusObs;\n    (_this$courseStatusObs = this.courseStatusObserver) === null || _this$courseStatusObs === void 0 || _this$courseStatusObs.off();\n  }\n  /**\n   * Delete all courses that have been downloaded.\n   *\n   * @param event Event Object.\n   */\n  deleteCompletelyDownloadedCourses(event) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      event.preventDefault();\n      event.stopPropagation();\n      try {\n        yield CoreDomUtils.showDeleteConfirm('addon.storagemanager.confirmdeletecourses');\n      } catch (error) {\n        if (!CoreDomUtils.isCanceledError(error)) {\n          throw error;\n        }\n        return;\n      }\n      const modal = yield CoreDomUtils.showModalLoading('core.deleting', true);\n      const deletedCourseIds = _this2.completelyDownloadedCourses.map(course => course.id);\n      try {\n        yield Promise.all(deletedCourseIds.map(courseId => CoreCourseHelper.deleteCourseFiles(courseId)));\n        _this2.setDownloadedCourses(_this2.downloadedCourses.filter(course => !deletedCourseIds.includes(course.id)));\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.errordeletefile'));\n      } finally {\n        modal.dismiss();\n      }\n    })();\n  }\n  /**\n   * Delete course.\n   *\n   * @param event Event Object.\n   * @param course Course to delete.\n   */\n  deleteCourse(event, course) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      event.preventDefault();\n      event.stopPropagation();\n      try {\n        yield CoreDomUtils.showDeleteConfirm('addon.storagemanager.confirmdeletedatafrom', {\n          name: course.title\n        });\n      } catch (error) {\n        if (!CoreDomUtils.isCanceledError(error)) {\n          throw error;\n        }\n        return;\n      }\n      const modal = yield CoreDomUtils.showModalLoading('core.deleting', true);\n      try {\n        yield CoreCourseHelper.deleteCourseFiles(course.id);\n        _this3.setDownloadedCourses(CoreArray.withoutItem(_this3.downloadedCourses, course));\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.errordeletefile'));\n      } finally {\n        modal.dismiss();\n      }\n    })();\n  }\n  /**\n   * Handle course updated event.\n   *\n   * @param courseId Updated course id.\n   */\n  onCourseUpdated(courseId, status) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (courseId == CoreCourseProvider.ALL_COURSES_CLEARED) {\n        _this4.setDownloadedCourses([]);\n        return;\n      }\n      const course = _this4.downloadedCourses.find(course => course.id === courseId);\n      if (!course) {\n        return;\n      }\n      course.isDownloading = status === CoreConstants.DOWNLOADING;\n      course.totalSize = yield _this4.calculateDownloadedCourseSize(course.id);\n      _this4.setDownloadedCourses(_this4.downloadedCourses);\n    })();\n  }\n  /**\n   * Set downloaded courses data.\n   *\n   * @param courses Courses info.\n   */\n  setDownloadedCourses(courses) {\n    this.downloadedCourses = courses.sort((a, b) => b.totalSize - a.totalSize);\n    this.completelyDownloadedCourses = courses.filter(course => !course.isDownloading);\n    this.totalSize = this.downloadedCourses.reduce((totalSize, course) => totalSize + course.totalSize, 0);\n  }\n  /**\n   * Get downloaded course data.\n   *\n   * @param course Course.\n   * @returns Course info.\n   */\n  getDownloadedCourse(course) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const totalSize = yield _this5.calculateDownloadedCourseSize(course.id);\n      const status = yield CoreCourse.getCourseStatus(course.id);\n      return {\n        id: course.id,\n        title: course.displayname || course.fullname,\n        totalSize,\n        isDownloading: status === CoreConstants.DOWNLOADING\n      };\n    })();\n  }\n  /**\n   * Calculate the size of a downloaded course.\n   *\n   * @param courseId Downloaded course id.\n   * @returns Promise to be resolved with the course size.\n   */\n  calculateDownloadedCourseSize(courseId) {\n    return _asyncToGenerator(function* () {\n      const sections = yield CoreCourse.getSections(courseId);\n      const modules = CoreArray.flatten(sections.map(section => section.modules));\n      const promisedModuleSizes = modules.map( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (module) {\n          const size = yield CoreCourseModulePrefetchDelegate.getModuleStoredSize(module, courseId);\n          return isNaN(size) ? 0 : size;\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      const moduleSizes = yield Promise.all(promisedModuleSizes);\n      return moduleSizes.reduce((totalSize, moduleSize) => totalSize + moduleSize, 0);\n    })();\n  }\n  /**\n   * Open course storage.\n   *\n   * @param courseId Course Id.\n   */\n  openCourse(courseId, title) {\n    CoreNavigator.navigateToSitePath('/storage/' + courseId, {\n      params: {\n        title\n      }\n    });\n  }\n  /**\n   * Deletes files of a site and the tables that can be cleared.\n   *\n   * @param event Event Object.\n   */\n  deleteSiteStorage(event) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      event.preventDefault();\n      event.stopPropagation();\n      try {\n        const site = CoreSites.getRequiredCurrentSite();\n        const siteName = yield site.getSiteName();\n        _this6.spaceUsage = yield CoreSettingsHelper.deleteSiteStorage(siteName, _this6.siteId);\n      } catch (_unused) {\n        // Ignore cancelled confirmation modal.\n      }\n    })();\n  }\n}\n_class = AddonStorageManagerCoursesStoragePage;\n_class.ɵfac = function AddonStorageManagerCoursesStoragePage_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-storagemanager-courses-storage\"]],\n  decls: 30,\n  vars: 23,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [1, \"limited-width\"], [3, \"hideUntil\"], [\"class\", \"ion-padding-horizontal ion-text-wrap\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"ion-padding-horizontal\", \"ion-text-wrap\"], [\"lines\", \"full\", 1, \"size\", \"courses\", \"ion-text-wrap\"], [1, \"item-heading\"], [\"color\", \"light\"], [\"slot\", \"end\", \"color\", \"danger\", \"fill\", \"clear\", 3, \"disabled\", \"click\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\", 3, \"ariaLabel\"], [\"class\", \"course\", \"button\", \"\", 3, \"detail\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"ion-text-wrap\", \"total\"], [1, \"item-heading\", \"ion-text-wrap\"], [\"color\", \"light\", 4, \"ngIf\"], [\"fill\", \"clear\", \"color\", \"danger\", \"slot\", \"end\", 3, \"hidden\", \"click\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"button\", \"\", 1, \"course\", 3, \"detail\", \"click\"], [1, \"ion-text-wrap\"], [\"contextLevel\", \"course\", 3, \"text\", \"contextInstanceId\", \"adaptImg\"], [\"class\", \"item-heading item-heading-secondary\", 4, \"ngIf\"], [\"name\", \"fas-trash\", \"slot\", \"icon-only\"], [1, \"item-heading\", \"item-heading-secondary\"]],\n  template: function AddonStorageManagerCoursesStoragePage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵtext(7);\n      i0.ɵɵpipe(8, \"translate\");\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(9, \"ion-content\", 2)(10, \"core-loading\", 3);\n      i0.ɵɵtemplate(11, AddonStorageManagerCoursesStoragePage_div_11_Template, 4, 3, \"div\", 4);\n      i0.ɵɵtemplate(12, AddonStorageManagerCoursesStoragePage_ion_card_12_Template, 10, 8, \"ion-card\", 5);\n      i0.ɵɵelementStart(13, \"div\", 6)(14, \"h2\");\n      i0.ɵɵtext(15);\n      i0.ɵɵpipe(16, \"translate\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"ion-card\")(18, \"ion-item\", 7)(19, \"ion-label\")(20, \"p\", 8);\n      i0.ɵɵtext(21);\n      i0.ɵɵpipe(22, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"ion-badge\", 9);\n      i0.ɵɵtext(24);\n      i0.ɵɵpipe(25, \"coreBytesToSize\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(26, \"ion-button\", 10);\n      i0.ɵɵlistener(\"click\", function AddonStorageManagerCoursesStoragePage_Template_ion_button_click_26_listener($event) {\n        return ctx.deleteCompletelyDownloadedCourses($event);\n      });\n      i0.ɵɵelement(27, \"ion-icon\", 11);\n      i0.ɵɵpipe(28, \"translate\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(29, AddonStorageManagerCoursesStoragePage_ion_item_29_Template, 11, 15, \"ion-item\", 12);\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 11, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(8, 13, \"addon.storagemanager.managedownloads\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"hideUntil\", ctx.loaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.spaceUsage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.spaceUsage);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(16, 15, \"addon.storagemanager.downloadedcourses\"));\n      i0.ɵɵadvance(6);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(22, 17, \"addon.storagemanager.totalspaceusage\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(25, 19, ctx.totalSize));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"disabled\", ctx.completelyDownloadedCourses.length === 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵpropertyInterpolate(\"ariaLabel\", i0.ɵɵpipeBind1(28, 21, \"addon.storagemanager.deletecourses\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.downloadedCourses);\n    }\n  },\n  dependencies: [i1.NgForOf, i1.NgIf, i2.CoreLoadingComponent, i3.CoreFaIconDirective, i4.CoreFormatTextDirective, i5.CoreContentDirective, i6.CoreUpdateNonReactiveAttributesDirective, i7.IonBadge, i7.IonButton, i7.IonButtons, i7.IonCard, i7.IonContent, i7.IonHeader, i7.IonIcon, i7.IonItem, i7.IonLabel, i7.IonTitle, i7.IonToolbar, i7.IonBackButton, i8.CoreBytesToSizePipe, i9.TranslatePipe],\n  styles: [\"ion-item.courses[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], ion-item.total[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%] {\\n  font-weight: bold;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hZGRvbnMvc3RvcmFnZW1hbmFnZXIvcGFnZXMvY291cnNlcy1zdG9yYWdlL2NvdXJzZXMtc3RvcmFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVJOztFQUNJLGlCQUFBO0FBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpb24taXRlbS5jb3Vyc2VzLFxuaW9uLWl0ZW0udG90YWwge1xuICAgIC5pdGVtLWhlYWRpbmcge1xuICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"names":["CoreConstants","CoreCourse","CoreCourseProvider","CoreCourseHelper","CoreCourseModulePrefetchDelegate","CoreCourses","CoreSettingsHelper","CoreSiteHome","CoreNavigator","CoreSites","CoreDomUtils","Translate","CoreArray","CoreEvents","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate","ɵɵpipeBind1","ctx_r3","spaceUsage","ɵɵtemplate","AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template","ɵɵlistener","AddonStorageManagerCoursesStoragePage_ion_card_12_Template_ion_button_click_7_listener","$event","ɵɵrestoreView","_r5","ctx_r4","ɵɵnextContext","ɵɵresetView","deleteSiteStorage","ɵɵelement","ɵɵproperty","ctx_r1","cacheEntries","ɵɵattribute","ɵɵtextInterpolate1","AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_item_click_0_listener","restoredCtx","_r9","course_r6","$implicit","ctx_r8","openCourse","id","title","AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template","AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_button_click_8_listener","ctx_r10","deleteCourse","isDownloading","totalSize","ɵɵpipeBind2","ɵɵpureFunction1","_c0","AddonStorageManagerCoursesStoragePage","constructor","userCourses","downloadedCourses","completelyDownloadedCourses","loaded","siteId","getCurrentSiteId","ngOnInit","_this","_asyncToGenerator","getUserCourses","courseStatusObserver","on","COURSE_STATUS_CHANGED","courseId","status","onCourseUpdated","downloadedCourseIds","getDownloadedCourseIds","Promise","all","filter","course","indexOf","map","getDownloadedCourse","siteHomeEnabled","isAvailable","siteHomeId","getCurrentSiteHomeId","size","calculateDownloadedCourseSize","getCourseStatus","push","instant","DOWNLOADING","getSiteSpaceUsage","setDownloadedCourses","ngOnDestroy","_this$courseStatusObs","off","deleteCompletelyDownloadedCourses","event","_this2","preventDefault","stopPropagation","showDeleteConfirm","error","isCanceledError","modal","showModalLoading","deletedCourseIds","deleteCourseFiles","includes","showErrorModalDefault","dismiss","_this3","name","withoutItem","_this4","ALL_COURSES_CLEARED","find","courses","sort","a","b","reduce","_this5","displayname","fullname","sections","getSections","modules","flatten","section","promisedModuleSizes","_ref","module","getModuleStoredSize","isNaN","_x","apply","arguments","moduleSizes","moduleSize","navigateToSitePath","params","_this6","site","getRequiredCurrentSite","siteName","getSiteName","_unused","selectors","decls","vars","consts","template","AddonStorageManagerCoursesStoragePage_Template","rf","ctx","AddonStorageManagerCoursesStoragePage_div_11_Template","AddonStorageManagerCoursesStoragePage_ion_card_12_Template","AddonStorageManagerCoursesStoragePage_Template_ion_button_click_26_listener","AddonStorageManagerCoursesStoragePage_ion_item_29_Template","length","ɵɵpropertyInterpolate"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/storagemanager/pages/courses-storage/courses-storage.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/storagemanager/pages/courses-storage/courses-storage.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CoreConstants } from '@/core/constants';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { CoreCourse, CoreCourseProvider } from '@features/course/services/course';\nimport { CoreCourseHelper } from '@features/course/services/course-helper';\nimport { CoreCourseModulePrefetchDelegate } from '@features/course/services/module-prefetch-delegate';\nimport { CoreCourses, CoreEnrolledCourseData } from '@features/courses/services/courses';\nimport { CoreSettingsHelper, CoreSiteSpaceUsage } from '@features/settings/services/settings-helper';\nimport { CoreSiteHome } from '@features/sitehome/services/sitehome';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { Translate } from '@singletons';\nimport { CoreArray } from '@singletons/array';\nimport { CoreEventObserver, CoreEvents } from '@singletons/events';\n\n/**\n * Page that displays downloaded courses and allows the user to delete them.\n */\n@Component({\n    selector: 'page-addon-storagemanager-courses-storage',\n    templateUrl: 'courses-storage.html',\n    styleUrls: ['courses-storage.scss'],\n})\nexport class AddonStorageManagerCoursesStoragePage implements OnInit, OnDestroy {\n\n    userCourses: CoreEnrolledCourseData[] = [];\n    downloadedCourses: DownloadedCourse[] = [];\n    completelyDownloadedCourses: DownloadedCourse[] = [];\n    totalSize = 0;\n    loaded = false;\n    spaceUsage: CoreSiteSpaceUsage = {\n        cacheEntries: 0,\n        spaceUsage: 0,\n    };\n\n    courseStatusObserver?: CoreEventObserver;\n    siteId: string;\n\n    constructor() {\n        this.siteId = CoreSites.getCurrentSiteId();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        this.userCourses = await CoreCourses.getUserCourses();\n        this.courseStatusObserver = CoreEvents.on(\n            CoreEvents.COURSE_STATUS_CHANGED,\n            ({ courseId, status }) => this.onCourseUpdated(courseId, status),\n        );\n\n        const downloadedCourseIds = await CoreCourse.getDownloadedCourseIds();\n        const downloadedCourses = await Promise.all(\n            this.userCourses\n                .filter((course) => downloadedCourseIds.indexOf(course.id) !== -1)\n                .map((course) => this.getDownloadedCourse(course)),\n        );\n\n        const siteHomeEnabled = await CoreSiteHome.isAvailable(this.siteId);\n        if (siteHomeEnabled) {\n            const siteHomeId = CoreSites.getCurrentSiteHomeId();\n            const size = await this.calculateDownloadedCourseSize(siteHomeId);\n            if (size > 0) {\n                const status = await CoreCourse.getCourseStatus(siteHomeId);\n\n                downloadedCourses.push({\n                    id: siteHomeId,\n                    title: Translate.instant('core.sitehome.sitehome'),\n                    totalSize: size,\n                    isDownloading: status === CoreConstants.DOWNLOADING,\n                });\n            }\n        }\n\n        this.spaceUsage = await CoreSettingsHelper.getSiteSpaceUsage(this.siteId);\n\n        this.setDownloadedCourses(downloadedCourses);\n\n        this.loaded = true;\n    }\n\n    /**\n     * Component destroyed.\n     */\n    ngOnDestroy(): void {\n        this.courseStatusObserver?.off();\n    }\n\n    /**\n     * Delete all courses that have been downloaded.\n     *\n     * @param event Event Object.\n     */\n    async deleteCompletelyDownloadedCourses(event: Event): Promise<void> {\n        event.preventDefault();\n        event.stopPropagation();\n\n        try {\n            await CoreDomUtils.showDeleteConfirm('addon.storagemanager.confirmdeletecourses');\n        } catch (error) {\n            if (!CoreDomUtils.isCanceledError(error)) {\n                throw error;\n            }\n\n            return;\n        }\n\n        const modal = await CoreDomUtils.showModalLoading('core.deleting', true);\n        const deletedCourseIds = this.completelyDownloadedCourses.map((course) => course.id);\n\n        try {\n            await Promise.all(deletedCourseIds.map((courseId) => CoreCourseHelper.deleteCourseFiles(courseId)));\n\n            this.setDownloadedCourses(this.downloadedCourses.filter((course) => !deletedCourseIds.includes(course.id)));\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.errordeletefile'));\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * Delete course.\n     *\n     * @param event Event Object.\n     * @param course Course to delete.\n     */\n    async deleteCourse(event: Event, course: DownloadedCourse): Promise<void> {\n        event.preventDefault();\n        event.stopPropagation();\n\n        try {\n            await CoreDomUtils.showDeleteConfirm(\n                'addon.storagemanager.confirmdeletedatafrom',\n                { name: course.title },\n            );\n        } catch (error) {\n            if (!CoreDomUtils.isCanceledError(error)) {\n                throw error;\n            }\n\n            return;\n        }\n\n        const modal = await CoreDomUtils.showModalLoading('core.deleting', true);\n\n        try {\n            await CoreCourseHelper.deleteCourseFiles(course.id);\n\n            this.setDownloadedCourses(CoreArray.withoutItem(this.downloadedCourses, course));\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.errordeletefile'));\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * Handle course updated event.\n     *\n     * @param courseId Updated course id.\n     */\n    private async onCourseUpdated(courseId: number, status: string): Promise<void> {\n        if (courseId == CoreCourseProvider.ALL_COURSES_CLEARED) {\n            this.setDownloadedCourses([]);\n\n            return;\n        }\n\n        const course = this.downloadedCourses.find((course) => course.id === courseId);\n\n        if (!course) {\n            return;\n        }\n\n        course.isDownloading = status === CoreConstants.DOWNLOADING;\n        course.totalSize = await this.calculateDownloadedCourseSize(course.id);\n\n        this.setDownloadedCourses(this.downloadedCourses);\n    }\n\n    /**\n     * Set downloaded courses data.\n     *\n     * @param courses Courses info.\n     */\n    private setDownloadedCourses(courses: DownloadedCourse[]): void {\n        this.downloadedCourses = courses.sort((a, b) => b.totalSize - a.totalSize);\n        this.completelyDownloadedCourses = courses.filter((course) => !course.isDownloading);\n        this.totalSize = this.downloadedCourses.reduce((totalSize, course) => totalSize + course.totalSize, 0);\n    }\n\n    /**\n     * Get downloaded course data.\n     *\n     * @param course Course.\n     * @returns Course info.\n     */\n    private async getDownloadedCourse(course: CoreEnrolledCourseData): Promise<DownloadedCourse> {\n        const totalSize = await this.calculateDownloadedCourseSize(course.id);\n        const status = await CoreCourse.getCourseStatus(course.id);\n\n        return {\n            id: course.id,\n            title: course.displayname || course.fullname,\n            totalSize,\n            isDownloading: status === CoreConstants.DOWNLOADING,\n        };\n    }\n\n    /**\n     * Calculate the size of a downloaded course.\n     *\n     * @param courseId Downloaded course id.\n     * @returns Promise to be resolved with the course size.\n     */\n    private async calculateDownloadedCourseSize(courseId: number): Promise<number> {\n        const sections = await CoreCourse.getSections(courseId);\n        const modules = CoreArray.flatten(sections.map((section) => section.modules));\n        const promisedModuleSizes = modules.map(async (module) => {\n            const size = await CoreCourseModulePrefetchDelegate.getModuleStoredSize(module, courseId);\n\n            return isNaN(size) ? 0 : size;\n        });\n        const moduleSizes = await Promise.all(promisedModuleSizes);\n\n        return moduleSizes.reduce((totalSize, moduleSize) => totalSize + moduleSize, 0);\n    }\n\n    /**\n     * Open course storage.\n     *\n     * @param courseId Course Id.\n     */\n    openCourse(courseId: number, title: string): void {\n        CoreNavigator.navigateToSitePath('/storage/' + courseId, { params: { title } });\n    }\n\n    /**\n     * Deletes files of a site and the tables that can be cleared.\n     *\n     * @param event Event Object.\n     */\n    async deleteSiteStorage(event: Event): Promise<void> {\n        event.preventDefault();\n        event.stopPropagation();\n\n        try {\n            const site = CoreSites.getRequiredCurrentSite();\n            const siteName = await site.getSiteName();\n\n            this.spaceUsage = await CoreSettingsHelper.deleteSiteStorage(siteName, this.siteId);\n        } catch {\n            // Ignore cancelled confirmation modal.\n        }\n    }\n\n}\n\n/**\n * Downloaded course data.\n */\ninterface DownloadedCourse {\n    id: number;\n    title: string;\n    totalSize: number;\n    isDownloading: boolean;\n}\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>{{ 'addon.storagemanager.managedownloads' | translate }}</h1>\n        </ion-title>\n    </ion-toolbar>\n</ion-header>\n<ion-content class=\"limited-width\">\n    <core-loading [hideUntil]=\"loaded\">\n        <div class=\"ion-padding-horizontal ion-text-wrap\" *ngIf=\"spaceUsage\">\n            <h2>{{ 'addon.storagemanager.alldata' | translate }}</h2>\n        </div>\n        <ion-card *ngIf=\"spaceUsage\">\n            <ion-item class=\"ion-text-wrap total\">\n                <ion-label>\n                    <p class=\"item-heading ion-text-wrap\">{{ 'addon.storagemanager.totalspaceusage' | translate }}</p>\n                    <ion-badge color=\"light\" *ngIf=\"spaceUsage.spaceUsage\">{{ spaceUsage.spaceUsage | coreBytesToSize }}</ion-badge>\n                </ion-label>\n                <ion-button fill=\"clear\" color=\"danger\" slot=\"end\" (click)=\"deleteSiteStorage($event)\"\n                    [hidden]=\"spaceUsage.spaceUsage! + spaceUsage.cacheEntries! <= 0\"\n                    [attr.aria-label]=\"'addon.storagemanager.deleteallsitedata' | translate\">\n                    <ion-icon name=\"fas-trash\" slot=\"icon-only\" aria-hidden=\"true\" />\n                </ion-button>\n            </ion-item>\n        </ion-card>\n\n        <div class=\"ion-padding-horizontal ion-text-wrap\">\n            <h2>{{ 'addon.storagemanager.downloadedcourses' | translate }}</h2>\n        </div>\n        <ion-card>\n            <ion-item class=\"size courses ion-text-wrap\" lines=\"full\">\n                <ion-label>\n                    <p class=\"item-heading\">{{ 'addon.storagemanager.totalspaceusage' | translate }}</p>\n                    <ion-badge color=\"light\">{{ totalSize | coreBytesToSize }}</ion-badge>\n                </ion-label>\n                <ion-button slot=\"end\" (click)=\"deleteCompletelyDownloadedCourses($event)\"\n                    [disabled]=\"completelyDownloadedCourses.length === 0\" color=\"danger\" fill=\"clear\">\n                    <ion-icon name=\"fas-trash\" slot=\"icon-only\" ariaLabel=\"{{ 'addon.storagemanager.deletecourses' | translate }}\" />\n                </ion-button>\n            </ion-item>\n            <ion-item *ngFor=\"let course of downloadedCourses\" class=\"course\" (click)=\"openCourse(course.id, course.title)\" button\n                [detail]=\"true\">\n                <ion-label class=\"ion-text-wrap\">\n                    <p class=\"item-heading\">\n                        <core-format-text [text]=\"course.title\" contextLevel=\"course\" [contextInstanceId]=\"course.id\" [adaptImg]=\"false\" />\n                    </p>\n                    <p class=\"item-heading item-heading-secondary\" *ngIf=\"course.isDownloading\">\n                        {{ 'core.downloading' | translate }}\n                    </p>\n                    <ion-badge color=\"light\">\n                        {{ course.totalSize | coreBytesToSize }}\n                    </ion-badge>\n                </ion-label>\n                <ion-button slot=\"end\" (click)=\"deleteCourse($event, course)\" [disabled]=\"course.isDownloading\" color=\"danger\" fill=\"clear\">\n                    <ion-icon name=\"fas-trash\" slot=\"icon-only\" [attr.aria-label]=\"'addon.storagemanager.deletedatafrom' | translate:\n                            { name: course.title }\" />\n                </ion-button>\n            </ion-item>\n        </ion-card>\n    </core-loading>\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}