{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { EventEmitter } from '@angular/core';\nimport { NavigationEnd } from '@angular/router';\nimport { filter } from 'rxjs/operators';\nimport { CoreFile } from '@services/file';\nimport { CoreFilepool } from '@services/filepool';\nimport { CoreFileHelper } from '@services/file-helper';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreH5P } from '@features/h5p/services/h5p';\nimport { CoreConstants } from '@/core/constants';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreH5PCore } from '../../classes/core';\nimport { CoreH5PHelper } from '../../classes/helper';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nfunction CoreH5PIframeComponent_core_iframe_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-iframe\", 2);\n    i0.ɵɵlistener(\"loaded\", function CoreH5PIframeComponent_core_iframe_1_Template_core_iframe_loaded_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.iframeLoaded());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"src\", ctx_r0.iframeSrc)(\"allowFullscreen\", true)(\"showFullscreenOnToolbar\", ctx_r0.enableInAppFullscreen)(\"autoFullscreenOnRotate\", ctx_r0.enableInAppFullscreen);\n  }\n}\n/**\n * Component to render an iframe with an H5P package.\n */\nexport class CoreH5PIframeComponent {\n  constructor(elementRef, router) {\n    this.elementRef = elementRef;\n    this.onIframeUrlSet = new EventEmitter();\n    this.onIframeLoaded = new EventEmitter();\n    this.iframeLoadedOnce = false;\n    this.logger = CoreLogger.getInstance('CoreH5PIframeComponent');\n    this.site = CoreSites.getRequiredCurrentSite();\n    this.siteId = this.site.getId();\n    this.siteCanDownload = this.site.canDownloadFiles() && !CoreH5P.isOfflineDisabledInSite();\n    // Send resize events when the page holding this component is re-entered.\n    this.currentPageRoute = router.url;\n    this.subscription = router.events.pipe(filter(event => event instanceof NavigationEnd)).subscribe(event => {\n      if (!this.iframeLoadedOnce || event.urlAfterRedirects !== this.currentPageRoute) {\n        return;\n      }\n      window.dispatchEvent(new Event('resize'));\n    });\n  }\n  /**\n   * Detect changes on input properties.\n   */\n  ngOnChanges(changes) {\n    // If it's already playing don't change it.\n    if ((changes.fileUrl || changes.onlinePlayerUrl) && !this.iframeSrc) {\n      this.play();\n    }\n  }\n  /**\n   * Play the H5P.\n   *\n   * @returns Promise resolved when done.\n   */\n  play() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let localUrl;\n      let state;\n      _this.onlinePlayerUrl = _this.onlinePlayerUrl || CoreH5P.h5pPlayer.calculateOnlinePlayerUrl(_this.site.getURL(), _this.fileUrl || '', _this.displayOptions, _this.trackComponent);\n      if (_this.fileUrl) {\n        state = yield CoreFilepool.getFileStateByUrl(_this.siteId, _this.fileUrl);\n      } else {\n        state = CoreConstants.NOT_DOWNLOADABLE;\n      }\n      if (_this.siteCanDownload && CoreFileHelper.isStateDownloaded(state)) {\n        // Package is downloaded, use the local URL.\n        localUrl = yield _this.getLocalUrl();\n      }\n      try {\n        if (localUrl) {\n          // Local package.\n          _this.iframeSrc = localUrl;\n          // Only log analytics event when playing local package, online package already logs it.\n          CoreAnalytics.logEvent({\n            type: CoreAnalyticsEventType.VIEW_ITEM,\n            ws: 'core_h5p_get_trusted_h5p_file',\n            name: 'H5P content',\n            data: {\n              category: 'h5p'\n            },\n            url: _this.onlinePlayerUrl\n          });\n        } else {\n          // Never allow downloading in the app. This will only work if the user is allowed to change the params.\n          const src = _this.onlinePlayerUrl.replace(CoreH5PCore.DISPLAY_OPTION_DOWNLOAD + '=1', CoreH5PCore.DISPLAY_OPTION_DOWNLOAD + '=0');\n          // Add the preventredirect param so the user can authenticate.\n          _this.iframeSrc = CoreUrlUtils.addParamsToUrl(src, {\n            preventredirect: false\n          });\n        }\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'Error loading H5P package.', true);\n      } finally {\n        CoreH5PHelper.addResizerScript();\n        _this.onIframeUrlSet.emit({\n          src: _this.iframeSrc,\n          online: !!localUrl\n        });\n      }\n    })();\n  }\n  /**\n   * Get the local URL of the package.\n   *\n   * @returns Promise resolved with the local URL.\n   */\n  getLocalUrl() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const otherOptions = {\n        saveFreq: _this2.saveFreq,\n        state: _this2.state\n      };\n      try {\n        const url = yield CoreH5P.h5pPlayer.getContentIndexFileUrl(_this2.fileUrl, _this2.displayOptions, _this2.trackComponent, _this2.contextId, _this2.siteId, otherOptions);\n        return url;\n      } catch (error) {\n        // Index file doesn't exist, probably deleted because a lib was updated. Try to create it again.\n        try {\n          const path = yield CoreFilepool.getInternalUrlByUrl(_this2.siteId, _this2.fileUrl);\n          const file = yield CoreFile.getFile(path);\n          yield CoreH5PHelper.saveH5P(_this2.fileUrl, file, _this2.siteId);\n          // File treated. Try to get the index file URL again.\n          const url = yield CoreH5P.h5pPlayer.getContentIndexFileUrl(_this2.fileUrl, _this2.displayOptions, _this2.trackComponent, _this2.contextId, _this2.siteId, otherOptions);\n          return url;\n        } catch (error) {\n          // Still failing. Delete the H5P package?\n          _this2.logger.error('Error loading downloaded index:', error, _this2.fileUrl);\n        }\n      }\n    })();\n  }\n  /**\n   * H5P iframe has been loaded.\n   */\n  iframeLoaded() {\n    this.onIframeLoaded.emit();\n    this.iframeLoadedOnce = true;\n    // Send a resize event to the window so H5P package recalculates the size.\n    window.dispatchEvent(new Event('resize'));\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    var _this$subscription;\n    (_this$subscription = this.subscription) === null || _this$subscription === void 0 || _this$subscription.unsubscribe();\n  }\n}\n_class = CoreH5PIframeComponent;\n_class.ɵfac = function CoreH5PIframeComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.Router));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"core-h5p-iframe\"]],\n  inputs: {\n    fileUrl: \"fileUrl\",\n    displayOptions: \"displayOptions\",\n    onlinePlayerUrl: \"onlinePlayerUrl\",\n    trackComponent: \"trackComponent\",\n    contextId: \"contextId\",\n    enableInAppFullscreen: \"enableInAppFullscreen\",\n    saveFreq: \"saveFreq\",\n    state: \"state\"\n  },\n  outputs: {\n    onIframeUrlSet: \"onIframeUrlSet\",\n    onIframeLoaded: \"onIframeLoaded\"\n  },\n  features: [i0.ɵɵNgOnChangesFeature],\n  decls: 2,\n  vars: 3,\n  consts: [[3, \"hideUntil\", \"fullscreen\"], [\"iframeHeight\", \"auto\", 3, \"src\", \"allowFullscreen\", \"showFullscreenOnToolbar\", \"autoFullscreenOnRotate\", \"loaded\", 4, \"ngIf\"], [\"iframeHeight\", \"auto\", 3, \"src\", \"allowFullscreen\", \"showFullscreenOnToolbar\", \"autoFullscreenOnRotate\", \"loaded\"]],\n  template: function CoreH5PIframeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"core-loading\", 0);\n      i0.ɵɵtemplate(1, CoreH5PIframeComponent_core_iframe_1_Template, 1, 4, \"core-iframe\", 1);\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"hideUntil\", ctx.iframeSrc)(\"fullscreen\", false);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.iframeSrc);\n    }\n  },\n  encapsulation: 2\n});","map":{"version":3,"names":["EventEmitter","NavigationEnd","filter","CoreFile","CoreFilepool","CoreFileHelper","CoreSites","CoreDomUtils","CoreUrlUtils","CoreH5P","CoreConstants","CoreLogger","CoreH5PCore","CoreH5PHelper","CoreAnalytics","CoreAnalyticsEventType","i0","ɵɵelementStart","ɵɵlistener","CoreH5PIframeComponent_core_iframe_1_Template_core_iframe_loaded_0_listener","ɵɵrestoreView","_r2","ctx_r1","ɵɵnextContext","ɵɵresetView","iframeLoaded","ɵɵelementEnd","ɵɵproperty","ctx_r0","iframeSrc","enableInAppFullscreen","CoreH5PIframeComponent","constructor","elementRef","router","onIframeUrlSet","onIframeLoaded","iframeLoadedOnce","logger","getInstance","site","getRequiredCurrentSite","siteId","getId","siteCanDownload","canDownloadFiles","isOfflineDisabledInSite","currentPageRoute","url","subscription","events","pipe","event","subscribe","urlAfterRedirects","window","dispatchEvent","Event","ngOnChanges","changes","fileUrl","onlinePlayerUrl","play","_this","_asyncToGenerator","localUrl","state","h5pPlayer","calculateOnlinePlayerUrl","getURL","displayOptions","trackComponent","getFileStateByUrl","NOT_DOWNLOADABLE","isStateDownloaded","getLocalUrl","logEvent","type","VIEW_ITEM","ws","name","data","category","src","replace","DISPLAY_OPTION_DOWNLOAD","addParamsToUrl","preventredirect","error","showErrorModalDefault","addResizerScript","emit","online","_this2","otherOptions","saveFreq","getContentIndexFileUrl","contextId","path","getInternalUrlByUrl","file","getFile","saveH5P","ngOnDestroy","_this$subscription","unsubscribe","ɵɵdirectiveInject","ElementRef","i1","Router","selectors","inputs","outputs","features","ɵɵNgOnChangesFeature","decls","vars","consts","template","CoreH5PIframeComponent_Template","rf","ctx","ɵɵtemplate","CoreH5PIframeComponent_core_iframe_1_Template","ɵɵadvance"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/h5p/components/h5p-iframe/h5p-iframe.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/h5p/components/h5p-iframe/core-h5p-iframe.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, Input, Output, ElementRef, OnChanges, SimpleChange, EventEmitter, OnDestroy } from '@angular/core';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { CoreFile } from '@services/file';\nimport { CoreFilepool } from '@services/filepool';\nimport { CoreFileHelper } from '@services/file-helper';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreH5P } from '@features/h5p/services/h5p';\nimport { CoreConstants } from '@/core/constants';\nimport { CoreSite } from '@classes/sites/site';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreH5PCore, CoreH5PDisplayOptions } from '../../classes/core';\nimport { CoreH5PHelper } from '../../classes/helper';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\n\n/**\n * Component to render an iframe with an H5P package.\n */\n@Component({\n    selector: 'core-h5p-iframe',\n    templateUrl: 'core-h5p-iframe.html',\n})\nexport class CoreH5PIframeComponent implements OnChanges, OnDestroy {\n\n    @Input() fileUrl?: string; // The URL of the H5P file. If not supplied, onlinePlayerUrl is required.\n    @Input() displayOptions?: CoreH5PDisplayOptions; // Display options.\n    @Input() onlinePlayerUrl?: string; // The URL of the online player to display the H5P package.\n    @Input() trackComponent?: string; // Component to send xAPI events to.\n    @Input() contextId?: number; // Context ID. Required for tracking.\n    @Input() enableInAppFullscreen?: boolean; // Whether to enable our custom in-app fullscreen feature.\n    @Input() saveFreq?: number; // Save frequency (in seconds) if enabled.\n    @Input() state?: string; // Initial content state.\n    @Output() onIframeUrlSet = new EventEmitter<{src: string; online: boolean}>();\n    @Output() onIframeLoaded = new EventEmitter<void>();\n\n    iframeSrc?: string;\n\n    protected site: CoreSite;\n    protected siteId: string;\n    protected siteCanDownload: boolean;\n    protected logger: CoreLogger;\n    protected currentPageRoute?: string;\n    protected subscription: Subscription;\n    protected iframeLoadedOnce = false;\n\n    constructor(\n        public elementRef: ElementRef,\n        router: Router,\n    ) {\n        this.logger = CoreLogger.getInstance('CoreH5PIframeComponent');\n        this.site = CoreSites.getRequiredCurrentSite();\n        this.siteId = this.site.getId();\n        this.siteCanDownload = this.site.canDownloadFiles() && !CoreH5P.isOfflineDisabledInSite();\n\n        // Send resize events when the page holding this component is re-entered.\n        this.currentPageRoute = router.url;\n        this.subscription = router.events\n            .pipe(filter(event => event instanceof NavigationEnd))\n            .subscribe((event: NavigationEnd) => {\n                if (!this.iframeLoadedOnce || event.urlAfterRedirects !== this.currentPageRoute) {\n                    return;\n                }\n\n                window.dispatchEvent(new Event('resize'));\n            });\n    }\n\n    /**\n     * Detect changes on input properties.\n     */\n    ngOnChanges(changes: {[name: string]: SimpleChange}): void {\n        // If it's already playing don't change it.\n        if ((changes.fileUrl || changes.onlinePlayerUrl) && !this.iframeSrc) {\n            this.play();\n        }\n    }\n\n    /**\n     * Play the H5P.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async play(): Promise<void> {\n        let localUrl: string | undefined;\n        let state: string;\n        this.onlinePlayerUrl = this.onlinePlayerUrl || CoreH5P.h5pPlayer.calculateOnlinePlayerUrl(\n            this.site.getURL(),\n            this.fileUrl || '',\n            this.displayOptions,\n            this.trackComponent,\n        );\n\n        if (this.fileUrl) {\n            state = await CoreFilepool.getFileStateByUrl(this.siteId, this.fileUrl);\n        } else {\n            state = CoreConstants.NOT_DOWNLOADABLE;\n        }\n\n        if (this.siteCanDownload && CoreFileHelper.isStateDownloaded(state)) {\n            // Package is downloaded, use the local URL.\n            localUrl = await this.getLocalUrl();\n        }\n\n        try {\n            if (localUrl) {\n                // Local package.\n                this.iframeSrc = localUrl;\n\n                // Only log analytics event when playing local package, online package already logs it.\n                CoreAnalytics.logEvent({\n                    type: CoreAnalyticsEventType.VIEW_ITEM,\n                    ws: 'core_h5p_get_trusted_h5p_file',\n                    name: 'H5P content',\n                    data: { category: 'h5p' },\n                    url: this.onlinePlayerUrl,\n                });\n            } else {\n                // Never allow downloading in the app. This will only work if the user is allowed to change the params.\n                const src = this.onlinePlayerUrl.replace(\n                    CoreH5PCore.DISPLAY_OPTION_DOWNLOAD + '=1',\n                    CoreH5PCore.DISPLAY_OPTION_DOWNLOAD + '=0',\n                );\n\n                // Add the preventredirect param so the user can authenticate.\n                this.iframeSrc = CoreUrlUtils.addParamsToUrl(src, { preventredirect: false });\n            }\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading H5P package.', true);\n\n        } finally {\n            CoreH5PHelper.addResizerScript();\n            this.onIframeUrlSet.emit({ src: this.iframeSrc!, online: !!localUrl });\n        }\n    }\n\n    /**\n     * Get the local URL of the package.\n     *\n     * @returns Promise resolved with the local URL.\n     */\n    protected async getLocalUrl(): Promise<string | undefined> {\n        const otherOptions = {\n            saveFreq: this.saveFreq,\n            state: this.state,\n        };\n\n        try {\n            const url = await CoreH5P.h5pPlayer.getContentIndexFileUrl(\n                this.fileUrl!,\n                this.displayOptions,\n                this.trackComponent,\n                this.contextId,\n                this.siteId,\n                otherOptions,\n            );\n\n            return url;\n        } catch (error) {\n            // Index file doesn't exist, probably deleted because a lib was updated. Try to create it again.\n            try {\n                const path = await CoreFilepool.getInternalUrlByUrl(this.siteId, this.fileUrl!);\n\n                const file = await CoreFile.getFile(path);\n\n                await CoreH5PHelper.saveH5P(this.fileUrl!, file, this.siteId);\n\n                // File treated. Try to get the index file URL again.\n                const url = await CoreH5P.h5pPlayer.getContentIndexFileUrl(\n                    this.fileUrl!,\n                    this.displayOptions,\n                    this.trackComponent,\n                    this.contextId,\n                    this.siteId,\n                    otherOptions,\n                );\n\n                return url;\n            } catch (error) {\n                // Still failing. Delete the H5P package?\n                this.logger.error('Error loading downloaded index:', error, this.fileUrl);\n            }\n        }\n    }\n\n    /**\n     * H5P iframe has been loaded.\n     */\n    iframeLoaded(): void {\n        this.onIframeLoaded.emit();\n        this.iframeLoadedOnce = true;\n\n        // Send a resize event to the window so H5P package recalculates the size.\n        window.dispatchEvent(new Event('resize'));\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        this.subscription?.unsubscribe();\n    }\n\n}\n","<core-loading [hideUntil]=\"iframeSrc\" [fullscreen]=\"false\">\n    <core-iframe *ngIf=\"iframeSrc\" [src]=\"iframeSrc\" iframeHeight=\"auto\" [allowFullscreen]=\"true\" (loaded)=\"iframeLoaded()\"\n        [showFullscreenOnToolbar]=\"enableInAppFullscreen\" [autoFullscreenOnRotate]=\"enableInAppFullscreen\" />\n    <script *ngIf=\"resizeScript && iframeSrc\" type=\"text/javascript\" [src]=\"resizeScript\"></script>\n</core-loading>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}