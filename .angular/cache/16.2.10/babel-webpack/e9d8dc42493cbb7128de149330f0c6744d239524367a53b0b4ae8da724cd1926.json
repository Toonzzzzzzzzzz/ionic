{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { Md5 } from 'ts-md5';\nimport { CoreSitePlugins } from '@features/siteplugins/services/siteplugins';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\nimport { CorePromisedValue } from '@classes/promised-value';\n/**\n * Handler to display a site plugin in course options.\n */\nexport class CoreSitePluginsCourseOptionHandler extends CoreSitePluginsBaseHandler {\n  constructor(name, title, plugin, handlerSchema, initResult) {\n    super(name);\n    this.title = title;\n    this.plugin = plugin;\n    this.handlerSchema = handlerSchema;\n    this.initResult = initResult;\n    this.priority = handlerSchema.priority || 0;\n    this.isMenuHandler = !!handlerSchema.ismenuhandler;\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForCourse(courseId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      var _this$initResult;\n      // Wait for \"init\" result to be updated.\n      if (_this.updatingDefer) {\n        yield _this.updatingDefer;\n      }\n      return CoreSitePlugins.isHandlerEnabledForCourse(courseId, _this.handlerSchema.restricttoenrolledcourses, (_this$initResult = _this.initResult) === null || _this$initResult === void 0 ? void 0 : _this$initResult.restrict);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData() {\n    var _this$handlerSchema$d;\n    return {\n      title: this.title,\n      class: (_this$handlerSchema$d = this.handlerSchema.displaydata) === null || _this$handlerSchema$d === void 0 ? void 0 : _this$handlerSchema$d.class,\n      page: `siteplugins/${this.name}`,\n      pageParams: {}\n    };\n  }\n  /**\n   * @inheritdoc\n   */\n  getMenuDisplayData(course) {\n    var _this$handlerSchema$d2, _this$handlerSchema$d3;\n    const args = {\n      courseid: course.id\n    };\n    const hash = Md5.hashAsciiStr(JSON.stringify(args));\n    return {\n      title: this.title,\n      class: (_this$handlerSchema$d2 = this.handlerSchema.displaydata) === null || _this$handlerSchema$d2 === void 0 ? void 0 : _this$handlerSchema$d2.class,\n      icon: ((_this$handlerSchema$d3 = this.handlerSchema.displaydata) === null || _this$handlerSchema$d3 === void 0 ? void 0 : _this$handlerSchema$d3.icon) || '',\n      page: `siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${hash}`,\n      pageParams: {\n        title: this.title,\n        args,\n        initResult: this.initResult,\n        ptrEnabled: this.handlerSchema.ptrenabled\n      }\n    };\n  }\n  /**\n   * @inheritdoc\n   */\n  prefetch(course) {\n    const args = {\n      courseid: course.id\n    };\n    const component = this.plugin.component;\n    return CoreSitePlugins.prefetchFunctions(component, args, this.handlerSchema, course.id, undefined, true);\n  }\n  /**\n   * Set init result.\n   *\n   * @param result Result to set.\n   */\n  setInitResult(result) {\n    var _this$updatingDefer;\n    this.initResult = result;\n    (_this$updatingDefer = this.updatingDefer) === null || _this$updatingDefer === void 0 || _this$updatingDefer.resolve();\n    delete this.updatingDefer;\n  }\n  /**\n   * Mark init being updated.\n   */\n  updatingInit() {\n    this.updatingDefer = new CorePromisedValue();\n  }\n}","map":{"version":3,"names":["Md5","CoreSitePlugins","CoreSitePluginsBaseHandler","CorePromisedValue","CoreSitePluginsCourseOptionHandler","constructor","name","title","plugin","handlerSchema","initResult","priority","isMenuHandler","ismenuhandler","isEnabledForCourse","courseId","_this","_asyncToGenerator","_this$initResult","updatingDefer","isHandlerEnabledForCourse","restricttoenrolledcourses","restrict","getDisplayData","_this$handlerSchema$d","class","displaydata","page","pageParams","getMenuDisplayData","course","_this$handlerSchema$d2","_this$handlerSchema$d3","args","courseid","id","hash","hashAsciiStr","JSON","stringify","icon","component","method","ptrEnabled","ptrenabled","prefetch","prefetchFunctions","undefined","setInitResult","result","_this$updatingDefer","resolve","updatingInit"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/siteplugins/classes/handlers/course-option-handler.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Md5 } from 'ts-md5';\n\nimport {\n    CoreCourseOptionsHandler,\n    CoreCourseOptionsHandlerData,\n    CoreCourseOptionsMenuHandlerData,\n} from '@features/course/services/course-options-delegate';\nimport { CoreCourseAnyCourseData, CoreCourseAnyCourseDataWithOptions } from '@features/courses/services/courses';\nimport {\n    CoreSitePlugins,\n    CoreSitePluginsContent,\n    CoreSitePluginsCourseOptionHandlerData,\n    CoreSitePluginsPlugin,\n} from '@features/siteplugins/services/siteplugins';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\nimport { CorePromisedValue } from '@classes/promised-value';\n\n/**\n * Handler to display a site plugin in course options.\n */\nexport class CoreSitePluginsCourseOptionHandler extends CoreSitePluginsBaseHandler implements CoreCourseOptionsHandler {\n\n    priority: number;\n    isMenuHandler: boolean;\n\n    protected updatingDefer?: CorePromisedValue<void>;\n\n    constructor(\n        name: string,\n        protected title: string,\n        protected plugin: CoreSitePluginsPlugin,\n        protected handlerSchema: CoreSitePluginsCourseOptionHandlerData,\n        protected initResult: CoreSitePluginsContent | null,\n    ) {\n        super(name);\n\n        this.priority = handlerSchema.priority || 0;\n        this.isMenuHandler = !!handlerSchema.ismenuhandler;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForCourse(courseId: number): Promise<boolean> {\n        // Wait for \"init\" result to be updated.\n        if (this.updatingDefer) {\n            await this.updatingDefer;\n        }\n\n        return CoreSitePlugins.isHandlerEnabledForCourse(\n            courseId,\n            this.handlerSchema.restricttoenrolledcourses,\n            this.initResult?.restrict,\n        );\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getDisplayData(): CoreCourseOptionsHandlerData {\n        return {\n            title: this.title,\n            class: this.handlerSchema.displaydata?.class,\n            page: `siteplugins/${this.name}`,\n            pageParams: {},\n        };\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getMenuDisplayData(course: CoreCourseAnyCourseDataWithOptions): CoreCourseOptionsMenuHandlerData {\n        const args = {\n            courseid: course.id,\n        };\n        const hash = <string> Md5.hashAsciiStr(JSON.stringify(args));\n\n        return {\n            title: this.title,\n            class: this.handlerSchema.displaydata?.class,\n            icon: this.handlerSchema.displaydata?.icon || '',\n            page: `siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${hash}`,\n            pageParams: {\n                title: this.title,\n                args,\n                initResult: this.initResult,\n                ptrEnabled: this.handlerSchema.ptrenabled,\n            },\n        };\n    }\n\n    /**\n     * @inheritdoc\n     */\n    prefetch(course: CoreCourseAnyCourseData): Promise<void> {\n        const args = {\n            courseid: course.id,\n        };\n        const component = this.plugin.component;\n\n        return CoreSitePlugins.prefetchFunctions(component, args, this.handlerSchema, course.id, undefined, true);\n    }\n\n    /**\n     * Set init result.\n     *\n     * @param result Result to set.\n     */\n    setInitResult(result: CoreSitePluginsContent | null): void {\n        this.initResult = result;\n\n        this.updatingDefer?.resolve();\n        delete this.updatingDefer;\n    }\n\n    /**\n     * Mark init being updated.\n     */\n    updatingInit(): void {\n        this.updatingDefer = new CorePromisedValue();\n    }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}