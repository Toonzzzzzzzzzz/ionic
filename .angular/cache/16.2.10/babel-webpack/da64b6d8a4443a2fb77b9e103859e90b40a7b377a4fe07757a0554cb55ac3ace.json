{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate } from '@singletons';\nimport { CoreSitePluginsCallWSBaseDirective } from './call-ws-directive';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../components/plugin-content/plugin-content\";\n/**\n * Base class for directives to call a WS when the element is clicked.\n *\n * The directives that inherit from this class will call a WS method when the element is clicked.\n */\nexport class CoreSitePluginsCallWSOnClickBaseDirective extends CoreSitePluginsCallWSBaseDirective {\n  constructor(element, parentContent) {\n    super(element, parentContent);\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this = this;\n    super.ngOnInit();\n    this.element.addEventListener('click', /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (ev) {\n        ev.preventDefault();\n        ev.stopPropagation();\n        if (_this.confirmMessage !== undefined) {\n          // Ask for confirm.\n          try {\n            yield CoreDomUtils.showConfirm(_this.confirmMessage || Translate.instant('core.areyousure'));\n          } catch (_unused) {\n            // User cancelled, stop.\n            return;\n          }\n        }\n        _this.callWS();\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n  /**\n   * @inheritdoc\n   */\n  callWS() {\n    var _superprop_getCallWS = () => super.callWS,\n      _this2 = this;\n    return _asyncToGenerator(function* () {\n      const modal = yield CoreDomUtils.showModalLoading();\n      try {\n        yield _superprop_getCallWS().call(_this2);\n      } catch (error) {\n        if (_this2.showError === undefined || CoreUtils.isTrueOrOne(_this2.showError)) {\n          var _CoreTextUtils$getErr;\n          CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.serverconnection', {\n            details: (_CoreTextUtils$getErr = CoreTextUtils.getErrorMessageFromError(error)) !== null && _CoreTextUtils$getErr !== void 0 ? _CoreTextUtils$getErr : 'Unknown error'\n          }));\n        }\n      } finally {\n        modal.dismiss();\n      }\n    })();\n  }\n}\n_class = CoreSitePluginsCallWSOnClickBaseDirective;\n_class.ɵfac = function CoreSitePluginsCallWSOnClickBaseDirective_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.CoreSitePluginsPluginContentComponent));\n};\n_class.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n  type: _class,\n  inputs: {\n    confirmMessage: \"confirmMessage\",\n    showError: \"showError\"\n  },\n  features: [i0.ɵɵInheritDefinitionFeature]\n});","map":{"version":3,"names":["CoreDomUtils","CoreTextUtils","CoreUtils","Translate","CoreSitePluginsCallWSBaseDirective","CoreSitePluginsCallWSOnClickBaseDirective","constructor","element","parentContent","ngOnInit","_this","addEventListener","_ref","_asyncToGenerator","ev","preventDefault","stopPropagation","confirmMessage","undefined","showConfirm","instant","_unused","callWS","_x","apply","arguments","_superprop_getCallWS","_this2","modal","showModalLoading","call","error","showError","isTrueOrOne","_CoreTextUtils$getErr","showErrorModalDefault","details","getErrorMessageFromError","dismiss","i0","ɵɵdirectiveInject","ElementRef","i1","CoreSitePluginsPluginContentComponent","inputs","features","ɵɵInheritDefinitionFeature"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/siteplugins/classes/call-ws-click-directive.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Input, OnInit, ElementRef, Directive } from '@angular/core';\n\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate } from '@singletons';\nimport { CoreSitePluginsPluginContentComponent } from '../components/plugin-content/plugin-content';\nimport { CoreSitePluginsCallWSBaseDirective } from './call-ws-directive';\n\n/**\n * Base class for directives to call a WS when the element is clicked.\n *\n * The directives that inherit from this class will call a WS method when the element is clicked.\n */\n@Directive()\nexport class CoreSitePluginsCallWSOnClickBaseDirective extends CoreSitePluginsCallWSBaseDirective implements OnInit {\n\n    @Input() confirmMessage?: string; // Message to confirm the action. If not supplied, no confirmation. If empty, default message.\n    @Input() showError?: boolean | string; // Whether to show an error message if the WS call fails. Defaults to true.\n\n    constructor(\n        element: ElementRef,\n        parentContent: CoreSitePluginsPluginContentComponent | null,\n    ) {\n        super(element, parentContent);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        super.ngOnInit();\n\n        this.element.addEventListener('click', async (ev: Event) => {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            if (this.confirmMessage !== undefined) {\n                // Ask for confirm.\n                try {\n                    await CoreDomUtils.showConfirm(this.confirmMessage || Translate.instant('core.areyousure'));\n                } catch {\n                    // User cancelled, stop.\n                    return;\n                }\n            }\n\n            this.callWS();\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async callWS(): Promise<void> {\n        const modal = await CoreDomUtils.showModalLoading();\n\n        try {\n            await super.callWS();\n        } catch (error) {\n            if (this.showError === undefined || CoreUtils.isTrueOrOne(this.showError)) {\n                CoreDomUtils.showErrorModalDefault(\n                    error,\n                    Translate.instant('core.serverconnection', {\n                        details: CoreTextUtils.getErrorMessageFromError(error) ?? 'Unknown error',\n                    }),\n                );\n            }\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n}\n"],"mappings":";;AAgBA,SAASA,YAAY,QAAQ,qBAAqB;AAClD,SAASC,aAAa,QAAQ,sBAAsB;AACpD,SAASC,SAAS,QAAQ,uBAAuB;AACjD,SAASC,SAAS,QAAQ,aAAa;AAEvC,SAASC,kCAAkC,QAAQ,qBAAqB;;;AAExE;;;;;AAMA,OAAM,MAAOC,yCAA0C,SAAQD,kCAAkC;EAK7FE,YACIC,OAAmB,EACnBC,aAA2D;IAE3D,KAAK,CAACD,OAAO,EAAEC,aAAa,CAAC;EACjC;EAEA;;;EAGAC,QAAQA,CAAA;IAAA,IAAAC,KAAA;IACJ,KAAK,CAACD,QAAQ,EAAE;IAEhB,IAAI,CAACF,OAAO,CAACI,gBAAgB,CAAC,OAAO;MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAE,WAAOC,EAAS,EAAI;QACvDA,EAAE,CAACC,cAAc,EAAE;QACnBD,EAAE,CAACE,eAAe,EAAE;QAEpB,IAAIN,KAAI,CAACO,cAAc,KAAKC,SAAS,EAAE;UACnC;UACA,IAAI;YACA,MAAMlB,YAAY,CAACmB,WAAW,CAACT,KAAI,CAACO,cAAc,IAAId,SAAS,CAACiB,OAAO,CAAC,iBAAiB,CAAC,CAAC;WAC9F,CAAC,OAAAC,OAAA,EAAM;YACJ;YACA;;;QAIRX,KAAI,CAACY,MAAM,EAAE;MACjB,CAAC;MAAA,iBAAAC,EAAA;QAAA,OAAAX,IAAA,CAAAY,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;EACN;EAEA;;;EAGgBH,MAAMA,CAAA;IAAA,IAAAI,oBAAA,GAAAA,CAAA,WAAAJ,MAAA;MAAAK,MAAA;IAAA,OAAAd,iBAAA;MAClB,MAAMe,KAAK,SAAS5B,YAAY,CAAC6B,gBAAgB,EAAE;MAEnD,IAAI;QACA,MAAMH,oBAAA,GAAAI,IAAA,CAAAH,MAAY,CAAE;OACvB,CAAC,OAAOI,KAAK,EAAE;QACZ,IAAIJ,MAAI,CAACK,SAAS,KAAKd,SAAS,IAAIhB,SAAS,CAAC+B,WAAW,CAACN,MAAI,CAACK,SAAS,CAAC,EAAE;UAAA,IAAAE,qBAAA;UACvElC,YAAY,CAACmC,qBAAqB,CAC9BJ,KAAK,EACL5B,SAAS,CAACiB,OAAO,CAAC,uBAAuB,EAAE;YACvCgB,OAAO,GAAAF,qBAAA,GAAEjC,aAAa,CAACoC,wBAAwB,CAACN,KAAK,CAAC,cAAAG,qBAAA,cAAAA,qBAAA,GAAI;WAC7D,CAAC,CACL;;OAER,SAAS;QACNN,KAAK,CAACU,OAAO,EAAE;;IAClB;EACL;;SAxDSjC,yCAA0C;;mBAA1CA,MAAyC,EAAAkC,EAAA,CAAAC,iBAAA,CAAAD,EAAA,CAAAE,UAAA,GAAAF,EAAA,CAAAC,iBAAA,CAAAE,EAAA,CAAAC,qCAAA;AAAA;;QAAzCtC,MAAyC;EAAAuC,MAAA;IAAA3B,cAAA;IAAAe,SAAA;EAAA;EAAAa,QAAA,GAAAN,EAAA,CAAAO,0BAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}