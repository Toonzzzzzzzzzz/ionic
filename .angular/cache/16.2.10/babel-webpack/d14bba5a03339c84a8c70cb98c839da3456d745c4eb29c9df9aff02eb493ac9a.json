{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreRemindersService, CoreReminders } from '@features/reminders/services/reminders';\nimport { CoreConfig } from '@services/config';\nimport { CoreUtils } from '@services/utils/utils';\n/**\n * Database variables for AddonCalendarProvider service.\n */\nexport const EVENTS_TABLE = 'addon_calendar_events_3';\nexport const CALENDAR_SITE_SCHEMA = {\n  name: 'AddonCalendarProvider',\n  version: 5,\n  canBeCleared: [EVENTS_TABLE],\n  tables: [{\n    name: EVENTS_TABLE,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true\n    }, {\n      name: 'name',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'description',\n      type: 'TEXT'\n    }, {\n      name: 'eventtype',\n      type: 'TEXT'\n    }, {\n      name: 'courseid',\n      type: 'INTEGER'\n    }, {\n      name: 'timestart',\n      type: 'INTEGER'\n    }, {\n      name: 'timeduration',\n      type: 'INTEGER'\n    }, {\n      name: 'categoryid',\n      type: 'INTEGER'\n    }, {\n      name: 'groupid',\n      type: 'INTEGER'\n    }, {\n      name: 'userid',\n      type: 'INTEGER'\n    }, {\n      name: 'instance',\n      type: 'INTEGER'\n    }, {\n      name: 'modulename',\n      type: 'TEXT'\n    }, {\n      name: 'timemodified',\n      type: 'INTEGER'\n    }, {\n      name: 'repeatid',\n      type: 'INTEGER'\n    }, {\n      name: 'visible',\n      type: 'INTEGER'\n    }, {\n      name: 'uuid',\n      type: 'TEXT'\n    }, {\n      name: 'sequence',\n      type: 'INTEGER'\n    }, {\n      name: 'subscriptionid',\n      type: 'INTEGER'\n    }, {\n      name: 'location',\n      type: 'TEXT'\n    }, {\n      name: 'eventcount',\n      type: 'INTEGER'\n    }, {\n      name: 'timesort',\n      type: 'INTEGER'\n    }, {\n      name: 'category',\n      type: 'TEXT'\n    }, {\n      name: 'course',\n      type: 'TEXT'\n    }, {\n      name: 'subscription',\n      type: 'TEXT'\n    }, {\n      name: 'canedit',\n      type: 'INTEGER'\n    }, {\n      name: 'candelete',\n      type: 'INTEGER'\n    }, {\n      name: 'deleteurl',\n      type: 'TEXT'\n    }, {\n      name: 'editurl',\n      type: 'TEXT'\n    }, {\n      name: 'viewurl',\n      type: 'TEXT'\n    }, {\n      name: 'isactionevent',\n      type: 'INTEGER'\n    }, {\n      name: 'url',\n      type: 'TEXT'\n    }, {\n      name: 'islastday',\n      type: 'INTEGER'\n    }, {\n      name: 'popupname',\n      type: 'TEXT'\n    }, {\n      name: 'mindaytimestamp',\n      type: 'INTEGER'\n    }, {\n      name: 'maxdaytimestamp',\n      type: 'INTEGER'\n    }, {\n      name: 'draggable',\n      type: 'INTEGER'\n    }]\n  }],\n  migrate(db, oldVersion, siteId) {\n    return _asyncToGenerator(function* () {\n      if (oldVersion < 5) {\n        yield migrateDefaultTime(siteId, oldVersion < 4);\n      }\n    })();\n  }\n};\n/**\n * Migrate default notification time if it was changed.\n * Don't use getDefaultNotificationTime to be able to detect if the value was changed or not.\n *\n * @param siteId Site ID to migrate.\n * @param convertToSeconds If true, time will be converted to seconds.\n */\nconst migrateDefaultTime = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (siteId, convertToSeconds = false) {\n    const key = 'mmaCalendarDefaultNotifTime#' + siteId;\n    try {\n      let defaultTime = yield CoreConfig.get(key);\n      yield CoreUtils.ignoreErrors(CoreConfig.delete(key));\n      if (defaultTime <= 0) {\n        defaultTime = CoreRemindersService.DISABLED;\n      } else if (convertToSeconds) {\n        // Convert from minutes to seconds.\n        defaultTime = defaultTime * 60;\n      }\n      CoreReminders.setDefaultNotificationTime(defaultTime, siteId);\n    } catch (_unused) {\n      // Ignore errors, already migrated.\n    }\n  });\n  return function migrateDefaultTime(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["CoreRemindersService","CoreReminders","CoreConfig","CoreUtils","EVENTS_TABLE","CALENDAR_SITE_SCHEMA","name","version","canBeCleared","tables","columns","type","primaryKey","notNull","migrate","db","oldVersion","siteId","_asyncToGenerator","migrateDefaultTime","_ref","convertToSeconds","key","defaultTime","get","ignoreErrors","delete","DISABLED","setDefaultNotificationTime","_unused","_x","apply","arguments"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/calendar/services/database/calendar.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { SQLiteDB } from '@classes/sqlitedb';\nimport { CoreRemindersService, CoreReminders } from '@features/reminders/services/reminders';\nimport { CoreConfig } from '@services/config';\nimport { CoreSiteSchema } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { AddonCalendarEventType } from '../calendar';\n\n/**\n * Database variables for AddonCalendarProvider service.\n */\nexport const EVENTS_TABLE = 'addon_calendar_events_3';\nexport const CALENDAR_SITE_SCHEMA: CoreSiteSchema = {\n    name: 'AddonCalendarProvider',\n    version: 5,\n    canBeCleared: [EVENTS_TABLE],\n    tables: [\n        {\n            name: EVENTS_TABLE,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                },\n                {\n                    name: 'name',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'description',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'eventtype',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'courseid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'timestart',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'timeduration',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'categoryid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'groupid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'userid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'instance',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'modulename',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'timemodified',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'repeatid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'visible',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'uuid',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'sequence',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'subscriptionid',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'location',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'eventcount',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'timesort',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'category',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'course',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'subscription',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'canedit',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'candelete',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'deleteurl',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'editurl',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'viewurl',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'isactionevent',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'url',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'islastday',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'popupname',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'mindaytimestamp',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'maxdaytimestamp',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'draggable',\n                    type: 'INTEGER',\n                },\n            ],\n        },\n    ],\n    async migrate(db: SQLiteDB, oldVersion: number, siteId: string): Promise<void> {\n        if (oldVersion < 5) {\n            await migrateDefaultTime(siteId, oldVersion < 4);\n        }\n    },\n};\n\n/**\n * Migrate default notification time if it was changed.\n * Don't use getDefaultNotificationTime to be able to detect if the value was changed or not.\n *\n * @param siteId Site ID to migrate.\n * @param convertToSeconds If true, time will be converted to seconds.\n */\nconst migrateDefaultTime = async (siteId: string, convertToSeconds = false): Promise<void> => {\n\n    const key = 'mmaCalendarDefaultNotifTime#' + siteId;\n    try {\n        let defaultTime = await CoreConfig.get<number>(key);\n        await CoreUtils.ignoreErrors(CoreConfig.delete(key));\n\n        if (defaultTime <= 0) {\n            defaultTime = CoreRemindersService.DISABLED;\n        } else if (convertToSeconds) {\n            // Convert from minutes to seconds.\n            defaultTime = defaultTime * 60;\n        }\n\n        CoreReminders.setDefaultNotificationTime(defaultTime, siteId);\n    } catch {\n        // Ignore errors, already migrated.\n    }\n};\n\nexport type AddonCalendarEventDBRecord = {\n    id: number;\n    name: string;\n    description: string;\n    eventtype: AddonCalendarEventType | string;\n    timestart: number;\n    timeduration: number;\n    categoryid?: number;\n    groupid?: number;\n    userid?: number;\n    instance?: number;\n    modulename?: string;\n    timemodified: number;\n    repeatid?: number;\n    visible: number;\n    // Following properties are only available on AddonCalendarGetEventsEvent\n    courseid?: number;\n    uuid?: string;\n    sequence?: number;\n    subscriptionid?: number;\n    // Following properties are only available on AddonCalendarCalendarEvent\n    location?: string;\n    eventcount?: number;\n    timesort?: number;\n    category?: string;\n    course?: string;\n    subscription?: string;\n    canedit?: number;\n    candelete?: number;\n    deleteurl?: string;\n    editurl?: string;\n    viewurl?: string;\n    isactionevent?: number;\n    url?: string;\n    islastday?: number;\n    popupname?: string;\n    mindaytimestamp?: number;\n    maxdaytimestamp?: number;\n    draggable?: number;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}