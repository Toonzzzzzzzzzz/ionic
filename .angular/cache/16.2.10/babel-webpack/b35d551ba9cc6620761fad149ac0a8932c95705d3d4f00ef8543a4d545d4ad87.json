{"ast":null,"code":"var _class;\nimport { CoreFilterDefaultHandler } from '@features/filter/services/handlers/default-filter';\nimport { makeSingleton } from '@singletons';\nimport { CoreH5PPlayerComponent } from '@features/h5p/components/h5p-player/h5p-player';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreH5PHelper } from '@features/h5p/classes/helper';\nimport * as i0 from \"@angular/core\";\n/**\n * Handler to support the Display H5P filter.\n */\nexport class AddonFilterDisplayH5PHandlerService extends CoreFilterDefaultHandler {\n  constructor() {\n    super(...arguments);\n    this.name = 'AddonFilterDisplayH5PHandler';\n    this.filterName = 'displayh5p';\n    this.template = document.createElement('template'); // A template element to convert HTML to element.\n  }\n  /**\n   * @inheritdoc\n   */\n  filter(text) {\n    this.template.innerHTML = text;\n    const h5pIframes = Array.from(this.template.content.querySelectorAll('iframe.h5p-iframe'));\n    // Replace all iframes with an empty div that will be treated in handleHtml.\n    h5pIframes.forEach(iframe => {\n      var _iframe$parentElement;\n      const placeholder = document.createElement('div');\n      placeholder.classList.add('core-h5p-tmp-placeholder');\n      placeholder.setAttribute('data-player-src', iframe.src);\n      (_iframe$parentElement = iframe.parentElement) === null || _iframe$parentElement === void 0 || _iframe$parentElement.replaceChild(placeholder, iframe);\n    });\n    // Handle H5P iframes embedded using the embed HTML code.\n    const embeddedH5PIframes = Array.from(this.template.content.querySelectorAll('iframe.h5p-player'));\n    embeddedH5PIframes.forEach(iframe => {\n      // Add the preventredirect param to allow authenticating if auto-login fails.\n      iframe.src = CoreUrlUtils.addParamsToUrl(iframe.src, {\n        preventredirect: false\n      });\n      // Add resizer script so the H5P has the right height.\n      CoreH5PHelper.addResizerScript();\n      // If the iframe has a small height, add some minimum initial height so it's seen if auto-login fails.\n      const styleHeight = Number(iframe.style.height);\n      const height = Number(iframe.getAttribute('height'));\n      if ((!height || height < 400) && (!styleHeight || styleHeight < 400)) {\n        iframe.style.height = '400px';\n      }\n    });\n    return this.template.innerHTML;\n  }\n  /**\n   * @inheritdoc\n   */\n  handleHtml(container, filter, options, viewContainerRef, component, componentId) {\n    const placeholders = Array.from(container.querySelectorAll('div.core-h5p-tmp-placeholder'));\n    placeholders.forEach(placeholder => {\n      var _placeholder$parentEl;\n      const url = placeholder.getAttribute('data-player-src') || '';\n      // Create the component to display the player.\n      const componentRef = viewContainerRef.createComponent(CoreH5PPlayerComponent);\n      componentRef.instance.src = url;\n      componentRef.instance.component = component;\n      componentRef.instance.componentId = componentId;\n      // Move the component to its right position.\n      (_placeholder$parentEl = placeholder.parentElement) === null || _placeholder$parentEl === void 0 || _placeholder$parentEl.replaceChild(componentRef.instance.elementRef.nativeElement, placeholder);\n    });\n  }\n}\n_class = AddonFilterDisplayH5PHandlerService;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonFilterDisplayH5PHandlerService_BaseFactory;\n  return function AddonFilterDisplayH5PHandlerService_Factory(t) {\n    return (ɵAddonFilterDisplayH5PHandlerService_BaseFactory || (ɵAddonFilterDisplayH5PHandlerService_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonFilterDisplayH5PHandler = makeSingleton(AddonFilterDisplayH5PHandlerService);","map":{"version":3,"names":["CoreFilterDefaultHandler","makeSingleton","CoreH5PPlayerComponent","CoreUrlUtils","CoreH5PHelper","AddonFilterDisplayH5PHandlerService","constructor","name","filterName","template","document","createElement","filter","text","innerHTML","h5pIframes","Array","from","content","querySelectorAll","forEach","iframe","_iframe$parentElement","placeholder","classList","add","setAttribute","src","parentElement","replaceChild","embeddedH5PIframes","addParamsToUrl","preventredirect","addResizerScript","styleHeight","Number","style","height","getAttribute","handleHtml","container","options","viewContainerRef","component","componentId","placeholders","_placeholder$parentEl","url","componentRef","createComponent","instance","elementRef","nativeElement","t","factory","ɵfac","providedIn","AddonFilterDisplayH5PHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/filter/displayh5p/services/handlers/displayh5p.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Injectable, ViewContainerRef } from '@angular/core';\n\nimport { CoreFilterDefaultHandler } from '@features/filter/services/handlers/default-filter';\nimport { CoreFilterFilter, CoreFilterFormatTextOptions } from '@features/filter/services/filter';\nimport { makeSingleton } from '@singletons';\nimport { CoreH5PPlayerComponent } from '@features/h5p/components/h5p-player/h5p-player';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreH5PHelper } from '@features/h5p/classes/helper';\n\n/**\n * Handler to support the Display H5P filter.\n */\n@Injectable({ providedIn: 'root' })\nexport class AddonFilterDisplayH5PHandlerService extends CoreFilterDefaultHandler {\n\n    name = 'AddonFilterDisplayH5PHandler';\n    filterName = 'displayh5p';\n\n    protected template = document.createElement('template'); // A template element to convert HTML to element.\n\n    /**\n     * @inheritdoc\n     */\n    filter(\n        text: string,\n    ): string | Promise<string> {\n        this.template.innerHTML = text;\n\n        const h5pIframes = <HTMLIFrameElement[]> Array.from(this.template.content.querySelectorAll('iframe.h5p-iframe'));\n\n        // Replace all iframes with an empty div that will be treated in handleHtml.\n        h5pIframes.forEach((iframe) => {\n            const placeholder = document.createElement('div');\n\n            placeholder.classList.add('core-h5p-tmp-placeholder');\n            placeholder.setAttribute('data-player-src', iframe.src);\n\n            iframe.parentElement?.replaceChild(placeholder, iframe);\n        });\n\n        // Handle H5P iframes embedded using the embed HTML code.\n        const embeddedH5PIframes = <HTMLIFrameElement[]> Array.from(this.template.content.querySelectorAll('iframe.h5p-player'));\n\n        embeddedH5PIframes.forEach((iframe) => {\n            // Add the preventredirect param to allow authenticating if auto-login fails.\n            iframe.src = CoreUrlUtils.addParamsToUrl(iframe.src, { preventredirect: false });\n\n            // Add resizer script so the H5P has the right height.\n            CoreH5PHelper.addResizerScript();\n\n            // If the iframe has a small height, add some minimum initial height so it's seen if auto-login fails.\n            const styleHeight = Number(iframe.style.height);\n            const height = Number(iframe.getAttribute('height'));\n            if ((!height || height < 400) && (!styleHeight || styleHeight < 400)) {\n                iframe.style.height = '400px';\n            }\n        });\n\n        return this.template.innerHTML;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    handleHtml(\n        container: HTMLElement,\n        filter: CoreFilterFilter,\n        options: CoreFilterFormatTextOptions,\n        viewContainerRef: ViewContainerRef,\n        component?: string,\n        componentId?: string | number,\n    ): void | Promise<void> {\n\n        const placeholders = <HTMLElement[]> Array.from(container.querySelectorAll('div.core-h5p-tmp-placeholder'));\n\n        placeholders.forEach((placeholder) => {\n            const url = placeholder.getAttribute('data-player-src') || '';\n\n            // Create the component to display the player.\n            const componentRef = viewContainerRef.createComponent<CoreH5PPlayerComponent>(CoreH5PPlayerComponent);\n\n            componentRef.instance.src = url;\n            componentRef.instance.component = component;\n            componentRef.instance.componentId = componentId;\n\n            // Move the component to its right position.\n            placeholder.parentElement?.replaceChild(componentRef.instance.elementRef.nativeElement, placeholder);\n        });\n    }\n\n}\n\nexport const AddonFilterDisplayH5PHandler = makeSingleton(AddonFilterDisplayH5PHandlerService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}