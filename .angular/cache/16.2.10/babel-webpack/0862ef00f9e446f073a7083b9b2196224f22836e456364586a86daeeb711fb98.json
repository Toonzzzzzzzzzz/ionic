{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { Translate, makeSingleton } from '@singletons';\nimport { AddonModWorkshopAssessmentStrategyNumErrorsComponent } from '../component/numerrors';\nimport { AddonModWorkshopAssessmentStrategyNumErrorsHandlerService } from './handler';\nimport * as i0 from \"@angular/core\";\n/**\n * Handler for numerrors assessment strategy plugin.\n */\nexport class AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService extends AddonModWorkshopAssessmentStrategyNumErrorsHandlerService {\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return _asyncToGenerator(function* () {\n      return true;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getComponent() {\n    return AddonModWorkshopAssessmentStrategyNumErrorsComponent;\n  }\n  /**\n   * @inheritdoc\n   */\n  getOriginalValues(form) {\n    return _asyncToGenerator(function* () {\n      const originalValues = [];\n      form.fields.forEach((field, n) => {\n        field.dimtitle = Translate.instant('addon.mod_workshop_assessment_numerrors.dimensionnumber', {\n          $a: field.number\n        });\n        if (!form.current[n]) {\n          form.current[n] = {};\n        }\n        originalValues[n] = {};\n        originalValues[n].peercomment = form.current[n].peercomment || '';\n        originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n        originalValues[n].grade = form.current[n].grade || '';\n      });\n      return originalValues;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  hasDataChanged(originalValues, currentValues) {\n    for (const x in originalValues) {\n      if (originalValues[x].grade != currentValues[x].grade) {\n        return true;\n      }\n      if (originalValues[x].peercomment != currentValues[x].peercomment) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * @inheritdoc\n   */\n  prepareAssessmentData(currentValues, form) {\n    return _asyncToGenerator(function* () {\n      const data = {};\n      const errors = {};\n      let hasErrors = false;\n      form.fields.forEach((field, idx) => {\n        if (idx < form.dimenssionscount) {\n          var _currentValues$idx$pe;\n          const grade = parseInt(String(currentValues[idx].grade), 10);\n          if (!isNaN(grade) && (grade == 1 || grade == -1)) {\n            data['grade__idx_' + idx] = grade;\n          } else {\n            errors['grade_' + idx] = Translate.instant('core.required');\n            hasErrors = true;\n          }\n          data['peercomment__idx_' + idx] = (_currentValues$idx$pe = currentValues[idx].peercomment) !== null && _currentValues$idx$pe !== void 0 ? _currentValues$idx$pe : '';\n          data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n          data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n          data['weight__idx_' + idx] = parseInt(field.weight, 10) || 0;\n        }\n      });\n      if (hasErrors) {\n        throw errors;\n      }\n      return data;\n    })();\n  }\n}\n_class = AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService_BaseFactory;\n  return function AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService_Factory(t) {\n    return (ɵAddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService_BaseFactory || (ɵAddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonModWorkshopAssessmentStrategyNumErrorsHandler = makeSingleton(AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService);","map":{"version":3,"names":["Translate","makeSingleton","AddonModWorkshopAssessmentStrategyNumErrorsComponent","AddonModWorkshopAssessmentStrategyNumErrorsHandlerService","AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService","isEnabled","_asyncToGenerator","getComponent","getOriginalValues","form","originalValues","fields","forEach","field","n","dimtitle","instant","$a","number","current","peercomment","grade","hasDataChanged","currentValues","x","prepareAssessmentData","data","errors","hasErrors","idx","dimenssionscount","_currentValues$idx$pe","parseInt","String","isNaN","gradeid","dimensionid","weight","t","factory","ɵfac","providedIn","AddonModWorkshopAssessmentStrategyNumErrorsHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/workshop/assessment/numerrors/services/handler-lazy.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n    AddonModWorkshopAssessmentStrategyFieldErrors,\n} from '@addons/mod/workshop/components/assessment-strategy/assessment-strategy';\nimport { AddonWorkshopAssessmentStrategyHandler } from '@addons/mod/workshop/services/assessment-strategy-delegate';\nimport {\n    AddonModWorkshopGetAssessmentFormDefinitionData,\n    AddonModWorkshopGetAssessmentFormFieldsParsedData,\n} from '@addons/mod/workshop/services/workshop';\nimport { Injectable, Type } from '@angular/core';\nimport { Translate, makeSingleton } from '@singletons';\nimport { CoreFormFields } from '@singletons/form';\nimport { AddonModWorkshopAssessmentStrategyNumErrorsComponent } from '../component/numerrors';\nimport { AddonModWorkshopAssessmentStrategyNumErrorsHandlerService } from './handler';\n\n/**\n * Handler for numerrors assessment strategy plugin.\n */\n@Injectable({ providedIn: 'root' })\nexport class AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService\n    extends AddonModWorkshopAssessmentStrategyNumErrorsHandlerService\n    implements AddonWorkshopAssessmentStrategyHandler {\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabled(): Promise<boolean> {\n        return true;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getComponent(): Type<unknown> {\n        return AddonModWorkshopAssessmentStrategyNumErrorsComponent;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getOriginalValues(\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<AddonModWorkshopGetAssessmentFormFieldsParsedData[]> {\n        const originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[] = [];\n\n        form.fields.forEach((field, n) => {\n            field.dimtitle = Translate.instant('addon.mod_workshop_assessment_numerrors.dimensionnumber', { $a: field.number });\n\n            if (!form.current[n]) {\n                form.current[n] = {};\n            }\n\n            originalValues[n] = {};\n            originalValues[n].peercomment = form.current[n].peercomment || '';\n            originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n            originalValues[n].grade = form.current[n].grade || '';\n        });\n\n        return originalValues;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    hasDataChanged(\n        originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n    ): boolean {\n        for (const x in originalValues) {\n            if (originalValues[x].grade != currentValues[x].grade) {\n                return true;\n            }\n            if (originalValues[x].peercomment != currentValues[x].peercomment) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async prepareAssessmentData(\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<CoreFormFields> {\n        const data: CoreFormFields = {};\n        const errors: AddonModWorkshopAssessmentStrategyFieldErrors = {};\n        let hasErrors = false;\n\n        form.fields.forEach((field, idx) => {\n            if (idx < form.dimenssionscount) {\n                const grade = parseInt(String(currentValues[idx].grade), 10);\n                if (!isNaN(grade) && (grade == 1 || grade == -1)) {\n                    data['grade__idx_' + idx] = grade;\n                } else {\n                    errors['grade_' + idx] = Translate.instant('core.required');\n                    hasErrors = true;\n                }\n\n                data['peercomment__idx_' + idx] = currentValues[idx].peercomment ?? '';\n\n                data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n                data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n                data['weight__idx_' + idx] = parseInt(field.weight, 10) || 0;\n            }\n        });\n\n        if (hasErrors) {\n            throw errors;\n        }\n\n        return data;\n    }\n\n}\nexport const AddonModWorkshopAssessmentStrategyNumErrorsHandler =\n    makeSingleton(AddonModWorkshopAssessmentStrategyNumErrorsHandlerLazyService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}