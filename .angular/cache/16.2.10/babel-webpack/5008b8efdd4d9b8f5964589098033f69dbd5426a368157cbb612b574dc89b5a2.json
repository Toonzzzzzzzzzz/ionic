{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n/**\n * Database variables for CoreH5PProvider service.\n */\n// DB table names.\nexport const CONTENT_TABLE_NAME = 'h5p_content'; // H5P content.\nexport const LIBRARIES_TABLE_NAME = 'h5p_libraries'; // Installed libraries.\nexport const LIBRARY_DEPENDENCIES_TABLE_NAME = 'h5p_library_dependencies'; // Library dependencies.\nexport const CONTENTS_LIBRARIES_TABLE_NAME = 'h5p_contents_libraries'; // Which library is used in which content.\nexport const LIBRARIES_CACHEDASSETS_TABLE_NAME = 'h5p_libraries_cachedassets'; // H5P cached library assets.\nexport const SITE_SCHEMA = {\n  name: 'CoreH5PProvider',\n  version: 2,\n  canBeCleared: [CONTENT_TABLE_NAME, LIBRARIES_TABLE_NAME, LIBRARY_DEPENDENCIES_TABLE_NAME, CONTENTS_LIBRARIES_TABLE_NAME, LIBRARIES_CACHEDASSETS_TABLE_NAME],\n  tables: [{\n    name: CONTENT_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true,\n      autoIncrement: true\n    }, {\n      name: 'jsoncontent',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'mainlibraryid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'foldername',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'fileurl',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'filtered',\n      type: 'TEXT'\n    }, {\n      name: 'timecreated',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'timemodified',\n      type: 'INTEGER',\n      notNull: true\n    }]\n  }, {\n    name: LIBRARIES_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true,\n      autoIncrement: true\n    }, {\n      name: 'machinename',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'title',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'majorversion',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'minorversion',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'patchversion',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'runnable',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'fullscreen',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'embedtypes',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'preloadedjs',\n      type: 'TEXT'\n    }, {\n      name: 'preloadedcss',\n      type: 'TEXT'\n    }, {\n      name: 'droplibrarycss',\n      type: 'TEXT'\n    }, {\n      name: 'semantics',\n      type: 'TEXT'\n    }, {\n      name: 'addto',\n      type: 'TEXT'\n    }, {\n      name: 'metadatasettings',\n      type: 'TEXT'\n    }]\n  }, {\n    name: LIBRARY_DEPENDENCIES_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true,\n      autoIncrement: true\n    }, {\n      name: 'libraryid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'requiredlibraryid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'dependencytype',\n      type: 'TEXT',\n      notNull: true\n    }]\n  }, {\n    name: CONTENTS_LIBRARIES_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true,\n      autoIncrement: true\n    }, {\n      name: 'h5pid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'libraryid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'dependencytype',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'dropcss',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'weight',\n      type: 'INTEGER',\n      notNull: true\n    }]\n  }, {\n    name: LIBRARIES_CACHEDASSETS_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'INTEGER',\n      primaryKey: true,\n      autoIncrement: true\n    }, {\n      name: 'libraryid',\n      type: 'INTEGER',\n      notNull: true\n    }, {\n      name: 'hash',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'foldername',\n      type: 'TEXT',\n      notNull: true\n    }]\n  }],\n  migrate(db, oldVersion) {\n    return _asyncToGenerator(function* () {\n      if (oldVersion >= 2) {\n        return;\n      }\n      // Add the metadata column to the table.\n      yield db.addColumn(LIBRARIES_TABLE_NAME, 'metadatasettings', 'TEXT');\n    })();\n  }\n};","map":{"version":3,"names":["CONTENT_TABLE_NAME","LIBRARIES_TABLE_NAME","LIBRARY_DEPENDENCIES_TABLE_NAME","CONTENTS_LIBRARIES_TABLE_NAME","LIBRARIES_CACHEDASSETS_TABLE_NAME","SITE_SCHEMA","name","version","canBeCleared","tables","columns","type","primaryKey","autoIncrement","notNull","migrate","db","oldVersion","_asyncToGenerator","addColumn"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/h5p/services/database/h5p.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { SQLiteDB } from '@classes/sqlitedb';\nimport { CoreSiteSchema } from '@services/sites';\n\n/**\n * Database variables for CoreH5PProvider service.\n */\n// DB table names.\nexport const CONTENT_TABLE_NAME = 'h5p_content'; // H5P content.\nexport const LIBRARIES_TABLE_NAME = 'h5p_libraries'; // Installed libraries.\nexport const LIBRARY_DEPENDENCIES_TABLE_NAME = 'h5p_library_dependencies'; // Library dependencies.\nexport const CONTENTS_LIBRARIES_TABLE_NAME = 'h5p_contents_libraries'; // Which library is used in which content.\nexport const LIBRARIES_CACHEDASSETS_TABLE_NAME = 'h5p_libraries_cachedassets'; // H5P cached library assets.\nexport const SITE_SCHEMA: CoreSiteSchema = {\n    name: 'CoreH5PProvider',\n    version: 2,\n    canBeCleared: [\n        CONTENT_TABLE_NAME,\n        LIBRARIES_TABLE_NAME,\n        LIBRARY_DEPENDENCIES_TABLE_NAME,\n        CONTENTS_LIBRARIES_TABLE_NAME,\n        LIBRARIES_CACHEDASSETS_TABLE_NAME,\n    ],\n    tables: [\n        {\n            name: CONTENT_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                    autoIncrement: true,\n                },\n                {\n                    name: 'jsoncontent',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'mainlibraryid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'foldername',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'fileurl',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'filtered',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'timecreated',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'timemodified',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n            ],\n        },\n        {\n            name: LIBRARIES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                    autoIncrement: true,\n                },\n                {\n                    name: 'machinename',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'title',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'majorversion',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'minorversion',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'patchversion',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'runnable',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'fullscreen',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'embedtypes',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'preloadedjs',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'preloadedcss',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'droplibrarycss',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'semantics',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'addto',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'metadatasettings',\n                    type: 'TEXT',\n                },\n            ],\n        },\n        {\n            name: LIBRARY_DEPENDENCIES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                    autoIncrement: true,\n                },\n                {\n                    name: 'libraryid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'requiredlibraryid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'dependencytype',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n            ],\n        },\n        {\n            name: CONTENTS_LIBRARIES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                    autoIncrement: true,\n                },\n                {\n                    name: 'h5pid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'libraryid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'dependencytype',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'dropcss',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'weight',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n            ],\n        },\n        {\n            name: LIBRARIES_CACHEDASSETS_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'INTEGER',\n                    primaryKey: true,\n                    autoIncrement: true,\n                },\n                {\n                    name: 'libraryid',\n                    type: 'INTEGER',\n                    notNull: true,\n                },\n                {\n                    name: 'hash',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'foldername',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n            ],\n        },\n    ],\n    async migrate(db: SQLiteDB, oldVersion: number): Promise<void> {\n        if (oldVersion >= 2) {\n            return;\n        }\n\n        // Add the metadata column to the table.\n        await db.addColumn(LIBRARIES_TABLE_NAME, 'metadatasettings', 'TEXT');\n    },\n};\n\n/**\n * Structure of content data stored in DB.\n */\nexport type CoreH5PContentDBRecord = {\n    id: number; // The id of the content.\n    jsoncontent: string; // The content in json format.\n    mainlibraryid: number; // The library we first instantiate for this node.\n    foldername: string; // Name of the folder that contains the contents.\n    fileurl: string; // The online URL of the H5P package.\n    filtered: string | null; // Filtered version of json_content.\n    timecreated: number; // Time created.\n    timemodified: number; // Time modified.\n};\n\n/**\n * Structure of library data stored in DB.\n */\nexport type CoreH5PLibraryDBRecord = {\n    id: number; // The id of the library.\n    machinename: string; // The library machine name.\n    title: string; // The human readable name of this library.\n    majorversion: number; // Major version.\n    minorversion: number; // Minor version.\n    patchversion: number; // Patch version.\n    runnable: number; // Can this library be started by the module? I.e. not a dependency.\n    fullscreen: number; // Display fullscreen button.\n    embedtypes: string; // List of supported embed types.\n    preloadedjs?: string | null; // Comma separated list of scripts to load.\n    preloadedcss?: string | null; // Comma separated list of stylesheets to load.\n    droplibrarycss?: string | null; // Libraries that should not have CSS included if this lib is used. Comma separated list.\n    semantics?: string | null; // The semantics definition.\n    addto?: string | null; // Plugin configuration data.\n    metadatasettings?: string | null; // Metadata settings.\n};\n\n/**\n * Structure of library dependencies stored in DB.\n */\nexport type CoreH5PLibraryDependencyDBRecord = {\n    id: number; // Id.\n    libraryid: number; // The id of an H5P library.\n    requiredlibraryid: number; // The dependent library to load.\n    dependencytype: string; // Type: preloaded, dynamic, or editor.\n};\n\n/**\n * Structure of library used by a content stored in DB.\n */\nexport type CoreH5PContentsLibraryDBRecord = {\n    id: number;\n    h5pid: number;\n    libraryid: number;\n    dependencytype: string;\n    dropcss: number;\n    weight: number;\n};\n\n/**\n * Structure of library cached assets stored in DB.\n */\nexport type CoreH5PLibraryCachedAssetsDBRecord = {\n    id: number; // Id.\n    libraryid: number; // The id of an H5P library.\n    hash: string; // The hash to identify the cached asset.\n    foldername: string; // Name of the folder that contains the contents.\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}