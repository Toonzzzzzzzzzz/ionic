{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { AddonModForum } from '@addons/mod/forum/services/forum';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreUtils } from '@services/utils/utils';\nimport { makeSingleton } from '@singletons';\nimport { AddonModForumModuleHandlerService } from './module';\nimport { isSafeNumber } from '@/core/utils/types';\nimport * as i0 from \"@angular/core\";\n/**\n * Handler for forum push notifications clicks.\n */\nexport class AddonModForumPushClickHandlerService {\n  constructor() {\n    this.name = 'AddonModForumPushClickHandler';\n    this.priority = 200;\n    this.featureName = 'CoreCourseModuleDelegate_AddonModForum';\n  }\n  /**\n   * Check if a notification click is handled by this handler.\n   *\n   * @param notification The notification to check.\n   * @returns Whether the notification click is handled by this handler\n   */\n  handles(notification) {\n    return _asyncToGenerator(function* () {\n      var _notification$customd;\n      return CoreUtils.isTrueOrOne(notification.notif) && notification.moodlecomponent == 'mod_forum' && notification.name == 'posts' && !!(notification.contexturl || (_notification$customd = notification.customdata) !== null && _notification$customd !== void 0 && _notification$customd.discussionid);\n    })();\n  }\n  /**\n   * Handle the notification click.\n   *\n   * @param notification The notification to check.\n   * @returns Promise resolved when done.\n   */\n  handleClick(notification) {\n    return _asyncToGenerator(function* () {\n      const contextUrlParams = CoreUrlUtils.extractUrlParams(notification.contexturl);\n      const data = notification.customdata || {};\n      const courseId = Number(notification.courseid);\n      const discussionId = Number(contextUrlParams.d || data.discussionid);\n      const cmId = data.cmid && Number(data.cmid);\n      const pageParams = {\n        forumId: Number(data.instance),\n        cmId,\n        courseId\n      };\n      if (!isSafeNumber(discussionId)) {\n        return;\n      }\n      if (data.postid || contextUrlParams.urlHash) {\n        pageParams.postId = Number(data.postid || contextUrlParams.urlHash.replace('p', ''));\n      }\n      yield CoreUtils.ignoreErrors(AddonModForum.invalidateDiscussionPosts(discussionId, undefined, notification.site));\n      yield CoreNavigator.navigateToSitePath(`${AddonModForumModuleHandlerService.PAGE_NAME}/discussion/${discussionId}`, {\n        siteId: notification.site,\n        params: pageParams\n      });\n    })();\n  }\n}\n_class = AddonModForumPushClickHandlerService;\n_class.ɵfac = function AddonModForumPushClickHandlerService_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonModForumPushClickHandler = makeSingleton(AddonModForumPushClickHandlerService);","map":{"version":3,"names":["AddonModForum","CoreNavigator","CoreUrlUtils","CoreUtils","makeSingleton","AddonModForumModuleHandlerService","isSafeNumber","AddonModForumPushClickHandlerService","constructor","name","priority","featureName","handles","notification","_asyncToGenerator","_notification$customd","isTrueOrOne","notif","moodlecomponent","contexturl","customdata","discussionid","handleClick","contextUrlParams","extractUrlParams","data","courseId","Number","courseid","discussionId","d","cmId","cmid","pageParams","forumId","instance","postid","urlHash","postId","replace","ignoreErrors","invalidateDiscussionPosts","undefined","site","navigateToSitePath","PAGE_NAME","siteId","params","factory","ɵfac","providedIn","AddonModForumPushClickHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/forum/services/handlers/push-click.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Injectable } from '@angular/core';\nimport { Params } from '@angular/router';\n\nimport { AddonModForum } from '@addons/mod/forum/services/forum';\nimport { CoreNavigator } from '@services/navigator';\nimport { CorePushNotificationsClickHandler } from '@features/pushnotifications/services/push-delegate';\nimport { CorePushNotificationsNotificationBasicData } from '@features/pushnotifications/services/pushnotifications';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreUtils } from '@services/utils/utils';\nimport { makeSingleton } from '@singletons';\n\nimport { AddonModForumModuleHandlerService } from './module';\nimport { isSafeNumber } from '@/core/utils/types';\n\n/**\n * Handler for forum push notifications clicks.\n */\n@Injectable({ providedIn: 'root' })\nexport class AddonModForumPushClickHandlerService implements CorePushNotificationsClickHandler {\n\n    name = 'AddonModForumPushClickHandler';\n    priority = 200;\n    featureName = 'CoreCourseModuleDelegate_AddonModForum';\n\n    /**\n     * Check if a notification click is handled by this handler.\n     *\n     * @param notification The notification to check.\n     * @returns Whether the notification click is handled by this handler\n     */\n    async handles(notification: NotificationData): Promise<boolean> {\n        return CoreUtils.isTrueOrOne(notification.notif)\n            && notification.moodlecomponent == 'mod_forum'\n            && notification.name == 'posts'\n            && !!(notification.contexturl || notification.customdata?.discussionid);\n    }\n\n    /**\n     * Handle the notification click.\n     *\n     * @param notification The notification to check.\n     * @returns Promise resolved when done.\n     */\n    async handleClick(notification: NotificationData): Promise<void> {\n        const contextUrlParams = CoreUrlUtils.extractUrlParams(notification.contexturl);\n        const data = notification.customdata || {};\n        const courseId = Number(notification.courseid);\n        const discussionId = Number(contextUrlParams.d || data.discussionid);\n        const cmId = data.cmid && Number(data.cmid);\n        const pageParams: Params = {\n            forumId: Number(data.instance),\n            cmId,\n            courseId,\n        };\n\n        if (!isSafeNumber(discussionId)) {\n            return;\n        }\n\n        if (data.postid || contextUrlParams.urlHash) {\n            pageParams.postId = Number(data.postid || contextUrlParams.urlHash.replace('p', ''));\n        }\n\n        await CoreUtils.ignoreErrors(\n            AddonModForum.invalidateDiscussionPosts(discussionId, undefined, notification.site),\n        );\n\n        await CoreNavigator.navigateToSitePath(\n            `${AddonModForumModuleHandlerService.PAGE_NAME}/discussion/${discussionId}`,\n            { siteId: notification.site, params: pageParams },\n        );\n    }\n\n}\n\nexport const AddonModForumPushClickHandler = makeSingleton(AddonModForumPushClickHandlerService);\n\ntype NotificationData = CorePushNotificationsNotificationBasicData & {\n    courseid: number;\n    discussionid: number;\n    contexturl: string;\n};\n"],"mappings":";;AAiBA,SAASA,aAAa,QAAQ,kCAAkC;AAChE,SAASC,aAAa,QAAQ,qBAAqB;AAGnD,SAASC,YAAY,QAAQ,qBAAqB;AAClD,SAASC,SAAS,QAAQ,uBAAuB;AACjD,SAASC,aAAa,QAAQ,aAAa;AAE3C,SAASC,iCAAiC,QAAQ,UAAU;AAC5D,SAASC,YAAY,QAAQ,oBAAoB;;AAEjD;;;AAIA,OAAM,MAAOC,oCAAoC;EADjDC,YAAA;IAGI,KAAAC,IAAI,GAAG,+BAA+B;IACtC,KAAAC,QAAQ,GAAG,GAAG;IACd,KAAAC,WAAW,GAAG,wCAAwC;;EAEtD;;;;;;EAMMC,OAAOA,CAACC,YAA8B;IAAA,OAAAC,iBAAA;MAAA,IAAAC,qBAAA;MACxC,OAAOZ,SAAS,CAACa,WAAW,CAACH,YAAY,CAACI,KAAK,CAAC,IACzCJ,YAAY,CAACK,eAAe,IAAI,WAAW,IAC3CL,YAAY,CAACJ,IAAI,IAAI,OAAO,IAC5B,CAAC,EAAEI,YAAY,CAACM,UAAU,KAAAJ,qBAAA,GAAIF,YAAY,CAACO,UAAU,cAAAL,qBAAA,eAAvBA,qBAAA,CAAyBM,YAAY,CAAC;IAAC;EAChF;EAEA;;;;;;EAMMC,WAAWA,CAACT,YAA8B;IAAA,OAAAC,iBAAA;MAC5C,MAAMS,gBAAgB,GAAGrB,YAAY,CAACsB,gBAAgB,CAACX,YAAY,CAACM,UAAU,CAAC;MAC/E,MAAMM,IAAI,GAAGZ,YAAY,CAACO,UAAU,IAAI,EAAE;MAC1C,MAAMM,QAAQ,GAAGC,MAAM,CAACd,YAAY,CAACe,QAAQ,CAAC;MAC9C,MAAMC,YAAY,GAAGF,MAAM,CAACJ,gBAAgB,CAACO,CAAC,IAAIL,IAAI,CAACJ,YAAY,CAAC;MACpE,MAAMU,IAAI,GAAGN,IAAI,CAACO,IAAI,IAAIL,MAAM,CAACF,IAAI,CAACO,IAAI,CAAC;MAC3C,MAAMC,UAAU,GAAW;QACvBC,OAAO,EAAEP,MAAM,CAACF,IAAI,CAACU,QAAQ,CAAC;QAC9BJ,IAAI;QACJL;OACH;MAED,IAAI,CAACpB,YAAY,CAACuB,YAAY,CAAC,EAAE;QAC7B;;MAGJ,IAAIJ,IAAI,CAACW,MAAM,IAAIb,gBAAgB,CAACc,OAAO,EAAE;QACzCJ,UAAU,CAACK,MAAM,GAAGX,MAAM,CAACF,IAAI,CAACW,MAAM,IAAIb,gBAAgB,CAACc,OAAO,CAACE,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;;MAGxF,MAAMpC,SAAS,CAACqC,YAAY,CACxBxC,aAAa,CAACyC,yBAAyB,CAACZ,YAAY,EAAEa,SAAS,EAAE7B,YAAY,CAAC8B,IAAI,CAAC,CACtF;MAED,MAAM1C,aAAa,CAAC2C,kBAAkB,CAClC,GAAGvC,iCAAiC,CAACwC,SAAS,eAAehB,YAAY,EAAE,EAC3E;QAAEiB,MAAM,EAAEjC,YAAY,CAAC8B,IAAI;QAAEI,MAAM,EAAEd;MAAU,CAAE,CACpD;IAAC;EACN;;SArDS1B,oCAAoC;;mBAApCA,MAAoC;AAAA;;SAApCA,MAAoC;EAAAyC,OAAA,EAApCzC,MAAoC,CAAA0C,IAAA;EAAAC,UAAA,EADvB;AAAM;AA0DhC,OAAO,MAAMC,6BAA6B,GAAG/C,aAAa,CAACG,oCAAoC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}