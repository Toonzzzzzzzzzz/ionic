{"ast":null,"code":"// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n/**\n * Database variables for CoreFilepool service.\n */\nexport const QUEUE_TABLE_NAME = 'filepool_files_queue'; // Queue of files to download.\nexport const FILES_TABLE_NAME = 'filepool_files'; // Downloaded files.\nexport const LINKS_TABLE_NAME = 'filepool_files_links'; // Links between downloaded files and components.\nexport const PACKAGES_TABLE_NAME = 'filepool_packages'; // Downloaded packages (sets of files).\nexport const APP_SCHEMA = {\n  name: 'CoreFilepoolProvider',\n  version: 1,\n  tables: [{\n    name: QUEUE_TABLE_NAME,\n    columns: [{\n      name: 'siteId',\n      type: 'TEXT'\n    }, {\n      name: 'fileId',\n      type: 'TEXT'\n    }, {\n      name: 'added',\n      type: 'INTEGER'\n    }, {\n      name: 'priority',\n      type: 'INTEGER'\n    }, {\n      name: 'url',\n      type: 'TEXT'\n    }, {\n      name: 'revision',\n      type: 'INTEGER'\n    }, {\n      name: 'timemodified',\n      type: 'INTEGER'\n    }, {\n      name: 'isexternalfile',\n      type: 'INTEGER'\n    }, {\n      name: 'repositorytype',\n      type: 'TEXT'\n    }, {\n      name: 'path',\n      type: 'TEXT'\n    }, {\n      name: 'links',\n      type: 'TEXT'\n    }],\n    primaryKeys: ['siteId', 'fileId']\n  }]\n};\nexport const SITE_SCHEMA = {\n  name: 'CoreFilepoolProvider',\n  version: 1,\n  tables: [{\n    name: FILES_TABLE_NAME,\n    columns: [{\n      name: 'fileId',\n      type: 'TEXT',\n      primaryKey: true\n    }, {\n      name: 'url',\n      type: 'TEXT',\n      notNull: true\n    }, {\n      name: 'revision',\n      type: 'INTEGER'\n    }, {\n      name: 'timemodified',\n      type: 'INTEGER'\n    }, {\n      name: 'stale',\n      type: 'INTEGER'\n    }, {\n      name: 'downloadTime',\n      type: 'INTEGER'\n    }, {\n      name: 'isexternalfile',\n      type: 'INTEGER'\n    }, {\n      name: 'repositorytype',\n      type: 'TEXT'\n    }, {\n      name: 'path',\n      type: 'TEXT'\n    }, {\n      name: 'extension',\n      type: 'TEXT'\n    }]\n  }, {\n    name: LINKS_TABLE_NAME,\n    columns: [{\n      name: 'fileId',\n      type: 'TEXT'\n    }, {\n      name: 'component',\n      type: 'TEXT'\n    }, {\n      name: 'componentId',\n      type: 'TEXT'\n    }],\n    primaryKeys: ['fileId', 'component', 'componentId']\n  }, {\n    name: PACKAGES_TABLE_NAME,\n    columns: [{\n      name: 'id',\n      type: 'TEXT',\n      primaryKey: true\n    }, {\n      name: 'component',\n      type: 'TEXT'\n    }, {\n      name: 'componentId',\n      type: 'TEXT'\n    }, {\n      name: 'status',\n      type: 'TEXT'\n    }, {\n      name: 'previous',\n      type: 'TEXT'\n    }, {\n      name: 'updated',\n      type: 'INTEGER'\n    }, {\n      name: 'downloadTime',\n      type: 'INTEGER'\n    }, {\n      name: 'previousDownloadTime',\n      type: 'INTEGER'\n    }, {\n      name: 'extra',\n      type: 'TEXT'\n    }]\n  }]\n};","map":{"version":3,"names":["QUEUE_TABLE_NAME","FILES_TABLE_NAME","LINKS_TABLE_NAME","PACKAGES_TABLE_NAME","APP_SCHEMA","name","version","tables","columns","type","primaryKeys","SITE_SCHEMA","primaryKey","notNull"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/services/database/filepool.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CoreAppSchema } from '@services/app';\nimport { CoreSiteSchema } from '@services/sites';\n\n/**\n * Database variables for CoreFilepool service.\n */\nexport const QUEUE_TABLE_NAME = 'filepool_files_queue'; // Queue of files to download.\nexport const FILES_TABLE_NAME = 'filepool_files'; // Downloaded files.\nexport const LINKS_TABLE_NAME = 'filepool_files_links'; // Links between downloaded files and components.\nexport const PACKAGES_TABLE_NAME = 'filepool_packages'; // Downloaded packages (sets of files).\nexport const APP_SCHEMA: CoreAppSchema = {\n    name: 'CoreFilepoolProvider',\n    version: 1,\n    tables: [\n        {\n            name: QUEUE_TABLE_NAME,\n            columns: [\n                {\n                    name: 'siteId',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'fileId',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'added',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'priority',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'url',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'revision',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'timemodified',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'isexternalfile',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'repositorytype',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'path',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'links',\n                    type: 'TEXT',\n                },\n            ],\n            primaryKeys: ['siteId', 'fileId'],\n        },\n    ],\n};\n\nexport const SITE_SCHEMA: CoreSiteSchema = {\n    name: 'CoreFilepoolProvider',\n    version: 1,\n    tables: [\n        {\n            name: FILES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'fileId',\n                    type: 'TEXT',\n                    primaryKey: true,\n                },\n                {\n                    name: 'url',\n                    type: 'TEXT',\n                    notNull: true,\n                },\n                {\n                    name: 'revision',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'timemodified',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'stale',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'downloadTime',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'isexternalfile',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'repositorytype',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'path',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'extension',\n                    type: 'TEXT',\n                },\n            ],\n        },\n        {\n            name: LINKS_TABLE_NAME,\n            columns: [\n                {\n                    name: 'fileId',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'component',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'componentId',\n                    type: 'TEXT',\n                },\n            ],\n            primaryKeys: ['fileId', 'component', 'componentId'],\n        },\n        {\n            name: PACKAGES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'id',\n                    type: 'TEXT',\n                    primaryKey: true,\n                },\n                {\n                    name: 'component',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'componentId',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'status',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'previous',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'updated',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'downloadTime',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'previousDownloadTime',\n                    type: 'INTEGER',\n                },\n                {\n                    name: 'extra',\n                    type: 'TEXT',\n                },\n            ],\n        },\n    ],\n};\n\n/**\n * File options.\n */\nexport type CoreFilepoolFileOptions = {\n    revision?: number; // File's revision.\n    timemodified?: number; // File's timemodified.\n    isexternalfile?: number; // 1 if it's a external file (from an external repository), 0 otherwise.\n    repositorytype?: string; // Type of the repository this file belongs to.\n};\n\n/**\n * Entry from filepool.\n */\nexport type CoreFilepoolFileEntry = CoreFilepoolFileOptions & {\n    /**\n     * The fileId to identify the file.\n     */\n    fileId: string;\n\n    /**\n     * File's URL.\n     */\n    url: string;\n\n    /**\n     * 1 if file is stale (needs to be updated), 0 otherwise.\n     */\n    stale: number;\n\n    /**\n     * Timestamp when this file was downloaded.\n     */\n    downloadTime: number;\n\n    /**\n     * File's path.\n     */\n    path: string;\n\n    /**\n     * File's extension.\n     */\n    extension: string;\n};\n\n/**\n * DB data for entry from file's queue.\n */\nexport type CoreFilepoolQueueDBEntry = CoreFilepoolFileOptions & {\n    /**\n     * The site the file belongs to.\n     */\n    siteId: string;\n\n    /**\n     * The fileId to identify the file.\n     */\n    fileId: string;\n\n    /**\n     * Timestamp when the file was added to the queue.\n     */\n    added: number;\n\n    /**\n     * The priority of the file.\n     */\n    priority: number;\n\n    /**\n     * File's URL.\n     */\n    url: string;\n\n    /**\n     * File's path.\n     */\n    path?: string;\n\n    /**\n     * File links (to link the file to components and componentIds). Serialized to store on DB.\n     */\n    links: string;\n};\n\n/**\n * Entry from the file's queue.\n */\nexport type CoreFilepoolQueueEntry = CoreFilepoolQueueDBEntry & {\n    /**\n     * File links (to link the file to components and componentIds).\n     */\n    linksUnserialized?: CoreFilepoolComponentLink[];\n};\n\n/**\n * Entry from packages table.\n */\nexport type CoreFilepoolPackageEntry = {\n    /**\n     * Package id.\n     */\n    id?: string;\n\n    /**\n     * The component to link the files to.\n     */\n    component?: string;\n\n    /**\n     * An ID to use in conjunction with the component.\n     */\n    componentId?: string | number;\n\n    /**\n     * Package status.\n     */\n    status?: string;\n\n    /**\n     * Package previous status.\n     */\n    previous?: string;\n\n    /**\n     * Timestamp when this package was updated.\n     */\n    updated?: number;\n\n    /**\n     * Timestamp when this package was downloaded.\n     */\n    downloadTime?: number;\n\n    /**\n     * Previous download time.\n     */\n    previousDownloadTime?: number;\n\n    /**\n     * Extra data stored by the package.\n     */\n    extra?: string;\n};\n\n/**\n * A component link.\n */\nexport type CoreFilepoolComponentLink = {\n    /**\n     * Link's component.\n     */\n    component: string;\n\n    /**\n     * Link's componentId.\n     */\n    componentId?: string | number;\n};\n\n/**\n * Links table record type.\n */\nexport type CoreFilepoolLinksRecord = {\n    fileId: string; // File Id.\n    component: string; // Component name.\n    componentId: number | string; // Component Id.\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}