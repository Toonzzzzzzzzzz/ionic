{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreListItemsManager } from '@classes/items-management/list-items-manager';\nimport { CoreRoutedItemsManagerSourcesTracker } from '@classes/items-management/routed-items-manager-sources-tracker';\nimport { CoreSplitViewComponent } from '@components/split-view/split-view';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { AddonModChatSessionsSource } from '../../classes/chat-sessions-source';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { CoreTime } from '@singletons/time';\nimport { Translate } from '@singletons';\nimport { AddonModChat } from '@addons/mod/chat/services/chat';\nimport { CoreUtils } from '@services/utils/utils';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../../core/components/empty-box/empty-box\";\nimport * as i3 from \"../../../../../core/components/group-selector/group-selector\";\nimport * as i4 from \"../../../../../core/components/loading/loading\";\nimport * as i5 from \"../../../../../core/components/split-view/split-view\";\nimport * as i6 from \"../../../../../core/directives/content\";\nimport * as i7 from \"../../../../../core/directives/update-non-reactive-attributes\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"@ionic/angular\";\nimport * as i10 from \"../../../../../core/pipes/duration\";\nimport * as i11 from \"../../../../../core/pipes/format-date\";\nimport * as i12 from \"@ngx-translate/core\";\nfunction AddonModChatSessionsPage_ion_card_21_p_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"coreDuration\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const session_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, session_r2.duration));\n  }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const user_r7 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"(\", user_r7.messagecount, \")\");\n  }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_item_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\");\n    i0.ɵɵtext(2);\n    i0.ɵɵtemplate(3, AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template, 2, 1, \"span\", 12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const user_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", user_r7.userfullname, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", user_r7.messagecount);\n  }\n}\nfunction AddonModChatSessionsPage_ion_card_21_ion_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 15);\n    i0.ɵɵlistener(\"click\", function AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const session_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.showMoreUsers(session_r2, $event));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"core.showmore\"), \" \");\n  }\n}\nfunction AddonModChatSessionsPage_ion_card_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\", 9);\n    i0.ɵɵlistener(\"click\", function AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r14);\n      const session_r2 = restoredCtx.$implicit;\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.sessions.select(session_r2));\n    });\n    i0.ɵɵelementStart(1, \"ion-item\", 10)(2, \"ion-label\")(3, \"p\", 11);\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"coreFormatDate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, AddonModChatSessionsPage_ion_card_21_p_6_Template, 3, 3, \"p\", 12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"ion-card-content\");\n    i0.ɵɵtemplate(8, AddonModChatSessionsPage_ion_card_21_ion_item_8_Template, 4, 2, \"ion-item\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, AddonModChatSessionsPage_ion_card_21_ion_button_9_Template, 3, 3, \"ion-button\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const session_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"addon-mod-chat-session-show-more\", session_r2.sessionusers.length < session_r2.allsessionusers.length);\n    i0.ɵɵattribute(\"aria-current\", ctx_r0.sessions.getItemAriaCurrent(session_r2));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 7, session_r2.sessionstart * 1000));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", session_r2.duration);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", session_r2.sessionusers);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", session_r2.sessionusers.length < session_r2.allsessionusers.length);\n  }\n}\nfunction AddonModChatSessionsPage_core_empty_box_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-empty-box\", 16);\n    i0.ɵɵpipe(1, \"translate\");\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"message\", i0.ɵɵpipeBind1(1, 1, \"addon.mod_chat.nosessionsfound\"));\n  }\n}\n/**\n * Page that displays list of chat sessions.\n */\nexport class AddonModChatSessionsPage {\n  constructor() {\n    var _this = this;\n    this.logView = CoreTime.once( /*#__PURE__*/_asyncToGenerator(function* () {\n      const source = _this.sessions.getSource();\n      yield CoreUtils.ignoreErrors(AddonModChat.logViewSessions(_this.sessions.getSource().CM_ID));\n      CoreAnalytics.logEvent({\n        type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n        ws: 'mod_chat_view_sessions',\n        name: Translate.instant('addon.mod_chat.chatreport'),\n        data: {\n          chatid: source.CHAT_ID,\n          category: 'chat'\n        },\n        url: `/mod/chat/report.php?id=${source.CM_ID}`\n      });\n    }));\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    try {\n      this.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n      const chatId = CoreNavigator.getRequiredRouteNumberParam('chatId');\n      const cmId = CoreNavigator.getRequiredRouteNumberParam('cmId');\n      const source = CoreRoutedItemsManagerSourcesTracker.getOrCreateSource(AddonModChatSessionsSource, [this.courseId, chatId, cmId]);\n      this.sessions = new CoreListItemsManager(source, AddonModChatSessionsPage);\n    } catch (error) {\n      CoreDomUtils.showErrorModal(error);\n      CoreNavigator.back();\n      return;\n    }\n  }\n  get groupId() {\n    return this.sessions.getSource().groupId;\n  }\n  set groupId(value) {\n    this.sessions.getSource().groupId = value;\n  }\n  get showAll() {\n    return this.sessions.getSource().showAll;\n  }\n  set showAll(value) {\n    this.sessions.getSource().showAll = value;\n  }\n  get groupInfo() {\n    return this.sessions.getSource().groupInfo;\n  }\n  /**\n   * @inheritdoc\n   */\n  ngAfterViewInit() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.fetchSessions();\n      _this2.sessions.start(_this2.splitView);\n    })();\n  }\n  /**\n   * Fetch chat sessions.\n   */\n  fetchSessions() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this3.sessions.load();\n        _this3.logView();\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'core.errorloadingcontent', true);\n      }\n    })();\n  }\n  /**\n   * Reload chat sessions.\n   */\n  reloadSessions() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const modal = yield CoreDomUtils.showModalLoading();\n      try {\n        yield _this4.sessions.reload();\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'core.errorloadingcontent', true);\n      } finally {\n        modal.dismiss();\n      }\n    })();\n  }\n  /**\n   * Refresh chat sessions.\n   *\n   * @param refresher Refresher.\n   */\n  refreshSessions(refresher) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        _this5.sessions.getSource().setDirty(true);\n        yield _this5.sessions.getSource().invalidateCache();\n        yield _this5.fetchSessions();\n      } finally {\n        refresher.complete();\n      }\n    })();\n  }\n  /**\n   * Show more session users.\n   *\n   * @param session Chat session.\n   * @param event The event.\n   */\n  showMoreUsers(session, event) {\n    if (session.allsessionusers) {\n      session.sessionusers = session.allsessionusers;\n    }\n    event.stopPropagation();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    this.sessions.destroy();\n  }\n}\n_class = AddonModChatSessionsPage;\n_class.ɵfac = function AddonModChatSessionsPage_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-mod-chat-sessions\"]],\n  viewQuery: function AddonModChatSessionsPage_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(CoreSplitViewComponent, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.splitView = _t.first);\n    }\n  },\n  decls: 23,\n  vars: 20,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [3, \"groupInfo\", \"selected\", \"courseId\", \"selectedChange\"], [\"slot\", \"end\", 3, \"ngModel\", \"ngModelChange\", \"ionChange\"], [\"button\", \"\", 3, \"addon-mod-chat-session-show-more\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"icon\", \"far-comments\", 3, \"message\", 4, \"ngIf\"], [\"button\", \"\", 3, \"click\"], [1, \"ion-text-wrap\"], [1, \"item-heading\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\", 4, \"ngIf\"], [\"fill\", \"clear\", \"expand\", \"block\", 3, \"click\"], [\"icon\", \"far-comments\", 3, \"message\"]],\n  template: function AddonModChatSessionsPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵtext(7);\n      i0.ɵɵpipe(8, \"translate\");\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(9, \"ion-content\")(10, \"core-split-view\")(11, \"ion-refresher\", 2);\n      i0.ɵɵlistener(\"ionRefresh\", function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener($event) {\n        return ctx.refreshSessions($event.target);\n      });\n      i0.ɵɵelement(12, \"ion-refresher-content\", 3);\n      i0.ɵɵpipe(13, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"core-loading\", 4)(15, \"core-group-selector\", 5);\n      i0.ɵɵlistener(\"selectedChange\", function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener($event) {\n        return ctx.groupId = $event;\n      })(\"selectedChange\", function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener() {\n        return ctx.reloadSessions();\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"ion-item\")(17, \"ion-label\");\n      i0.ɵɵtext(18);\n      i0.ɵɵpipe(19, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"ion-toggle\", 6);\n      i0.ɵɵlistener(\"ngModelChange\", function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener($event) {\n        return ctx.showAll = $event;\n      })(\"ionChange\", function AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener() {\n        return ctx.reloadSessions();\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(21, AddonModChatSessionsPage_ion_card_21_Template, 10, 9, \"ion-card\", 7);\n      i0.ɵɵtemplate(22, AddonModChatSessionsPage_core_empty_box_22_Template, 2, 3, \"core-empty-box\", 8);\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 12, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(8, 14, \"addon.mod_chat.chatreport\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"disabled\", !ctx.sessions.loaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵpropertyInterpolate(\"pullingText\", i0.ɵɵpipeBind1(13, 16, \"core.pulltorefresh\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hideUntil\", ctx.sessions.loaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"groupInfo\", ctx.groupInfo)(\"selected\", ctx.groupId)(\"courseId\", ctx.courseId);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(19, 18, \"addon.mod_chat.showincompletesessions\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngModel\", ctx.showAll);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.sessions.items);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.sessions.empty);\n    }\n  },\n  dependencies: [i1.NgForOf, i1.NgIf, i2.CoreEmptyBoxComponent, i3.CoreGroupSelectorComponent, i4.CoreLoadingComponent, i5.CoreSplitViewComponent, i6.CoreContentDirective, i7.CoreUpdateNonReactiveAttributesDirective, i8.NgControlStatus, i8.NgModel, i9.IonButton, i9.IonButtons, i9.IonCard, i9.IonCardContent, i9.IonContent, i9.IonHeader, i9.IonItem, i9.IonLabel, i9.IonRefresher, i9.IonRefresherContent, i9.IonTitle, i9.IonToggle, i9.IonToolbar, i9.BooleanValueAccessor, i9.IonBackButton, i10.CoreDurationPipe, i11.CoreFormatDatePipe, i12.TranslatePipe],\n  encapsulation: 2\n});","map":{"version":3,"names":["CoreListItemsManager","CoreRoutedItemsManagerSourcesTracker","CoreSplitViewComponent","CoreNavigator","CoreDomUtils","AddonModChatSessionsSource","CoreAnalytics","CoreAnalyticsEventType","CoreTime","Translate","AddonModChat","CoreUtils","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate","ɵɵpipeBind1","session_r2","duration","ɵɵtextInterpolate1","user_r7","messagecount","ɵɵtemplate","AddonModChatSessionsPage_ion_card_21_ion_item_8_span_3_Template","userfullname","ɵɵproperty","ɵɵlistener","AddonModChatSessionsPage_ion_card_21_ion_button_9_Template_ion_button_click_0_listener","$event","ɵɵrestoreView","_r12","ɵɵnextContext","$implicit","ctx_r10","ɵɵresetView","showMoreUsers","AddonModChatSessionsPage_ion_card_21_Template_ion_card_click_0_listener","restoredCtx","_r14","ctx_r13","sessions","select","AddonModChatSessionsPage_ion_card_21_p_6_Template","AddonModChatSessionsPage_ion_card_21_ion_item_8_Template","AddonModChatSessionsPage_ion_card_21_ion_button_9_Template","ɵɵclassProp","sessionusers","length","allsessionusers","ɵɵattribute","ctx_r0","getItemAriaCurrent","sessionstart","ɵɵelement","AddonModChatSessionsPage","constructor","_this","logView","once","_asyncToGenerator","source","getSource","ignoreErrors","logViewSessions","CM_ID","logEvent","type","VIEW_ITEM_LIST","ws","name","instant","data","chatid","CHAT_ID","category","url","ngOnInit","courseId","getRequiredRouteNumberParam","chatId","cmId","getOrCreateSource","error","showErrorModal","back","groupId","value","showAll","groupInfo","ngAfterViewInit","_this2","fetchSessions","start","splitView","_this3","load","showErrorModalDefault","reloadSessions","_this4","modal","showModalLoading","reload","dismiss","refreshSessions","refresher","_this5","setDirty","invalidateCache","complete","session","event","stopPropagation","ngOnDestroy","destroy","selectors","viewQuery","AddonModChatSessionsPage_Query","rf","ctx","AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener","target","AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener","AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_20_listener","AddonModChatSessionsPage_Template_ion_toggle_ionChange_20_listener","AddonModChatSessionsPage_ion_card_21_Template","AddonModChatSessionsPage_core_empty_box_22_Template","loaded","ɵɵpropertyInterpolate","items","empty"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/chat/pages/sessions/sessions.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/chat/pages/sessions/sessions.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { AfterViewInit, Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { CoreListItemsManager } from '@classes/items-management/list-items-manager';\nimport { CoreRoutedItemsManagerSourcesTracker } from '@classes/items-management/routed-items-manager-sources-tracker';\nimport { CoreSplitViewComponent } from '@components/split-view/split-view';\nimport { CoreGroupInfo } from '@services/groups';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { AddonModChatSessionFormatted, AddonModChatSessionsSource } from '../../classes/chat-sessions-source';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { CoreTime } from '@singletons/time';\nimport { Translate } from '@singletons';\nimport { AddonModChat } from '@addons/mod/chat/services/chat';\nimport { CoreUtils } from '@services/utils/utils';\n\n/**\n * Page that displays list of chat sessions.\n */\n@Component({\n    selector: 'page-addon-mod-chat-sessions',\n    templateUrl: 'sessions.html',\n})\nexport class AddonModChatSessionsPage implements OnInit, AfterViewInit, OnDestroy {\n\n    @ViewChild(CoreSplitViewComponent) splitView!: CoreSplitViewComponent;\n\n    sessions!: CoreListItemsManager<AddonModChatSessionFormatted, AddonModChatSessionsSource>;\n    courseId?: number;\n    protected logView: () => void;\n\n    constructor() {\n        this.logView = CoreTime.once(async () => {\n            const source = this.sessions.getSource();\n\n            await CoreUtils.ignoreErrors(AddonModChat.logViewSessions(this.sessions.getSource().CM_ID));\n\n            CoreAnalytics.logEvent({\n                type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n                ws: 'mod_chat_view_sessions',\n                name: Translate.instant('addon.mod_chat.chatreport'),\n                data: { chatid: source.CHAT_ID, category: 'chat' },\n                url: `/mod/chat/report.php?id=${source.CM_ID}`,\n            });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        try {\n            this.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n            const chatId = CoreNavigator.getRequiredRouteNumberParam('chatId');\n            const cmId = CoreNavigator.getRequiredRouteNumberParam('cmId');\n            const source = CoreRoutedItemsManagerSourcesTracker.getOrCreateSource(\n                AddonModChatSessionsSource,\n                [this.courseId, chatId, cmId],\n            );\n\n            this.sessions = new CoreListItemsManager(source, AddonModChatSessionsPage);\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n\n            CoreNavigator.back();\n\n            return;\n        }\n    }\n\n    get groupId(): number {\n        return this.sessions.getSource().groupId;\n    }\n\n    set groupId(value: number) {\n        this.sessions.getSource().groupId = value;\n    }\n\n    get showAll(): boolean {\n        return this.sessions.getSource().showAll;\n    }\n\n    set showAll(value: boolean) {\n        this.sessions.getSource().showAll = value;\n    }\n\n    get groupInfo(): CoreGroupInfo | undefined {\n        return this.sessions.getSource().groupInfo;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngAfterViewInit(): Promise<void> {\n        await this.fetchSessions();\n\n        this.sessions.start(this.splitView);\n    }\n\n    /**\n     * Fetch chat sessions.\n     */\n    async fetchSessions(): Promise<void> {\n        try {\n            await this.sessions.load();\n\n            this.logView();\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'core.errorloadingcontent', true);\n        }\n    }\n\n    /**\n     * Reload chat sessions.\n     */\n    async reloadSessions(): Promise<void> {\n        const modal = await CoreDomUtils.showModalLoading();\n\n        try {\n            await this.sessions.reload();\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'core.errorloadingcontent', true);\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * Refresh chat sessions.\n     *\n     * @param refresher Refresher.\n     */\n    async refreshSessions(refresher: HTMLIonRefresherElement): Promise<void> {\n        try {\n            this.sessions.getSource().setDirty(true);\n\n            await this.sessions.getSource().invalidateCache();\n            await this.fetchSessions();\n        } finally {\n            refresher.complete();\n        }\n    }\n\n    /**\n     * Show more session users.\n     *\n     * @param session Chat session.\n     * @param event The event.\n     */\n    showMoreUsers(session: AddonModChatSessionFormatted, event: Event): void {\n        if (session.allsessionusers) {\n            session.sessionusers = session.allsessionusers;\n        }\n\n        event.stopPropagation();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        this.sessions.destroy();\n    }\n\n}\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>{{ 'addon.mod_chat.chatreport' | translate }}</h1>\n        </ion-title>\n    </ion-toolbar>\n</ion-header>\n<ion-content>\n    <core-split-view>\n        <ion-refresher slot=\"fixed\" [disabled]=\"!sessions.loaded\" (ionRefresh)=\"refreshSessions($event.target)\">\n            <ion-refresher-content pullingText=\"{{ 'core.pulltorefresh' | translate }}\" />\n        </ion-refresher>\n        <core-loading [hideUntil]=\"sessions.loaded\">\n            <core-group-selector [groupInfo]=\"groupInfo\" [(selected)]=\"groupId\" (selectedChange)=\"reloadSessions()\" [courseId]=\"courseId\" />\n\n            <ion-item>\n                <ion-label>{{ 'addon.mod_chat.showincompletesessions' | translate }}</ion-label>\n                <ion-toggle [(ngModel)]=\"showAll\" (ionChange)=\"reloadSessions()\" slot=\"end\" />\n            </ion-item>\n\n            <ion-card *ngFor=\"let session of sessions.items\" (click)=\"sessions.select(session)\" button\n                [attr.aria-current]=\"sessions.getItemAriaCurrent(session)\"\n                [class.addon-mod-chat-session-show-more]=\"session.sessionusers.length < session.allsessionusers.length\">\n\n                <ion-item class=\"ion-text-wrap\">\n                    <ion-label>\n                        <p class=\"item-heading\">{{ session.sessionstart * 1000 | coreFormatDate }}</p>\n                        <p *ngIf=\"session.duration\">{{ session.duration | coreDuration }}</p>\n                    </ion-label>\n                </ion-item>\n                <ion-card-content>\n                    <ion-item *ngFor=\"let user of session.sessionusers\">\n                        <ion-label>\n                            {{ user.userfullname }} <span *ngIf=\"user.messagecount\">({{ user.messagecount }})</span>\n                        </ion-label>\n                    </ion-item>\n                </ion-card-content>\n                <ion-button *ngIf=\"session.sessionusers.length < session.allsessionusers.length\" fill=\"clear\" expand=\"block\"\n                    (click)=\"showMoreUsers(session, $event)\">\n                    {{ 'core.showmore' | translate }}\n                </ion-button>\n            </ion-card>\n\n            <core-empty-box *ngIf=\"sessions.empty\" icon=\"far-comments\" [message]=\"'addon.mod_chat.nosessionsfound' | translate\" />\n        </core-loading>\n    </core-split-view>\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}