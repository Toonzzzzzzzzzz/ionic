{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { Translate, makeSingleton } from '@singletons';\nimport { AddonModWorkshopAssessmentStrategyRubricComponent } from '../component/rubric';\nimport { AddonModWorkshopAssessmentStrategyRubricHandlerService } from './handler';\nimport * as i0 from \"@angular/core\";\n/**\n * Handler for rubric assessment strategy plugin.\n */\nexport class AddonModWorkshopAssessmentStrategyRubricHandlerLazyService extends AddonModWorkshopAssessmentStrategyRubricHandlerService {\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return _asyncToGenerator(function* () {\n      return true;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getComponent() {\n    return AddonModWorkshopAssessmentStrategyRubricComponent;\n  }\n  /**\n   * @inheritdoc\n   */\n  getOriginalValues(form) {\n    return _asyncToGenerator(function* () {\n      const originalValues = [];\n      form.fields.forEach((field, n) => {\n        field.dimtitle = Translate.instant('addon.mod_workshop_assessment_rubric.dimensionnumber', {\n          $a: field.number\n        });\n        if (!form.current[n]) {\n          form.current[n] = {};\n        }\n        originalValues[n] = {};\n        originalValues[n].chosenlevelid = form.current[n].chosenlevelid || '';\n        originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n      });\n\n      return originalValues;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  hasDataChanged(originalValues, currentValues) {\n    for (const x in originalValues) {\n      if (originalValues[x].chosenlevelid != (currentValues[x].chosenlevelid || '')) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * @inheritdoc\n   */\n  prepareAssessmentData(currentValues, form) {\n    return _asyncToGenerator(function* () {\n      const data = {};\n      const errors = {};\n      let hasErrors = false;\n      form.fields.forEach((field, idx) => {\n        if (idx < form.dimenssionscount) {\n          const id = parseInt(currentValues[idx].chosenlevelid, 10);\n          if (!isNaN(id) && id >= 0) {\n            data['chosenlevelid__idx_' + idx] = id;\n          } else {\n            errors['chosenlevelid_' + idx] = Translate.instant('addon.mod_workshop_assessment_rubric.mustchooseone');\n            hasErrors = true;\n          }\n          data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n          data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n        }\n      });\n      if (hasErrors) {\n        throw errors;\n      }\n      return data;\n    })();\n  }\n}\n_class = AddonModWorkshopAssessmentStrategyRubricHandlerLazyService;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonModWorkshopAssessmentStrategyRubricHandlerLazyService_BaseFactory;\n  return function AddonModWorkshopAssessmentStrategyRubricHandlerLazyService_Factory(t) {\n    return (ɵAddonModWorkshopAssessmentStrategyRubricHandlerLazyService_BaseFactory || (ɵAddonModWorkshopAssessmentStrategyRubricHandlerLazyService_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonModWorkshopAssessmentStrategyRubricHandler = makeSingleton(AddonModWorkshopAssessmentStrategyRubricHandlerLazyService);","map":{"version":3,"names":["Translate","makeSingleton","AddonModWorkshopAssessmentStrategyRubricComponent","AddonModWorkshopAssessmentStrategyRubricHandlerService","AddonModWorkshopAssessmentStrategyRubricHandlerLazyService","isEnabled","_asyncToGenerator","getComponent","getOriginalValues","form","originalValues","fields","forEach","field","n","dimtitle","instant","$a","number","current","chosenlevelid","hasDataChanged","currentValues","x","prepareAssessmentData","data","errors","hasErrors","idx","dimenssionscount","id","parseInt","isNaN","gradeid","dimensionid","t","factory","ɵfac","providedIn","AddonModWorkshopAssessmentStrategyRubricHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/workshop/assessment/rubric/services/handler-lazy.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n    AddonModWorkshopAssessmentStrategyFieldErrors,\n} from '@addons/mod/workshop/components/assessment-strategy/assessment-strategy';\nimport { AddonWorkshopAssessmentStrategyHandler } from '@addons/mod/workshop/services/assessment-strategy-delegate';\nimport {\n    AddonModWorkshopGetAssessmentFormDefinitionData,\n    AddonModWorkshopGetAssessmentFormFieldsParsedData,\n} from '@addons/mod/workshop/services/workshop';\nimport { Injectable, Type } from '@angular/core';\nimport { Translate, makeSingleton } from '@singletons';\nimport { CoreFormFields } from '@singletons/form';\nimport { AddonModWorkshopAssessmentStrategyRubricComponent } from '../component/rubric';\nimport { AddonModWorkshopAssessmentStrategyRubricHandlerService } from './handler';\n\n/**\n * Handler for rubric assessment strategy plugin.\n */\n@Injectable({ providedIn: 'root' })\nexport class AddonModWorkshopAssessmentStrategyRubricHandlerLazyService\n    extends AddonModWorkshopAssessmentStrategyRubricHandlerService\n    implements AddonWorkshopAssessmentStrategyHandler {\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabled(): Promise<boolean> {\n        return true;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getComponent(): Type<unknown> {\n        return AddonModWorkshopAssessmentStrategyRubricComponent;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getOriginalValues(\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<AddonModWorkshopGetAssessmentFormFieldsParsedData[]> {\n        const originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[] = [];\n\n        form.fields.forEach((field, n) => {\n            field.dimtitle = Translate.instant('addon.mod_workshop_assessment_rubric.dimensionnumber', { $a: field.number });\n\n            if (!form.current[n]) {\n                form.current[n] = {};\n            }\n\n            originalValues[n] = {};\n            originalValues[n].chosenlevelid = form.current[n].chosenlevelid || '';\n            originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n        });\n\n        return originalValues;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    hasDataChanged(\n        originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n    ): boolean {\n        for (const x in originalValues) {\n            if (originalValues[x].chosenlevelid != (currentValues[x].chosenlevelid || '')) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async prepareAssessmentData(\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<CoreFormFields> {\n        const data: CoreFormFields = {};\n        const errors: AddonModWorkshopAssessmentStrategyFieldErrors = {};\n        let hasErrors = false;\n\n        form.fields.forEach((field, idx) => {\n            if (idx < form.dimenssionscount) {\n                const id = parseInt(currentValues[idx].chosenlevelid, 10);\n                if (!isNaN(id) && id >= 0) {\n                    data['chosenlevelid__idx_' + idx] = id;\n                } else {\n                    errors['chosenlevelid_' + idx] = Translate.instant('addon.mod_workshop_assessment_rubric.mustchooseone');\n                    hasErrors = true;\n                }\n\n                data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n                data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n            }\n        });\n\n        if (hasErrors) {\n            throw errors;\n        }\n\n        return data;\n    }\n\n}\nexport const AddonModWorkshopAssessmentStrategyRubricHandler =\n    makeSingleton(AddonModWorkshopAssessmentStrategyRubricHandlerLazyService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}