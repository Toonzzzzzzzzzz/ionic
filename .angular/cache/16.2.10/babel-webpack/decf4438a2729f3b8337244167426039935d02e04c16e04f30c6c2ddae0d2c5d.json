{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreUserNullSupportConfig } from '@features/user/classes/support/null-support-config';\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreUserSupportConfig } from './support-config';\nimport { CoreSitesFactory } from '@services/sites-factory';\n/**\n * Support config for a guest user.\n */\nexport class CoreUserGuestSupportConfig extends CoreUserSupportConfig {\n  /**\n   * Get support config for a site with given url.\n   *\n   * @param siteUrl Site url.\n   * @returns Support config.\n   */\n  static forSite(siteUrl) {\n    return _asyncToGenerator(function* () {\n      const siteConfig = yield CoreUtils.ignoreErrors(CoreSites.getPublicSiteConfigByUrl(siteUrl));\n      if (!siteConfig) {\n        return new CoreUserNullSupportConfig();\n      }\n      return new CoreUserGuestSupportConfig(CoreSitesFactory.makeUnauthenticatedSite(siteUrl, siteConfig), siteConfig);\n    })();\n  }\n  constructor(site, config) {\n    super();\n    this.site = site;\n    this.config = config;\n  }\n  /**\n   * @inheritdoc\n   */\n  canContactSupport() {\n    if (this.site.isFeatureDisabled('NoDelegate_CoreUserSupport')) {\n      return false;\n    }\n    // This config was introduced in 4.1, if it's missing we can assume the site is 4.0 or lower.\n    if ('supportavailability' in this.config) {\n      return this.config.supportavailability === 2 /* CoreSiteConfigSupportAvailability.Anyone */;\n    }\n    // This config is only available to guests since 4.0, if it's missing we can assume guests can't contact support.\n    return 'supportpage' in this.config;\n  }\n  /**\n   * @inheritdoc\n   */\n  getSupportPageLang() {\n    var _this$config$lang;\n    return (_this$config$lang = this.config.lang) !== null && _this$config$lang !== void 0 ? _this$config$lang : null;\n  }\n  /**\n   * @inheritdoc\n   */\n  buildSupportPageUrl() {\n    var _this$config$supportp;\n    return ((_this$config$supportp = this.config.supportpage) === null || _this$config$supportp === void 0 ? void 0 : _this$config$supportp.trim()) || `${this.config.httpswwwroot || this.config.wwwroot}/user/contactsitesupport.php`;\n  }\n}","map":{"version":3,"names":["CoreUserNullSupportConfig","CoreSites","CoreUtils","CoreUserSupportConfig","CoreSitesFactory","CoreUserGuestSupportConfig","forSite","siteUrl","_asyncToGenerator","siteConfig","ignoreErrors","getPublicSiteConfigByUrl","makeUnauthenticatedSite","constructor","site","config","canContactSupport","isFeatureDisabled","supportavailability","getSupportPageLang","_this$config$lang","lang","buildSupportPageUrl","_this$config$supportp","supportpage","trim","httpswwwroot","wwwroot"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/user/classes/support/guest-support-config.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n    CoreSiteConfigSupportAvailability,\n    CoreSitePublicConfigResponse,\n    CoreUnauthenticatedSite,\n} from '@classes/sites/unauthenticated-site';\nimport { CoreUserNullSupportConfig } from '@features/user/classes/support/null-support-config';\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreUserSupportConfig } from './support-config';\nimport { CoreSitesFactory } from '@services/sites-factory';\n\n/**\n * Support config for a guest user.\n */\nexport class CoreUserGuestSupportConfig extends CoreUserSupportConfig {\n\n    /**\n     * Get support config for a site with given url.\n     *\n     * @param siteUrl Site url.\n     * @returns Support config.\n     */\n    static async forSite(siteUrl: string): Promise<CoreUserSupportConfig> {\n        const siteConfig = await CoreUtils.ignoreErrors(CoreSites.getPublicSiteConfigByUrl(siteUrl));\n\n        if (!siteConfig) {\n            return new CoreUserNullSupportConfig();\n        }\n\n        return new CoreUserGuestSupportConfig(CoreSitesFactory.makeUnauthenticatedSite(siteUrl, siteConfig), siteConfig);\n    }\n\n    private site: CoreUnauthenticatedSite;\n    private config: CoreSitePublicConfigResponse;\n\n    constructor(site: CoreUnauthenticatedSite, config: CoreSitePublicConfigResponse) {\n        super();\n\n        this.site = site;\n        this.config = config;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    canContactSupport(): boolean {\n        if (this.site.isFeatureDisabled('NoDelegate_CoreUserSupport')) {\n            return false;\n        }\n\n        // This config was introduced in 4.1, if it's missing we can assume the site is 4.0 or lower.\n        if ('supportavailability' in this.config) {\n            return this.config.supportavailability === CoreSiteConfigSupportAvailability.Anyone;\n        }\n\n        // This config is only available to guests since 4.0, if it's missing we can assume guests can't contact support.\n        return 'supportpage' in this.config;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getSupportPageLang(): string | null {\n        return this.config.lang ?? null;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected buildSupportPageUrl(): string {\n        return this.config.supportpage?.trim()\n            || `${this.config.httpswwwroot || this.config.wwwroot}/user/contactsitesupport.php`;\n    }\n\n}\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA,SAASA,yBAAyB,QAAQ,oDAAoD;AAC9F,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,SAAS,QAAQ,uBAAuB;AACjD,SAASC,qBAAqB,QAAQ,kBAAkB;AACxD,SAASC,gBAAgB,QAAQ,yBAAyB;AAE1D;;;AAGA,OAAM,MAAOC,0BAA2B,SAAQF,qBAAqB;EAEjE;;;;;;EAMA,OAAaG,OAAOA,CAACC,OAAe;IAAA,OAAAC,iBAAA;MAChC,MAAMC,UAAU,SAASP,SAAS,CAACQ,YAAY,CAACT,SAAS,CAACU,wBAAwB,CAACJ,OAAO,CAAC,CAAC;MAE5F,IAAI,CAACE,UAAU,EAAE;QACb,OAAO,IAAIT,yBAAyB,EAAE;;MAG1C,OAAO,IAAIK,0BAA0B,CAACD,gBAAgB,CAACQ,uBAAuB,CAACL,OAAO,EAAEE,UAAU,CAAC,EAAEA,UAAU,CAAC;IAAC;EACrH;EAKAI,YAAYC,IAA6B,EAAEC,MAAoC;IAC3E,KAAK,EAAE;IAEP,IAAI,CAACD,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,MAAM,GAAGA,MAAM;EACxB;EAEA;;;EAGAC,iBAAiBA,CAAA;IACb,IAAI,IAAI,CAACF,IAAI,CAACG,iBAAiB,CAAC,4BAA4B,CAAC,EAAE;MAC3D,OAAO,KAAK;;IAGhB;IACA,IAAI,qBAAqB,IAAI,IAAI,CAACF,MAAM,EAAE;MACtC,OAAO,IAAI,CAACA,MAAM,CAACG,mBAAmB;;IAG1C;IACA,OAAO,aAAa,IAAI,IAAI,CAACH,MAAM;EACvC;EAEA;;;EAGAI,kBAAkBA,CAAA;IAAA,IAAAC,iBAAA;IACd,QAAAA,iBAAA,GAAO,IAAI,CAACL,MAAM,CAACM,IAAI,cAAAD,iBAAA,cAAAA,iBAAA,GAAI,IAAI;EACnC;EAEA;;;EAGUE,mBAAmBA,CAAA;IAAA,IAAAC,qBAAA;IACzB,OAAO,EAAAA,qBAAA,OAAI,CAACR,MAAM,CAACS,WAAW,cAAAD,qBAAA,uBAAvBA,qBAAA,CAAyBE,IAAI,EAAE,KAC/B,GAAG,IAAI,CAACV,MAAM,CAACW,YAAY,IAAI,IAAI,CAACX,MAAM,CAACY,OAAO,8BAA8B;EAC3F"},"metadata":{},"sourceType":"module","externalDependencies":[]}