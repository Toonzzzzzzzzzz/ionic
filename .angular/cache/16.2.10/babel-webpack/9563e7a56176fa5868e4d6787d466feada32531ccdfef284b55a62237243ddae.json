{"ast":null,"code":"var _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { makeSingleton } from '@singletons';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport * as i0 from \"@angular/core\";\n/**\n * Service with helper functions for tags.\n */\nexport class CoreTagHelperProvider {\n  /**\n   * Parses the rendered content of the \"core_tag/tagfeed\" web template and returns the items.\n   *\n   * @param content Rendered content.\n   * @returns Area items.\n   */\n  parseFeedContent(content) {\n    const items = [];\n    const element = CoreDomUtils.convertToElement(content);\n    Array.from(element.querySelectorAll('ul.tag_feed > li.media')).forEach(itemElement => {\n      const item = {\n        details: []\n      };\n      Array.from(itemElement.querySelectorAll('div.media-body > div')).forEach(div => {\n        if (div.classList.contains('media-heading')) {\n          item.heading = div.innerText.trim();\n          const link = div.querySelector('a');\n          if (link) {\n            item.url = link.getAttribute('href');\n          }\n        } else {\n          // Separate details by lines.\n          const lines = [''];\n          Array.from(div.childNodes).forEach(childNode => {\n            if (childNode.nodeType == Node.TEXT_NODE) {\n              lines[lines.length - 1] += childNode.textContent;\n            } else if (childNode.nodeType == Node.ELEMENT_NODE) {\n              const childElement = childNode;\n              if (childElement.tagName == 'BR') {\n                lines.push('');\n              } else {\n                lines[lines.length - 1] += childElement.innerText;\n              }\n            }\n          });\n          item.details.push(...lines.map(line => line.trim()).filter(line => line != ''));\n        }\n      });\n      const image = itemElement.querySelector('div.itemimage img');\n      if (image) {\n        if (image.classList.contains('userpicture')) {\n          item.avatarUrl = image.getAttribute('src');\n        } else {\n          item.iconUrl = image.getAttribute('src');\n        }\n      }\n      if (item.heading && item.url) {\n        items.push(item);\n      }\n    });\n    return items;\n  }\n}\n_class = CoreTagHelperProvider;\n_class.ɵfac = function CoreTagHelperProvider_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const CoreTagHelper = makeSingleton(CoreTagHelperProvider);","map":{"version":3,"names":["makeSingleton","CoreDomUtils","CoreTagHelperProvider","parseFeedContent","content","items","element","convertToElement","Array","from","querySelectorAll","forEach","itemElement","item","details","div","classList","contains","heading","innerText","trim","link","querySelector","url","getAttribute","lines","childNodes","childNode","nodeType","Node","TEXT_NODE","length","textContent","ELEMENT_NODE","childElement","tagName","push","map","line","filter","image","avatarUrl","iconUrl","factory","ɵfac","providedIn","CoreTagHelper"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/tag/services/tag-helper.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { makeSingleton } from '@singletons';\nimport { Injectable } from '@angular/core';\nimport { CoreDomUtils } from '@services/utils/dom';\n\n/**\n * Service with helper functions for tags.\n */\n@Injectable({ providedIn: 'root' })\nexport class CoreTagHelperProvider {\n\n    /**\n     * Parses the rendered content of the \"core_tag/tagfeed\" web template and returns the items.\n     *\n     * @param content Rendered content.\n     * @returns Area items.\n     */\n    parseFeedContent(content: string): CoreTagFeedElement[] {\n        const items: CoreTagFeedElement[] = [];\n        const element = CoreDomUtils.convertToElement(content);\n\n        Array.from(element.querySelectorAll('ul.tag_feed > li.media')).forEach((itemElement) => {\n            const item: CoreTagFeedElement = { details: [] };\n\n            Array.from(itemElement.querySelectorAll('div.media-body > div')).forEach((div: HTMLElement) => {\n                if (div.classList.contains('media-heading')) {\n                    item.heading = div.innerText.trim();\n                    const link = div.querySelector('a');\n                    if (link) {\n                        item.url = link.getAttribute('href');\n                    }\n                } else {\n                    // Separate details by lines.\n                    const lines = [''];\n                    Array.from(div.childNodes).forEach((childNode: Node) => {\n                        if (childNode.nodeType == Node.TEXT_NODE) {\n                            lines[lines.length - 1] += childNode.textContent;\n                        } else if (childNode.nodeType == Node.ELEMENT_NODE) {\n                            const childElement = childNode as HTMLElement;\n                            if (childElement.tagName == 'BR') {\n                                lines.push('');\n                            } else {\n                                lines[lines.length - 1] += childElement.innerText;\n                            }\n                        }\n                    });\n                    item.details.push(...lines.map((line) => line.trim()).filter((line) => line != ''));\n                }\n            });\n\n            const image = itemElement.querySelector('div.itemimage img');\n            if (image) {\n                if (image.classList.contains('userpicture')) {\n                    item.avatarUrl = image.getAttribute('src');\n                } else {\n                    item.iconUrl = image.getAttribute('src');\n                }\n            }\n\n            if (item.heading && item.url) {\n                items.push(item);\n            }\n        });\n\n        return items;\n    }\n\n}\n\nexport const CoreTagHelper = makeSingleton(CoreTagHelperProvider);\n\n/**\n * Feed area element type.\n */\nexport type CoreTagFeedElement = {\n    details: string[];\n    heading?: string;\n    iconUrl?: string | null;\n    avatarUrl?: string | null;\n    url?: string | null;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}