{"ast":null,"code":"import _objectSpread from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreLoginHelper } from '@features/login/services/login-helper';\nimport { CoreApp } from '@services/app';\nimport { CoreSites } from '@services/sites';\nimport { Router } from '@singletons';\n/**\n * Guard to check if the user is authenticated.\n *\n * @returns True if user has sites, redirect route otherwise.\n */\nexport const authGuard = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* () {\n    if (!CoreSites.isLoggedIn()) {\n      return Router.parseUrl('/login');\n    }\n    if (CoreLoginHelper.isSiteLoggedOut()) {\n      var _redirect;\n      // Send the user to reconnect page.\n      const newRoute = Router.parseUrl('/login/reconnect');\n      const siteId = CoreSites.getCurrentSiteId();\n      // Pass redirect data (if any and belongs to same site).\n      let redirect = CoreApp.consumeMemoryRedirect();\n      if (((_redirect = redirect) === null || _redirect === void 0 ? void 0 : _redirect.siteId) !== siteId) {\n        redirect = null;\n      }\n      newRoute.queryParams = _objectSpread({\n        siteId\n      }, redirect);\n      return newRoute;\n    }\n    return true;\n  });\n  return function authGuard() {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["CoreLoginHelper","CoreApp","CoreSites","Router","authGuard","_ref","_asyncToGenerator","isLoggedIn","parseUrl","isSiteLoggedOut","_redirect","newRoute","siteId","getCurrentSiteId","redirect","consumeMemoryRedirect","queryParams","_objectSpread","apply","arguments"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/mainmenu/guards/auth.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CanActivateFn } from '@angular/router';\nimport { CoreLoginHelper } from '@features/login/services/login-helper';\nimport { CoreApp } from '@services/app';\n\nimport { CoreSites } from '@services/sites';\nimport { Router } from '@singletons';\n\n/**\n * Guard to check if the user is authenticated.\n *\n * @returns True if user has sites, redirect route otherwise.\n */\nexport const authGuard: CanActivateFn = async () => {\n    if (!CoreSites.isLoggedIn()) {\n        return Router.parseUrl('/login');\n    }\n\n    if (CoreLoginHelper.isSiteLoggedOut()) {\n        // Send the user to reconnect page.\n        const newRoute = Router.parseUrl('/login/reconnect');\n        const siteId = CoreSites.getCurrentSiteId();\n\n        // Pass redirect data (if any and belongs to same site).\n        let redirect = CoreApp.consumeMemoryRedirect();\n        if (redirect?.siteId !== siteId) {\n            redirect = null;\n        }\n\n        newRoute.queryParams = {\n            siteId,\n            ...redirect,\n        };\n\n        return newRoute;\n    }\n\n    return true;\n};\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,SAASA,eAAe,QAAQ,uCAAuC;AACvE,SAASC,OAAO,QAAQ,eAAe;AAEvC,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,MAAM,QAAQ,aAAa;AAEpC;;;;;AAKA,OAAO,MAAMC,SAAS;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAkB,aAAW;IAC/C,IAAI,CAACJ,SAAS,CAACK,UAAU,EAAE,EAAE;MACzB,OAAOJ,MAAM,CAACK,QAAQ,CAAC,QAAQ,CAAC;;IAGpC,IAAIR,eAAe,CAACS,eAAe,EAAE,EAAE;MAAA,IAAAC,SAAA;MACnC;MACA,MAAMC,QAAQ,GAAGR,MAAM,CAACK,QAAQ,CAAC,kBAAkB,CAAC;MACpD,MAAMI,MAAM,GAAGV,SAAS,CAACW,gBAAgB,EAAE;MAE3C;MACA,IAAIC,QAAQ,GAAGb,OAAO,CAACc,qBAAqB,EAAE;MAC9C,IAAI,EAAAL,SAAA,GAAAI,QAAQ,cAAAJ,SAAA,uBAARA,SAAA,CAAUE,MAAM,MAAKA,MAAM,EAAE;QAC7BE,QAAQ,GAAG,IAAI;;MAGnBH,QAAQ,CAACK,WAAW,GAAAC,aAAA;QAChBL;MAAM,GACHE,QAAQ,CACd;MAED,OAAOH,QAAQ;;IAGnB,OAAO,IAAI;EACf,CAAC;EAAA,gBAzBYP,SAASA,CAAA;IAAA,OAAAC,IAAA,CAAAa,KAAA,OAAAC,SAAA;EAAA;AAAA,GAyBrB"},"metadata":{},"sourceType":"module","externalDependencies":[]}