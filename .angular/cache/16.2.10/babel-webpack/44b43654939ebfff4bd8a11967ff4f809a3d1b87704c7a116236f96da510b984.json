{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreCourseProvider } from '@features/course/services/course';\nimport { PARTICIPANTS_PAGE_NAME } from '@features/user/user.module';\nimport { makeSingleton } from '@singletons';\nimport { CoreUser } from '../user';\nimport * as i0 from \"@angular/core\";\n/**\n * Course nav handler.\n */\nexport class CoreUserCourseOptionHandlerService {\n  constructor() {\n    this.name = 'CoreUserParticipants';\n    this.priority = 600;\n  }\n  /**\n   * @inheritdoc\n   */\n  invalidateEnabledForCourse(courseId, navOptions) {\n    if (navOptions && navOptions.participants !== undefined) {\n      // No need to invalidate anything.\n      return Promise.resolve();\n    }\n    return CoreUser.invalidateParticipantsList(courseId);\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return Promise.resolve(true);\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForCourse(courseId, accessData, navOptions) {\n    if (accessData && accessData.type == CoreCourseProvider.ACCESS_GUEST) {\n      return false; // Not enabled for guests.\n    }\n\n    if (navOptions && navOptions.participants !== undefined) {\n      return navOptions.participants;\n    }\n    return CoreUser.isPluginEnabledForCourse(courseId);\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData() {\n    return {\n      title: 'core.user.participants',\n      class: 'core-user-participants-handler',\n      page: PARTICIPANTS_PAGE_NAME\n    };\n  }\n  /**\n   * @inheritdoc\n   */\n  prefetch(course) {\n    return _asyncToGenerator(function* () {\n      let offset = 0;\n      let canLoadMore = true;\n      do {\n        const result = yield CoreUser.getParticipants(course.id, offset, undefined, undefined, true);\n        offset += result.participants.length;\n        canLoadMore = result.canLoadMore;\n      } while (canLoadMore);\n    })();\n  }\n}\n_class = CoreUserCourseOptionHandlerService;\n_class.ɵfac = function CoreUserCourseOptionHandlerService_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const CoreUserCourseOptionHandler = makeSingleton(CoreUserCourseOptionHandlerService);","map":{"version":3,"names":["CoreCourseProvider","PARTICIPANTS_PAGE_NAME","makeSingleton","CoreUser","CoreUserCourseOptionHandlerService","constructor","name","priority","invalidateEnabledForCourse","courseId","navOptions","participants","undefined","Promise","resolve","invalidateParticipantsList","isEnabled","isEnabledForCourse","accessData","type","ACCESS_GUEST","isPluginEnabledForCourse","getDisplayData","title","class","page","prefetch","course","_asyncToGenerator","offset","canLoadMore","result","getParticipants","id","length","factory","ɵfac","providedIn","CoreUserCourseOptionHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/user/services/handlers/course-option.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Injectable } from '@angular/core';\nimport { CoreCourseProvider } from '@features/course/services/course';\nimport {\n    CoreCourseAccess,\n    CoreCourseOptionsHandler,\n    CoreCourseOptionsHandlerData,\n} from '@features/course/services/course-options-delegate';\nimport { CoreCourseAnyCourseData, CoreCourseUserAdminOrNavOptionIndexed } from '@features/courses/services/courses';\nimport { PARTICIPANTS_PAGE_NAME } from '@features/user/user.module';\nimport { makeSingleton } from '@singletons';\nimport { CoreUser } from '../user';\n\n/**\n * Course nav handler.\n */\n@Injectable({ providedIn: 'root' })\nexport class CoreUserCourseOptionHandlerService implements CoreCourseOptionsHandler {\n\n    name = 'CoreUserParticipants';\n    priority = 600;\n\n    /**\n     * @inheritdoc\n     */\n    invalidateEnabledForCourse(courseId: number, navOptions?: CoreCourseUserAdminOrNavOptionIndexed): Promise<void> {\n        if (navOptions && navOptions.participants !== undefined) {\n            // No need to invalidate anything.\n            return Promise.resolve();\n        }\n\n        return CoreUser.invalidateParticipantsList(courseId);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    isEnabled(): Promise<boolean> {\n        return Promise.resolve(true);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    isEnabledForCourse(\n        courseId: number,\n        accessData: CoreCourseAccess,\n        navOptions?: CoreCourseUserAdminOrNavOptionIndexed,\n    ): boolean | Promise<boolean> {\n        if (accessData && accessData.type == CoreCourseProvider.ACCESS_GUEST) {\n            return false; // Not enabled for guests.\n        }\n\n        if (navOptions && navOptions.participants !== undefined) {\n            return navOptions.participants;\n        }\n\n        return CoreUser.isPluginEnabledForCourse(courseId);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getDisplayData(): CoreCourseOptionsHandlerData | Promise<CoreCourseOptionsHandlerData> {\n        return {\n            title: 'core.user.participants',\n            class: 'core-user-participants-handler',\n            page: PARTICIPANTS_PAGE_NAME,\n        };\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async prefetch(course: CoreCourseAnyCourseData): Promise<void> {\n        let offset = 0;\n        let canLoadMore = true;\n\n        do {\n            const result = await CoreUser.getParticipants(course.id, offset, undefined, undefined, true);\n\n            offset += result.participants.length;\n            canLoadMore = result.canLoadMore;\n        } while (canLoadMore);\n    }\n\n}\n\nexport const CoreUserCourseOptionHandler = makeSingleton(CoreUserCourseOptionHandlerService);\n"],"mappings":";;AAeA,SAASA,kBAAkB,QAAQ,kCAAkC;AAOrE,SAASC,sBAAsB,QAAQ,4BAA4B;AACnE,SAASC,aAAa,QAAQ,aAAa;AAC3C,SAASC,QAAQ,QAAQ,SAAS;;AAElC;;;AAIA,OAAM,MAAOC,kCAAkC;EAD/CC,YAAA;IAGI,KAAAC,IAAI,GAAG,sBAAsB;IAC7B,KAAAC,QAAQ,GAAG,GAAG;;EAEd;;;EAGAC,0BAA0BA,CAACC,QAAgB,EAAEC,UAAkD;IAC3F,IAAIA,UAAU,IAAIA,UAAU,CAACC,YAAY,KAAKC,SAAS,EAAE;MACrD;MACA,OAAOC,OAAO,CAACC,OAAO,EAAE;;IAG5B,OAAOX,QAAQ,CAACY,0BAA0B,CAACN,QAAQ,CAAC;EACxD;EAEA;;;EAGAO,SAASA,CAAA;IACL,OAAOH,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;EAChC;EAEA;;;EAGAG,kBAAkBA,CACdR,QAAgB,EAChBS,UAA4B,EAC5BR,UAAkD;IAElD,IAAIQ,UAAU,IAAIA,UAAU,CAACC,IAAI,IAAInB,kBAAkB,CAACoB,YAAY,EAAE;MAClE,OAAO,KAAK,CAAC,CAAC;;;IAGlB,IAAIV,UAAU,IAAIA,UAAU,CAACC,YAAY,KAAKC,SAAS,EAAE;MACrD,OAAOF,UAAU,CAACC,YAAY;;IAGlC,OAAOR,QAAQ,CAACkB,wBAAwB,CAACZ,QAAQ,CAAC;EACtD;EAEA;;;EAGAa,cAAcA,CAAA;IACV,OAAO;MACHC,KAAK,EAAE,wBAAwB;MAC/BC,KAAK,EAAE,gCAAgC;MACvCC,IAAI,EAAExB;KACT;EACL;EAEA;;;EAGMyB,QAAQA,CAACC,MAA+B;IAAA,OAAAC,iBAAA;MAC1C,IAAIC,MAAM,GAAG,CAAC;MACd,IAAIC,WAAW,GAAG,IAAI;MAEtB,GAAG;QACC,MAAMC,MAAM,SAAS5B,QAAQ,CAAC6B,eAAe,CAACL,MAAM,CAACM,EAAE,EAAEJ,MAAM,EAAEjB,SAAS,EAAEA,SAAS,EAAE,IAAI,CAAC;QAE5FiB,MAAM,IAAIE,MAAM,CAACpB,YAAY,CAACuB,MAAM;QACpCJ,WAAW,GAAGC,MAAM,CAACD,WAAW;OACnC,QAAQA,WAAW;IAAE;EAC1B;;SAnES1B,kCAAkC;;mBAAlCA,MAAkC;AAAA;;SAAlCA,MAAkC;EAAA+B,OAAA,EAAlC/B,MAAkC,CAAAgC,IAAA;EAAAC,UAAA,EADrB;AAAM;AAwEhC,OAAO,MAAMC,2BAA2B,GAAGpC,aAAa,CAACE,kCAAkC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}