{"ast":null,"code":"import _objectSpread from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreError } from '@classes/errors/error';\nimport { CoreCourseModuleMainActivityComponent } from '@features/course/classes/main-activity-component';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreTag } from '@features/tag/services/tag';\nimport { CoreUser } from '@features/user/services/user';\nimport { CoreNetwork } from '@services/network';\nimport { CoreGroups } from '@services/groups';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate, NgZone } from '@singletons';\nimport { CoreEvents } from '@singletons/events';\nimport { CorePath } from '@singletons/path';\nimport { Md5 } from 'ts-md5';\nimport { AddonModWikiModuleHandlerService } from '../../services/handlers/module';\nimport { AddonModWiki, AddonModWikiProvider } from '../../services/wiki';\nimport { AddonModWikiOffline } from '../../services/wiki-offline';\nimport { AddonModWikiSync, AddonModWikiSyncProvider } from '../../services/wiki-sync';\nimport { AddonModWikiMapModalComponent } from '../map/map';\nimport { AddonModWikiSubwikiPickerComponent } from '../subwiki-picker/subwiki-picker';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@features/course/pages/contents/contents\";\nfunction AddonModWikiIndexComponent_ion_button_1_ion_icon_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"ion-icon\", 19);\n  }\n}\nfunction AddonModWikiIndexComponent_ion_button_1_ion_icon_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"ion-icon\", 20);\n  }\n}\nfunction AddonModWikiIndexComponent_ion_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function AddonModWikiIndexComponent_ion_button_1_Template_ion_button_click_0_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.showSubwikiPicker($event));\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵtemplate(2, AddonModWikiIndexComponent_ion_button_1_ion_icon_2_Template, 1, 0, \"ion-icon\", 17);\n    i0.ɵɵtemplate(3, AddonModWikiIndexComponent_ion_button_1_ion_icon_3_Template, 1, 0, \"ion-icon\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 3, \"addon.mod_wiki.subwiki\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.groupWiki);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.groupWiki);\n  }\n}\nfunction AddonModWikiIndexComponent_ion_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function AddonModWikiIndexComponent_ion_button_2_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.openMap());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelement(2, \"ion-icon\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 1, \"addon.mod_wiki.map\"));\n  }\n}\nfunction AddonModWikiIndexComponent_core_context_menu_item_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-context-menu-item\", 22);\n    i0.ɵɵlistener(\"action\", function AddonModWikiIndexComponent_core_context_menu_item_4_Template_core_context_menu_item_action_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.goToEditPage());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"priority\", 590)(\"content\", i0.ɵɵpipeBind1(1, 2, \"core.edit\"));\n  }\n}\nfunction AddonModWikiIndexComponent_core_context_menu_item_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-context-menu-item\", 23);\n    i0.ɵɵlistener(\"action\", function AddonModWikiIndexComponent_core_context_menu_item_5_Template_core_context_menu_item_action_0_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.goToNewPage());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"priority\", 580)(\"content\", i0.ɵɵpipeBind1(1, 2, \"addon.mod_wiki.createpage\"));\n  }\n}\nfunction AddonModWikiIndexComponent_core_course_module_info_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-course-module-info\", 24);\n    i0.ɵɵlistener(\"completionChanged\", function AddonModWikiIndexComponent_core_course_module_info_10_Template_core_course_module_info_completionChanged_0_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.onCompletionChange());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"module\", ctx_r4.module)(\"description\", ctx_r4.description)(\"component\", ctx_r4.component)(\"componentId\", ctx_r4.componentId)(\"courseId\", ctx_r4.courseId);\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    $a: a0\n  };\n};\nfunction AddonModWikiIndexComponent_div_11_ion_card_1_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r26 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, \"core.hasdatatosync\", i0.ɵɵpureFunction1(4, _c0, ctx_r26.pageStr)));\n  }\n}\nfunction AddonModWikiIndexComponent_div_11_ion_card_1_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r27 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, \"core.hasdatatosync\", i0.ɵɵpureFunction1(4, _c0, ctx_r27.moduleName)));\n  }\n}\nfunction AddonModWikiIndexComponent_div_11_ion_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\", 26)(1, \"ion-item\", 27);\n    i0.ɵɵelement(2, \"ion-icon\", 28);\n    i0.ɵɵelementStart(3, \"ion-label\");\n    i0.ɵɵtemplate(4, AddonModWikiIndexComponent_div_11_ion_card_1_span_4_Template, 3, 6, \"span\", 8);\n    i0.ɵɵtemplate(5, AddonModWikiIndexComponent_div_11_ion_card_1_span_5_Template, 3, 6, \"span\", 8);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r24 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r24.pageIsOffline);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r24.pageIsOffline);\n  }\n}\nfunction AddonModWikiIndexComponent_div_11_ion_card_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\", 26)(1, \"ion-item\");\n    i0.ɵɵelement(2, \"ion-icon\", 28);\n    i0.ɵɵelementStart(3, \"ion-label\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r25 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r25.pageWarning);\n  }\n}\nfunction AddonModWikiIndexComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, AddonModWikiIndexComponent_div_11_ion_card_1_Template, 6, 2, \"ion-card\", 25);\n    i0.ɵɵtemplate(2, AddonModWikiIndexComponent_div_11_ion_card_2_Template, 5, 1, \"ion-card\", 25);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.pageIsOffline || ctx_r5.hasOffline);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.pageWarning);\n  }\n}\nfunction AddonModWikiIndexComponent_h2_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r6.pageTitle);\n  }\n}\nfunction AddonModWikiIndexComponent_core_format_text_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-format-text\", 29);\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"component\", ctx_r7.component)(\"componentId\", ctx_r7.componentId)(\"text\", ctx_r7.pageContent)(\"contextInstanceId\", ctx_r7.module.id)(\"courseId\", ctx_r7.courseId);\n  }\n}\nfunction AddonModWikiIndexComponent_core_empty_box_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-empty-box\", 30);\n    i0.ɵɵpipe(1, \"translate\");\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"message\", i0.ɵɵpipeBind1(1, 1, \"addon.mod_wiki.nocontent\"));\n  }\n}\nfunction AddonModWikiIndexComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"strong\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"core-tag-list\", 32);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(3, 2, \"core.tag.tags\"), \":\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"tags\", ctx_r9.tags);\n  }\n}\nfunction AddonModWikiIndexComponent_core_course_module_navigation_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-course-module-navigation\", 33);\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"hidden\", ctx_r10.showLoading)(\"courseId\", ctx_r10.courseId)(\"currentModuleId\", ctx_r10.module.id);\n  }\n}\nfunction AddonModWikiIndexComponent_ion_fab_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r29 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-fab\", 34)(1, \"ion-fab-button\", 35);\n    i0.ɵɵlistener(\"click\", function AddonModWikiIndexComponent_ion_fab_19_Template_ion_fab_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r29);\n      const ctx_r28 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r28.goToNewPage());\n    });\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelement(3, \"ion-icon\", 36);\n    i0.ɵɵelementStart(4, \"span\", 37);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(2, 2, \"addon.mod_wiki.createpage\"));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 4, \"addon.mod_wiki.createpage\"));\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    \"addon-mod_wiki-noedit\": a0\n  };\n};\n/**\n * Component that displays a wiki entry page.\n */\nexport class AddonModWikiIndexComponent extends CoreCourseModuleMainActivityComponent {\n  constructor(content, courseContentsPage) {\n    super('AddonModLessonIndexComponent', content, courseContentsPage);\n    this.content = content;\n    this.component = AddonModWikiProvider.COMPONENT;\n    this.pluginName = 'wiki';\n    this.groupWiki = false;\n    this.isOnline = false;\n    this.isMainPage = false; // Whether the user is viewing wiki's main page (just entered the wiki).\n    this.canEdit = false; // Whether user can edit the page.\n    this.pageStr = '';\n    this.loadedSubwikis = []; // The loaded subwikis.\n    this.pageIsOffline = false; // Whether the loaded page is an offline page.\n    this.tagsEnabled = false;\n    this.tags = [];\n    this.subwikiData = {\n      subwikiSelected: 0,\n      userSelected: 0,\n      groupSelected: 0,\n      subwikis: [],\n      count: 0\n    };\n    this.syncEventName = AddonModWikiSyncProvider.AUTO_SYNCED;\n    this.ignoreManualSyncEvent = false; // Whether manual sync event should be ignored.\n    this.isOnline = CoreNetwork.isOnline();\n    // Refresh online status when changes.\n    this.onlineSubscription = CoreNetwork.onChange().subscribe(() => {\n      // Execute the callback in the Angular zone, so change detection doesn't stop working.\n      NgZone.run(() => {\n        this.isOnline = CoreNetwork.isOnline();\n      });\n    });\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _superprop_getNgOnInit = () => super.ngOnInit,\n      _this = this;\n    return _asyncToGenerator(function* () {\n      _superprop_getNgOnInit().call(_this);\n      _this.pageStr = Translate.instant('addon.mod_wiki.wikipage');\n      _this.tagsEnabled = CoreTag.areTagsAvailableInSite();\n      _this.currentUserId = CoreSites.getCurrentSiteUserId();\n      _this.isMainPage = !_this.pageId && !_this.pageTitle;\n      _this.currentPage = _this.pageId;\n      _this.currentPath = CoreNavigator.getCurrentPath();\n      _this.listenEvents();\n      try {\n        yield _this.loadContent(false, true);\n      } finally {\n        if (_this.action == 'map') {\n          _this.openMap();\n        }\n      }\n    })();\n  }\n  /**\n   * Listen to events.\n   */\n  listenEvents() {\n    // Listen for manual sync events.\n    this.manualSyncObserver = CoreEvents.on(AddonModWikiSyncProvider.MANUAL_SYNCED, data => {\n      if (!data || !this.wiki || data.wikiId != this.wiki.id) {\n        return;\n      }\n      if (this.ignoreManualSyncEvent) {\n        // Event needs to be ignored.\n        this.ignoreManualSyncEvent = false;\n        return;\n      }\n      if (this.currentSubwiki) {\n        this.checkPageCreatedOrDiscarded(data.subwikis[this.currentSubwiki.id]);\n      }\n      if (!this.pageWarning) {\n        this.showLoadingAndFetch(false, false);\n      }\n    }, this.siteId);\n  }\n  /**\n   * Check if the current page was created or discarded.\n   *\n   * @param data Data about created and deleted pages.\n   */\n  checkPageCreatedOrDiscarded(data) {\n    if (this.currentPage || !data) {\n      return;\n    }\n    // This is an offline page. Check if the page was created.\n    const page = data.created.find(page => page.title == this.pageTitle);\n    if (page) {\n      // Page was created, set the ID so it's retrieved from server.\n      this.currentPage = page.pageId;\n      this.pageIsOffline = false;\n    } else {\n      // Page not found in created list, check if it was discarded.\n      const page = data.discarded.find(page => page.title == this.pageTitle);\n      if (page) {\n        // Page discarded, show warning.\n        this.pageWarning = page.warning;\n        this.pageContent = '';\n        this.pageIsOffline = false;\n        this.hasOffline = false;\n      }\n    }\n  }\n  /**\n   * @inheritdoc\n   */\n  fetchContent(refresh, sync = false, showErrors = false) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // Get the wiki instance.\n        _this2.wiki = yield AddonModWiki.getWiki(_this2.courseId, _this2.module.id);\n        if (_this2.pageContent === undefined) {\n          // Page not loaded yet, emit the data to update the page title.\n          _this2.dataRetrieved.emit(_this2.wiki);\n        }\n        AddonModWiki.wikiPageOpened(_this2.wiki.id, _this2.currentPath);\n        if (sync) {\n          // Try to synchronize the wiki.\n          yield CoreUtils.ignoreErrors(_this2.syncActivity(showErrors));\n        }\n        if (_this2.pageWarning) {\n          // Page discarded, stop getting data.\n          return;\n        }\n        // Get module instance if it's empty.\n        if (!_this2.module.id) {\n          _this2.module = yield CoreCourse.getModule(_this2.wiki.coursemodule, _this2.wiki.course, undefined, true);\n        }\n        _this2.description = _this2.wiki.intro || _this2.module.description;\n        _this2.componentId = _this2.module.id;\n        yield _this2.fetchSubwikis(_this2.wiki.id);\n        // Get the subwiki list data from the cache.\n        const subwikiList = AddonModWiki.getSubwikiList(_this2.wiki.id);\n        if (!subwikiList) {\n          // Not found in cache, create a new one.\n          // Get real groupmode, in case it's forced by the course.\n          const groupInfo = yield CoreGroups.getActivityGroupInfo(_this2.wiki.coursemodule);\n          if (groupInfo.separateGroups && !groupInfo.groups.length) {\n            throw new CoreError(Translate.instant('addon.mod_wiki.cannotviewpage'));\n          }\n          yield _this2.createSubwikiList(groupInfo.groups);\n        } else {\n          _this2.subwikiData.count = subwikiList.count;\n          _this2.setSelectedWiki(_this2.subwikiId, _this2.userId, _this2.groupId);\n          // If nothing was selected using nav params, use the selected from cache.\n          if (!_this2.isAnySubwikiSelected()) {\n            _this2.setSelectedWiki(subwikiList.subwikiSelected, subwikiList.userSelected, subwikiList.groupSelected);\n          }\n          _this2.subwikiData.subwikis = subwikiList.subwikis;\n        }\n        if (!_this2.isAnySubwikiSelected() || _this2.subwikiData.count <= 0) {\n          throw new CoreError(Translate.instant('addon.mod_wiki.errornowikiavailable'));\n        }\n        yield _this2.fetchWikiPage();\n      } catch (error) {\n        if (_this2.pageWarning) {\n          // Warning is already shown in screen, no need to show a modal.\n          return;\n        }\n        throw error;\n      }\n    })();\n  }\n  fetchPageContents(pageId) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (pageId) {\n        // Online page.\n        _this3.pageIsOffline = false;\n        return AddonModWiki.getPageContents(pageId, {\n          cmId: _this3.module.id\n        });\n      }\n      // No page ID but we received a title. This means we're trying to load an offline page.\n      try {\n        var _this3$wiki, _this3$currentSubwiki, _this3$currentSubwiki2, _this3$currentSubwiki3, _this3$currentSubwiki4;\n        const title = _this3.pageTitle || ((_this3$wiki = _this3.wiki) === null || _this3$wiki === void 0 ? void 0 : _this3$wiki.firstpagetitle) || '';\n        const offlinePage = yield AddonModWikiOffline.getNewPage(title, (_this3$currentSubwiki = _this3.currentSubwiki) === null || _this3$currentSubwiki === void 0 ? void 0 : _this3$currentSubwiki.id, (_this3$currentSubwiki2 = _this3.currentSubwiki) === null || _this3$currentSubwiki2 === void 0 ? void 0 : _this3$currentSubwiki2.wikiid, (_this3$currentSubwiki3 = _this3.currentSubwiki) === null || _this3$currentSubwiki3 === void 0 ? void 0 : _this3$currentSubwiki3.userid, (_this3$currentSubwiki4 = _this3.currentSubwiki) === null || _this3$currentSubwiki4 === void 0 ? void 0 : _this3$currentSubwiki4.groupid);\n        _this3.pageIsOffline = true;\n        if (!_this3.newPageObserver) {\n          // It's an offline page, listen for new pages event to detect if the user goes to Edit and submits the page.\n          _this3.newPageObserver = CoreEvents.on(AddonModWikiProvider.PAGE_CREATED_EVENT, /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (data) {\n              var _this3$currentSubwiki5, _this3$newPageObserve;\n              if (data.subwikiId != ((_this3$currentSubwiki5 = _this3.currentSubwiki) === null || _this3$currentSubwiki5 === void 0 ? void 0 : _this3$currentSubwiki5.id) || data.pageTitle != title) {\n                return;\n              }\n              // The page has been submitted. Get the page from the server.\n              _this3.currentPage = data.pageId;\n              // Stop listening for new page events.\n              (_this3$newPageObserve = _this3.newPageObserver) === null || _this3$newPageObserve === void 0 || _this3$newPageObserve.off();\n              _this3.newPageObserver = undefined;\n              yield _this3.showLoadingAndFetch(true, false);\n              _this3.currentPage && _this3.logPageViewed(_this3.currentPage);\n            });\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }(), CoreSites.getCurrentSiteId());\n        }\n        return offlinePage;\n      } catch (_unused) {\n        // Page not found, ignore.\n      }\n    })();\n  }\n  /**\n   * Fetch the list of pages of a subwiki.\n   *\n   * @param subwiki Subwiki.\n   */\n  fetchSubwikiPages(subwiki) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const subwikiPages = subwiki.id <= 0 ? [] : yield AddonModWiki.getSubwikiPages(subwiki.wikiid, {\n        groupId: subwiki.groupid,\n        userId: subwiki.userid,\n        cmId: _this4.module.id\n      });\n      _this4.setCurrentPage(subwikiPages);\n      // Now get the offline pages.\n      const dbPages = yield AddonModWikiOffline.getSubwikiNewPages(subwiki.id, subwiki.wikiid, subwiki.userid, subwiki.groupid);\n      _this4.subwikiPages = AddonModWiki.sortPagesByTitle(subwikiPages.concat(dbPages));\n      // Reject if no currentPage selected from the subwikis given (if no subwikis available, do not reject).\n      if (!_this4.currentPage && !_this4.pageTitle && _this4.subwikiPages.length > 0) {\n        throw new CoreError();\n      }\n    })();\n  }\n  /**\n   * Set current page if needed.\n   *\n   * @param subwikiPages List of subwiki pages.\n   */\n  setCurrentPage(subwikiPages) {\n    var _firstPage$title, _this$wiki;\n    if (this.currentPage) {\n      return; // Already set, nothing to do.\n    }\n\n    if (this.pageTitle) {\n      // Got the page title but not its ID. Search the page.\n      const page = subwikiPages.find(page => page.title === this.pageTitle);\n      if (page) {\n        this.currentPage = page.id;\n      }\n      return;\n    }\n    // No page specified, search first page.\n    const firstPage = subwikiPages.find(page => page.firstpage);\n    this.currentPage = firstPage === null || firstPage === void 0 ? void 0 : firstPage.id;\n    this.pageTitle = (_firstPage$title = firstPage === null || firstPage === void 0 ? void 0 : firstPage.title) !== null && _firstPage$title !== void 0 ? _firstPage$title : (_this$wiki = this.wiki) === null || _this$wiki === void 0 ? void 0 : _this$wiki.firstpagetitle;\n  }\n  /**\n   * Get the subwikis.\n   *\n   * @param wikiId Wiki ID.\n   */\n  fetchSubwikis(wikiId) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      _this5.loadedSubwikis = yield AddonModWiki.getSubwikis(wikiId, {\n        cmId: _this5.module.id\n      });\n      _this5.hasOffline = yield AddonModWikiOffline.subwikisHaveOfflineData(_this5.loadedSubwikis);\n    })();\n  }\n  /**\n   * Fetch the page to be shown.\n   *\n   * @returns Promise resolved when done.\n   */\n  fetchWikiPage() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      // Search the current Subwiki.\n      _this6.currentSubwiki = _this6.loadedSubwikis.find(subwiki => _this6.isSubwikiSelected(subwiki));\n      if (!_this6.currentSubwiki) {\n        throw new CoreError();\n      }\n      _this6.setSelectedWiki(_this6.currentSubwiki.id, _this6.currentSubwiki.userid, _this6.currentSubwiki.groupid);\n      yield _this6.fetchSubwikiPages(_this6.currentSubwiki);\n      // Check can edit before to have the value if there's no valid page.\n      _this6.canEdit = _this6.currentSubwiki.canedit;\n      const pageContents = yield _this6.fetchPageContents(_this6.currentPage);\n      if (pageContents) {\n        _this6.setSelectedWiki(pageContents.subwikiid, pageContents.userid, pageContents.groupid);\n        _this6.pageTitle = pageContents.title;\n        _this6.pageContent = _this6.replaceEditLinks(pageContents.cachedcontent);\n        _this6.canEdit = !!pageContents.caneditpage;\n        _this6.currentPageObj = pageContents;\n        _this6.tags = 'tags' in pageContents && pageContents.tags || [];\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  logActivity() {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      var _this7$currentPageObj2;\n      if (!_this7.wiki) {\n        return; // Shouldn't happen.\n      }\n\n      if (_this7.pageId) {\n        // View page.\n        _this7.checkCompletionAfterLog = false;\n        yield _this7.logPageViewed(_this7.pageId);\n        return;\n      }\n      yield AddonModWiki.logView(_this7.wiki.id);\n      if (_this7.groupId === undefined && _this7.userId === undefined) {\n        var _this7$currentPageObj;\n        // View initial page.\n        _this7.analyticsLogEvent('mod_wiki_view_wiki', {\n          name: (_this7$currentPageObj = _this7.currentPageObj) === null || _this7$currentPageObj === void 0 ? void 0 : _this7$currentPageObj.title\n        });\n        return;\n      }\n      // Viewing a different subwiki.\n      const hasPersonalSubwikis = _this7.loadedSubwikis.some(subwiki => subwiki.userid > 0);\n      const hasGroupSubwikis = _this7.loadedSubwikis.some(subwiki => subwiki.groupid > 0);\n      let url = `/mod/wiki/view.php?wid=${_this7.wiki.id}&title=${_this7.wiki.firstpagetitle}`;\n      if (hasPersonalSubwikis && hasGroupSubwikis) {\n        url += `&groupanduser=${_this7.groupId}-${_this7.userId}`;\n      } else if (hasPersonalSubwikis) {\n        url += `&uid=${_this7.userId}`;\n      } else {\n        url += `&group=${_this7.groupId}`;\n      }\n      _this7.analyticsLogEvent('mod_wiki_view_wiki', {\n        name: (_this7$currentPageObj2 = _this7.currentPageObj) === null || _this7$currentPageObj2 === void 0 ? void 0 : _this7$currentPageObj2.title,\n        data: {\n          subwiki: _this7.subwikiId,\n          userid: _this7.userId,\n          groupid: _this7.groupId\n        },\n        url\n      });\n    })();\n  }\n  /**\n   * Log page viewed.\n   *\n   * @param pageId Page ID.\n   */\n  logPageViewed(pageId) {\n    var _this8 = this;\n    return _asyncToGenerator(function* () {\n      var _this8$currentPageObj;\n      if (!_this8.wiki) {\n        return; // Shouldn't happen.\n      }\n\n      yield CoreUtils.ignoreErrors(AddonModWiki.logPageView(pageId, _this8.wiki.id));\n      _this8.analyticsLogEvent('mod_wiki_view_page', {\n        name: (_this8$currentPageObj = _this8.currentPageObj) === null || _this8$currentPageObj === void 0 ? void 0 : _this8$currentPageObj.title,\n        data: {\n          pageid: _this8.pageId\n        },\n        url: `/mod/wiki/view.php?page=${_this8.pageId}`\n      });\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  storeModuleViewed() {\n    var _superprop_getStoreModuleViewed = () => super.storeModuleViewed,\n      _this9 = this;\n    return _asyncToGenerator(function* () {\n      // Only store module viewed when viewing the main page.\n      if (!_this9.pageId) {\n        yield _superprop_getStoreModuleViewed().call(_this9);\n      }\n    })();\n  }\n  /**\n   * Get path to the wiki home view. If cannot determine or it's current view, return undefined.\n   *\n   * @returns The path of the home view\n   */\n  getWikiHomeView() {\n    if (!this.wiki) {\n      return;\n    }\n    return AddonModWiki.getFirstWikiPageOpened(this.wiki.id, this.currentPath);\n  }\n  /**\n   * Open the view to create the first page of the wiki.\n   */\n  goToCreateFirstPage() {\n    var _this$wiki$firstpaget, _this$wiki2, _this$currentSubwiki, _this$currentSubwiki2, _this$currentSubwiki3;\n    CoreNavigator.navigateToSitePath(`${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`, {\n      params: {\n        pageTitle: (_this$wiki$firstpaget = (_this$wiki2 = this.wiki) === null || _this$wiki2 === void 0 ? void 0 : _this$wiki2.firstpagetitle) !== null && _this$wiki$firstpaget !== void 0 ? _this$wiki$firstpaget : '',\n        wikiId: (_this$currentSubwiki = this.currentSubwiki) === null || _this$currentSubwiki === void 0 ? void 0 : _this$currentSubwiki.wikiid,\n        userId: (_this$currentSubwiki2 = this.currentSubwiki) === null || _this$currentSubwiki2 === void 0 ? void 0 : _this$currentSubwiki2.userid,\n        groupId: (_this$currentSubwiki3 = this.currentSubwiki) === null || _this$currentSubwiki3 === void 0 ? void 0 : _this$currentSubwiki3.groupid\n      }\n    });\n  }\n  /**\n   * Open the view to edit the current page.\n   */\n  goToEditPage() {\n    if (!this.canEdit) {\n      return;\n    }\n    if (this.currentPageObj) {\n      // Current page exists, go to edit it.\n      const pageParams = {\n        pageTitle: this.currentPageObj.title,\n        subwikiId: this.currentPageObj.subwikiid\n      };\n      if ('id' in this.currentPageObj) {\n        pageParams.pageId = this.currentPageObj.id;\n      }\n      if (this.currentSubwiki) {\n        pageParams.wikiId = this.currentSubwiki.wikiid;\n        pageParams.userId = this.currentSubwiki.userid;\n        pageParams.groupId = this.currentSubwiki.groupid;\n      }\n      CoreNavigator.navigateToSitePath(`${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`, {\n        params: pageParams\n      });\n    } else if (this.currentSubwiki) {\n      // No page loaded, the wiki doesn't have first page.\n      this.goToCreateFirstPage();\n    }\n  }\n  /**\n   * Go to the view to create a new page.\n   */\n  goToNewPage() {\n    if (!this.canEdit) {\n      return;\n    }\n    if (this.currentPageObj) {\n      // Current page exists, go to edit it.\n      const pageParams = {\n        subwikiId: this.currentPageObj.subwikiid\n      };\n      if (this.currentSubwiki) {\n        pageParams.wikiId = this.currentSubwiki.wikiid;\n        pageParams.userId = this.currentSubwiki.userid;\n        pageParams.groupId = this.currentSubwiki.groupid;\n      }\n      CoreNavigator.navigateToSitePath(`${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`, {\n        params: pageParams\n      });\n    } else if (this.currentSubwiki) {\n      // No page loaded, the wiki doesn't have first page.\n      this.goToCreateFirstPage();\n    }\n  }\n  /**\n   * Go to view a certain page.\n   *\n   * @param page Page to view.\n   */\n  goToPage(page) {\n    var _this10 = this;\n    return _asyncToGenerator(function* () {\n      if (!('id' in page)) {\n        // It's an offline page. Check if we are already in the same offline page.\n        if (_this10.currentPage || !_this10.pageTitle || page.title != _this10.pageTitle) {\n          _this10.openPageOrSubwiki({\n            pageTitle: page.title,\n            subwikiId: page.subwikiid\n          });\n        }\n      } else if (_this10.currentPage != page.id) {\n        // Add a new State.\n        const pageContents = yield _this10.fetchPageContents(page.id);\n        _this10.openPageOrSubwiki({\n          pageTitle: pageContents.title,\n          pageId: pageContents.id,\n          subwikiId: page.subwikiid\n        });\n      }\n    })();\n  }\n  /**\n   * Open a page or a subwiki in the current wiki.\n   *\n   * @param options Options\n   * @returns Promise.\n   */\n  openPageOrSubwiki(options) {\n    var _this11 = this;\n    return _asyncToGenerator(function* () {\n      const hash = Md5.hashAsciiStr(JSON.stringify(_objectSpread(_objectSpread({}, options), {}, {\n        timestamp: Date.now()\n      })));\n      CoreNavigator.navigateToSitePath(`${AddonModWikiModuleHandlerService.PAGE_NAME}/${_this11.courseId}/${_this11.module.id}/page/${hash}`, {\n        params: _objectSpread({\n          module: _this11.module\n        }, options),\n        animated: !options.replace,\n        replace: options.replace\n      });\n    })();\n  }\n  /**\n   * Show the map.\n   */\n  openMap() {\n    var _this12 = this;\n    return _asyncToGenerator(function* () {\n      // Create the toc modal.\n      const modalData = yield CoreDomUtils.openSideModal({\n        component: AddonModWikiMapModalComponent,\n        componentProps: {\n          pages: _this12.subwikiPages,\n          homeView: _this12.getWikiHomeView(),\n          moduleId: _this12.module.id,\n          courseId: _this12.courseId,\n          selectedId: _this12.currentPage,\n          selectedTitle: _this12.currentPageObj && _this12.currentPageObj.title,\n          wiki: _this12.wiki\n        }\n      });\n      if (modalData) {\n        if (modalData.home) {\n          // Go back to the initial page of the wiki.\n          CoreNavigator.navigateToSitePath(modalData.home, {\n            animationDirection: 'back'\n          });\n        } else if (modalData.page) {\n          _this12.goToPage(modalData.page);\n        }\n      }\n    })();\n  }\n  /**\n   * Go to the page to view a certain subwiki.\n   *\n   * @param subwikiId Subwiki ID.\n   * @param userId User ID of the subwiki.\n   * @param groupId Group ID of the subwiki.\n   */\n  goToSubwiki(subwikiId, userId, groupId) {\n    var _this$currentSubwiki4, _this$currentSubwiki5, _this$currentSubwiki6;\n    if (subwikiId !== ((_this$currentSubwiki4 = this.currentSubwiki) === null || _this$currentSubwiki4 === void 0 ? void 0 : _this$currentSubwiki4.id) || userId !== ((_this$currentSubwiki5 = this.currentSubwiki) === null || _this$currentSubwiki5 === void 0 ? void 0 : _this$currentSubwiki5.userid) || groupId !== ((_this$currentSubwiki6 = this.currentSubwiki) === null || _this$currentSubwiki6 === void 0 ? void 0 : _this$currentSubwiki6.groupid)) {\n      this.openPageOrSubwiki({\n        subwikiId: subwikiId,\n        userId: userId,\n        groupId: groupId,\n        replace: true\n      });\n    }\n  }\n  /**\n   * Checks if there is any subwiki selected.\n   *\n   * @returns Whether there is any subwiki selected.\n   */\n  isAnySubwikiSelected() {\n    return this.subwikiData.subwikiSelected !== 0 || this.subwikiData.userSelected > 0 || this.subwikiData.groupSelected > 0;\n  }\n  /**\n   * Checks if the given subwiki is the one picked on the subwiki picker.\n   *\n   * @param subwiki Subwiki to check.\n   * @returns Whether it's the selected subwiki.\n   */\n  isSubwikiSelected(subwiki) {\n    if (subwiki.id > 0 && this.subwikiData.subwikiSelected > 0) {\n      return subwiki.id == this.subwikiData.subwikiSelected;\n    }\n    return subwiki.userid == this.subwikiData.userSelected && subwiki.groupid == this.subwikiData.groupSelected;\n  }\n  /**\n   * Replace edit links to have full url.\n   *\n   * @param content Content to treat.\n   * @returns Treated content.\n   */\n  replaceEditLinks(content) {\n    content = content.trim();\n    if (content.length > 0) {\n      const editUrl = CorePath.concatenatePaths(CoreSites.getRequiredCurrentSite().getURL(), '/mod/wiki/edit.php');\n      content = content.replace(/href=\"edit\\.php/g, 'href=\"' + editUrl);\n    }\n    return content;\n  }\n  /**\n   * Sets the selected subwiki for the subwiki picker.\n   *\n   * @param subwikiId Subwiki ID to select.\n   * @param userId User ID of the subwiki to select.\n   * @param groupId Group ID of the subwiki to select.\n   */\n  setSelectedWiki(subwikiId, userId, groupId) {\n    this.subwikiData.subwikiSelected = subwikiId !== null && subwikiId !== void 0 ? subwikiId : 0;\n    this.subwikiData.userSelected = AddonModWikiOffline.convertToPositiveNumber(userId);\n    this.subwikiData.groupSelected = AddonModWikiOffline.convertToPositiveNumber(groupId);\n  }\n  /**\n   * @inheritdoc\n   */\n  hasSyncSucceed(result) {\n    if (!result) {\n      return false;\n    }\n    if (result.updated && this.wiki) {\n      // Trigger event.\n      this.ignoreManualSyncEvent = true;\n      CoreEvents.trigger(AddonModWikiSyncProvider.MANUAL_SYNCED, _objectSpread(_objectSpread({}, result), {}, {\n        wikiId: this.wiki.id\n      }));\n    }\n    if (this.currentSubwiki) {\n      this.checkPageCreatedOrDiscarded(result.subwikis[this.currentSubwiki.id]);\n    }\n    return result.updated;\n  }\n  /**\n   * User entered the page that contains the component.\n   */\n  ionViewDidEnter() {\n    super.ionViewDidEnter();\n    const editedPageData = AddonModWiki.consumeEditedPageData();\n    if (!editedPageData) {\n      return;\n    }\n    // User has just edited a page. Check if it's the current page.\n    if (this.pageId && editedPageData.pageId === this.pageId) {\n      this.showLoadingAndRefresh(true, false);\n      return;\n    }\n    const sameSubwiki = this.currentSubwiki && (this.currentSubwiki.id > 0 && this.currentSubwiki.id === editedPageData.subwikiId || this.currentSubwiki.userid === editedPageData.userId && this.currentSubwiki.groupid === editedPageData.groupId);\n    if (sameSubwiki && editedPageData.pageTitle === this.pageTitle) {\n      this.showLoadingAndRefresh(true, false);\n      return;\n    }\n    // Not same page or we cannot tell. Open the page.\n    this.openPageOrSubwiki({\n      pageId: editedPageData.pageId,\n      pageTitle: editedPageData.pageTitle,\n      subwikiId: editedPageData.subwikiId,\n      userId: editedPageData.wikiId,\n      groupId: editedPageData.groupId\n    });\n    if (editedPageData.pageId && (!this.pageContent || this.pageContent.indexOf('/mod/wiki/create.php') != -1)) {\n      // Refresh current page anyway because the new page could have been created using the create link.\n      this.showLoadingAndRefresh(true, false);\n    }\n  }\n  /**\n   * @inheritdoc\n   */\n  invalidateContent() {\n    var _this13 = this;\n    return _asyncToGenerator(function* () {\n      const promises = [];\n      promises.push(AddonModWiki.invalidateWikiData(_this13.courseId));\n      if (_this13.wiki) {\n        promises.push(AddonModWiki.invalidateSubwikis(_this13.wiki.id));\n        promises.push(CoreGroups.invalidateActivityAllowedGroups(_this13.wiki.coursemodule));\n        promises.push(CoreGroups.invalidateActivityGroupMode(_this13.wiki.coursemodule));\n      }\n      if (_this13.currentSubwiki) {\n        promises.push(AddonModWiki.invalidateSubwikiPages(_this13.currentSubwiki.wikiid));\n        promises.push(AddonModWiki.invalidateSubwikiFiles(_this13.currentSubwiki.wikiid));\n      }\n      if (_this13.currentPage) {\n        promises.push(AddonModWiki.invalidatePage(_this13.currentPage));\n      }\n      yield Promise.all(promises);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  isRefreshSyncNeeded(syncEventData) {\n    if (this.currentSubwiki && syncEventData.subwikiId == this.currentSubwiki.id && syncEventData.wikiId == this.currentSubwiki.wikiid && syncEventData.userId == this.currentSubwiki.userid && syncEventData.groupId == this.currentSubwiki.groupid) {\n      if (this.isCurrentView && syncEventData.warnings && syncEventData.warnings.length) {\n        // Show warnings.\n        CoreDomUtils.showAlert(undefined, syncEventData.warnings[0]);\n      }\n      // Check if current page was created or discarded.\n      this.checkPageCreatedOrDiscarded(syncEventData);\n    }\n    return !this.pageWarning;\n  }\n  /**\n   * Show the TOC.\n   *\n   * @param event Event.\n   */\n  showSubwikiPicker(event) {\n    var _this14 = this;\n    return _asyncToGenerator(function* () {\n      const subwiki = yield CoreDomUtils.openPopover({\n        component: AddonModWikiSubwikiPickerComponent,\n        componentProps: {\n          courseId: _this14.courseId,\n          subwikis: _this14.subwikiData.subwikis,\n          currentSubwiki: _this14.currentSubwiki\n        },\n        event\n      });\n      if (subwiki) {\n        _this14.goToSubwiki(subwiki.id, subwiki.userid, subwiki.groupid);\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  sync() {\n    var _this15 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this15.wiki) {\n        throw new CoreError('Cannot sync without a wiki.');\n      }\n      return AddonModWikiSync.syncWiki(_this15.wiki.id, _this15.courseId, _this15.wiki.coursemodule);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    var _this$manualSyncObser, _this$newPageObserver;\n    super.ngOnDestroy();\n    (_this$manualSyncObser = this.manualSyncObserver) === null || _this$manualSyncObser === void 0 || _this$manualSyncObser.off();\n    (_this$newPageObserver = this.newPageObserver) === null || _this$newPageObserver === void 0 || _this$newPageObserver.off();\n    this.onlineSubscription.unsubscribe();\n    if (this.wiki) {\n      AddonModWiki.wikiPageClosed(this.wiki.id, this.currentPath);\n    }\n  }\n  /**\n   * Create the subwiki list for the selector and store it in the cache.\n   *\n   * @param userGroups Groups.\n   * @returns Promise resolved when done.\n   */\n  createSubwikiList(userGroups) {\n    var _this16 = this;\n    return _asyncToGenerator(function* () {\n      const subwikiList = [];\n      let allParticipants = false;\n      let showMyGroupsLabel = false;\n      let multiLevelList = false;\n      _this16.subwikiData.subwikis = [];\n      _this16.setSelectedWiki(_this16.subwikiId, _this16.userId, _this16.groupId);\n      _this16.subwikiData.count = 0;\n      // Add the subwikis to the subwikiList.\n      yield Promise.all(_this16.loadedSubwikis.map( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (subwiki) {\n          let groupLabel = '';\n          if (subwiki.groupid === 0 && subwiki.userid === 0) {\n            // Add 'All participants' subwiki if needed at the start.\n            if (!allParticipants) {\n              subwikiList.unshift({\n                name: Translate.instant('core.allparticipants'),\n                id: subwiki.id,\n                userid: subwiki.userid,\n                groupid: subwiki.groupid,\n                groupLabel: '',\n                canedit: subwiki.canedit\n              });\n              allParticipants = true;\n            }\n          } else {\n            if (subwiki.groupid !== 0 && userGroups.length > 0) {\n              var _group$name;\n              // Get groupLabel if it has groupId.\n              const group = userGroups.find(group => group.id == subwiki.groupid);\n              groupLabel = (_group$name = group === null || group === void 0 ? void 0 : group.name) !== null && _group$name !== void 0 ? _group$name : '';\n            } else {\n              groupLabel = Translate.instant('addon.mod_wiki.notingroup');\n            }\n            if (subwiki.userid !== 0) {\n              if (!multiLevelList && subwiki.groupid != 0) {\n                multiLevelList = true;\n              }\n              // Get user if it has userId.\n              const user = yield CoreUser.getProfile(subwiki.userid, _this16.courseId, true);\n              subwikiList.push({\n                name: user.fullname,\n                id: subwiki.id,\n                userid: subwiki.userid,\n                groupid: subwiki.groupid,\n                groupLabel: groupLabel,\n                canedit: subwiki.canedit\n              });\n            } else {\n              subwikiList.push({\n                name: groupLabel,\n                id: subwiki.id,\n                userid: subwiki.userid,\n                groupid: subwiki.groupid,\n                groupLabel: groupLabel,\n                canedit: subwiki.canedit\n              });\n              showMyGroupsLabel = true;\n            }\n          }\n        });\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }()));\n      _this16.fillSubwikiData(subwikiList, showMyGroupsLabel, multiLevelList);\n    })();\n  }\n  /**\n   * Fill the subwiki data.\n   *\n   * @param subwikiList List of subwikis.\n   * @param showMyGroupsLabel Whether subwikis should be grouped in \"My groups\" and \"Other groups\".\n   * @param multiLevelList Whether it's a multi level list.\n   */\n  fillSubwikiData(subwikiList, showMyGroupsLabel, multiLevelList) {\n    this.groupWiki = showMyGroupsLabel;\n    this.subwikiData.count = subwikiList.length;\n    // If no subwiki is received as view param, select always the most appropiate.\n    if ((!this.subwikiId || !this.userId && !this.groupId) && !this.isAnySubwikiSelected() && subwikiList.length > 0) {\n      let firstCanEdit;\n      let candidateNoFirstPage;\n      let candidateFirstPage;\n      for (const i in subwikiList) {\n        const subwiki = subwikiList[i];\n        if (subwiki.canedit) {\n          let candidateSubwikiId;\n          if (subwiki.userid > 0) {\n            // Check if it's the current user.\n            if (this.currentUserId == subwiki.userid) {\n              candidateSubwikiId = subwiki.id;\n            }\n          } else if (subwiki.groupid > 0) {\n            // Check if it's a current user's group.\n            if (showMyGroupsLabel) {\n              candidateSubwikiId = subwiki.id;\n            }\n          } else if (subwiki.id > 0) {\n            candidateSubwikiId = subwiki.id;\n          }\n          if (candidateSubwikiId !== undefined) {\n            if (candidateSubwikiId > 0) {\n              // Subwiki found and created, no need to keep looking.\n              candidateFirstPage = Number(i);\n              break;\n            } else if (candidateNoFirstPage === undefined) {\n              candidateNoFirstPage = Number(i);\n            }\n          } else if (firstCanEdit === undefined) {\n            firstCanEdit = Number(i);\n          }\n        }\n      }\n      let subWikiToTake;\n      if (candidateFirstPage !== undefined) {\n        // Take the candidate that already has the first page created.\n        subWikiToTake = candidateFirstPage;\n      } else if (candidateNoFirstPage !== undefined) {\n        // No first page created, take the first candidate.\n        subWikiToTake = candidateNoFirstPage;\n      } else if (firstCanEdit !== undefined) {\n        // None selected, take the first the user can edit.\n        subWikiToTake = firstCanEdit;\n      } else {\n        // Otherwise take the very first.\n        subWikiToTake = 0;\n      }\n      const subwiki = subwikiList[subWikiToTake];\n      if (subwiki !== undefined) {\n        this.setSelectedWiki(subwiki.id, subwiki.userid, subwiki.groupid);\n      }\n    }\n    if (multiLevelList) {\n      // As we loop over each subwiki, add it to the current group\n      let groupValue = -1;\n      let grouping;\n      subwikiList.forEach(subwiki => {\n        // Should we create a new grouping?\n        if (subwiki.groupid !== groupValue) {\n          grouping = {\n            label: subwiki.groupLabel,\n            subwikis: []\n          };\n          groupValue = subwiki.groupid;\n          this.subwikiData.subwikis.push(grouping);\n        }\n        // Add the subwiki to the currently active grouping.\n        grouping.subwikis.push(subwiki);\n      });\n    } else if (showMyGroupsLabel) {\n      const noGroupSubwikis = [];\n      const myGroupsSubwikis = [];\n      const otherGroupsSubwikis = [];\n      // As we loop over each subwiki, add it to the current group.\n      subwikiList.forEach(subwiki => {\n        // Add the subwiki to the currently active grouping.\n        if (subwiki.groupid === 0 && subwiki.userid === 0) {\n          // All participants\n          noGroupSubwikis.push(subwiki);\n        } else if (subwiki.canedit) {\n          myGroupsSubwikis.push(subwiki);\n        } else {\n          otherGroupsSubwikis.push(subwiki);\n        }\n      });\n      if (myGroupsSubwikis.length > 0 && otherGroupsSubwikis.length > 0) {\n        // Add each grouping to the subwikis.\n        if (noGroupSubwikis.length > 0) {\n          this.subwikiData.subwikis.push({\n            label: '',\n            subwikis: noGroupSubwikis\n          });\n        }\n        if (myGroupsSubwikis.length > 0) {\n          this.subwikiData.subwikis.push({\n            label: Translate.instant('core.mygroups'),\n            subwikis: myGroupsSubwikis\n          });\n        }\n        if (otherGroupsSubwikis.length > 0) {\n          this.subwikiData.subwikis.push({\n            label: Translate.instant('core.othergroups'),\n            subwikis: otherGroupsSubwikis\n          });\n        }\n      } else {\n        // Mix it again since it does not have groups and other groups.\n        this.subwikiData.subwikis.push({\n          label: '',\n          subwikis: subwikiList\n        });\n      }\n    } else {\n      this.subwikiData.subwikis.push({\n        label: '',\n        subwikis: subwikiList\n      });\n    }\n    if (this.wiki) {\n      AddonModWiki.setSubwikiList(this.wiki.id, this.subwikiData.subwikis, this.subwikiData.count, this.subwikiData.subwikiSelected, this.subwikiData.userSelected, this.subwikiData.groupSelected);\n    }\n  }\n}\n_class = AddonModWikiIndexComponent;\n_class.ɵfac = function AddonModWikiIndexComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.IonContent), i0.ɵɵdirectiveInject(i2.CoreCourseContentsPage, 8));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"addon-mod-wiki-index\"]],\n  inputs: {\n    action: \"action\",\n    pageId: \"pageId\",\n    pageTitle: \"pageTitle\",\n    subwikiId: \"subwikiId\",\n    userId: \"userId\",\n    groupId: \"groupId\"\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 20,\n  vars: 19,\n  consts: [[\"slot\", \"end\"], [\"aria-haspopup\", \"true\", 3, \"click\", 4, \"ngIf\"], [\"iconAction\", \"fas-pen\", 3, \"priority\", \"content\", \"action\", 4, \"ngIf\"], [\"iconAction\", \"fas-plus\", 3, \"priority\", \"content\", \"action\", 4, \"ngIf\"], [\"fill\", \"clear\", \"aria-haspopup\", \"true\", 3, \"click\"], [\"name\", \"fas-circle-info\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [3, \"hideUntil\"], [3, \"module\", \"description\", \"component\", \"componentId\", \"courseId\", \"completionChanged\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"ion-padding-horizontal\", \"addon-mod_wiki-page-content\"], [3, \"ngClass\"], [\"contextLevel\", \"module\", 3, \"component\", \"componentId\", \"text\", \"contextInstanceId\", \"courseId\", 4, \"ngIf\"], [\"icon\", \"fas-file-lines\", 3, \"message\", 4, \"ngIf\"], [\"class\", \"ion-margin-top\", 4, \"ngIf\"], [\"collapsible-footer\", \"\", 3, \"hidden\", \"courseId\", \"currentModuleId\", 4, \"ngIf\"], [\"slot\", \"fixed\", \"core-fab\", \"\", \"vertical\", \"bottom\", \"horizontal\", \"end\", 4, \"ngIf\"], [\"aria-haspopup\", \"true\", 3, \"click\"], [\"name\", \"fas-user\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [\"name\", \"fas-users\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [\"name\", \"fas-user\", \"aria-hidden\", \"true\"], [\"name\", \"fas-users\", \"aria-hidden\", \"true\"], [\"name\", \"fas-map\", \"aria-hidden\", \"true\"], [\"iconAction\", \"fas-pen\", 3, \"priority\", \"content\", \"action\"], [\"iconAction\", \"fas-plus\", 3, \"priority\", \"content\", \"action\"], [3, \"module\", \"description\", \"component\", \"componentId\", \"courseId\", \"completionChanged\"], [\"class\", \"core-warning-card\", 4, \"ngIf\"], [1, \"core-warning-card\"], [1, \"ion-text-wrap\"], [\"name\", \"fas-triangle-exclamation\", \"slot\", \"start\", \"aria-hidden\", \"true\"], [\"contextLevel\", \"module\", 3, \"component\", \"componentId\", \"text\", \"contextInstanceId\", \"courseId\"], [\"icon\", \"fas-file-lines\", 3, \"message\"], [1, \"ion-margin-top\"], [3, \"tags\"], [\"collapsible-footer\", \"\", 3, \"hidden\", \"courseId\", \"currentModuleId\"], [\"slot\", \"fixed\", \"core-fab\", \"\", \"vertical\", \"bottom\", \"horizontal\", \"end\"], [3, \"click\"], [\"name\", \"fas-plus\", \"aria-hidden\", \"true\"], [1, \"sr-only\"]],\n  template: function AddonModWikiIndexComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"core-navbar-buttons\", 0);\n      i0.ɵɵtemplate(1, AddonModWikiIndexComponent_ion_button_1_Template, 4, 5, \"ion-button\", 1);\n      i0.ɵɵtemplate(2, AddonModWikiIndexComponent_ion_button_2_Template, 3, 3, \"ion-button\", 1);\n      i0.ɵɵelementStart(3, \"core-context-menu\");\n      i0.ɵɵtemplate(4, AddonModWikiIndexComponent_core_context_menu_item_4_Template, 2, 4, \"core-context-menu-item\", 2);\n      i0.ɵɵtemplate(5, AddonModWikiIndexComponent_core_context_menu_item_5_Template, 2, 4, \"core-context-menu-item\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"ion-button\", 4);\n      i0.ɵɵlistener(\"click\", function AddonModWikiIndexComponent_Template_ion_button_click_6_listener() {\n        return ctx.openModuleSummary();\n      });\n      i0.ɵɵpipe(7, \"translate\");\n      i0.ɵɵelement(8, \"ion-icon\", 5);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(9, \"core-loading\", 6);\n      i0.ɵɵtemplate(10, AddonModWikiIndexComponent_core_course_module_info_10_Template, 1, 5, \"core-course-module-info\", 7);\n      i0.ɵɵtemplate(11, AddonModWikiIndexComponent_div_11_Template, 3, 2, \"div\", 8);\n      i0.ɵɵelementStart(12, \"div\", 9);\n      i0.ɵɵtemplate(13, AddonModWikiIndexComponent_h2_13_Template, 2, 1, \"h2\", 8);\n      i0.ɵɵelementStart(14, \"article\", 10);\n      i0.ɵɵtemplate(15, AddonModWikiIndexComponent_core_format_text_15_Template, 1, 5, \"core-format-text\", 11);\n      i0.ɵɵtemplate(16, AddonModWikiIndexComponent_core_empty_box_16_Template, 2, 3, \"core-empty-box\", 12);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(17, AddonModWikiIndexComponent_div_17_Template, 5, 4, \"div\", 13);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(18, AddonModWikiIndexComponent_core_course_module_navigation_18_Template, 1, 3, \"core-course-module-navigation\", 14);\n      i0.ɵɵtemplate(19, AddonModWikiIndexComponent_ion_fab_19_Template, 7, 6, \"ion-fab\", 15);\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.subwikiData.count > 1);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.showLoading && ctx.currentPageObj);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.canEdit && (ctx.isOnline || ctx.pageIsOffline));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.canEdit);\n      i0.ɵɵadvance(1);\n      i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(7, 15, \"core.info\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"hideUntil\", !ctx.showLoading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.isMainPage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.pageIsOffline || ctx.hasOffline || ctx.pageWarning);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.pageTitle);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(17, _c1, !ctx.canEdit));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.pageContent);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.pageContent);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.tagsEnabled && ctx.tags.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.isMainPage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.canEdit);\n    }\n  },\n  styles: [\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n[_nghost-%COMP%] {\\n  --addon-mod-wiki-newentry-link-color: var(--danger);\\n  --addon-mod-wiki-toc-border-color: var(--gray-500);\\n  --addon-mod-wiki-toc-background-color: var(--gray-200);\\n  background-color: var(--ion-item-background);\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%] {\\n  background-color: var(--ion-item-background);\\n  padding-bottom: 10px;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     {\\n  \\n\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc {\\n  margin: 16px;\\n  padding: 8px;\\n  border: 1px solid var(--addon-mod-wiki-toc-border-color);\\n  background: var(--addon-mod-wiki-toc-background-color);\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc p {\\n  color: var(--ion-text-color);\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc-title {\\n  font-size: 1.1em;\\n  font-variant: small-caps;\\n  text-align: center;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc-section {\\n  padding: 0;\\n  margin: 2px 8px;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc-section-2 {\\n  -webkit-padding-start: 12px;\\n  padding-inline-start: 12px;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki-toc-section-3 {\\n  -webkit-padding-start: 24px;\\n  padding-inline-start: 24px;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .wiki_newentry {\\n  color: var(--addon-mod-wiki-newentry-link-color);\\n  font-style: italic;\\n}\\n[_nghost-%COMP%]   .addon-mod_wiki-page-content[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .addon-mod_wiki-noedit a.wiki_edit_section {\\n  display: none;\\n}\\n\\nhtml.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%] {\\n  --addon-mod-wiki-newentry-link-color: var(--danger-tint);\\n  --addon-mod-wiki-toc-background-color: var(--medium);\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9nbG9iYWxzLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvdGhlbWUvaGVscGVycy9pb25pYy5mdW5jdGlvbnMuc3RyaW5nLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvdGhlbWUvaGVscGVycy9pb25pYy5mdW5jdGlvbnMuY29sb3Iuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9oZWxwZXJzL2lvbmljLm1peGlucy5zY3NzIiwid2VicGFjazovLy4vc3JjL3RoZW1lL2hlbHBlcnMvaW9uaWMuY29tcG9uZW50cy5taXhpbnMuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9oZWxwZXJzL2N1c3RvbS5taXhpbnMuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9nbG9iYWxzLmN1c3RvbS5zY3NzIiwid2VicGFjazovLy4vc3JjL3RoZW1lL2dsb2JhbHMudmFyaWFibGVzLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvYWRkb25zL21vZC93aWtpL2NvbXBvbmVudHMvaW5kZXgvaW5kZXguc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztFQUFBO0FDQUE7Ozs7O0VBQUE7QUNBQTs7Ozs7RUFBQTtBQ0FBOzs7OztFQUFBO0FDQUE7Ozs7OztFQUFBO0FDRUE7Ozs7RUFBQTtBQTRHQTs7RUFBQTtBQzlHQTs7OztFQUFBO0FDQUE7Ozs7RUFBQTtBQStEQTs7OztFQUFBO0FDM0RBO0VBQ0ksbURBQUE7RUFDQSxrREFBQTtFQUNBLHNEQUFBO0VBRUEsNENBQUE7QUFpREo7QUEvQ0k7RUFDSSw0Q0FBQTtFQUNBLG9CQUFBO0FBaURSO0FBOUNJO0VBbUNJLDRCQUFBO0FBY1I7QUFoRFE7RUFDSSxZQUFBO0VBQ0EsWUFBQTtFQUNBLHdEQUFBO0VBQ0Esc0RBQUE7QUFrRFo7QUFqRFk7RUFDSSw0QkFBQTtBQW1EaEI7QUEvQ1E7RUFDSSxnQkFBQTtFQUNBLHdCQUFBO0VBQ0Esa0JBQUE7QUFpRFo7QUE5Q1E7RUFDSSxVQUFBO0VBQ0EsZUFBQTtBQWdEWjtBQTdDUTtFTCtRSiwyQktuVGtDO0VMb1RsQywwQktwVGtDO0FBcUZ0QztBQTdDUTtFTDJRSiwyQksxUW9DO0VMMlFwQywwQkszUW9DO0FBZ0R4QztBQTdDUTtFQUNJLGdEQUFBO0VBQ0Esa0JBQUE7QUErQ1o7QUEzQ1E7RUFDSSxhQUFBO0FBNkNaOztBQXhDQTtFQUNJLHdEQUFBO0VBQ0Esb0RBQUE7QUEyQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFwcCBHbG9iYWwgdmFyaWFibGVzIFNDU1NcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFBsYWNlIGhlcmUgdGhlIGRpZmZlcmVudCBmaWxlcyB5b3Ugc2hvdWxkIGltcG9ydCB0byB1c2UgZ2xvYmFsIHZhcmlhYmxlcy5cbiAqL1xuXG4kZm9udC1wYXRoOiBcIi4uL2Fzc2V0cy9mb250c1wiO1xuJGFzc2V0cy1wYXRoOiBcIi4uL2Fzc2V0c1wiO1xuXG5AaW1wb3J0IFwiLi9oZWxwZXJzL2hlbHBlcnMuc2Nzc1wiO1xuQGltcG9ydCBcIi4vZ2xvYmFscy5jdXN0b20uc2Nzc1wiO1xuQGltcG9ydCBcIi4vZ2xvYmFscy52YXJpYWJsZXMuc2Nzc1wiO1xuIiwiLyoqXG4gKiBJbXBvcnRlZCBpb25pYyBzdHJpbmcgZnVuY3Rpb25zIGZvciBTQ1NTXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBFeHRyYWN0ZWQgZnJvbVxuICogaHR0cHM6Ly9naXRodWIuY29tL2lvbmljLXRlYW0vaW9uaWMtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL3RoZW1lcy9pb25pYy5mdW5jdGlvbnMuc3RyaW5nLnNjc3NcbiAqL1xuXG5cbi8vIFN0cmluZyBVdGlsaXR5IEZ1bmN0aW9uc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLy8gU3RyaW5nIFJlcGxhY2UgRnVuY3Rpb25cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBmdW5jdGlvbiBzdHItcmVwbGFjZSgkc3RyaW5nLCAkc2VhcmNoLCAkcmVwbGFjZTogXCJcIikge1xuICAkaW5kZXg6IHN0ci1pbmRleCgkc3RyaW5nLCAkc2VhcmNoKTtcblxuICBAaWYgJGluZGV4IHtcbiAgICBAcmV0dXJuIHN0ci1zbGljZSgkc3RyaW5nLCAxLCAkaW5kZXggLSAxKSArICRyZXBsYWNlICsgc3RyLXJlcGxhY2Uoc3RyLXNsaWNlKCRzdHJpbmcsICRpbmRleCArIHN0ci1sZW5ndGgoJHNlYXJjaCkpLCAkc2VhcmNoLCAkcmVwbGFjZSk7XG4gIH1cblxuICBAcmV0dXJuICRzdHJpbmc7XG59XG5cbi8vIFN0cmluZyBTcGxpdCBGdW5jdGlvblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXG5AZnVuY3Rpb24gc3RyLXNwbGl0KCRzdHJpbmcsICRzZXBhcmF0b3IpIHtcbiAgLy8gZW1wdHkgYXJyYXkvbGlzdFxuICAkc3BsaXQtYXJyOiAoKTtcbiAgLy8gZmlyc3QgaW5kZXggb2Ygc2VwYXJhdG9yIGluIHN0cmluZ1xuICAkaW5kZXg6IHN0ci1pbmRleCgkc3RyaW5nLCAkc2VwYXJhdG9yKTtcbiAgLy8gbG9vcCB0aHJvdWdoIHN0cmluZ1xuICBAd2hpbGUgJGluZGV4ICE9IG51bGwge1xuICAgIC8vIGdldCB0aGUgc3Vic3RyaW5nIGZyb20gdGhlIGZpcnN0IGNoYXJhY3RlciB0byB0aGUgc2VwYXJhdG9yXG4gICAgJGl0ZW06IHN0ci1zbGljZSgkc3RyaW5nLCAxLCAkaW5kZXggLSAxKTtcbiAgICAvLyBwdXNoIGl0ZW0gdG8gYXJyYXlcbiAgICAkc3BsaXQtYXJyOiBhcHBlbmQoJHNwbGl0LWFyciwgJGl0ZW0pO1xuICAgIC8vIHJlbW92ZSBpdGVtIGFuZCBzZXBhcmF0b3IgZnJvbSBzdHJpbmdcbiAgICAkc3RyaW5nOiBzdHItc2xpY2UoJHN0cmluZywgJGluZGV4ICsgMSk7XG4gICAgLy8gZmluZCBuZXcgaW5kZXggb2Ygc2VwYXJhdG9yXG4gICAgJGluZGV4OiBzdHItaW5kZXgoJHN0cmluZywgJHNlcGFyYXRvcik7XG4gIH1cbiAgLy8gYWRkIHRoZSByZW1haW5pbmcgc3RyaW5nIHRvIGxpc3QgKHRoZSBsYXN0IGl0ZW0pXG4gICRzcGxpdC1hcnI6IGFwcGVuZCgkc3BsaXQtYXJyLCAkc3RyaW5nKTtcblxuICBAcmV0dXJuICRzcGxpdC1hcnI7XG59XG5cblxuLy8gU3RyaW5nIEV4dHJhY3QgRnVuY3Rpb25cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBmdW5jdGlvbiBzdHItZXh0cmFjdCgkc3RyaW5nLCAkc3RhcnQsICRlbmQpIHtcbiAgJHN0YXJ0LWluZGV4OiBzdHItaW5kZXgoJHN0cmluZywgJHN0YXJ0KTtcblxuICBAaWYgJHN0YXJ0LWluZGV4IHtcbiAgICAkcG9zdDogc3RyLXNsaWNlKCRzdHJpbmcsICRzdGFydC1pbmRleCArIHN0ci1sZW5ndGgoJHN0YXJ0KSk7XG4gICAgJGVuZC1pbmRleDogc3RyLWluZGV4KCRwb3N0LCAkZW5kKTtcblxuICAgIEBpZiAkZW5kLWluZGV4IHtcbiAgICAgIEByZXR1cm4gc3RyLXNsaWNlKCRwb3N0LCAxLCAkZW5kLWluZGV4IC0gMSk7XG4gICAgfVxuICB9XG5cbiAgQHJldHVybiBudWxsO1xufVxuXG5cbi8vIFN0cmluZyBDb250YWlucyBGdW5jdGlvblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQGZ1bmN0aW9uIHN0ci1jb250YWlucygkc3RyaW5nLCAkbmVlZGxlKSB7XG4gIEBpZiAodHlwZS1vZigkc3RyaW5nKSA9PSBzdHJpbmcpIHtcbiAgICBAcmV0dXJuIHN0ci1pbmRleCgkc3RyaW5nLCAkbmVlZGxlKSAhPSBudWxsO1xuICB9XG5cbiAgQHJldHVybiBmYWxzZTtcbn1cblxuXG4vLyBVUkwgRW5jb2RlIEZ1bmN0aW9uXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AZnVuY3Rpb24gdXJsLWVuY29kZSgkdmFsKSB7XG4gICRzcGFjZXM6IHN0ci1yZXBsYWNlKCR2YWwsIFwiIFwiLCBcIiUyMFwiKTtcbiAgJGVuY29kZWQ6IHN0ci1yZXBsYWNlKCRzcGFjZXMsIFwiI1wiLCBcIiUyM1wiKTtcbiAgQHJldHVybiAkZW5jb2RlZDtcbn1cblxuXG4vLyBBZGQgUm9vdCBTZWxlY3RvclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEFkZHMgYSByb290IHNlbGVjdG9yIHVzaW5nIGhvc3QgYmFzZWQgb24gdGhlIHNlbGVjdG9yIHBhc3NlZFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQGZ1bmN0aW9uIGFkZC1yb290LXNlbGVjdG9yKCRyb290LCAkYWRkSG9zdFNlbGVjdG9yKSB7XG4gICRzZWxlY3RvcnM6IHN0ci1zcGxpdCgkcm9vdCwgXCIsXCIpO1xuXG4gICRsaXN0OiAoKTtcblxuICBAZWFjaCAkc2VsZWN0b3IgaW4gJHNlbGVjdG9ycyB7XG4gICAgLy8gSWYgdGhlIHNlbGVjdG9yIGNvbnRhaW5zIDpob3N0KCBpdCBtZWFucyBpdCBpcyB0YXJnZXRpbmcgYSBjbGFzcyBvbiB0aGUgaG9zdFxuICAgIC8vIGVsZW1lbnQgc28gd2UgbmVlZCB0byBjaGFuZ2UgaG93IHdlIHRhcmdldCBpdDpcbiAgICAvLyBAaW5jbHVkZSBhZGQtcm9vdC1zZWxlY3RvcihcIjpob3N0KC5maXhlZClcIiwgXCJbZGlyPXJ0bF1cIilcbiAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pOmhvc3QoLmZpeGVkKVxuICAgIC8vIC0tPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSkuZml4ZWRcbiAgICBAaWYgc3RyLWNvbnRhaW5zKCRzZWxlY3RvciwgXCI6aG9zdChcIikge1xuICAgICAgLy8gQGluY2x1ZGUgYWRkLXJvb3Qtc2VsZWN0b3IoXCI6aG9zdCguZml4ZWQpXCIsIFwiW2Rpcj1ydGxdXCIpXG4gICAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pOmhvc3QoLmZpeGVkKVxuICAgICAgJHNoYWRvdy1lbGVtZW50OiBzdHItcmVwbGFjZSgkc2VsZWN0b3IsIFwiOmhvc3QoXCIsIFwiOmhvc3QtY29udGV4dCgjeyRhZGRIb3N0U2VsZWN0b3J9KTpob3N0KFwiKTtcbiAgICAgICRsaXN0OiBhcHBlbmQoJGxpc3QsICRzaGFkb3ctZWxlbWVudCwgY29tbWEpO1xuXG4gICAgICAkbmV3LWVsZW1lbnQ6ICgpO1xuICAgICAgJGVsZW1lbnRzOiBzdHItc3BsaXQoJHNlbGVjdG9yLCBcIiBcIik7XG5cbiAgICAgIEBlYWNoICRlbGVtZW50IGluICRlbGVtZW50cyB7XG4gICAgICAgIEBpZiBzdHItY29udGFpbnMoJGVsZW1lbnQsIFwiOmhvc3QoXCIpIHtcbiAgICAgICAgICAkc2NvcGVkLWVsZW1lbnQ6ICRlbGVtZW50O1xuXG4gICAgICAgICAgLy8gUmVwbGFjZSB0aGUgOmhvc3QoIGFuZCApIHNvIGFsbCB3ZSBoYXZlIGxlZnQgaXMgdGhlIGNsYXNzXG4gICAgICAgICAgLy8gaW5zaWRlIG9mIGl0OlxuICAgICAgICAgIC8vIDpob3N0KC5maXhlZCkgLT4gLmZpeGVkXG4gICAgICAgICAgJHNjb3BlZC1lbGVtZW50OiBzdHItcmVwbGFjZSgkc2NvcGVkLWVsZW1lbnQsIFwiKVwiLCBcIlwiKTtcbiAgICAgICAgICAkc2NvcGVkLWVsZW1lbnQ6IHN0ci1yZXBsYWNlKCRzY29wZWQtZWxlbWVudCwgXCI6aG9zdChcIiwgXCJcIik7XG5cbiAgICAgICAgICAvLyBBZGQgdGhlIGNsYXNzIGJhY2sgaW5zaWRlIG9mIGhvc3Qgd2l0aCB0aGUgcnRsIHNlbGVjdG9yOlxuICAgICAgICAgIC8vIC5maXhlZCAtPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSkuZml4ZWRcbiAgICAgICAgICAkc2NvcGVkLWVsZW1lbnQ6IHN0ci1yZXBsYWNlKCRzY29wZWQtZWxlbWVudCwgJHNjb3BlZC1lbGVtZW50LCBcIjpob3N0LWNvbnRleHQoI3skYWRkSG9zdFNlbGVjdG9yfSkjeyRzY29wZWQtZWxlbWVudH1cIik7XG5cbiAgICAgICAgICAvLyBAaW5jbHVkZSBhZGQtcm9vdC1zZWxlY3RvcihcIjpob3N0KC5maXhlZClcIiwgXCJbZGlyPXJ0bF1cIilcbiAgICAgICAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pLmZpeGVkXG4gICAgICAgICAgJG5ldy1lbGVtZW50OiBhcHBlbmQoJG5ldy1lbGVtZW50LCAkc2NvcGVkLWVsZW1lbnQsIHNwYWNlKTtcbiAgICAgICAgfSBAZWxzZSB7XG4gICAgICAgICAgLy8gQWRkIGJhY2sgYW55IHNlbGVjdG9ycyB0aGF0IGZvbGxvd2VkIHRoZSBob3N0IGFmdGVyIHRyYW5zZm9ybWluZyB0aGVcbiAgICAgICAgICAvLyBmaXJzdCBzZWxlY3RvcjpcbiAgICAgICAgICAvLyA6aG9zdCguZml4ZWQpIDo6c2xvdHRlZChpb24taWNvbilcbiAgICAgICAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pOmhvc3QoLmZpeGVkKSA6OnNsb3R0ZWQoaW9uLWljb24pXG4gICAgICAgICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKS5maXhlZCA6OnNsb3R0ZWQoaW9uLWljb24pXG4gICAgICAgICAgJG5ldy1lbGVtZW50OiBhcHBlbmQoJG5ldy1lbGVtZW50LCAkZWxlbWVudCwgc3BhY2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgICRsaXN0OiBhcHBlbmQoJGxpc3QsICRuZXctZWxlbWVudCwgY29tbWEpO1xuICAgIC8vIElmIHRoZSBzZWxlY3RvciBjb250YWlucyA6aG9zdCB3aXRob3V0IGEgcGFyYW50aGVzZXNcbiAgICAvLyBpdCBtZWFucyBpdCBpcyB0YXJnZXRpbmcganVzdCB0aGUgaG9zdFxuICAgIC8vIGVsZW1lbnQgc28gd2UgY2FuIGNoYW5nZSBpdCB0byBsb29rIGZvciBob3N0LWNvbnRleHRcbiAgICAvLyBAaW5jbHVkZSBhZGQtcm9vdC1zZWxlY3RvcihcIjpob3N0XCIsIFwiW2Rpcj1ydGxdXCIpXG4gICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKVxuICAgIC8vIC0tPiA6aG9zdDpkaXIocnRsKVxuICAgIH0gQGVsc2UgaWYgc3RyLWNvbnRhaW5zKCRzZWxlY3RvciwgXCI6aG9zdFwiKSB7XG4gICAgICAkbmV3LWVsZW1lbnQ6ICgpO1xuICAgICAgJGVsZW1lbnRzOiBzdHItc3BsaXQoJHNlbGVjdG9yLCBcIiBcIik7XG5cbiAgICAgIEBlYWNoICRlbGVtZW50IGluICRlbGVtZW50cyB7XG4gICAgICAgIEBpZiBzdHItY29udGFpbnMoJGVsZW1lbnQsIFwiOmhvc3RcIikge1xuICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIDpob3N0IHdpdGggdGhlIGFkZEhvc3RTZWxlY3RvcjpcbiAgICAgICAgICAvLyA6aG9zdCAtPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSlcbiAgICAgICAgICAkdXBkYXRlZC1lbGVtZW50OiBzdHItcmVwbGFjZSgkZWxlbWVudCwgXCI6aG9zdFwiLCBcIjpob3N0LWNvbnRleHQoI3skYWRkSG9zdFNlbGVjdG9yfSlcIik7XG5cbiAgICAgICAgICAvLyBBZGQgdGhlIGZpbmFsIHNlbGVjdG9yIGFmdGVyIGFsbCB0cmFuc2Zvcm1hdGlvbnM6XG4gICAgICAgICAgLy8gOmhvc3QgLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pXG4gICAgICAgICAgJG5ldy1lbGVtZW50OiBhcHBlbmQoJG5ldy1lbGVtZW50LCAkdXBkYXRlZC1lbGVtZW50LCBzcGFjZSk7XG4gICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgIC8vIEFkZCBiYWNrIGFueSBzZWxlY3RvcnMgdGhhdCBmb2xsb3dlZCB0aGUgaG9zdCBhZnRlciB0cmFuc2Zvcm1pbmcgdGhlXG4gICAgICAgICAgLy8gZmlyc3Qgc2VsZWN0b3I6XG4gICAgICAgICAgLy8gOmhvc3QgOjpzbG90dGVkKGlvbi1pY29uKSAtPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSkgOjpzbG90dGVkKGlvbi1pY29uKVxuICAgICAgICAgICRuZXctZWxlbWVudDogYXBwZW5kKCRuZXctZWxlbWVudCwgJGVsZW1lbnQsIHNwYWNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkbGlzdDogYXBwZW5kKCRsaXN0LCAkbmV3LWVsZW1lbnQsIGNvbW1hKTtcbiAgICAvLyBJZiB0aGUgc2VsZWN0b3IgZG9lcyBub3QgY29udGFpbiBob3N0IGF0IGFsbCBpdCBpcyBlaXRoZXIgYSBzaGFkb3dcbiAgICAvLyBvciBub3JtYWwgZWxlbWVudCBzbyBhcHBlbmQgYm90aCB0aGUgYWRkSG9zdFNlbGVjdG9yIGFuZCBob3N0LWNvbnRleHRcbiAgICAvLyBAaW5jbHVkZSBhZGQtcm9vdC1zZWxlY3RvcihcImlvbi1jb21wb25lbnRcIiwgXCJbZGlyPXJ0bF1cIilcbiAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pIGlvbi1jb21wb25lbnRcbiAgICAvLyAtLT4gW2Rpcj1ydGxdIGlvbi1jb21wb25lbnRcbiAgICB9IEBlbHNlIHtcbiAgICAgICRsaXN0OiBhcHBlbmQoJGxpc3QsIFwiI3skYWRkSG9zdFNlbGVjdG9yfSAjeyRzZWxlY3Rvcn1cIiwgY29tbWEpO1xuICAgICAgJGxpc3Q6IGFwcGVuZCgkbGlzdCwgXCI6aG9zdC1jb250ZXh0KCN7JGFkZEhvc3RTZWxlY3Rvcn0pICN7JHNlbGVjdG9yfVwiLCBjb21tYSk7XG4gICAgfVxuICB9XG5cbiAgQHJldHVybiAkbGlzdDtcbn1cbiIsIi8qKlxuICogSW1wb3J0ZWQgaW9uaWMgY29sb3IgZnVuY3Rpb25zIGZvciBTQ1NTXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBFeHRyYWN0ZWQgZnJvbVxuICogaHR0cHM6Ly9naXRodWIuY29tL2lvbmljLXRlYW0vaW9uaWMtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL3RoZW1lcy9pb25pYy5mdW5jdGlvbnMuY29sb3Iuc2Nzc1xuICovXG5cbi8vIEdldHMgdGhlIGFjdGl2ZSBjb2xvcidzIGNzcyB2YXJpYWJsZSBmcm9tIGEgdmFyaWF0aW9uLiBBbHBoYSBpcyBvcHRpb25hbC5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBFeGFtcGxlIHVzYWdlOlxuLy8gY3VycmVudC1jb2xvcihiYXNlKSA9PiB2YXIoLS1pb24tY29sb3ItYmFzZSlcbi8vIGN1cnJlbnQtY29sb3IoY29udHJhc3QsIDAuMSkgPT4gcmdiYSh2YXIoLS1pb24tY29sb3ItY29udHJhc3QtcmdiKSwgMC4xKVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBmdW5jdGlvbiBjdXJyZW50LWNvbG9yKCR2YXJpYXRpb24sICRhbHBoYTogbnVsbCkge1xuICBAaWYgJGFscGhhID09IG51bGwge1xuICAgIEByZXR1cm4gdmFyKC0taW9uLWNvbG9yLSN7JHZhcmlhdGlvbn0pO1xuICB9IEBlbHNlIHtcbiAgICBAcmV0dXJuIHJnYmEodmFyKC0taW9uLWNvbG9yLSN7JHZhcmlhdGlvbn0tcmdiKSwgI3skYWxwaGF9KTtcbiAgfVxufVxuXG4vLyBHZXRzIHRoZSBzcGVjaWZpYyBjb2xvcidzIGNzcyB2YXJpYWJsZSBmcm9tIHRoZSBuYW1lIGFuZCB2YXJpYXRpb24uIEFscGhhL3JnYiBhcmUgb3B0aW9uYWwuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRXhhbXBsZSB1c2FnZTpcbi8vIGlvbi1jb2xvcihwcmltYXJ5LCBiYXNlKSA9PiB2YXIoLS1pb24tY29sb3ItcHJpbWFyeSwgIzM4ODBmZilcbi8vIGlvbi1jb2xvcihzZWNvbmRhcnksIGNvbnRyYXN0KSA9PiB2YXIoLS1pb24tY29sb3Itc2Vjb25kYXJ5LWNvbnRyYXN0KVxuLy8gaW9uLWNvbG9yKHByaW1hcnksIGJhc2UsIDAuNSkgPT4gcmdiYSh2YXIoLS1pb24tY29sb3ItcHJpbWFyeS1yZ2IsIDU2LCAxMjgsIDI1NSksIDAuNSlcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AZnVuY3Rpb24gaW9uLWNvbG9yKCRuYW1lLCAkdmFyaWF0aW9uLCAkYWxwaGE6IG51bGwsICRyZ2I6IG51bGwpIHtcbiAgJHZhbHVlczogbWFwLWdldCgkY29sb3JzLCAkbmFtZSk7XG4gICR2YWx1ZTogbWFwLWdldCgkdmFsdWVzLCAkdmFyaWF0aW9uKTtcbiAgJHZhcmlhYmxlOiAtLWlvbi1jb2xvci0jeyRuYW1lfS0jeyR2YXJpYXRpb259O1xuXG4gIEBpZiAoJHZhcmlhdGlvbiA9PSBiYXNlKSB7XG4gICAgJHZhcmlhYmxlOiAtLWlvbi1jb2xvci0jeyRuYW1lfTtcbiAgfVxuXG4gIEBpZiAoJGFscGhhKSB7XG4gICAgJHZhbHVlOiBjb2xvci10by1yZ2ItbGlzdCgkdmFsdWUpO1xuICAgIEByZXR1cm4gcmdiYSh2YXIoI3skdmFyaWFibGV9LXJnYiwgJHZhbHVlKSwgJGFscGhhKTtcbiAgfVxuICBAaWYgKCRyZ2IpIHtcbiAgICAkdmFsdWU6IGNvbG9yLXRvLXJnYi1saXN0KCR2YWx1ZSk7XG4gICAgJHZhcmlhYmxlOiAjeyR2YXJpYWJsZX0tcmdiO1xuICB9XG5cbiAgQHJldHVybiB2YXIoI3skdmFyaWFibGV9LCAkdmFsdWUpO1xufVxuXG4vLyBNaXhlcyBhIGNvbG9yIHdpdGggYmxhY2sgdG8gY3JlYXRlIGl0cyBzaGFkZS5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AZnVuY3Rpb24gZ2V0LWNvbG9yLXNoYWRlKCRjb2xvcikge1xuICBAcmV0dXJuIG1peCgjMDAwLCAkY29sb3IsIDEyJSk7XG59XG5cbi8vIE1peGVzIGEgY29sb3Igd2l0aCB3aGl0ZSB0byBjcmVhdGUgaXRzIHRpbnQuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQGZ1bmN0aW9uIGdldC1jb2xvci10aW50KCRjb2xvcikge1xuICBAcmV0dXJuIG1peCgjZmZmLCAkY29sb3IsIDEwJSk7XG59XG5cbi8vIENvbnZlcnRzIGEgY29sb3IgdG8gYSBjb21tYSBzZXBhcmF0ZWQgcmdiLlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBmdW5jdGlvbiBjb2xvci10by1yZ2ItbGlzdCgkY29sb3IpIHtcbiAgQHJldHVybiAje3JlZCgkY29sb3IpfSwje2dyZWVuKCRjb2xvcil9LCN7Ymx1ZSgkY29sb3IpfTtcbn1cbiIsIi8qKlxuICogSW1wb3J0ZWQgaW9uaWMgbWl4aW5zIGZvciBTQ1NTXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBFeHRyYWN0ZWQgZnJvbVxuICogaHR0cHM6Ly9naXRodWIuY29tL2lvbmljLXRlYW0vaW9uaWMtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL3RoZW1lcy9pb25pYy5taXhpbnMuc2Nzc1xuICovXG5cbkBtaXhpbiBpbnB1dC1jb3ZlcigpIHtcbiAgQGluY2x1ZGUgcG9zaXRpb24oMCwgbnVsbCwgbnVsbCwgMCk7XG4gIEBpbmNsdWRlIG1hcmdpbigwKTtcblxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG5cbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcblxuICBib3JkZXI6IDA7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICBjdXJzb3I6IHBvaW50ZXI7XG5cbiAgYXBwZWFyYW5jZTogbm9uZTtcbiAgb3V0bGluZTogbm9uZTtcblxuICAmOjotbW96LWZvY3VzLWlubmVyIHtcbiAgICBib3JkZXI6IDA7XG4gIH1cbn1cblxuQG1peGluIHZpc3VhbGx5LWhpZGRlbigpIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuXG4gIHRvcDogMDtcbiAgbGVmdDogMDtcbiAgcmlnaHQ6IDA7XG4gIGJvdHRvbTogMDtcblxuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xuXG4gIG1hcmdpbjogMDtcbiAgcGFkZGluZzogMDtcblxuICBib3JkZXI6IDA7XG4gIG91dGxpbmU6IDA7XG4gIGNsaXA6IHJlY3QoMCAwIDAgMCk7XG5cbiAgb3BhY2l0eTogMDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcblxuICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7XG4gIC1tb3otYXBwZWFyYW5jZTogbm9uZTtcbn1cblxuQG1peGluIHRleHQtaW5oZXJpdCgpIHtcbiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7XG4gIGZvbnQtc2l6ZTogaW5oZXJpdDtcbiAgZm9udC1zdHlsZTogaW5oZXJpdDtcbiAgZm9udC13ZWlnaHQ6IGluaGVyaXQ7XG4gIGxldHRlci1zcGFjaW5nOiBpbmhlcml0O1xuICB0ZXh0LWRlY29yYXRpb246IGluaGVyaXQ7XG4gIHRleHQtaW5kZW50OiBpbmhlcml0O1xuICB0ZXh0LW92ZXJmbG93OiBpbmhlcml0O1xuICB0ZXh0LXRyYW5zZm9ybTogaW5oZXJpdDtcbiAgdGV4dC1hbGlnbjogaW5oZXJpdDtcbiAgd2hpdGUtc3BhY2U6IGluaGVyaXQ7XG4gIGNvbG9yOiBpbmhlcml0O1xufVxuXG5AbWl4aW4gYnV0dG9uLXN0YXRlKCkge1xuICBAaW5jbHVkZSBwb3NpdGlvbigwLCAwLCAwLCAwKTtcblxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG5cbiAgY29udGVudDogXCJcIjtcblxuICBvcGFjaXR5OiAwO1xufVxuXG4vLyBGb250IHNtb290aGluZ1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQG1peGluIGZvbnQtc21vb3RoaW5nKCkge1xuICAtbW96LW9zeC1mb250LXNtb290aGluZzogZ3JheXNjYWxlO1xuICAtd2Via2l0LWZvbnQtc21vb3RoaW5nOiBhbnRpYWxpYXNlZDtcbn1cblxuLy8gR2V0IHRoZSBrZXkgZnJvbSBhIG1hcCBiYXNlZCBvbiB0aGUgaW5kZXhcbkBmdW5jdGlvbiBpbmRleC10by1rZXkoJG1hcCwgJGluZGV4KSB7XG4gICRrZXlzOiBtYXAta2V5cygkbWFwKTtcblxuICBAcmV0dXJuIG50aCgka2V5cywgJGluZGV4KTtcbn1cblxuXG4vLyBCcmVha3BvaW50IE1peGluc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIEJyZWFrcG9pbnQgdmlld3BvcnQgc2l6ZXMgYW5kIG1lZGlhIHF1ZXJpZXMuXG4vL1xuLy8gQnJlYWtwb2ludHMgYXJlIGRlZmluZWQgYXMgYSBtYXAgb2YgKG5hbWU6IG1pbmltdW0gd2lkdGgpLCBvcmRlciBmcm9tIHNtYWxsIHRvIGxhcmdlOlxuLy9cbi8vICAgICh4czogMCwgc206IDU3NnB4LCBtZDogNzY4cHgsIGxnOiA5OTJweCwgeGw6IDEyMDBweClcbi8vXG4vLyBUaGUgbWFwIGRlZmluZWQgaW4gdGhlIGAkc2NyZWVuLWJyZWFrcG9pbnRzYCBnbG9iYWwgdmFyaWFibGUgaXMgdXNlZCBhcyB0aGUgYCRicmVha3BvaW50c2AgYXJndW1lbnQgYnkgZGVmYXVsdC5cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIE1pbmltdW0gYnJlYWtwb2ludCB3aWR0aC4gTnVsbCBmb3IgdGhlIHNtYWxsZXN0IChmaXJzdCkgYnJlYWtwb2ludC5cbi8vXG4vLyAgICA+PiBicmVha3BvaW50LW1pbihzbSwgKHhzOiAwLCBzbTogNTc2cHgsIG1kOiA3NjhweCwgbGc6IDk5MnB4LCB4bDogMTIwMHB4KSlcbi8vICAgIDU3NnB4XG5AZnVuY3Rpb24gYnJlYWtwb2ludC1taW4oJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICAkbWluOiBtYXAtZ2V0KCRicmVha3BvaW50cywgJG5hbWUpO1xuXG4gIEByZXR1cm4gaWYoJG5hbWUgIT0gaW5kZXgtdG8ta2V5KCRicmVha3BvaW50cywgMSksICRtaW4sIG51bGwpO1xufVxuXG4vLyBSZXR1cm5zIGEgYmxhbmsgc3RyaW5nIGlmIHNtYWxsZXN0IGJyZWFrcG9pbnQsIG90aGVyd2lzZSByZXR1cm5zIHRoZSBuYW1lIHdpdGggYSBkYXNoIGluZnJvbnQuXG4vLyBVc2VmdWwgZm9yIG1ha2luZyByZXNwb25zaXZlIHV0aWxpdGllcy5cbi8vXG4vLyAgICA+PiBicmVha3BvaW50LWluZml4KHhzLCAoeHM6IDAsIHNtOiA1NzZweCwgbWQ6IDc2OHB4LCBsZzogOTkycHgsIHhsOiAxMjAwcHgpKVxuLy8gICAgXCJcIiAgKFJldHVybnMgYSBibGFuayBzdHJpbmcpXG4vLyAgICA+PiBicmVha3BvaW50LWluZml4KHNtLCAoeHM6IDAsIHNtOiA1NzZweCwgbWQ6IDc2OHB4LCBsZzogOTkycHgsIHhsOiAxMjAwcHgpKVxuLy8gICAgXCItc21cIlxuQGZ1bmN0aW9uIGJyZWFrcG9pbnQtaW5maXgoJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICBAcmV0dXJuIGlmKGJyZWFrcG9pbnQtbWluKCRuYW1lLCAkYnJlYWtwb2ludHMpID09IG51bGwsIFwiXCIsIFwiLSN7JG5hbWV9XCIpO1xufVxuXG4vLyBNZWRpYSBvZiBhdCBsZWFzdCB0aGUgbWluaW11bSBicmVha3BvaW50IHdpZHRoLiBObyBxdWVyeSBmb3IgdGhlIHNtYWxsZXN0IGJyZWFrcG9pbnQuXG4vLyBNYWtlcyB0aGUgQGNvbnRlbnQgYXBwbHkgdG8gdGhlIGdpdmVuIGJyZWFrcG9pbnQgYW5kIHdpZGVyLlxuQG1peGluIG1lZGlhLWJyZWFrcG9pbnQtdXAoJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICAkbWluOiBicmVha3BvaW50LW1pbigkbmFtZSwgJGJyZWFrcG9pbnRzKTtcbiAgQGlmICRtaW4ge1xuICAgIEBtZWRpYSAobWluLXdpZHRoOiAkbWluKSB7XG4gICAgICBAY29udGVudDtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBjb250ZW50O1xuICB9XG59XG5cbi8vIE5hbWUgb2YgdGhlIG5leHQgYnJlYWtwb2ludCwgb3IgbnVsbCBmb3IgdGhlIGxhc3QgYnJlYWtwb2ludC5cbi8vXG4vLyAgICA+PiBicmVha3BvaW50LW5leHQoc20pXG4vLyAgICBtZFxuLy8gICAgPj4gYnJlYWtwb2ludC1uZXh0KHNtLCAoeHM6IDAsIHNtOiA1NzZweCwgbWQ6IDc2OHB4LCBsZzogOTkycHgsIHhsOiAxMjAwcHgpKVxuLy8gICAgbWRcbi8vICAgID4+IGJyZWFrcG9pbnQtbmV4dChzbSwgJGJyZWFrcG9pbnQtbmFtZXM6ICh4cyBzbSBtZCBsZyB4bCkpXG4vLyAgICBtZFxuQGZ1bmN0aW9uIGJyZWFrcG9pbnQtbmV4dCgkbmFtZSwgJGJyZWFrcG9pbnRzOiAkc2NyZWVuLWJyZWFrcG9pbnRzLCAkYnJlYWtwb2ludC1uYW1lczogbWFwLWtleXMoJGJyZWFrcG9pbnRzKSkge1xuICAkbjogaW5kZXgoJGJyZWFrcG9pbnQtbmFtZXMsICRuYW1lKTtcbiAgQHJldHVybiBpZigkbiA8IGxlbmd0aCgkYnJlYWtwb2ludC1uYW1lcyksIG50aCgkYnJlYWtwb2ludC1uYW1lcywgJG4gKyAxKSwgbnVsbCk7XG59XG5cbi8vIE1heGltdW0gYnJlYWtwb2ludCB3aWR0aC4gTnVsbCBmb3IgdGhlIHNtYWxsZXN0IChmaXJzdCkgYnJlYWtwb2ludC5cbi8vIFRoZSBtYXhpbXVtIHZhbHVlIGlzIHJlZHVjZWQgYnkgMC4wMnB4IHRvIHdvcmsgYXJvdW5kIHRoZSBsaW1pdGF0aW9ucyBvZlxuLy8gYG1pbi1gIGFuZCBgbWF4LWAgcHJlZml4ZXMgYW5kIHZpZXdwb3J0cyB3aXRoIGZyYWN0aW9uYWwgd2lkdGhzLlxuLy9cbi8vIFNlZSBodHRwczovL3d3dy53My5vcmcvVFIvbWVkaWFxdWVyaWVzLTQvI21xLW1pbi1tYXhcbi8vIFVzZXMgMC4wMnB4IHJhdGhlciB0aGFuIDAuMDFweCB0byB3b3JrIGFyb3VuZCBhIGN1cnJlbnQgcm91bmRpbmcgYnVnIGluIFNhZmFyaS5cdC8vIFVzZXMgMC4wMnB4IHJhdGhlciB0aGFuIDAuMDFweCB0byB3b3JrIGFyb3VuZCBhIGN1cnJlbnQgcm91bmRpbmcgYnVnIGluIFNhZmFyaS5cbi8vIFNlZSBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTc4MjYxXHQvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE3ODI2MVxuLy9cbi8vICAgID4+IGJyZWFrcG9pbnQtbWF4KG1kLCAoeHM6IDAsIHNtOiA1NzZweCwgbWQ6IDc2OHB4LCBsZzogOTkycHgsIHhsOiAxMjAwcHgpKVxuLy8gICAgNzY3Ljk4cHhcbkBmdW5jdGlvbiBicmVha3BvaW50LW1heCgkbmFtZSwgJGJyZWFrcG9pbnRzOiAkc2NyZWVuLWJyZWFrcG9pbnRzKSB7XG4gICRtYXg6IG1hcC1nZXQoJGJyZWFrcG9pbnRzLCAkbmFtZSk7XG4gIEByZXR1cm4gaWYoJG1heCBhbmQgJG1heCA+IDAsICRtYXggLSAuMDIsIG51bGwpO1xufVxuXG4vLyBNZWRpYSBvZiBhdCBtb3N0IHRoZSBtYXhpbXVtIGJyZWFrcG9pbnQgd2lkdGguIE5vIHF1ZXJ5IGZvciB0aGUgbGFyZ2VzdCBicmVha3BvaW50LlxuLy8gTWFrZXMgdGhlIEBjb250ZW50IGFwcGx5IHRvIHRoZSBnaXZlbiBicmVha3BvaW50IGFuZCBuYXJyb3dlci5cbkBtaXhpbiBtZWRpYS1icmVha3BvaW50LWRvd24oJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICAkbWF4OiBicmVha3BvaW50LW1heCgkbmFtZSwgJGJyZWFrcG9pbnRzKTtcbiAgQGlmICRtYXgge1xuICAgIEBtZWRpYSAobWF4LXdpZHRoOiAkbWF4KSB7XG4gICAgICBAY29udGVudDtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBjb250ZW50O1xuICB9XG59XG5cblxuLy8gVGV4dCBEaXJlY3Rpb24gLSBsdHIgLyBydGxcbi8vXG4vLyBDU1MgZGVmYXVsdHMgdG8gdXNlIHRoZSBsdHIgY3NzLCBhbmQgYWRkcyBbZGlyPXJ0bF0gc2VsZWN0b3JzXG4vLyB0byBvdmVycmlkZSBsdHIgZGVmYXVsdHMuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBtaXhpbiBtdWx0aS1kaXIoKSB7XG4gIEBjb250ZW50O1xuXG4gIC8vICRyb290OiAjeyZ9O1xuICAvLyBAYXQtcm9vdCBbZGlyXSB7XG4gIC8vICAgI3skcm9vdH0ge1xuICAvLyAgICAgQGNvbnRlbnQ7XG4gIC8vICAgfVxuICAvLyB9XG59XG5cbkBtaXhpbiBydGwoKSB7XG4gICRyb290OiAjeyZ9O1xuXG4gICRyb290U3BsaXQ6IHN0ci1zcGxpdCgkcm9vdCwgXCIsXCIpO1xuICAkc2VsZWN0b3JzOiAje2FkZC1yb290LXNlbGVjdG9yKCRyb290LCBcIltkaXI9cnRsXVwiKX07XG4gICRzZWxlY3RvcnNTcGxpdDogc3RyLXNwbGl0KCRzZWxlY3RvcnMsIFwiLFwiKTtcblxuICAkaG9zdENvbnRleHRTZWxlY3RvcnM6ICgpO1xuICAkcmVzdFNlbGVjdG9yczogKCk7XG4gICRkaXJTZWxlY3RvcnM6ICgpO1xuXG4gIC8vIFNlbGVjdG9ycyBtdXN0IGJlIHNwbGl0IGludG8gaW5kaXZpZHVhbCBzZWxlY3RvcnMgaW4gY2FzZSB0aGUgYnJvd3NlclxuICAvLyBkb2Vzbid0IHN1cHBvcnQgYSBzcGVjaWZpYyBzZWxlY3Rvci5cbiAgLy8gRm9yIGV4YW1wbGUsIEZpcmVmb3ggYW5kIFNhZmFyaSBkb2Vzbid0IHN1cHBvcnQgYDpob3N0LWNvbnRleHQoKWAuXG4gIC8vIElmIGFuIGludmFsaWQgc2VsZWN0b3IgaXMgdXNlZCwgdGhlbiB0aGUgZW50aXJlIGdyb3VwIG9mIHNlbGVjdG9yc1xuICAvLyB3aWxsIGJlIGlnbm9yZWQuXG4gIC8vIEBsaW5rIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMtMy8jZ3JvdXBpbmdcbiAgQGVhY2ggJHNlbGVjdG9yIGluICRzZWxlY3RvcnNTcGxpdCB7XG4gICAgLy8gR3JvdXAgdGhlIHNlbGVjdG9ycyBiYWNrIGludG8gYSBzaW5nbGUgc2VsZWN0b3IgdG8gb3B0aW1pemUgdGhlIG91dHB1dC5cbiAgICBAaWYgc3RyLWluZGV4KCRzZWxlY3RvciwgXCI6aG9zdC1jb250ZXh0XCIpIHtcbiAgICAgICRob3N0Q29udGV4dFNlbGVjdG9yczogYXBwZW5kKCRob3N0Q29udGV4dFNlbGVjdG9ycywgJHNlbGVjdG9yLCBjb21tYSk7XG4gICAgfSBAZWxzZSB7XG4gICAgICAvLyBHcm91cCB0aGUgc2VsZWN0b3JzIGJhY2sgaW50byBhIHNpbmdsZSBzZWxlY3RvciB0byBvcHRpbWl6ZSB0aGUgb3V0cHV0LlxuICAgICAgJHJlc3RTZWxlY3RvcnM6IGFwcGVuZCgkcmVzdFNlbGVjdG9ycywgJHNlbGVjdG9yLCBjb21tYSk7XG4gICAgfVxuICB9XG5cbiAgLy8gU3VwcG9ydGVkIGJ5IENocm9tZS5cbiAgQGlmIGxlbmd0aCgkaG9zdENvbnRleHRTZWxlY3RvcnMpID4gMCB7XG4gICAgQGF0LXJvb3QgI3skaG9zdENvbnRleHRTZWxlY3RvcnN9IHtcbiAgICAgIEBjb250ZW50O1xuICAgIH1cbiAgfVxuXG4gIC8vIFN1cHBvcnRlZCBieSBhbGwgYnJvd3NlcnMuXG4gIEBpZiBsZW5ndGgoJHJlc3RTZWxlY3RvcnMpID4gMCB7XG4gICAgQGF0LXJvb3QgI3skcmVzdFNlbGVjdG9yc30ge1xuICAgICAgQGNvbnRlbnQ7XG4gICAgfVxuICB9XG5cbiAgLy8gSWYgYnJvd3NlciBjYW4gc3VwcG9ydCBgOmRpcigpYCwgdGhlbiBhZGQgdGhlIGA6ZGlyKClgIHNlbGVjdG9ycy5cbiAgLy8gQHN1cHBvcnRzIHNlbGVjdG9yKDpkaXIocnRsKSkgeyAvLyBAIElNUE9UQU5UIE5PVEU6IFRoaXMgaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIHNlbGVjdG9yIGZ1bmN0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaW4gY3VycmVudCBTQ1NTXG4gIC8vIEFkZGluZyA6ZGlyKCkgaW4gY2FzZSB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgYDpob3N0LWNvbnRleHQoKWAgYW5kIGRvZXMgc3VwcG9ydCBgOmRpcigpYC5cbiAgLy8gYDpob3N0LWNvbnRleHQoKWAgaXMgYWRkZWQ6XG4gIC8vIC0gdGhyb3VnaCB0aGUgYGFkZC1yb290LXNlbGVjdG9yKClgIGZ1bmN0aW9uLlxuICAvLyAtIGZpcnN0IHNvIHRoYXQgaXQgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGA6ZGlyKClgLlxuICAvLyBGb3IgZXhhbXBsZSxcbiAgLy8gLSBGaXJlZm94IGRvZXNuJ3Qgc3VwcG9ydCBgOmhvc3QtY29udGV4dCgpYCwgYnV0IGRvZXMgc3VwcG9ydCBgOmRpcigpYC5cbiAgLy8gLSBTYWZhcmkgZG9lc24ndCBzdXBwb3J0IGA6aG9zdC1jb250ZXh0KClgLCBidXQgU2FmYXJpIDE2LjQrIHN1cHBvcnRzIGA6ZGlyKClgXG4gIC8vIEBsaW5rIGh0dHBzOi8vd2Via2l0Lm9yZy9ibG9nLzEzOTY2L3dlYmtpdC1mZWF0dXJlcy1pbi1zYWZhcmktMTYtNC9cbiAgQGVhY2ggJHNlbGVjdG9yIGluICRyb290U3BsaXQge1xuICAgICRkaXJTZWxlY3RvcjogXCIjeyRzZWxlY3Rvcn06ZGlyKHJ0bClcIjtcbiAgICAvLyBHcm91cCB0aGUgc2VsZWN0b3JzIGJhY2sgaW50byBhIHNpbmdsZSBzZWxlY3RvciB0byBvcHRpbWl6ZSB0aGUgb3V0cHV0LlxuICAgICRkaXJTZWxlY3RvcnM6IGFwcGVuZCgkZGlyU2VsZWN0b3JzLCAkZGlyU2VsZWN0b3IsIGNvbW1hKTtcbiAgfVxuXG4gIC8vIFN1cHBvcnRlZCBieSBGaXJlZm94LlxuICBAaWYgbGVuZ3RoKCRkaXJTZWxlY3RvcnMpID4gMCB7XG4gICAgQGF0LXJvb3QgI3skZGlyU2VsZWN0b3JzfSB7XG4gICAgICBAY29udGVudDtcbiAgICB9XG4gIH1cbiAgLy99XG59XG5cbkBtaXhpbiBsdHIoKSB7XG4gIEBjb250ZW50O1xufVxuXG5cbi8vIFNWRyBCYWNrZ3JvdW5kIEltYWdlIE1peGluXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN2Z1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHN2Zy1iYWNrZ3JvdW5kLWltYWdlKCRzdmcsICRmbGlwLXJ0bDogZmFsc2UpIHtcbiAgJHVybDogdXJsLWVuY29kZSgkc3ZnKTtcbiAgJHZpZXdCb3g6IHN0ci1zcGxpdChzdHItZXh0cmFjdCgkc3ZnLCBcInZpZXdCb3g9J1wiLCBcIidcIiksIFwiIFwiKTtcblxuICBAaWYgJGZsaXAtcnRsICE9IHRydWUgb3IgJHZpZXdCb3ggPT0gbnVsbCB7XG4gICAgQGluY2x1ZGUgbXVsdGktZGlyKCkge1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFwiZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLTgsI3skdXJsfVwiKTtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgICR0cmFuc2Zvcm06IFwidHJhbnNmb3JtPSd0cmFuc2xhdGUoI3tudGgoJHZpZXdCb3gsIDMpfSwgMCkgc2NhbGUoLTEsIDEpJ1wiO1xuICAgICRmbGlwcGVkLXVybDogJHN2ZztcbiAgICAkZmxpcHBlZC11cmw6IHN0ci1yZXBsYWNlKCRmbGlwcGVkLXVybCwgXCI8cGF0aFwiLCBcIjxwYXRoICN7JHRyYW5zZm9ybX1cIik7XG4gICAgJGZsaXBwZWQtdXJsOiBzdHItcmVwbGFjZSgkZmxpcHBlZC11cmwsIFwiPGxpbmVcIiwgXCI8bGluZSAjeyR0cmFuc2Zvcm19XCIpO1xuICAgICRmbGlwcGVkLXVybDogc3RyLXJlcGxhY2UoJGZsaXBwZWQtdXJsLCBcIjxwb2x5Z29uXCIsIFwiPHBvbHlnb24gI3skdHJhbnNmb3JtfVwiKTtcbiAgICAkZmxpcHBlZC11cmw6IHVybC1lbmNvZGUoJGZsaXBwZWQtdXJsKTtcblxuICAgIEBpbmNsdWRlIGx0ciAoKSB7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCJkYXRhOmltYWdlL3N2Zyt4bWw7Y2hhcnNldD11dGYtOCwjeyR1cmx9XCIpO1xuICAgIH1cbiAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCJkYXRhOmltYWdlL3N2Zyt4bWw7Y2hhcnNldD11dGYtOCwjeyRmbGlwcGVkLXVybH1cIik7XG4gICAgfVxuICB9XG59XG5cbi8vIEFkZCBwcm9wZXJ0eSBob3Jpem9udGFsXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN0YXJ0XG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHByb3BlcnR5LWhvcml6b250YWwoJHByb3AsICRzdGFydCwgJGVuZDogJHN0YXJ0KSB7XG4gIEBpZiAkc3RhcnQgPT0gMCBhbmQgJGVuZCA9PSAwIHtcbiAgICAjeyRwcm9wfS1sZWZ0OiAkc3RhcnQ7XG4gICAgI3skcHJvcH0tcmlnaHQ6ICRlbmQ7XG5cbiAgfSBAZWxzZSB7XG4gICAgLXdlYmtpdC0jeyRwcm9wfS1zdGFydDogJHN0YXJ0O1xuICAgICN7JHByb3B9LWlubGluZS1zdGFydDogJHN0YXJ0O1xuICAgIC13ZWJraXQtI3skcHJvcH0tZW5kOiAkZW5kO1xuICAgICN7JHByb3B9LWlubGluZS1lbmQ6ICRlbmQ7XG4gIH1cbn1cblxuLy8gQWRkIHByb3BlcnR5IGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICRwcm9wXG4vLyBAcGFyYW0ge3N0cmluZ30gJHRvcFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRlbmRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkYm90dG9tXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN0YXJ0XG4vLyBAcGFyYW0ge2Jvb2xlYW59ICRjb250ZW50IGluY2x1ZGUgY29udGVudCBvciB1c2UgZGVmYXVsdFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHByb3BlcnR5KCRwcm9wLCAkdG9wLCAkZW5kOiAkdG9wLCAkYm90dG9tOiAkdG9wLCAkc3RhcnQ6ICRlbmQpIHtcbiAgQGluY2x1ZGUgcHJvcGVydHktaG9yaXpvbnRhbCgkcHJvcCwgJHN0YXJ0LCAkZW5kKTtcbiAgI3skcHJvcH0tdG9wOiAkdG9wO1xuICAjeyRwcm9wfS1ib3R0b206ICRib3R0b207XG59XG5cbi8vIEFkZCBwYWRkaW5nIGhvcml6b250YWxcbi8vIEBwYXJhbSB7c3RyaW5nfSAkc3RhcnRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AbWl4aW4gcGFkZGluZy1ob3Jpem9udGFsKCRzdGFydCwgJGVuZDogJHN0YXJ0KSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5LWhvcml6b250YWwocGFkZGluZywgJHN0YXJ0LCAkZW5kKTtcbn1cblxuLy8gQWRkIHBhZGRpbmcgZm9yIGFsbCBkaXJlY3Rpb25zXG4vLyBAcGFyYW0ge3N0cmluZ30gJHRvcFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRlbmRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkYm90dG9tXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN0YXJ0XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AbWl4aW4gcGFkZGluZygkdG9wLCAkZW5kOiAkdG9wLCAkYm90dG9tOiAkdG9wLCAkc3RhcnQ6ICRlbmQpIHtcbiAgQGluY2x1ZGUgcHJvcGVydHkocGFkZGluZywgJHRvcCwgJGVuZCwgJGJvdHRvbSwgJHN0YXJ0KTtcbn1cblxuLy8gQWRkIG1hcmdpbiBob3Jpem9udGFsXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN0YXJ0XG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIG1hcmdpbi1ob3Jpem9udGFsKCRzdGFydCwgJGVuZDogJHN0YXJ0KSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5LWhvcml6b250YWwobWFyZ2luLCAkc3RhcnQsICRlbmQpO1xufVxuXG4vLyBBZGQgbWFyZ2luIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3Bcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIG1hcmdpbigkdG9wLCAkZW5kOiAkdG9wLCAkYm90dG9tOiAkdG9wLCAkc3RhcnQ6ICRlbmQpIHtcbiAgQGluY2x1ZGUgcHJvcGVydHkobWFyZ2luLCAkdG9wLCAkZW5kLCAkYm90dG9tLCAkc3RhcnQpO1xufVxuXG4vLyBBZGQgcG9zaXRpb24gaG9yaXpvbnRhbFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydCAtIGFtb3VudCB0byBwb3NpdGlvbiBzdGFydFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRlbmQgLSBhbW91bnQgdG8gbGVmdDogMDsgZW5kXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AbWl4aW4gcG9zaXRpb24taG9yaXpvbnRhbCgkc3RhcnQ6IG51bGwsICRlbmQ6IG51bGwpIHtcbiAgQGlmICRzdGFydCA9PSAkZW5kIHtcbiAgICBAaW5jbHVkZSBtdWx0aS1kaXIoKSB7XG4gICAgICBsZWZ0OiAkc3RhcnQ7XG4gICAgICByaWdodDogJGVuZDtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBhdC1yb290IHtcbiAgICAgIEBzdXBwb3J0cyAoaW5zZXQtaW5saW5lLXN0YXJ0OiAwKSB7XG4gICAgICAgICYge1xuICAgICAgICAgIGluc2V0LWlubGluZS1zdGFydDogJHN0YXJ0O1xuICAgICAgICAgIGluc2V0LWlubGluZS1lbmQ6ICRlbmQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUT0RPIEZXLTM3NjZcbiAgICBAYXQtcm9vdCB7XG4gICAgICBAc3VwcG9ydHMgbm90IChpbnNldC1pbmxpbmUtc3RhcnQ6IDApIHtcbiAgICAgICAgJiB7XG4gICAgICAgICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgICAgICAgbGVmdDogJHN0YXJ0O1xuICAgICAgICAgICAgcmlnaHQ6ICRlbmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgICAgICAgIGxlZnQ6IHVuc2V0O1xuICAgICAgICAgICAgcmlnaHQ6IHVuc2V0O1xuXG4gICAgICAgICAgICBsZWZ0OiAkZW5kO1xuICAgICAgICAgICAgcmlnaHQ6ICRzdGFydDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLy8gQWRkIHBvc2l0aW9uIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3Bcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHBvc2l0aW9uKCR0b3A6IG51bGwsICRlbmQ6IG51bGwsICRib3R0b206IG51bGwsICRzdGFydDogbnVsbCkge1xuICBAaW5jbHVkZSBwb3NpdGlvbi1ob3Jpem9udGFsKCRzdGFydCwgJGVuZCk7XG4gIHRvcDogJHRvcDtcbiAgYm90dG9tOiAkYm90dG9tO1xufVxuXG4vLyBBZGQgYm9yZGVyIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3Bcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIGJvcmRlcigkdG9wLCAkZW5kOiAkdG9wLCAkYm90dG9tOiAkdG9wLCAkc3RhcnQ6ICRlbmQpIHtcbiAgQGluY2x1ZGUgcHJvcGVydHkoYm9yZGVyLCAkdG9wLCAkZW5kLCAkYm90dG9tLCAkc3RhcnQpO1xufVxuXG4vLyBBZGQgYm9yZGVyIHJhZGl1cyBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkdG9wLXN0YXJ0XG4vLyBAcGFyYW0ge3N0cmluZ30gJHRvcC1lbmRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkYm90dG9tLWVuZFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRib3R0b20tc3RhcnRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBib3JkZXItcmFkaXVzKCR0b3Atc3RhcnQsICR0b3AtZW5kOiAkdG9wLXN0YXJ0LCAkYm90dG9tLWVuZDogJHRvcC1zdGFydCwgJGJvdHRvbS1zdGFydDogJHRvcC1lbmQpIHtcbiAgQGlmICR0b3Atc3RhcnQgPT0gJHRvcC1lbmQgYW5kICR0b3Atc3RhcnQgPT0gJGJvdHRvbS1lbmQgYW5kICR0b3Atc3RhcnQgPT0gJGJvdHRvbS1zdGFydCB7XG4gICAgQGluY2x1ZGUgbXVsdGktZGlyKCkge1xuICAgICAgYm9yZGVyLXJhZGl1czogJHRvcC1zdGFydDtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6ICR0b3Atc3RhcnQ7XG4gICAgICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogJHRvcC1lbmQ7XG4gICAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogJGJvdHRvbS1lbmQ7XG4gICAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAkYm90dG9tLXN0YXJ0O1xuICAgIH1cblxuICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6ICR0b3AtZW5kO1xuICAgICAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6ICR0b3Atc3RhcnQ7XG4gICAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogJGJvdHRvbS1zdGFydDtcbiAgICAgIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6ICRib3R0b20tZW5kO1xuICAgIH1cbiAgfVxufVxuXG4vLyBBZGQgZGlyZWN0aW9uIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICRkaXIgLSBEaXJlY3Rpb24gb24gTFRSXG5AbWl4aW4gZGlyZWN0aW9uKCRkaXIpIHtcbiAgJG90aGVyLWRpcjogbnVsbDtcblxuICBAaWYgJGRpciA9PSBsdHIge1xuICAgICRvdGhlci1kaXI6IHJ0bDtcbiAgfSBAZWxzZSB7XG4gICAgJG90aGVyLWRpcjogbHRyO1xuICB9XG5cbiAgQGluY2x1ZGUgbHRyKCkge1xuICAgIGRpcmVjdGlvbjogJGRpcjtcbiAgfVxuICBAaW5jbHVkZSBydGwoKSB7XG4gICAgZGlyZWN0aW9uOiAkb3RoZXItZGlyO1xuICB9XG59XG5cbi8vIEFkZCBmbG9hdCBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkc2lkZVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRkZWNvcmF0b3IgLSAhaW1wb3J0YW50XG5AbWl4aW4gZmxvYXQoJHNpZGUsICRkZWNvcmF0b3I6IG51bGwpIHtcbiAgQGlmICRzaWRlID09IHN0YXJ0IHtcbiAgICBAaW5jbHVkZSBsdHIoKSB7XG4gICAgICBmbG9hdDogbGVmdCAkZGVjb3JhdG9yO1xuICAgIH1cbiAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICBmbG9hdDogcmlnaHQgJGRlY29yYXRvcjtcbiAgICB9XG4gIH0gQGVsc2UgaWYgJHNpZGUgPT0gZW5kIHtcbiAgICBAaW5jbHVkZSBsdHIoKSB7XG4gICAgICBmbG9hdDogcmlnaHQgJGRlY29yYXRvcjtcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgZmxvYXQ6IGxlZnQgJGRlY29yYXRvcjtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIGZsb2F0OiAkc2lkZSAkZGVjb3JhdG9yO1xuICAgIH1cbiAgfVxufVxuXG5AbWl4aW4gYmFja2dyb3VuZC1wb3NpdGlvbigkaG9yaXpvbnRhbCwgJGhvcml6b250YWwtYW1vdW50OiBudWxsLCAkdmVydGljYWw6IG51bGwsICR2ZXJ0aWNhbC1hbW91bnQ6IG51bGwpIHtcbiAgQGlmICRob3Jpem9udGFsID09IHN0YXJ0IG9yICRob3Jpem9udGFsID09IGVuZCB7XG4gICAgJGhvcml6b250YWwtbHRyOiBudWxsO1xuICAgICRob3Jpem9udGFsLXJ0bDogbnVsbDtcbiAgICBAaWYgJGhvcml6b250YWwgPT0gc3RhcnQge1xuICAgICAgJGhvcml6b250YWwtbHRyOiBsZWZ0O1xuICAgICAgJGhvcml6b250YWwtcnRsOiByaWdodDtcbiAgICB9IEBlbHNlIHtcbiAgICAgICRob3Jpem9udGFsLWx0cjogcmlnaHQ7XG4gICAgICAkaG9yaXpvbnRhbC1ydGw6IGxlZnQ7XG4gICAgfVxuXG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogJGhvcml6b250YWwtbHRyICRob3Jpem9udGFsLWFtb3VudCAkdmVydGljYWwgJHZlcnRpY2FsLWFtb3VudDtcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogJGhvcml6b250YWwtcnRsICRob3Jpem9udGFsLWFtb3VudCAkdmVydGljYWwgJHZlcnRpY2FsLWFtb3VudDtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246ICRob3Jpem9udGFsICRob3Jpem9udGFsLWFtb3VudCAkdmVydGljYWwgJHZlcnRpY2FsLWFtb3VudDtcbiAgICB9XG4gIH1cbn1cblxuQG1peGluIHRyYW5zZm9ybS1vcmlnaW4oJHgtYXhpcywgJHktYXhpczogbnVsbCkge1xuICBAaWYgJHgtYXhpcyA9PSBzdGFydCB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdCAkeS1heGlzO1xuICAgIH1cbiAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiByaWdodCAkeS1heGlzO1xuICAgIH1cbiAgfSBAZWxzZSBpZiAkeC1heGlzID09IGVuZCB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogcmlnaHQgJHktYXhpcztcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdCAkeS1heGlzO1xuICAgIH1cbiAgfSBAZWxzZSBpZiAkeC1heGlzID09IGxlZnQgb3IgJHgtYXhpcyA9PSByaWdodCB7XG4gICAgQGluY2x1ZGUgbXVsdGktZGlyKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogJHgtYXhpcyAkeS1heGlzO1xuICAgIH1cbiAgfSBAZWxzZSB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogJHgtYXhpcyAkeS1heGlzO1xuICAgIH1cbiAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiBjYWxjKDEwMCUgLSAjeyR4LWF4aXN9KSAkeS1heGlzO1xuICAgIH1cbiAgfVxufVxuXG4vLyBBZGQgdHJhbnNmb3JtIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICR0cmFuc2Zvcm1zIC0gY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgdHJhbnNmb3Jtc1xuQG1peGluIHRyYW5zZm9ybSgkdHJhbnNmb3Jtcy4uLikge1xuICAkZXh0cmE6IG51bGw7XG5cbiAgJHg6IG51bGw7XG4gICRsdHItdHJhbnNsYXRlOiBudWxsO1xuICAkcnRsLXRyYW5zbGF0ZTogbnVsbDtcblxuICBAZWFjaCAkdHJhbnNmb3JtIGluICR0cmFuc2Zvcm1zIHtcbiAgICBAaWYgKHN0ci1pbmRleCgkdHJhbnNmb3JtLCB0cmFuc2xhdGUzZCkpIHtcbiAgICAgICR0cmFuc2Zvcm06IHN0ci1yZXBsYWNlKCR0cmFuc2Zvcm0sICd0cmFuc2xhdGUzZCgnKTtcbiAgICAgICR0cmFuc2Zvcm06IHN0ci1yZXBsYWNlKCR0cmFuc2Zvcm0sICcpJyk7XG5cbiAgICAgICRjb29yZGluYXRlczogc3RyLXNwbGl0KCR0cmFuc2Zvcm0sICcsJyk7XG5cbiAgICAgICR4OiBudGgoJGNvb3JkaW5hdGVzLCAxKTtcbiAgICAgICR5OiBudGgoJGNvb3JkaW5hdGVzLCAyKTtcbiAgICAgICR6OiBudGgoJGNvb3JkaW5hdGVzLCAzKTtcblxuICAgICAgJGx0ci10cmFuc2xhdGU6IHRyYW5zbGF0ZTNkKCR4LCAkeSwgJHopO1xuICAgICAgJHJ0bC10cmFuc2xhdGU6IHRyYW5zbGF0ZTNkKGNhbGMoLTEgKiAjeyR4fSksICR5LCAkeik7XG4gICAgfSBAZWxzZSB7XG4gICAgICBAaWYgJGV4dHJhID09IG51bGwge1xuICAgICAgICAkZXh0cmE6ICR0cmFuc2Zvcm07XG4gICAgICB9IEBlbHNlIHtcbiAgICAgICAgJGV4dHJhOiAkZXh0cmEgJHRyYW5zZm9ybTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBAaWYgJHggPT0gJzAnIG9yICR4ID09IG51bGwge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIHRyYW5zZm9ybTogJGx0ci10cmFuc2xhdGUgJGV4dHJhO1xuICAgIH1cbiAgfSBAZWxzZSB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgdHJhbnNmb3JtOiAkbHRyLXRyYW5zbGF0ZSAkZXh0cmE7XG4gICAgfVxuXG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgdHJhbnNmb3JtOiAkcnRsLXRyYW5zbGF0ZSAkZXh0cmE7XG4gICAgfVxuICB9XG59XG4iLCIvKipcbiAqIEltcG9ydGVkIGlvbmljIG1peGlucyBmb3IgU0NTUyBmcm9tIGRpZmZlcmVudCBjb21wb25lbnRzXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBFeHRyYWN0ZWQgZnJvbVxuICogaHR0cHM6Ly9naXRodWIuY29tL2lvbmljLXRlYW0vaW9uaWMtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL2NvbXBvbmVudHMvZ3JpZC9ncmlkLm1peGlucy5zY3NzXG4gKiBodHRwczovL2dpdGh1Yi5jb20vaW9uaWMtdGVhbS9pb25pYy1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvY29yZS9zcmMvY29tcG9uZW50cy9pdGVtL2l0ZW0ubWl4aW5zLnNjc3NcbiAqL1xuXG4vLyBSZXNwb25zaXZlIE1peGluc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXG4vLyBDcmVhdGVzIGEgZml4ZWQgd2lkdGggZm9yIHRoZSBncmlkIGJhc2VkIG9uIHRoZSBzY3JlZW4gc2l6ZVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBtaXhpbiBtYWtlLWdyaWQtd2lkdGhzKCR3aWR0aHM6ICRncmlkLXdpZHRocywgJGJyZWFrcG9pbnRzOiAkc2NyZWVuLWJyZWFrcG9pbnRzKSB7XG4gIEBlYWNoICRicmVha3BvaW50LCAkd2lkdGggaW4gJHdpZHRocyB7XG4gICAgQGluY2x1ZGUgbWVkaWEtYnJlYWtwb2ludC11cCgkYnJlYWtwb2ludCwgJGJyZWFrcG9pbnRzKSB7XG4gICAgICB3aWR0aDogJHdpZHRoO1xuICAgIH1cbiAgfVxuXG4gIG1heC13aWR0aDogMTAwJTtcbn1cblxuXG4vLyBBZGRzIHBhZGRpbmcgdG8gdGhlIGVsZW1lbnQgYmFzZWQgb24gYnJlYWtwb2ludHNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AbWl4aW4gbWFrZS1icmVha3BvaW50LXBhZGRpbmcoJHBhZGRpbmdzKSB7XG4gIEBlYWNoICRicmVha3BvaW50IGluIG1hcC1rZXlzKCRwYWRkaW5ncykge1xuICAgIEBpbmNsdWRlIG1lZGlhLWJyZWFrcG9pbnQtdXAoJGJyZWFrcG9pbnQpIHtcbiAgICAgICRwYWRkaW5nOiBtYXAtZ2V0KCRwYWRkaW5ncywgJGJyZWFrcG9pbnQpO1xuXG4gICAgICBAaW5jbHVkZSBwYWRkaW5nKCRwYWRkaW5nKTtcbiAgICB9XG4gIH1cbn1cblxuXG4vLyBJdGVtIE1peGluc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQG1peGluIGl0ZW0tcHVzaC1zdmctdXJsKCRmaWxsKSB7XG4gICRpdGVtLWRldGFpbC1wdXNoLXN2ZzogXCI8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEyIDIwJz48cGF0aCBkPSdNMiwyMGwtMi0ybDgtOEwwLDJsMi0ybDEwLDEwTDIsMjB6JyBmaWxsPScjeyRmaWxsfScvPjwvc3ZnPlwiO1xuXG4gIEBpbmNsdWRlIHN2Zy1iYWNrZ3JvdW5kLWltYWdlKCRpdGVtLWRldGFpbC1wdXNoLXN2ZywgdHJ1ZSk7XG59XG4iLCJAdXNlIFwic2FzczptYXRoXCIgYXMgbWF0aDtcblxuLyoqXG4gKiBBcHAgY3VzdG9tIG1peGlucyBmb3IgU0NTU1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogUGxhY2UgaGVyZSBvdXIgY3VzdG9tIG1peGlucy5cbiAqL1xuXG4vLyBNaXhlcyBhIGNvbG9yIHdpdGggYmxhY2sgdG8gY3JlYXRlIGl0cyBzaGFkZS5cbi8vIERlZmF1bHQgdG8gYm9vdHN0cmFwIGxldmVsIDYuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQGZ1bmN0aW9uIGdldC1jb2xvci1zaGFkZS1wZXJjZW50KCRjb2xvciwgJHBlcmNlbnQ6IDQ4JSkge1xuICAgIEByZXR1cm4gbWl4KCMwMDAsICRjb2xvciwgJHBlcmNlbnQpO1xufVxuXG4vLyBNaXhlcyBhIGNvbG9yIHdpdGggd2hpdGUgdG8gY3JlYXRlIGl0cyB0aW50LlxuLy8gRGVmYXVsdCB0byBib290c3RyYXAgbGV2ZWwgLTEwLlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBmdW5jdGlvbiBnZXQtY29sb3ItdGludC1wZXJjZW50KCRjb2xvciwgJHBlcmNlbnQ6IDgwJSkge1xuICAgIEByZXR1cm4gbWl4KCNmZmYsICRjb2xvciwgJHBlcmNlbnQpO1xufVxuXG4vLyBJb25pYyBDb2xvcnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBHZW5lcmF0ZXMgdGhlIGNvbG9yIGNsYXNzZXMgYW5kIHZhcmlhYmxlcyBiYXNlZCBvbiB0aGVcbi8vIGNvbG9ycyBtYXBcblxuQG1peGluIGdlbmVyYXRlLWNvbG9yKCRjb2xvci1uYW1lLCAkY29sb3JzLCAkdGhlbWUpIHtcbiAgICAkY29sb3ItdGhlbWVzOiBtYXAtZ2V0KCRjb2xvcnMsICRjb2xvci1uYW1lKTtcbiAgICAkYmFzZTogbWFwLWdldCgkY29sb3ItdGhlbWVzLCAkdGhlbWUpO1xuXG4gICAgQGlmICR0aGVtZSA9PSAnZGFyaycge1xuICAgICAgICAkYmFzZTogbWl4KG1hcC1nZXQoJGNvbG9yLXRoZW1lcywgJ2xpZ2h0JyksIHdoaXRlLCA4MCUpICFkZWZhdWx0O1xuICAgIH1cblxuICAgIEBpbmNsdWRlIGdlbmVyYXRlLWNvbG9yLXZhcmlhbnRzKCRjb2xvci1uYW1lLCAkYmFzZSk7XG59XG5cbkBtaXhpbiBnZW5lcmF0ZS1jb2xvci12YXJpYW50cygkY29sb3ItbmFtZSwgJGJhc2UpIHtcbiAgICAkY29udHJhc3Q6IGdldF9jb250cmFzdF9jb2xvcigkYmFzZSk7XG4gICAgJHNoYWRlOiBnZXQtY29sb3Itc2hhZGUtcGVyY2VudCgkYmFzZSk7XG4gICAgJHRpbnQ6IGdldC1jb2xvci10aW50LXBlcmNlbnQoJGJhc2UpO1xuXG4gICAgLS0jeyRjb2xvci1uYW1lfTogI3skYmFzZX07XG4gICAgLS0jeyRjb2xvci1uYW1lfS1zaGFkZTogI3skc2hhZGV9O1xuICAgIC0tI3skY29sb3ItbmFtZX0tdGludDogI3skdGludH07XG4gICAgLS0jeyRjb2xvci1uYW1lfS1jb250cmFzdDogI3skY29udHJhc3R9O1xuXG4gICAgLy8gSW50ZXJuYWwgaW9uaWMgdXNlIG9ubHkuXG4gICAgLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX06IHZhcigtLSN7JGNvbG9yLW5hbWV9KTtcbiAgICAtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1iYXNlOiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0pO1xuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXJnYjogI3tjb2xvci10by1yZ2ItbGlzdCgkYmFzZSl9O1xuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LWNvbnRyYXN0OiAjeyRjb250cmFzdH07XG4gICAgLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tY29udHJhc3QtcmdiOiAje2NvbG9yLXRvLXJnYi1saXN0KCRjb250cmFzdCl9O1xuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXNoYWRlOiAjeyRzaGFkZX07XG4gICAgLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tdGludDogI3skdGludH07XG5cbiAgICAuaW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9IHtcbiAgICAgICAgLS1pb24tY29sb3I6IHZhcigtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfSk7XG4gICAgICAgIC0taW9uLWNvbG9yLWJhc2U6IHZhcigtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1iYXNlKTtcbiAgICAgICAgLS1pb24tY29sb3ItcmdiOiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tcmdiKTtcbiAgICAgICAgLS1pb24tY29sb3ItY29udHJhc3Q6IHZhcigtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1jb250cmFzdCk7XG4gICAgICAgIC0taW9uLWNvbG9yLWNvbnRyYXN0LXJnYjogdmFyKC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LWNvbnRyYXN0LXJnYik7XG4gICAgICAgIC0taW9uLWNvbG9yLXNoYWRlOiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tc2hhZGUpO1xuICAgICAgICAtLWlvbi1jb2xvci10aW50OiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tdGludCk7XG4gICAgfVxufVxuXG5AbWl4aW4gY29yZS1mb2N1cygpIHtcbiAgICBvdXRsaW5lOiBub25lO1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAmOjphZnRlciB7XG4gICAgICAgIEBpbmNsdWRlIHBvc2l0aW9uKDAsIDAsIDAsIDApO1xuICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgIGNvbnRlbnQ6IFwiXCI7XG4gICAgICAgIG9wYWNpdHk6IDE7XG4gICAgICAgIHotaW5kZXg6IDE7XG4gICAgICAgIEBpbmNsdWRlIGNvcmUtZm9jdXMtc3R5bGUoKTtcbiAgICB9XG59XG5cbkBtaXhpbiBjb3JlLWZvY3VzLXN0eWxlKCkge1xuICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCB2YXIoLS1hMTF5LWZvY3VzLXdpZHRoKSAxcHggdmFyKC0tYTExeS1mb2N1cy1jb2xvcik7XG4gICAgYm9yZGVyLXJhZGl1czogdmFyKC0tYm9yZGVyLXJhZGl1cyk7XG4gICAgLy8gVGhpY2tlciBvcHRpb246XG4gICAgLy8gYm9yZGVyOiB2YXIoLS1hMTF5LWZvY3VzLXdpZHRoKSBzb2xpZCB2YXIoLS1hMTF5LWZvY3VzLWNvbG9yKTtcbn1cblxuQG1peGluIGNvcmUtdHJhbnNpdGlvbigkcHJvcGVydGllczogYWxsLCAkZHVyYXRpb246IDUwMG1zLCAkdGltaW5nLWZ1bmN0aW9uOiBlYXNlLWluLW91dCkge1xuICAgICR0cmFuc2l0aW9uczogKCk7XG4gICAgQGVhY2ggJHByb3BlcnR5IGluICRwcm9wZXJ0aWVzIHtcbiAgICAgICR0cmFuc2l0aW9uczogYXBwZW5kKCR0cmFuc2l0aW9ucywgJHByb3BlcnR5ICRkdXJhdGlvbiAkdGltaW5nLWZ1bmN0aW9uLCBjb21tYSk7XG4gICAgfVxuXG4gICAgLXdlYmtpdC10cmFuc2l0aW9uOiAkdHJhbnNpdGlvbnM7XG4gICAgdHJhbnNpdGlvbjogJHRyYW5zaXRpb25zO1xufVxuXG5AbWl4aW4gc3Itb25seSgpIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgd2lkdGg6IDFweDtcbiAgICBoZWlnaHQ6IDFweDtcbiAgICBwYWRkaW5nOiAwO1xuICAgIG1hcmdpbjogLTFweDtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgIGNsaXA6IHJlY3QoMCwgMCwgMCwgMCk7XG4gICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgICBib3JkZXI6IDA7XG59XG5cbi8qKlxuICogU2FtZSBhcyBpdGVtLXB1c2gtc3ZnLXVybCBidXQgYWRtaXRzIGZsaXAtcnRsXG4gKi9cbkBtaXhpbiBwdXNoLWFycm93LWNvbG9yKCRmaWxsOiA2MjYyNjIsICRmbGlwLXJ0bDogZmFsc2UpIHtcbiAgICAkaXRlbS1kZXRhaWwtcHVzaC1zdmc6IFwiPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMiAyMCc+PHBhdGggZD0nTTIsMjBsLTItMmw4LThMMCwybDItMmwxMCwxMEwyLDIweicgZmlsbD0nI3skZmlsbH0nLz48L3N2Zz5cIjtcblxuICAgIEBpbmNsdWRlIHN2Zy1iYWNrZ3JvdW5kLWltYWdlKCRpdGVtLWRldGFpbC1wdXNoLXN2ZywgJGZsaXAtcnRsKTtcbn1cblxuQG1peGluIGJvcmRlci1zdGFydCgkcHgsICR0eXBlOiBudWxsLCAkY29sb3I6IG51bGwpIHtcbiAgICBAaW5jbHVkZSBwcm9wZXJ0eS1ob3Jpem9udGFsKGJvcmRlciwgJHB4ICR0eXBlICRjb2xvciwgbnVsbCk7XG59XG5cbkBtaXhpbiBib3JkZXItZW5kKCRweCwgJHR5cGU6IG51bGwsICRjb2xvcjogbnVsbCkge1xuICAgIEBpbmNsdWRlIHByb3BlcnR5LWhvcml6b250YWwoYm9yZGVyLCBudWxsLCAkcHggJHR5cGUgJGNvbG9yKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1ib3JkZXItc3RhcnQoJHB4LCAkdHlwZSwgJGNvbG9yKSB7XG4gICAgJHNhZmUtYXJlYS1wb3NpdGlvbjogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLWxlZnQpICsgI3skcHh9KTtcblxuICAgIEBpbmNsdWRlIGJvcmRlci1zdGFydCgkc2FmZS1hcmVhLXBvc2l0aW9uLCAkdHlwZSwgJGNvbG9yKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1ib3JkZXItZW5kKCRweCwgJHR5cGUsICRjb2xvcikge1xuICAgICRzYWZlLWFyZWEtcG9zaXRpb246IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1yaWdodCkgKyAjeyRweH0pO1xuXG4gICAgQGluY2x1ZGUgYm9yZGVyLWVuZCgkc2FmZS1hcmVhLXBvc2l0aW9uLCAkdHlwZSwgJGNvbG9yKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1tYXJnaW4taG9yaXpvbnRhbCgkc3RhcnQsICRlbmQ6ICRzdGFydCkge1xuICAgICRzYWZlLWFyZWEtZW5kOiBudWxsO1xuICAgICRzYWZlLWFyZWEtc3RhcnQ6IG51bGw7XG5cbiAgICBAaWYgKCRlbmQpIHtcbiAgICAgICAgJHNhZmUtYXJlYS1lbmQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1yaWdodCkgKyAjeyRlbmR9KTtcbiAgICB9XG4gICAgQGlmICgkc3RhcnQpIHtcbiAgICAgICAgJHNhZmUtYXJlYS1zdGFydDogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLWxlZnQpICsgI3skc3RhcnR9KTtcbiAgICB9XG5cbiAgICBAaW5jbHVkZSBtYXJnaW4taG9yaXpvbnRhbCgkc2FmZS1hcmVhLXN0YXJ0LCAkc2FmZS1hcmVhLWVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtbWFyZ2luLXN0YXJ0KCRzdGFydCwgJGVuZCkge1xuICAgICRzYWZlLWFyZWEtc3RhcnQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1sZWZ0KSArICN7JHN0YXJ0fSk7XG5cbiAgICBAaW5jbHVkZSBtYXJnaW4taG9yaXpvbnRhbCgkc2FmZS1hcmVhLXN0YXJ0LCAkZW5kKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1tYXJnaW4tZW5kKCRzdGFydCwgJGVuZCkge1xuICAgICRzYWZlLWFyZWEtZW5kOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skZW5kfSk7XG5cbiAgICBAaW5jbHVkZSBtYXJnaW4taG9yaXpvbnRhbCgkc3RhcnQsICRzYWZlLWFyZWEtZW5kKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1wYWRkaW5nLWhvcml6b250YWwoJHN0YXJ0LCAkZW5kOiAkc3RhcnQpIHtcbiAgICAkc2FmZS1hcmVhLWVuZDogbnVsbDtcbiAgICAkc2FmZS1hcmVhLXN0YXJ0OiBudWxsO1xuXG4gICAgQGlmICgkZW5kKSB7XG4gICAgICAgICRzYWZlLWFyZWEtZW5kOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skZW5kfSk7XG4gICAgfVxuICAgIEBpZiAoJHN0YXJ0KSB7XG4gICAgICAgICRzYWZlLWFyZWEtc3RhcnQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1sZWZ0KSArICN7JHN0YXJ0fSk7XG4gICAgfVxuXG4gICAgQGluY2x1ZGUgcGFkZGluZy1ob3Jpem9udGFsKCRzYWZlLWFyZWEtc3RhcnQsICRzYWZlLWFyZWEtZW5kKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1wYWRkaW5nLXN0YXJ0KCRzdGFydCwgJGVuZCkge1xuICAgICRzYWZlLWFyZWEtc3RhcnQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1sZWZ0KSArICN7JHN0YXJ0fSk7XG5cbiAgICBAaW5jbHVkZSBwYWRkaW5nLWhvcml6b250YWwoJHNhZmUtYXJlYS1zdGFydCwgJGVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtcGFkZGluZy1lbmQoJHN0YXJ0LCAkZW5kKSB7XG4gICAgJHNhZmUtYXJlYS1lbmQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1yaWdodCkgKyAjeyRlbmR9KTtcblxuICAgIEBpbmNsdWRlIHBhZGRpbmctaG9yaXpvbnRhbCgkc3RhcnQsICRzYWZlLWFyZWEtZW5kKTtcbn1cblxuQG1peGluIHNhZmUtYXJlYS1wb3NpdGlvbigkdG9wOiBudWxsLCAkZW5kOiBudWxsLCAkYm90dG9tOiBudWxsLCAkc3RhcnQ6IG51bGwpIHtcbiAgICAkc2FmZS1hcmVhLXN0YXJ0OiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtbGVmdCkgKyAjeyRzdGFydH0pO1xuICAgICRzYWZlLWFyZWEtZW5kOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skZW5kfSk7XG5cbiAgICBAaW5jbHVkZSBwb3NpdGlvbigkdG9wLCAkc2FmZS1hcmVhLWVuZCwgJGJvdHRvbSwgJHNhZmUtYXJlYS1zdGFydCk7XG59XG5cbkBtaXhpbiBjb3JlLWhlYWRpbmdzKCkge1xuICAgIGgxIHtcbiAgICAgICAgZm9udC1zaXplOiAyNnB4O1xuICAgIH1cbiAgICBoMiwgLml0ZW0taGVhZGluZyB7XG4gICAgICAgIGZvbnQtc2l6ZTogMjRweDtcbiAgICB9XG4gICAgaDMge1xuICAgICAgICBmb250LXNpemU6IDIycHg7XG4gICAgfVxuICAgIGg0IHtcbiAgICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgIH1cbiAgICBoNSB7XG4gICAgICAgIGZvbnQtc2l6ZTogMThweDtcbiAgICB9XG4gICAgaDYge1xuICAgICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgfVxufVxuXG5AbWl4aW4gZGFya21vZGUoKSB7XG4gICAgJHJvb3Q6ICN7Jn07XG5cbiAgICBAYXQtcm9vdCAje2FkZC1yb290LXNlbGVjdG9yKCRyb290LCBcImh0bWwuZGFya1wiKX0ge1xuICAgICAgICBAY29udGVudDtcbiAgICB9XG59XG5cbkBtaXhpbiBob3Jpem9udGFsX3Njcm9sbF9pdGVtKCR3aWR0aCwgJG1pbi13aWR0aCwgJG1heC13aWR0aCkge1xuICAgIGZsZXg6IDAgMCAkd2lkdGg7XG4gICAgbWluLXdpZHRoOiAkbWluLXdpZHRoO1xuICAgIG1heC13aWR0aDogJG1heC13aWR0aDtcbiAgICBhbGlnbi1zZWxmOiBzdHJldGNoO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuXG4gICAgaW9uLWNhcmQge1xuICAgICAgICAtLXZlcnRpY2FsLW1hcmdpbjogMTBweDtcbiAgICAgICAgLS1ob3Jpem9udGFsLW1hcmdpbjogMTBweDtcblxuICAgICAgICB3aWR0aDogY2FsYygxMDAlIC0gdmFyKC0taG9yaXpvbnRhbC1tYXJnaW4pIC0gdmFyKC0taG9yaXpvbnRhbC1tYXJnaW4pKTtcbiAgICAgICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSB2YXIoLS12ZXJ0aWNhbC1tYXJnaW4pIC0gdmFyKC0tdmVydGljYWwtbWFyZ2luKSk7XG4gICAgICAgIG1hcmdpbjogdmFyKC0tdmVydGljYWwtbWFyZ2luKSB2YXIoLS1ob3Jpem9udGFsLW1hcmdpbik7XG5cbiAgICAgICAgQG1lZGlhIChtYXgtd2lkdGg6IDM2MHB4KSB7XG4gICAgICAgICAgICAtLWhvcml6b250YWwtbWFyZ2luOiA2cHg7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIENvbG9yIG1peGlucy5cbkBmdW5jdGlvbiBnZXRfYnJpZ2h0bmVzcygkY29sb3IpIHtcbiAgICBAcmV0dXJuIG1hdGguZGl2KHJlZCgkY29sb3IpICsgZ3JlZW4oJGNvbG9yKSArIGJsdWUoJGNvbG9yKSwgMyk7XG59XG5cbi8vIEdldCB0aGUgYmV0dGVyIGNvbG9yIGNvbnRyYXN0IHVzaW5nIFdDQUcgYWxnb3J5dGhtLlxuQGZ1bmN0aW9uIGdldF9jb250cmFzdF9jb2xvcigkY29sb3IpIHtcbiAgICAkbHVtaWFuY2U6IGx1bWluYW5jZSgkY29sb3IpO1xuXG4gICAgLy8gV2hpdGUgbHVtaWFuY2UgaXMgMS5cbiAgICAkd2hpdGVDb250cmFzdDogbWF0aC5kaXYoJGx1bWlhbmNlICsgMC4wNSwgMSArIDAuMDUpO1xuICAgIC8vIFdoaXRlIGx1bWlhbmNlIGlzIDAuXG4gICAgJGJsYWNrQ29udHJhc3Q6IG1hdGguZGl2KDAuMDUsICRsdW1pYW5jZSArIDAuMDUpO1xuXG4gICAgQHJldHVybiBpZigkd2hpdGVDb250cmFzdCA8ICRibGFja0NvbnRyYXN0LCB3aGl0ZSwgYmxhY2spO1xufVxuXG4vLyBDb2xvciBjb250cmFzdCB1c2luZyB5aXEgYXByb3hpbWF0aW9uIHdpdGggMTUwIHRocmVzaG9sZC5cbkBmdW5jdGlvbiBnZXRfY29udHJhc3RfY29sb3JfeWlxKCRjb2xvciwgJGRhcms6IGJsYWNrLCAkbGlnaHQ6IHdoaXRlKSB7XG4gICAgJHI6IHJlZCgkY29sb3IpO1xuICAgICRnOiBncmVlbigkY29sb3IpO1xuICAgICRiOiBibHVlKCRjb2xvcik7XG5cbiAgICAkeWlxOiBtYXRoLmRpdigoJHIgKiAyOTkpICsgKCRnICogNTg3KSArICgkYiAqIDExNCksIDEwMDApO1xuXG4gICAgQHJldHVybiBpZigkeWlxID49IDEyOCwgJGRhcmssICRsaWdodCk7XG59XG5cbi8vIFdDQUcgY29udHJhc3QgYWxnb3JpdGhtXG5AZnVuY3Rpb24gY2hlY2stY29udHJhc3QoJGZvcmVncm91bmQsICRiYWNrZ3JvdW5kKSB7XG4gICAgJGZvcmVncm91bmRMdW1pYW5jZTogbHVtaW5hbmNlKCRmb3JlZ3JvdW5kKTtcbiAgICAkYmFja2dyb3VuZEx1bWluYW5jZTogbHVtaW5hbmNlKCRiYWNrZ3JvdW5kKTtcblxuICAgIEBpZiAoJGJhY2tncm91bmRMdW1pbmFuY2UgPCAkZm9yZWdyb3VuZEx1bWlhbmNlKSB7XG4gICAgICAgIEByZXR1cm4gbWF0aC5kaXYoJGJhY2tncm91bmRMdW1pbmFuY2UgKyAwLjA1LCAkZm9yZWdyb3VuZEx1bWlhbmNlICsgMC4wNSk7XG4gICAgfSBAZWxzZSB7XG4gICAgICAgIEByZXR1cm4gbWF0aC5kaXYoJGZvcmVncm91bmRMdW1pYW5jZSArIDAuMDUsICRiYWNrZ3JvdW5kTHVtaW5hbmNlICsgMC4wNSk7XG4gICAgfVxufVxuXG5AZnVuY3Rpb24gbHVtaW5hbmNlKCRjb2xvcikge1xuICAgICRyOiByZWQoJGNvbG9yKTtcbiAgICAkZzogZ3JlZW4oJGNvbG9yKTtcbiAgICAkYjogYmx1ZSgkY29sb3IpO1xuXG4gICAgJHI6IGNvbXBvbmVudC1sdW1pbmFuY2UoJHIpO1xuICAgICRnOiBjb21wb25lbnQtbHVtaW5hbmNlKCRnKTtcbiAgICAkYjogY29tcG9uZW50LWx1bWluYW5jZSgkYik7XG5cbiAgICBAcmV0dXJuICRyICogMC4yMTI2ICsgJGcgKiAwLjcxNTIgKyAkYiAqIDAuMDcyMjtcbn1cblxuQGZ1bmN0aW9uIGNvbXBvbmVudC1sdW1pbmFuY2UoJHZhbHVlKSB7XG4gICAgJHZhbHVlOiBtYXRoLmRpdigkdmFsdWUsIDI1NSk7XG5cbiAgICBAaWYgKCR2YWx1ZSA8PSAwLjAzOTI4KSB7XG4gICAgICAgIEByZXR1cm4gbWF0aC5kaXYoJHZhbHVlLCAxMi45Mik7XG4gICAgfSBAZWxzZSB7XG4gICAgICAgIEByZXR1cm4gbWF0aC5wb3cobWF0aC5kaXYoJHZhbHVlICsgMC4wNTUsIDEuMDU1KSwgMi40KTtcbiAgICB9XG59XG4iLCIvKlxuICogQXBwIEN1c3RvbSBBcHAgdmFyaWFibGVzIFNDU1NcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFBsYWNlIGhlcmUgYWxsIGN1c3RvbSBhcHAgdmFyaWFibGVzLlxuICovXG4iLCIvKlxuICogQXBwIEdsb2JhbCB2YXJpYWJsZXMgU0NTU1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogUGxhY2UgaGVyZSBhbGwgZ2xvYmFsIHZhcmlhYmxlcy5cbiAqL1xuXG4kd2hpdGU6ICAgICAgICNmZmZmZmYgIWRlZmF1bHQ7XG4kZ3JheS0xMDA6ICAgICNmOGY5ZmEgIWRlZmF1bHQ7XG4kZ3JheS0yMDA6ICAgICNlOWVjZWYgIWRlZmF1bHQ7XG4kZ3JheS0zMDA6ICAgICNkZWUyZTYgIWRlZmF1bHQ7IC8vIFN0cm9rZVxuJGdyYXktNDAwOiAgICAjY2VkNGRhICFkZWZhdWx0O1xuJGdyYXktNTAwOiAgICAjOGY5NTllICFkZWZhdWx0OyAvLyBTdHJva2Ugb24gaW5wdXRzXG4kZ3JheS02MDA6ICAgICM2YTczN2IgIWRlZmF1bHQ7XG4kZ3JheS03MDA6ICAgICM0OTUwNTcgIWRlZmF1bHQ7XG4kZ3JheS04MDA6ICAgICMzNDNhNDAgIWRlZmF1bHQ7XG4kZ3JheS05MDA6ICAgICMyODI4MjggIWRlZmF1bHQ7IC8vIENvcHkgdGV4dFxuJGJsYWNrOiAgICAgICAjMDAwMDAwICFkZWZhdWx0OyAvLyBBdm9pZCB1c2FnZVxuXG4kYmx1ZTogICAgICAgICMwZjZjYmYgIWRlZmF1bHQ7XG4kY3lhbjogICAgICAgICMwMDgxOTYgIWRlZmF1bHQ7IC8vIE5vdCB1c2VkLlxuJGdyZWVuOiAgICAgICAjMzU3YTMyICFkZWZhdWx0O1xuJHJlZDogICAgICAgICAjY2EzMTIwICFkZWZhdWx0O1xuJHllbGxvdzogICAgICAjZjBhZDRlICFkZWZhdWx0O1xuXG4kYnJhbmQtY29sb3I6ICNmOTgwMTIgIWRlZmF1bHQ7XG5cbiR0ZXh0LWNvbG9yOiAgICAgICAgICAgICAgICRncmF5LTkwMCAhZGVmYXVsdDtcbiR0ZXh0LWNvbG9yLXJnYjogICAgICAgICAgIGNvbG9yLXRvLXJnYi1saXN0KCR0ZXh0LWNvbG9yKSAhZGVmYXVsdDtcbiR0ZXh0LWNvbG9yLWRhcms6ICAgICAgICAgICR3aGl0ZSAhZGVmYXVsdDtcbiR0ZXh0LWNvbG9yLWRhcmstcmdiOiAgICAgIGNvbG9yLXRvLXJnYi1saXN0KCR0ZXh0LWNvbG9yLWRhcmspICFkZWZhdWx0O1xuXG4kYmFja2dyb3VuZC1jb2xvcjogICAgICAgICAgJHdoaXRlICFkZWZhdWx0O1xuJGJhY2tncm91bmQtY29sb3ItcmdiOiAgICAgIGNvbG9yLXRvLXJnYi1saXN0KCRiYWNrZ3JvdW5kLWNvbG9yKSAhZGVmYXVsdDtcbiRiYWNrZ3JvdW5kLWNvbG9yLWRhcms6ICAgICAkZ3JheS05MDAgIWRlZmF1bHQ7IC8vICMxYTFhMWFcbiRiYWNrZ3JvdW5kLWNvbG9yLWRhcmstcmdiOiBjb2xvci10by1yZ2ItbGlzdCgkYmFja2dyb3VuZC1jb2xvci1kYXJrKSAhZGVmYXVsdDtcblxuJGlvbi1pdGVtLWJhY2tncm91bmQ6ICAgICAgJHdoaXRlICFkZWZhdWx0O1xuJGlvbi1pdGVtLWJhY2tncm91bmQtcmdiOiAgY29sb3ItdG8tcmdiLWxpc3QoJGlvbi1pdGVtLWJhY2tncm91bmQpICFkZWZhdWx0O1xuJGlvbi1pdGVtLWJhY2tncm91bmQtZGFyazogJGdyYXktOTAwICFkZWZhdWx0O1xuJGlvbi1pdGVtLWJhY2tncm91bmQtZGFyay1yZ2I6IGNvbG9yLXRvLXJnYi1saXN0KCRpb24taXRlbS1iYWNrZ3JvdW5kLWRhcmspICFkZWZhdWx0O1xuXG4kcHJpbWFyeTogICAgJGJyYW5kLWNvbG9yICFkZWZhdWx0O1xuJHNlY29uZGFyeTogICRncmF5LTMwMCAhZGVmYXVsdDtcbiRkYW5nZXI6ICAgICAkcmVkICFkZWZhdWx0O1xuJHdhcm5pbmc6ICAgICR5ZWxsb3cgIWRlZmF1bHQ7XG4kc3VjY2VzczogICAgJGdyZWVuICFkZWZhdWx0O1xuJGluZm86ICAgICAgICRibHVlICFkZWZhdWx0O1xuJGxpZ2h0OiAgICAgICRncmF5LTEwMCAhZGVmYXVsdDtcbiRtZWRpdW06ICAgICAkZ3JheS03MDAgIWRlZmF1bHQ7XG4kZGFyazogICAgICAgJGdyYXktOTAwICFkZWZhdWx0O1xuXG4kY29sb3JzOiAgKFxuICAgIHByaW1hcnk6IChsaWdodDogJHByaW1hcnksIGRhcms6ICRwcmltYXJ5KSxcbiAgICBzZWNvbmRhcnk6IChsaWdodDogJHNlY29uZGFyeSwgZGFyazogJGdyYXktNzAwKSxcbiAgICBzdWNjZXNzOiAobGlnaHQ6ICRzdWNjZXNzKSxcbiAgICB3YXJuaW5nOiAobGlnaHQ6ICR3YXJuaW5nKSxcbiAgICBkYW5nZXI6ICAobGlnaHQ6ICRkYW5nZXIpLFxuICAgIGluZm86IChsaWdodDogJGluZm8pLFxuICAgIGxpZ2h0OiAobGlnaHQ6ICRsaWdodCwgZGFyazogJGRhcmspLFxuICAgIG1lZGl1bTogKGxpZ2h0OiAkbWVkaXVtLCBkYXJrOiAkZ3JheS0yMDApLFxuICAgIGRhcms6IChsaWdodDogJGRhcmssIGRhcms6ICRsaWdodCksXG4pICFkZWZhdWx0O1xuXG4vKipcbiAqIExheW91dCBCcmVha3BvaW50c1xuICpcbiAqIGh0dHBzOi8vaW9uaWNmcmFtZXdvcmsuY29tL2RvY3MvbGF5b3V0L2dyaWQjZGVmYXVsdC1icmVha3BvaW50c1xuICovXG5cbi8vIFRoZSBtaW5pbXVtIGRpbWVuc2lvbnMgYXQgd2hpY2ggeW91ciBsYXlvdXQgd2lsbCBjaGFuZ2UsXG4vLyBhZGFwdGluZyB0byBkaWZmZXJlbnQgc2NyZWVuIHNpemVzLCBmb3IgdXNlIGluIG1lZGlhIHF1ZXJpZXNcbiRzY3JlZW4tYnJlYWtwb2ludHM6IChcbiAgICB4czogMHB4LFxuICAgIHNtOiA1NzZweCxcbiAgICBtZDogNzY4cHgsXG4gICAgbGc6IDk5MnB4LFxuICAgIHRhYmxldDogOTkycHgsXG4gICAgeGw6IDEyMDBweFxuKSAhZGVmYXVsdDtcblxuJGNvcmUtY291cnNlLWltYWdlLWJhY2tncm91bmQ6ICM4MWVjZWMsICM3NGI5ZmYsICNhMjliZmUsICNkZmU2ZTksICMwMGI4OTQsICMwOTg0ZTMsICNiMmJlYzMsICNmZGNiNmUsICNmZDc5YTgsICM2YzVjZTcgIWRlZmF1bHQ7XG4kY29yZS1kZC1xdWVzdGlvbi1jb2xvcnM6ICNGRkZGRkYsICNCMEM0REUsICNEQ0RDREMsICNEOEJGRDgsICM4N0NFRkEsICNEQUE1MjAsICNGRkQ3MDAsICNGMEU2OEMgIWRlZmF1bHQ7XG4kY29yZS10ZXh0LWhpZ2h0bGlnaHQtYmFja2dyb3VuZC1jb2xvcjogbGlnaHRlbigkYmx1ZSwgNDAlKSAhZGVmYXVsdDtcblxuJGNvcmUtZml4ZWQtdXJsOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWRhc2hib2FyZC1sb2dvOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWFsd2F5cy1zaG93LW1haW4tbWVudTogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1mb3JtYXQtdGV4dC1uZXZlci1zaG9ydGVuOiBmYWxzZSAhZGVmYXVsdDtcblxuJGNvcmUtaGlkZS1jb3Vyc2VpbWFnZS1vbi1jb3Vyc2U6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtaGlkZS1wcm9ncmVzcy1vbi1jb3Vyc2U6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtaGlkZS1wcm9ncmVzcy1vbi1zZWN0aW9uLXNlbGVjdG9yOiBmYWxzZSAhZGVmYXVsdDtcblxuJGNvcmUtY291cnNlLWhpZGUtdGh1bWItb24tY2FyZHM6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtY291cnNlLXRodW1iLW9uLWNhcmRzLWJhY2tncm91bmQ6IG51bGwgIWRlZmF1bHQ7XG4kY29yZS1jb3Vyc2UtaGlkZS1wcm9ncmVzcy1vbi1jYXJkczogZmFsc2UgIWRlZmF1bHQ7XG5cbi8vIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgbG9naW4gcGFnZS5cbiRjb3JlLWxvZ2luLWJ1dHRvbi1vdXRsaW5lOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWxvZ2luLWJ1dHRvbi1vdXRsaW5lLWRhcms6ICRjb3JlLWxvZ2luLWJ1dHRvbi1vdXRsaW5lICFkZWZhdWx0O1xuJGNvcmUtbG9naW4tbG9hZGluZy1jb2xvcjogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1sb2dpbi1sb2FkaW5nLWNvbG9yLWRhcms6ICR0ZXh0LWNvbG9yLWRhcmsgIWRlZmF1bHQ7XG4kY29yZS1sb2dpbi1oaWRlLWZvcmdvdC1wYXNzd29yZDogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1sb2dpbi1oaWRlLW5lZWQtaGVscDogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1sb2dpbi1oaWRlLXFyY29kZTogZmFsc2UgIWRlZmF1bHQ7XG5cbi8vIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgbW9yZSBwYWdlLiAoZGVwcmVjYXRlZCBvbiA0LjApXG4kY29yZS1tb3JlLWhpZGUtc2l0ZWluZm86IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtbW9yZS1oaWRlLXNpdGVuYW1lOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLW1vcmUtaGlkZS1zaXRldXJsOiBmYWxzZSAhZGVmYXVsdDtcblxuLy8gQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB1c2VyIHBhZ2UuXG4kY29yZS11c2VyLWhpZGUtc2l0ZWluZm86ICRjb3JlLW1vcmUtaGlkZS1zaXRlaW5mbyAhZGVmYXVsdDtcbiRjb3JlLXVzZXItaGlkZS1zaXRlbmFtZTogJGNvcmUtbW9yZS1oaWRlLXNpdGVuYW1lICFkZWZhdWx0O1xuJGNvcmUtdXNlci1oaWRlLXNpdGV1cmw6ICRjb3JlLW1vcmUtaGlkZS1zaXRldXJsICFkZWZhdWx0O1xuXG4vLyBBY3Rpdml0eSBpY29uIGJhY2tncm91bmQgY29sb3JzLlxuJGFjdGl2aXR5LWljb24tY29sb3JzOiAoXG4gICAgYWRtaW5pc3RyYXRpb246ICM1ZDYzZjYsXG4gICAgYXNzZXNzbWVudDogI2ViNjZhMixcbiAgICBjb2xsYWJvcmF0aW9uOiAjZjc2MzRkLFxuICAgIGNvbW11bmljYXRpb246ICMxMWE2NzYsXG4gICAgY29udGVudDogIzM5OWJlMixcbiAgICBpbnRlcmZhY2U6ICNhMzc4ZmZcbikgIWRlZmF1bHQ7XG5cbiRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1jYXRlZ29yeTogIzhlMjRhYSAhZGVmYXVsdDtcbiRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1jb3Vyc2U6ICRyZWQgIWRlZmF1bHQ7XG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktZ3JvdXA6ICR5ZWxsb3cgIWRlZmF1bHQ7XG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktdXNlcjogJGJsdWUgIWRlZmF1bHQ7XG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktc2l0ZTogJGdyZWVuICFkZWZhdWx0O1xuXG4vLyBDYWxlbmRhciBldmVudCBjYXRlZ29yeSBiYWNrZ3JvdW5kIGNvbG9ycy5cbiRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1jb2xvcnM6IChcbiAgICBjYXRlZ29yeTogJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LWNhdGVnb3J5LFxuICAgIGNvdXJzZTogJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LWNvdXJzZSxcbiAgICBncm91cDogJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LWdyb3VwLFxuICAgIHVzZXI6ICRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS11c2VyLFxuICAgIHNpdGU6ICRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1zaXRlLFxuKSAhZGVmYXVsdDtcbiIsIkB1c2UgXCJ0aGVtZS9nbG9iYWxzXCIgYXMgKjtcblxuJGFkZG9uLW1vZC13aWtpLXRvYy1sZXZlbC1wYWRkaW5nOiAgICAxMnB4ICFkZWZhdWx0O1xuXG46aG9zdCB7XG4gICAgLS1hZGRvbi1tb2Qtd2lraS1uZXdlbnRyeS1saW5rLWNvbG9yOiB2YXIoLS1kYW5nZXIpO1xuICAgIC0tYWRkb24tbW9kLXdpa2ktdG9jLWJvcmRlci1jb2xvcjogdmFyKC0tZ3JheS01MDApO1xuICAgIC0tYWRkb24tbW9kLXdpa2ktdG9jLWJhY2tncm91bmQtY29sb3I6IHZhcigtLWdyYXktMjAwKTtcblxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWlvbi1pdGVtLWJhY2tncm91bmQpO1xuXG4gICAgLmFkZG9uLW1vZF93aWtpLXBhZ2UtY29udGVudCB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWlvbi1pdGVtLWJhY2tncm91bmQpO1xuICAgICAgICBwYWRkaW5nLWJvdHRvbTogMTBweDtcbiAgICB9XG5cbiAgICAuYWRkb24tbW9kX3dpa2ktcGFnZS1jb250ZW50IGNvcmUtZm9ybWF0LXRleHQgOjpuZy1kZWVwIHtcbiAgICAgICAgLndpa2ktdG9jIHtcbiAgICAgICAgICAgIG1hcmdpbjogMTZweDtcbiAgICAgICAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWFkZG9uLW1vZC13aWtpLXRvYy1ib3JkZXItY29sb3IpO1xuICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYWRkb24tbW9kLXdpa2ktdG9jLWJhY2tncm91bmQtY29sb3IpO1xuICAgICAgICAgICAgcCB7XG4gICAgICAgICAgICAgICAgY29sb3I6IHZhcigtLWlvbi10ZXh0LWNvbG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC53aWtpLXRvYy10aXRsZSB7XG4gICAgICAgICAgICBmb250LXNpemU6IDEuMWVtO1xuICAgICAgICAgICAgZm9udC12YXJpYW50OiBzbWFsbC1jYXBzO1xuICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgLndpa2ktdG9jLXNlY3Rpb24ge1xuICAgICAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgICAgIG1hcmdpbjogMnB4IDhweDtcbiAgICAgICAgfVxuXG4gICAgICAgIC53aWtpLXRvYy1zZWN0aW9uLTIge1xuICAgICAgICAgICAgQGluY2x1ZGUgcGFkZGluZy1ob3Jpem9udGFsKCRhZGRvbi1tb2Qtd2lraS10b2MtbGV2ZWwtcGFkZGluZywgbnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgICAud2lraS10b2Mtc2VjdGlvbi0zIHtcbiAgICAgICAgICAgIEBpbmNsdWRlIHBhZGRpbmctaG9yaXpvbnRhbCgkYWRkb24tbW9kLXdpa2ktdG9jLWxldmVsLXBhZGRpbmcgKiAyLCBudWxsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC53aWtpX25ld2VudHJ5IHtcbiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1hZGRvbi1tb2Qtd2lraS1uZXdlbnRyeS1saW5rLWNvbG9yKTtcbiAgICAgICAgICAgIGZvbnQtc3R5bGU6IGl0YWxpYztcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIEhpZGUgZWRpdCBzZWN0aW9uIGxpbmtzICovXG4gICAgICAgIC5hZGRvbi1tb2Rfd2lraS1ub2VkaXQgYS53aWtpX2VkaXRfc2VjdGlvbiB7XG4gICAgICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICB9XG4gICAgfVxufVxuXG46aG9zdC1jb250ZXh0KGh0bWwuZGFyaykge1xuICAgIC0tYWRkb24tbW9kLXdpa2ktbmV3ZW50cnktbGluay1jb2xvcjogdmFyKC0tZGFuZ2VyLXRpbnQpO1xuICAgIC0tYWRkb24tbW9kLXdpa2ktdG9jLWJhY2tncm91bmQtY29sb3I6IHZhcigtLW1lZGl1bSk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"names":["CoreError","CoreCourseModuleMainActivityComponent","CoreCourse","CoreTag","CoreUser","CoreNetwork","CoreGroups","CoreNavigator","CoreSites","CoreDomUtils","CoreUtils","Translate","NgZone","CoreEvents","CorePath","Md5","AddonModWikiModuleHandlerService","AddonModWiki","AddonModWikiProvider","AddonModWikiOffline","AddonModWikiSync","AddonModWikiSyncProvider","AddonModWikiMapModalComponent","AddonModWikiSubwikiPickerComponent","i0","ɵɵelement","ɵɵelementStart","ɵɵlistener","AddonModWikiIndexComponent_ion_button_1_Template_ion_button_click_0_listener","$event","ɵɵrestoreView","_r15","ctx_r14","ɵɵnextContext","ɵɵresetView","showSubwikiPicker","ɵɵtemplate","AddonModWikiIndexComponent_ion_button_1_ion_icon_2_Template","AddonModWikiIndexComponent_ion_button_1_ion_icon_3_Template","ɵɵelementEnd","ɵɵattribute","ɵɵpipeBind1","ɵɵadvance","ɵɵproperty","ctx_r0","groupWiki","AddonModWikiIndexComponent_ion_button_2_Template_ion_button_click_0_listener","_r17","ctx_r16","openMap","AddonModWikiIndexComponent_core_context_menu_item_4_Template_core_context_menu_item_action_0_listener","_r19","ctx_r18","goToEditPage","AddonModWikiIndexComponent_core_context_menu_item_5_Template_core_context_menu_item_action_0_listener","_r21","ctx_r20","goToNewPage","AddonModWikiIndexComponent_core_course_module_info_10_Template_core_course_module_info_completionChanged_0_listener","_r23","ctx_r22","onCompletionChange","ctx_r4","module","description","component","componentId","courseId","ɵɵtext","ɵɵtextInterpolate","ɵɵpipeBind2","ɵɵpureFunction1","_c0","ctx_r26","pageStr","ctx_r27","moduleName","AddonModWikiIndexComponent_div_11_ion_card_1_span_4_Template","AddonModWikiIndexComponent_div_11_ion_card_1_span_5_Template","ctx_r24","pageIsOffline","ctx_r25","pageWarning","AddonModWikiIndexComponent_div_11_ion_card_1_Template","AddonModWikiIndexComponent_div_11_ion_card_2_Template","ctx_r5","hasOffline","ctx_r6","pageTitle","ctx_r7","pageContent","id","ɵɵtextInterpolate1","ctx_r9","tags","ctx_r10","showLoading","AddonModWikiIndexComponent_ion_fab_19_Template_ion_fab_button_click_1_listener","_r29","ctx_r28","AddonModWikiIndexComponent","constructor","content","courseContentsPage","COMPONENT","pluginName","isOnline","isMainPage","canEdit","loadedSubwikis","tagsEnabled","subwikiData","subwikiSelected","userSelected","groupSelected","subwikis","count","syncEventName","AUTO_SYNCED","ignoreManualSyncEvent","onlineSubscription","onChange","subscribe","run","ngOnInit","_superprop_getNgOnInit","_this","_asyncToGenerator","call","instant","areTagsAvailableInSite","currentUserId","getCurrentSiteUserId","pageId","currentPage","currentPath","getCurrentPath","listenEvents","loadContent","action","manualSyncObserver","on","MANUAL_SYNCED","data","wiki","wikiId","currentSubwiki","checkPageCreatedOrDiscarded","showLoadingAndFetch","siteId","page","created","find","title","discarded","warning","fetchContent","refresh","sync","showErrors","_this2","getWiki","undefined","dataRetrieved","emit","wikiPageOpened","ignoreErrors","syncActivity","getModule","coursemodule","course","intro","fetchSubwikis","subwikiList","getSubwikiList","groupInfo","getActivityGroupInfo","separateGroups","groups","length","createSubwikiList","setSelectedWiki","subwikiId","userId","groupId","isAnySubwikiSelected","fetchWikiPage","error","fetchPageContents","_this3","getPageContents","cmId","_this3$wiki","_this3$currentSubwiki","_this3$currentSubwiki2","_this3$currentSubwiki3","_this3$currentSubwiki4","firstpagetitle","offlinePage","getNewPage","wikiid","userid","groupid","newPageObserver","PAGE_CREATED_EVENT","_ref","_this3$currentSubwiki5","_this3$newPageObserve","off","logPageViewed","_x","apply","arguments","getCurrentSiteId","_unused","fetchSubwikiPages","subwiki","_this4","subwikiPages","getSubwikiPages","setCurrentPage","dbPages","getSubwikiNewPages","sortPagesByTitle","concat","_firstPage$title","_this$wiki","firstPage","firstpage","_this5","getSubwikis","subwikisHaveOfflineData","_this6","isSubwikiSelected","canedit","pageContents","subwikiid","replaceEditLinks","cachedcontent","caneditpage","currentPageObj","logActivity","_this7","_this7$currentPageObj2","checkCompletionAfterLog","logView","_this7$currentPageObj","analyticsLogEvent","name","hasPersonalSubwikis","some","hasGroupSubwikis","url","_this8","_this8$currentPageObj","logPageView","pageid","storeModuleViewed","_superprop_getStoreModuleViewed","_this9","getWikiHomeView","getFirstWikiPageOpened","goToCreateFirstPage","_this$wiki$firstpaget","_this$wiki2","_this$currentSubwiki","_this$currentSubwiki2","_this$currentSubwiki3","navigateToSitePath","PAGE_NAME","params","pageParams","goToPage","_this10","openPageOrSubwiki","options","_this11","hash","hashAsciiStr","JSON","stringify","_objectSpread","timestamp","Date","now","animated","replace","_this12","modalData","openSideModal","componentProps","pages","homeView","moduleId","selectedId","selectedTitle","home","animationDirection","goToSubwiki","_this$currentSubwiki4","_this$currentSubwiki5","_this$currentSubwiki6","trim","editUrl","concatenatePaths","getRequiredCurrentSite","getURL","convertToPositiveNumber","hasSyncSucceed","result","updated","trigger","ionViewDidEnter","editedPageData","consumeEditedPageData","showLoadingAndRefresh","sameSubwiki","indexOf","invalidateContent","_this13","promises","push","invalidateWikiData","invalidateSubwikis","invalidateActivityAllowedGroups","invalidateActivityGroupMode","invalidateSubwikiPages","invalidateSubwikiFiles","invalidatePage","Promise","all","isRefreshSyncNeeded","syncEventData","isCurrentView","warnings","showAlert","event","_this14","openPopover","_this15","syncWiki","ngOnDestroy","_this$manualSyncObser","_this$newPageObserver","unsubscribe","wikiPageClosed","userGroups","_this16","allParticipants","showMyGroupsLabel","multiLevelList","map","_ref2","groupLabel","unshift","_group$name","group","user","getProfile","fullname","_x2","fillSubwikiData","firstCanEdit","candidateNoFirstPage","candidateFirstPage","i","candidateSubwikiId","Number","subWikiToTake","groupValue","grouping","forEach","label","noGroupSubwikis","myGroupsSubwikis","otherGroupsSubwikis","setSubwikiList","ɵɵdirectiveInject","i1","IonContent","i2","CoreCourseContentsPage","selectors","inputs","features","ɵɵInheritDefinitionFeature","decls","vars","consts","template","AddonModWikiIndexComponent_Template","rf","ctx","AddonModWikiIndexComponent_ion_button_1_Template","AddonModWikiIndexComponent_ion_button_2_Template","AddonModWikiIndexComponent_core_context_menu_item_4_Template","AddonModWikiIndexComponent_core_context_menu_item_5_Template","AddonModWikiIndexComponent_Template_ion_button_click_6_listener","openModuleSummary","AddonModWikiIndexComponent_core_course_module_info_10_Template","AddonModWikiIndexComponent_div_11_Template","AddonModWikiIndexComponent_h2_13_Template","AddonModWikiIndexComponent_core_format_text_15_Template","AddonModWikiIndexComponent_core_empty_box_16_Template","AddonModWikiIndexComponent_div_17_Template","AddonModWikiIndexComponent_core_course_module_navigation_18_Template","AddonModWikiIndexComponent_ion_fab_19_Template","_c1"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/wiki/components/index/index.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/wiki/components/index/addon-mod-wiki-index.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, Optional, Input, OnInit, OnDestroy } from '@angular/core';\nimport { Params } from '@angular/router';\nimport { CoreError } from '@classes/errors/error';\nimport { CoreCourseModuleMainActivityComponent } from '@features/course/classes/main-activity-component';\nimport { CoreCourseContentsPage } from '@features/course/pages/contents/contents';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreTag, CoreTagItem } from '@features/tag/services/tag';\nimport { CoreUser } from '@features/user/services/user';\nimport { IonContent } from '@ionic/angular';\nimport { CoreNetwork } from '@services/network';\nimport { CoreGroup, CoreGroups } from '@services/groups';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate, NgZone } from '@singletons';\nimport { CoreEventObserver, CoreEvents } from '@singletons/events';\nimport { CorePath } from '@singletons/path';\nimport { Subscription } from 'rxjs';\nimport { Md5 } from 'ts-md5';\nimport { AddonModWikiPageDBRecord } from '../../services/database/wiki';\nimport { AddonModWikiModuleHandlerService } from '../../services/handlers/module';\nimport {\n    AddonModWiki,\n    AddonModWikiPageContents,\n    AddonModWikiProvider,\n    AddonModWikiSubwiki,\n    AddonModWikiSubwikiListData,\n    AddonModWikiSubwikiListGrouping,\n    AddonModWikiSubwikiListSubwiki,\n    AddonModWikiSubwikiPage,\n    AddonModWikiWiki,\n} from '../../services/wiki';\nimport { AddonModWikiOffline } from '../../services/wiki-offline';\nimport {\n    AddonModWikiAutoSyncData,\n    AddonModWikiSync,\n    AddonModWikiSyncProvider,\n    AddonModWikiSyncWikiResult,\n    AddonModWikiSyncWikiSubwiki,\n} from '../../services/wiki-sync';\nimport { AddonModWikiMapModalComponent, AddonModWikiMapModalReturn } from '../map/map';\nimport { AddonModWikiSubwikiPickerComponent } from '../subwiki-picker/subwiki-picker';\n\n/**\n * Component that displays a wiki entry page.\n */\n@Component({\n    selector: 'addon-mod-wiki-index',\n    templateUrl: 'addon-mod-wiki-index.html',\n    styleUrls: ['index.scss'],\n})\nexport class AddonModWikiIndexComponent extends CoreCourseModuleMainActivityComponent implements OnInit, OnDestroy {\n\n    @Input() action?: string;\n    @Input() pageId?: number;\n    @Input() pageTitle?: string;\n    @Input() subwikiId?: number;\n    @Input() userId?: number;\n    @Input() groupId?: number;\n\n    component = AddonModWikiProvider.COMPONENT;\n    componentId?: number;\n    pluginName = 'wiki';\n    groupWiki = false;\n\n    isOnline = false;\n\n    wiki?: AddonModWikiWiki; // The wiki instance.\n    isMainPage = false; // Whether the user is viewing wiki's main page (just entered the wiki).\n    canEdit = false; // Whether user can edit the page.\n    pageStr = '';\n    pageWarning?: string; // Message telling that the page was discarded.\n    loadedSubwikis: AddonModWikiSubwiki[] = []; // The loaded subwikis.\n    pageIsOffline = false; // Whether the loaded page is an offline page.\n    pageContent?: string; // Page content to display.\n    tagsEnabled = false;\n    currentPageObj?: AddonModWikiPageContents | AddonModWikiPageDBRecord; // Object of the current loaded page.\n    tags: CoreTagItem[] = [];\n    subwikiData: AddonModWikiSubwikiListData = { // Data for the subwiki selector.\n        subwikiSelected: 0,\n        userSelected: 0,\n        groupSelected: 0,\n        subwikis: [],\n        count: 0,\n    };\n\n    protected syncEventName = AddonModWikiSyncProvider.AUTO_SYNCED;\n    protected currentSubwiki?: AddonModWikiSubwiki; // Current selected subwiki.\n    protected currentPage?: number; // Current loaded page ID.\n    protected subwikiPages?: (AddonModWikiSubwikiPage | AddonModWikiPageDBRecord)[]; // List of subwiki pages.\n    protected newPageObserver?: CoreEventObserver; // Observer to check for new pages.\n    protected manualSyncObserver?: CoreEventObserver; // An observer to watch for manual sync events.\n    protected ignoreManualSyncEvent = false; // Whether manual sync event should be ignored.\n    protected currentUserId?: number; // Current user ID.\n    protected currentPath!: string;\n    protected onlineSubscription: Subscription; // It will observe the status of the network connection.\n\n    constructor(\n        protected content?: IonContent,\n        @Optional() courseContentsPage?: CoreCourseContentsPage,\n    ) {\n        super('AddonModLessonIndexComponent', content, courseContentsPage);\n\n        this.isOnline = CoreNetwork.isOnline();\n\n        // Refresh online status when changes.\n        this.onlineSubscription = CoreNetwork.onChange().subscribe(() => {\n            // Execute the callback in the Angular zone, so change detection doesn't stop working.\n            NgZone.run(() => {\n                this.isOnline = CoreNetwork.isOnline();\n            });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        super.ngOnInit();\n\n        this.pageStr = Translate.instant('addon.mod_wiki.wikipage');\n        this.tagsEnabled = CoreTag.areTagsAvailableInSite();\n        this.currentUserId = CoreSites.getCurrentSiteUserId();\n        this.isMainPage = !this.pageId && !this.pageTitle;\n        this.currentPage = this.pageId;\n        this.currentPath = CoreNavigator.getCurrentPath();\n        this.listenEvents();\n\n        try {\n            await this.loadContent(false, true);\n        } finally {\n            if (this.action == 'map') {\n                this.openMap();\n            }\n        }\n    }\n\n    /**\n     * Listen to events.\n     */\n    protected listenEvents(): void {\n        // Listen for manual sync events.\n        this.manualSyncObserver = CoreEvents.on(AddonModWikiSyncProvider.MANUAL_SYNCED, (data) => {\n            if (!data || !this.wiki || data.wikiId != this.wiki.id) {\n                return;\n            }\n\n            if (this.ignoreManualSyncEvent) {\n                // Event needs to be ignored.\n                this.ignoreManualSyncEvent = false;\n\n                return;\n            }\n\n            if (this.currentSubwiki) {\n                this.checkPageCreatedOrDiscarded(data.subwikis[this.currentSubwiki.id]);\n            }\n\n            if (!this.pageWarning) {\n                this.showLoadingAndFetch(false, false);\n            }\n        }, this.siteId);\n    }\n\n    /**\n     * Check if the current page was created or discarded.\n     *\n     * @param data Data about created and deleted pages.\n     */\n    protected checkPageCreatedOrDiscarded(data?: AddonModWikiSyncWikiSubwiki): void {\n        if (this.currentPage || !data) {\n            return;\n        }\n\n        // This is an offline page. Check if the page was created.\n        const page = data.created.find((page) => page.title == this.pageTitle);\n        if (page) {\n            // Page was created, set the ID so it's retrieved from server.\n            this.currentPage = page.pageId;\n            this.pageIsOffline = false;\n        } else {\n            // Page not found in created list, check if it was discarded.\n            const page = data.discarded.find((page) => page.title == this.pageTitle);\n            if (page) {\n                // Page discarded, show warning.\n                this.pageWarning = page.warning;\n                this.pageContent = '';\n                this.pageIsOffline = false;\n                this.hasOffline = false;\n            }\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async fetchContent(refresh?: boolean, sync = false, showErrors = false): Promise<void> {\n        try {\n            // Get the wiki instance.\n            this.wiki = await AddonModWiki.getWiki(this.courseId, this.module.id);\n\n            if (this.pageContent === undefined) {\n                // Page not loaded yet, emit the data to update the page title.\n                this.dataRetrieved.emit(this.wiki);\n            }\n\n            AddonModWiki.wikiPageOpened(this.wiki.id, this.currentPath);\n\n            if (sync) {\n                // Try to synchronize the wiki.\n                await CoreUtils.ignoreErrors(this.syncActivity(showErrors));\n            }\n\n            if (this.pageWarning) {\n                // Page discarded, stop getting data.\n                return;\n            }\n\n            // Get module instance if it's empty.\n            if (!this.module.id) {\n                this.module = await CoreCourse.getModule(this.wiki.coursemodule, this.wiki.course, undefined, true);\n            }\n\n            this.description = this.wiki.intro || this.module.description;\n            this.componentId = this.module.id;\n\n            await this.fetchSubwikis(this.wiki.id);\n\n            // Get the subwiki list data from the cache.\n            const subwikiList = AddonModWiki.getSubwikiList(this.wiki.id);\n\n            if (!subwikiList) {\n                // Not found in cache, create a new one.\n                // Get real groupmode, in case it's forced by the course.\n                const groupInfo = await CoreGroups.getActivityGroupInfo(this.wiki.coursemodule);\n\n                if (groupInfo.separateGroups && !groupInfo.groups.length) {\n                    throw new CoreError(Translate.instant('addon.mod_wiki.cannotviewpage'));\n                }\n\n                await this.createSubwikiList(groupInfo.groups);\n            } else {\n                this.subwikiData.count = subwikiList.count;\n                this.setSelectedWiki(this.subwikiId, this.userId, this.groupId);\n\n                // If nothing was selected using nav params, use the selected from cache.\n                if (!this.isAnySubwikiSelected()) {\n                    this.setSelectedWiki(subwikiList.subwikiSelected, subwikiList.userSelected, subwikiList.groupSelected);\n                }\n\n                this.subwikiData.subwikis = subwikiList.subwikis;\n            }\n\n            if (!this.isAnySubwikiSelected() || this.subwikiData.count <= 0) {\n                throw new CoreError(Translate.instant('addon.mod_wiki.errornowikiavailable'));\n            }\n\n            await this.fetchWikiPage();\n        } catch (error) {\n            if (this.pageWarning) {\n                // Warning is already shown in screen, no need to show a modal.\n                return;\n            }\n\n            throw error;\n        }\n    }\n\n    /**\n     * Get wiki page contents.\n     *\n     * @param pageId Page to get.\n     * @returns Promise resolved with the page data.\n     */\n    protected async fetchPageContents(pageId: number): Promise<AddonModWikiPageContents>;\n    protected async fetchPageContents(): Promise<AddonModWikiPageDBRecord | undefined>;\n    protected async fetchPageContents(pageId?: number): Promise<AddonModWikiPageContents | AddonModWikiPageDBRecord | undefined>;\n    protected async fetchPageContents(pageId?: number): Promise<AddonModWikiPageContents | AddonModWikiPageDBRecord | undefined> {\n        if (pageId) {\n            // Online page.\n            this.pageIsOffline = false;\n\n            return AddonModWiki.getPageContents(pageId, { cmId: this.module.id });\n        }\n\n        // No page ID but we received a title. This means we're trying to load an offline page.\n        try {\n            const title = this.pageTitle || this.wiki?.firstpagetitle || '';\n\n            const offlinePage = await AddonModWikiOffline.getNewPage(\n                title,\n                this.currentSubwiki?.id,\n                this.currentSubwiki?.wikiid,\n                this.currentSubwiki?.userid,\n                this.currentSubwiki?.groupid,\n            );\n\n            this.pageIsOffline = true;\n            if (!this.newPageObserver) {\n                // It's an offline page, listen for new pages event to detect if the user goes to Edit and submits the page.\n                this.newPageObserver = CoreEvents.on(AddonModWikiProvider.PAGE_CREATED_EVENT, async (data) => {\n                    if (data.subwikiId != this.currentSubwiki?.id || data.pageTitle != title) {\n                        return;\n                    }\n\n                    // The page has been submitted. Get the page from the server.\n                    this.currentPage = data.pageId;\n\n                    // Stop listening for new page events.\n                    this.newPageObserver?.off();\n                    this.newPageObserver = undefined;\n\n                    await this.showLoadingAndFetch(true, false);\n\n                    this.currentPage && this.logPageViewed(this.currentPage);\n                }, CoreSites.getCurrentSiteId());\n            }\n\n            return offlinePage;\n        } catch {\n            // Page not found, ignore.\n        }\n    }\n\n    /**\n     * Fetch the list of pages of a subwiki.\n     *\n     * @param subwiki Subwiki.\n     */\n    protected async fetchSubwikiPages(subwiki: AddonModWikiSubwiki): Promise<void> {\n        const subwikiPages = subwiki.id <= 0 ?\n            [] :\n            await AddonModWiki.getSubwikiPages(subwiki.wikiid, {\n                groupId: subwiki.groupid,\n                userId: subwiki.userid,\n                cmId: this.module.id,\n            });\n\n        this.setCurrentPage(subwikiPages);\n\n        // Now get the offline pages.\n        const dbPages = await AddonModWikiOffline.getSubwikiNewPages(subwiki.id, subwiki.wikiid, subwiki.userid, subwiki.groupid);\n\n        this.subwikiPages = AddonModWiki.sortPagesByTitle(\n            (<(AddonModWikiSubwikiPage | AddonModWikiPageDBRecord)[]> subwikiPages).concat(dbPages),\n        );\n\n        // Reject if no currentPage selected from the subwikis given (if no subwikis available, do not reject).\n        if (!this.currentPage && !this.pageTitle && this.subwikiPages.length > 0) {\n            throw new CoreError();\n        }\n    }\n\n    /**\n     * Set current page if needed.\n     *\n     * @param subwikiPages List of subwiki pages.\n     */\n    setCurrentPage(subwikiPages: AddonModWikiSubwikiPage[]): void {\n        if (this.currentPage) {\n            return; // Already set, nothing to do.\n        }\n\n        if (this.pageTitle) {\n            // Got the page title but not its ID. Search the page.\n            const page = subwikiPages.find((page) => page.title === this.pageTitle);\n            if (page) {\n                this.currentPage = page.id;\n            }\n\n            return;\n        }\n\n        // No page specified, search first page.\n        const firstPage = subwikiPages.find((page) => page.firstpage);\n        this.currentPage = firstPage?.id;\n        this.pageTitle = firstPage?.title ?? this.wiki?.firstpagetitle;\n    }\n\n    /**\n     * Get the subwikis.\n     *\n     * @param wikiId Wiki ID.\n     */\n    protected async fetchSubwikis(wikiId: number): Promise<void> {\n        this.loadedSubwikis = await AddonModWiki.getSubwikis(wikiId, { cmId: this.module.id });\n\n        this.hasOffline = await AddonModWikiOffline.subwikisHaveOfflineData(this.loadedSubwikis);\n    }\n\n    /**\n     * Fetch the page to be shown.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async fetchWikiPage(): Promise<void> {\n        // Search the current Subwiki.\n        this.currentSubwiki = this.loadedSubwikis.find((subwiki) => this.isSubwikiSelected(subwiki));\n\n        if (!this.currentSubwiki) {\n            throw new CoreError();\n        }\n\n        this.setSelectedWiki(this.currentSubwiki.id, this.currentSubwiki.userid, this.currentSubwiki.groupid);\n\n        await this.fetchSubwikiPages(this.currentSubwiki);\n\n        // Check can edit before to have the value if there's no valid page.\n        this.canEdit = this.currentSubwiki.canedit;\n\n        const pageContents = await this.fetchPageContents(this.currentPage);\n\n        if (pageContents) {\n            this.setSelectedWiki(pageContents.subwikiid, pageContents.userid, pageContents.groupid);\n\n            this.pageTitle = pageContents.title;\n            this.pageContent = this.replaceEditLinks(pageContents.cachedcontent);\n            this.canEdit = !!pageContents.caneditpage;\n            this.currentPageObj = pageContents;\n            this.tags = ('tags' in pageContents && pageContents.tags) || [];\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async logActivity(): Promise<void> {\n        if (!this.wiki) {\n            return; // Shouldn't happen.\n        }\n\n        if (this.pageId) {\n            // View page.\n            this.checkCompletionAfterLog = false;\n            await this.logPageViewed(this.pageId);\n\n            return;\n        }\n\n        await AddonModWiki.logView(this.wiki.id);\n\n        if (this.groupId === undefined && this.userId === undefined) {\n            // View initial page.\n            this.analyticsLogEvent('mod_wiki_view_wiki', { name: this.currentPageObj?.title });\n\n            return;\n        }\n\n        // Viewing a different subwiki.\n        const hasPersonalSubwikis = this.loadedSubwikis.some(subwiki => subwiki.userid > 0);\n        const hasGroupSubwikis = this.loadedSubwikis.some(subwiki => subwiki.groupid > 0);\n\n        let url = `/mod/wiki/view.php?wid=${this.wiki.id}&title=${this.wiki.firstpagetitle}`;\n        if (hasPersonalSubwikis && hasGroupSubwikis) {\n            url += `&groupanduser=${this.groupId}-${this.userId}`;\n        } else if (hasPersonalSubwikis) {\n            url += `&uid=${this.userId}`;\n        } else {\n            url += `&group=${this.groupId}`;\n        }\n\n        this.analyticsLogEvent('mod_wiki_view_wiki', {\n            name: this.currentPageObj?.title,\n            data: { subwiki: this.subwikiId, userid: this.userId, groupid: this.groupId },\n            url,\n        });\n    }\n\n    /**\n     * Log page viewed.\n     *\n     * @param pageId Page ID.\n     */\n    protected async logPageViewed(pageId: number): Promise<void> {\n        if (!this.wiki) {\n            return; // Shouldn't happen.\n        }\n\n        await CoreUtils.ignoreErrors(AddonModWiki.logPageView(pageId, this.wiki.id));\n\n        this.analyticsLogEvent('mod_wiki_view_page', {\n            name: this.currentPageObj?.title,\n            data: { pageid: this.pageId },\n            url: `/mod/wiki/view.php?page=${this.pageId}`,\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async storeModuleViewed(): Promise<void> {\n        // Only store module viewed when viewing the main page.\n        if (!this.pageId) {\n            await super.storeModuleViewed();\n        }\n    }\n\n    /**\n     * Get path to the wiki home view. If cannot determine or it's current view, return undefined.\n     *\n     * @returns The path of the home view\n     */\n    protected getWikiHomeView(): string | undefined {\n        if (!this.wiki) {\n            return;\n        }\n\n        return AddonModWiki.getFirstWikiPageOpened(this.wiki.id, this.currentPath);\n    }\n\n    /**\n     * Open the view to create the first page of the wiki.\n     */\n    protected goToCreateFirstPage(): void {\n        CoreNavigator.navigateToSitePath(\n            `${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`,\n            {\n                params: {\n                    pageTitle: this.wiki?.firstpagetitle ?? '',\n                    wikiId: this.currentSubwiki?.wikiid,\n                    userId: this.currentSubwiki?.userid,\n                    groupId: this.currentSubwiki?.groupid,\n                },\n            },\n        );\n    }\n\n    /**\n     * Open the view to edit the current page.\n     */\n    goToEditPage(): void {\n        if (!this.canEdit) {\n            return;\n        }\n\n        if (this.currentPageObj) {\n            // Current page exists, go to edit it.\n            const pageParams: Params = {\n                pageTitle: this.currentPageObj.title,\n                subwikiId: this.currentPageObj.subwikiid,\n            };\n\n            if ('id' in this.currentPageObj) {\n                pageParams.pageId = this.currentPageObj.id;\n            }\n\n            if (this.currentSubwiki) {\n                pageParams.wikiId = this.currentSubwiki.wikiid;\n                pageParams.userId = this.currentSubwiki.userid;\n                pageParams.groupId = this.currentSubwiki.groupid;\n            }\n\n            CoreNavigator.navigateToSitePath(\n                `${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`,\n                { params: pageParams },\n            );\n        } else if (this.currentSubwiki) {\n            // No page loaded, the wiki doesn't have first page.\n            this.goToCreateFirstPage();\n        }\n    }\n\n    /**\n     * Go to the view to create a new page.\n     */\n    goToNewPage(): void {\n        if (!this.canEdit) {\n            return;\n        }\n\n        if (this.currentPageObj) {\n            // Current page exists, go to edit it.\n            const pageParams: Params = {\n                subwikiId: this.currentPageObj.subwikiid,\n            };\n\n            if (this.currentSubwiki) {\n                pageParams.wikiId = this.currentSubwiki.wikiid;\n                pageParams.userId = this.currentSubwiki.userid;\n                pageParams.groupId = this.currentSubwiki.groupid;\n            }\n\n            CoreNavigator.navigateToSitePath(\n                `${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/edit`,\n                { params: pageParams },\n            );\n        } else if (this.currentSubwiki) {\n            // No page loaded, the wiki doesn't have first page.\n            this.goToCreateFirstPage();\n        }\n    }\n\n    /**\n     * Go to view a certain page.\n     *\n     * @param page Page to view.\n     */\n    protected async goToPage(page: AddonModWikiSubwikiPage | AddonModWikiPageDBRecord): Promise<void> {\n        if (!('id' in page)) {\n            // It's an offline page. Check if we are already in the same offline page.\n            if (this.currentPage || !this.pageTitle || page.title != this.pageTitle) {\n                this.openPageOrSubwiki({\n                    pageTitle: page.title,\n                    subwikiId: page.subwikiid,\n                });\n            }\n        } else if (this.currentPage != page.id) {\n            // Add a new State.\n            const pageContents = await this.fetchPageContents(page.id);\n\n            this.openPageOrSubwiki({\n                pageTitle: pageContents.title,\n                pageId: pageContents.id,\n                subwikiId: page.subwikiid,\n            });\n        }\n    }\n\n    /**\n     * Open a page or a subwiki in the current wiki.\n     *\n     * @param options Options\n     * @returns Promise.\n     */\n    protected async openPageOrSubwiki(options: AddonModWikiOpenPageOptions): Promise<void> {\n        const hash = <string> Md5.hashAsciiStr(JSON.stringify({\n            ...options,\n            timestamp: Date.now(),\n        }));\n\n        CoreNavigator.navigateToSitePath(\n            `${AddonModWikiModuleHandlerService.PAGE_NAME}/${this.courseId}/${this.module.id}/page/${hash}`,\n            {\n                params: {\n                    module: this.module,\n                    ...options,\n                },\n                animated: !options.replace,\n                replace: options.replace,\n            },\n        );\n    }\n\n    /**\n     * Show the map.\n     */\n    async openMap(): Promise<void> {\n        // Create the toc modal.\n        const modalData = await CoreDomUtils.openSideModal<AddonModWikiMapModalReturn>({\n            component: AddonModWikiMapModalComponent,\n            componentProps: {\n                pages: this.subwikiPages,\n                homeView: this.getWikiHomeView(),\n                moduleId: this.module.id,\n                courseId: this.courseId,\n                selectedId: this.currentPage,\n                selectedTitle: this.currentPageObj && this.currentPageObj.title,\n                wiki: this.wiki,\n            },\n        });\n\n        if (modalData) {\n            if (modalData.home) {\n                // Go back to the initial page of the wiki.\n                CoreNavigator.navigateToSitePath(modalData.home, { animationDirection: 'back' });\n            } else if (modalData.page) {\n                this.goToPage(modalData.page);\n            }\n        }\n\n    }\n\n    /**\n     * Go to the page to view a certain subwiki.\n     *\n     * @param subwikiId Subwiki ID.\n     * @param userId User ID of the subwiki.\n     * @param groupId Group ID of the subwiki.\n     */\n    goToSubwiki(subwikiId: number, userId: number, groupId: number): void {\n        if (\n            subwikiId !== this.currentSubwiki?.id ||\n            userId !== this.currentSubwiki?.userid ||\n            groupId !== this.currentSubwiki?.groupid\n        ) {\n            this.openPageOrSubwiki({\n                subwikiId: subwikiId,\n                userId: userId,\n                groupId: groupId,\n                replace: true,\n            });\n        }\n    }\n\n    /**\n     * Checks if there is any subwiki selected.\n     *\n     * @returns Whether there is any subwiki selected.\n     */\n    protected isAnySubwikiSelected(): boolean {\n        return this.subwikiData.subwikiSelected !== 0 || this.subwikiData.userSelected > 0 || this.subwikiData.groupSelected > 0;\n    }\n\n    /**\n     * Checks if the given subwiki is the one picked on the subwiki picker.\n     *\n     * @param subwiki Subwiki to check.\n     * @returns Whether it's the selected subwiki.\n     */\n    protected isSubwikiSelected(subwiki: AddonModWikiSubwiki): boolean {\n        if (subwiki.id > 0 && this.subwikiData.subwikiSelected > 0) {\n            return subwiki.id == this.subwikiData.subwikiSelected;\n        }\n\n        return subwiki.userid == this.subwikiData.userSelected && subwiki.groupid == this.subwikiData.groupSelected;\n    }\n\n    /**\n     * Replace edit links to have full url.\n     *\n     * @param content Content to treat.\n     * @returns Treated content.\n     */\n    protected replaceEditLinks(content: string): string {\n        content = content.trim();\n\n        if (content.length > 0) {\n            const editUrl = CorePath.concatenatePaths(CoreSites.getRequiredCurrentSite().getURL(), '/mod/wiki/edit.php');\n            content = content.replace(/href=\"edit\\.php/g, 'href=\"' + editUrl);\n        }\n\n        return content;\n    }\n\n    /**\n     * Sets the selected subwiki for the subwiki picker.\n     *\n     * @param subwikiId Subwiki ID to select.\n     * @param userId User ID of the subwiki to select.\n     * @param groupId Group ID of the subwiki to select.\n     */\n    protected setSelectedWiki(subwikiId: number | undefined, userId: number | undefined, groupId: number | undefined): void {\n        this.subwikiData.subwikiSelected = subwikiId ?? 0;\n        this.subwikiData.userSelected = AddonModWikiOffline.convertToPositiveNumber(userId);\n        this.subwikiData.groupSelected = AddonModWikiOffline.convertToPositiveNumber(groupId);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected hasSyncSucceed(result: AddonModWikiSyncWikiResult): boolean {\n        if (!result) {\n            return false;\n        }\n\n        if (result.updated && this.wiki) {\n            // Trigger event.\n            this.ignoreManualSyncEvent = true;\n            CoreEvents.trigger(AddonModWikiSyncProvider.MANUAL_SYNCED, {\n                ...result,\n                wikiId: this.wiki.id,\n            });\n        }\n\n        if (this.currentSubwiki) {\n            this.checkPageCreatedOrDiscarded(result.subwikis[this.currentSubwiki.id]);\n        }\n\n        return result.updated;\n    }\n\n    /**\n     * User entered the page that contains the component.\n     */\n    ionViewDidEnter(): void {\n        super.ionViewDidEnter();\n\n        const editedPageData = AddonModWiki.consumeEditedPageData();\n        if (!editedPageData) {\n            return;\n        }\n\n        // User has just edited a page. Check if it's the current page.\n        if (this.pageId && editedPageData.pageId === this.pageId) {\n            this.showLoadingAndRefresh(true, false);\n\n            return;\n        }\n\n        const sameSubwiki = this.currentSubwiki &&\n            ((this.currentSubwiki.id > 0 && this.currentSubwiki.id === editedPageData.subwikiId) ||\n            (this.currentSubwiki.userid === editedPageData.userId && this.currentSubwiki.groupid === editedPageData.groupId));\n\n        if (sameSubwiki && editedPageData.pageTitle === this.pageTitle) {\n            this.showLoadingAndRefresh(true, false);\n\n            return;\n        }\n\n        // Not same page or we cannot tell. Open the page.\n        this.openPageOrSubwiki({\n            pageId: editedPageData.pageId,\n            pageTitle: editedPageData.pageTitle,\n            subwikiId: editedPageData.subwikiId,\n            userId: editedPageData.wikiId,\n            groupId: editedPageData.groupId,\n        });\n\n        if (editedPageData.pageId && (!this.pageContent || this.pageContent.indexOf('/mod/wiki/create.php') != -1)) {\n            // Refresh current page anyway because the new page could have been created using the create link.\n            this.showLoadingAndRefresh(true, false);\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async invalidateContent(): Promise<void> {\n        const promises: Promise<void>[] = [];\n\n        promises.push(AddonModWiki.invalidateWikiData(this.courseId));\n\n        if (this.wiki) {\n            promises.push(AddonModWiki.invalidateSubwikis(this.wiki.id));\n            promises.push(CoreGroups.invalidateActivityAllowedGroups(this.wiki.coursemodule));\n            promises.push(CoreGroups.invalidateActivityGroupMode(this.wiki.coursemodule));\n        }\n\n        if (this.currentSubwiki) {\n            promises.push(AddonModWiki.invalidateSubwikiPages(this.currentSubwiki.wikiid));\n            promises.push(AddonModWiki.invalidateSubwikiFiles(this.currentSubwiki.wikiid));\n        }\n\n        if (this.currentPage) {\n            promises.push(AddonModWiki.invalidatePage(this.currentPage));\n        }\n\n        await Promise.all(promises);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected isRefreshSyncNeeded(syncEventData: AddonModWikiAutoSyncData): boolean {\n        if (this.currentSubwiki && syncEventData.subwikiId == this.currentSubwiki.id &&\n                syncEventData.wikiId == this.currentSubwiki.wikiid && syncEventData.userId == this.currentSubwiki.userid &&\n                syncEventData.groupId == this.currentSubwiki.groupid) {\n\n            if (this.isCurrentView && syncEventData.warnings && syncEventData.warnings.length) {\n                // Show warnings.\n                CoreDomUtils.showAlert(undefined, syncEventData.warnings[0]);\n            }\n\n            // Check if current page was created or discarded.\n            this.checkPageCreatedOrDiscarded(syncEventData);\n        }\n\n        return !this.pageWarning;\n    }\n\n    /**\n     * Show the TOC.\n     *\n     * @param event Event.\n     */\n    async showSubwikiPicker(event: MouseEvent): Promise<void> {\n        const subwiki = await CoreDomUtils.openPopover<AddonModWikiSubwiki>({\n            component: AddonModWikiSubwikiPickerComponent,\n            componentProps: {\n                courseId: this.courseId,\n                subwikis: this.subwikiData.subwikis,\n                currentSubwiki: this.currentSubwiki,\n            },\n            event,\n        });\n\n        if (subwiki) {\n            this.goToSubwiki(subwiki.id, subwiki.userid, subwiki.groupid);\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected async sync(): Promise<AddonModWikiSyncWikiResult> {\n        if (!this.wiki) {\n            throw new CoreError('Cannot sync without a wiki.');\n        }\n\n        return AddonModWikiSync.syncWiki(this.wiki.id, this.courseId, this.wiki.coursemodule);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        super.ngOnDestroy();\n\n        this.manualSyncObserver?.off();\n        this.newPageObserver?.off();\n        this.onlineSubscription.unsubscribe();\n        if (this.wiki) {\n            AddonModWiki.wikiPageClosed(this.wiki.id, this.currentPath);\n        }\n    }\n\n    /**\n     * Create the subwiki list for the selector and store it in the cache.\n     *\n     * @param userGroups Groups.\n     * @returns Promise resolved when done.\n     */\n    protected async createSubwikiList(userGroups: CoreGroup[]): Promise<void> {\n        const subwikiList: AddonModWikiSubwikiListSubwiki[] = [];\n        let allParticipants = false;\n        let showMyGroupsLabel = false;\n        let multiLevelList = false;\n\n        this.subwikiData.subwikis = [];\n        this.setSelectedWiki(this.subwikiId, this.userId, this.groupId);\n        this.subwikiData.count = 0;\n\n        // Add the subwikis to the subwikiList.\n        await Promise.all(this.loadedSubwikis.map(async (subwiki) => {\n            let groupLabel = '';\n\n            if (subwiki.groupid === 0 && subwiki.userid === 0) {\n                // Add 'All participants' subwiki if needed at the start.\n                if (!allParticipants) {\n                    subwikiList.unshift({\n                        name: Translate.instant('core.allparticipants'),\n                        id: subwiki.id,\n                        userid: subwiki.userid,\n                        groupid: subwiki.groupid,\n                        groupLabel: '',\n                        canedit: subwiki.canedit,\n                    });\n                    allParticipants = true;\n                }\n            } else {\n                if (subwiki.groupid !== 0 && userGroups.length > 0) {\n                    // Get groupLabel if it has groupId.\n                    const group = userGroups.find(group => group.id == subwiki.groupid);\n                    groupLabel = group?.name ?? '';\n                } else {\n                    groupLabel = Translate.instant('addon.mod_wiki.notingroup');\n                }\n\n                if (subwiki.userid !== 0) {\n                    if (!multiLevelList && subwiki.groupid != 0) {\n                        multiLevelList = true;\n                    }\n\n                    // Get user if it has userId.\n                    const user = await CoreUser.getProfile(subwiki.userid, this.courseId, true);\n\n                    subwikiList.push({\n                        name: user.fullname,\n                        id: subwiki.id,\n                        userid: subwiki.userid,\n                        groupid: subwiki.groupid,\n                        groupLabel: groupLabel,\n                        canedit: subwiki.canedit,\n                    });\n\n                } else {\n                    subwikiList.push({\n                        name: groupLabel,\n                        id: subwiki.id,\n                        userid: subwiki.userid,\n                        groupid: subwiki.groupid,\n                        groupLabel: groupLabel,\n                        canedit: subwiki.canedit,\n                    });\n                    showMyGroupsLabel = true;\n                }\n            }\n        }));\n\n        this.fillSubwikiData(subwikiList, showMyGroupsLabel, multiLevelList);\n    }\n\n    /**\n     * Fill the subwiki data.\n     *\n     * @param subwikiList List of subwikis.\n     * @param showMyGroupsLabel Whether subwikis should be grouped in \"My groups\" and \"Other groups\".\n     * @param multiLevelList Whether it's a multi level list.\n     */\n    protected fillSubwikiData(\n        subwikiList: AddonModWikiSubwikiListSubwiki[],\n        showMyGroupsLabel: boolean,\n        multiLevelList: boolean,\n    ): void {\n        this.groupWiki = showMyGroupsLabel;\n        this.subwikiData.count = subwikiList.length;\n\n        // If no subwiki is received as view param, select always the most appropiate.\n        if ((!this.subwikiId || (!this.userId && !this.groupId)) && !this.isAnySubwikiSelected() && subwikiList.length > 0) {\n            let firstCanEdit: number | undefined;\n            let candidateNoFirstPage: number | undefined;\n            let candidateFirstPage: number | undefined;\n\n            for (const i in subwikiList) {\n                const subwiki = subwikiList[i];\n\n                if (subwiki.canedit) {\n                    let candidateSubwikiId: number | undefined;\n                    if (subwiki.userid > 0) {\n                        // Check if it's the current user.\n                        if (this.currentUserId == subwiki.userid) {\n                            candidateSubwikiId = subwiki.id;\n                        }\n                    } else if (subwiki.groupid > 0) {\n                        // Check if it's a current user's group.\n                        if (showMyGroupsLabel) {\n                            candidateSubwikiId = subwiki.id;\n                        }\n                    } else if (subwiki.id > 0) {\n                        candidateSubwikiId = subwiki.id;\n                    }\n\n                    if (candidateSubwikiId !== undefined) {\n                        if (candidateSubwikiId > 0) {\n                            // Subwiki found and created, no need to keep looking.\n                            candidateFirstPage = Number(i);\n                            break;\n                        } else if (candidateNoFirstPage === undefined) {\n                            candidateNoFirstPage = Number(i);\n                        }\n                    } else if (firstCanEdit === undefined) {\n                        firstCanEdit = Number(i);\n                    }\n                }\n            }\n\n            let subWikiToTake: number;\n            if (candidateFirstPage !== undefined) {\n                // Take the candidate that already has the first page created.\n                subWikiToTake = candidateFirstPage;\n            } else if (candidateNoFirstPage !== undefined) {\n                // No first page created, take the first candidate.\n                subWikiToTake = candidateNoFirstPage;\n            } else if (firstCanEdit !== undefined) {\n                // None selected, take the first the user can edit.\n                subWikiToTake = firstCanEdit;\n            } else {\n                // Otherwise take the very first.\n                subWikiToTake = 0;\n            }\n\n            const subwiki = subwikiList[subWikiToTake];\n            if (subwiki !== undefined) {\n                this.setSelectedWiki(subwiki.id, subwiki.userid, subwiki.groupid);\n            }\n        }\n\n        if (multiLevelList) {\n            // As we loop over each subwiki, add it to the current group\n            let groupValue = -1;\n            let grouping: AddonModWikiSubwikiListGrouping;\n\n            subwikiList.forEach((subwiki) => {\n                // Should we create a new grouping?\n                if (subwiki.groupid !== groupValue) {\n                    grouping = { label: subwiki.groupLabel, subwikis: [] };\n                    groupValue = subwiki.groupid;\n\n                    this.subwikiData.subwikis.push(grouping);\n                }\n\n                // Add the subwiki to the currently active grouping.\n                grouping.subwikis.push(subwiki);\n            });\n        } else if (showMyGroupsLabel) {\n            const noGroupSubwikis: AddonModWikiSubwikiListSubwiki[] = [];\n            const myGroupsSubwikis: AddonModWikiSubwikiListSubwiki[] = [];\n            const otherGroupsSubwikis: AddonModWikiSubwikiListSubwiki[] = [];\n\n            // As we loop over each subwiki, add it to the current group.\n            subwikiList.forEach((subwiki) => {\n                // Add the subwiki to the currently active grouping.\n                if (subwiki.groupid === 0 && subwiki.userid === 0) {\n                    // All participants\n                    noGroupSubwikis.push(subwiki);\n                } else if (subwiki.canedit) {\n                    myGroupsSubwikis.push(subwiki);\n                } else {\n                    otherGroupsSubwikis.push(subwiki);\n                }\n            });\n\n            if (myGroupsSubwikis.length > 0 && otherGroupsSubwikis.length > 0) {\n                // Add each grouping to the subwikis.\n                if (noGroupSubwikis.length > 0) {\n                    this.subwikiData.subwikis.push({ label: '', subwikis: noGroupSubwikis });\n                }\n\n                if (myGroupsSubwikis.length > 0) {\n                    this.subwikiData.subwikis.push({ label: Translate.instant('core.mygroups'), subwikis: myGroupsSubwikis });\n                }\n\n                if (otherGroupsSubwikis.length > 0) {\n                    this.subwikiData.subwikis.push({ label: Translate.instant('core.othergroups'), subwikis: otherGroupsSubwikis });\n                }\n            } else {\n                // Mix it again since it does not have groups and other groups.\n                this.subwikiData.subwikis.push({ label: '', subwikis: subwikiList });\n            }\n        } else {\n            this.subwikiData.subwikis.push({ label: '', subwikis: subwikiList });\n        }\n\n        if (this.wiki) {\n            AddonModWiki.setSubwikiList(\n                this.wiki.id,\n                this.subwikiData.subwikis,\n                this.subwikiData.count,\n                this.subwikiData.subwikiSelected,\n                this.subwikiData.userSelected,\n                this.subwikiData.groupSelected,\n            );\n        }\n    }\n\n}\n\ntype AddonModWikiOpenPageOptions = {\n    subwikiId?: number;\n    pageTitle?: string;\n    pageId?: number;\n    userId?: number;\n    groupId?: number;\n    replace?: boolean;\n};\n","<!-- Buttons to add to the header. -->\n<core-navbar-buttons slot=\"end\">\n    <!-- Select subwiki. -->\n    <ion-button *ngIf=\"subwikiData.count > 1\" (click)=\"showSubwikiPicker($event)\" [attr.aria-label]=\"'addon.mod_wiki.subwiki' | translate\"\n        aria-haspopup=\"true\">\n        <ion-icon *ngIf=\"!groupWiki\" name=\"fas-user\" aria-hidden=\"true\" />\n        <ion-icon *ngIf=\"groupWiki\" name=\"fas-users\" aria-hidden=\"true\" />\n    </ion-button>\n\n    <ion-button *ngIf=\"!showLoading && currentPageObj\" (click)=\"openMap()\" [attr.aria-label]=\"'addon.mod_wiki.map' | translate\"\n        aria-haspopup=\"true\">\n        <ion-icon name=\"fas-map\" aria-hidden=\"true\" />\n    </ion-button>\n\n    <core-context-menu>\n        <core-context-menu-item *ngIf=\"canEdit && (isOnline || pageIsOffline)\" [priority]=\"590\" [content]=\"'core.edit' | translate\"\n            iconAction=\"fas-pen\" (action)=\"goToEditPage()\" />\n        <core-context-menu-item *ngIf=\"canEdit\" [priority]=\"580\" [content]=\"'addon.mod_wiki.createpage' | translate\" iconAction=\"fas-plus\"\n            (action)=\"goToNewPage()\" />\n    </core-context-menu>\n\n    <ion-button fill=\"clear\" (click)=\"openModuleSummary()\" aria-haspopup=\"true\" [attr.aria-label]=\"'core.info' | translate\">\n        <ion-icon name=\"fas-circle-info\" slot=\"icon-only\" aria-hidden=\"true\" />\n    </ion-button>\n</core-navbar-buttons>\n\n<!-- Content. -->\n<core-loading [hideUntil]=\"!showLoading\">\n\n    <!-- Activity info. -->\n    <core-course-module-info *ngIf=\"isMainPage\" [module]=\"module\" [description]=\"description\" [component]=\"component\"\n        [componentId]=\"componentId\" [courseId]=\"courseId\" (completionChanged)=\"onCompletionChange()\" />\n\n    <div *ngIf=\"pageIsOffline || hasOffline || pageWarning\">\n        <!-- Wiki has something offline. -->\n        <ion-card class=\"core-warning-card\" *ngIf=\"pageIsOffline || hasOffline\">\n            <ion-item class=\"ion-text-wrap\">\n                <ion-icon name=\"fas-triangle-exclamation\" slot=\"start\" aria-hidden=\"true\" />\n                <ion-label>\n                    <span *ngIf=\"pageIsOffline\">{{ 'core.hasdatatosync' | translate:{$a: pageStr} }}</span>\n                    <span *ngIf=\"!pageIsOffline\">{{ 'core.hasdatatosync' | translate:{$a: moduleName} }}</span>\n                </ion-label>\n            </ion-item>\n        </ion-card>\n\n        <!-- Page warning. -->\n        <ion-card class=\"core-warning-card\" *ngIf=\"pageWarning\">\n            <ion-item>\n                <ion-icon name=\"fas-triangle-exclamation\" slot=\"start\" aria-hidden=\"true\" />\n                <ion-label>{{ pageWarning }}</ion-label>\n            </ion-item>\n        </ion-card>\n    </div>\n    <div class=\"ion-padding-horizontal addon-mod_wiki-page-content\">\n        <h2 *ngIf=\"pageTitle\">{{pageTitle}}</h2>\n        <article [ngClass]=\"{'addon-mod_wiki-noedit': !canEdit}\">\n            <core-format-text *ngIf=\"pageContent\" [component]=\"component\" [componentId]=\"componentId\" [text]=\"pageContent\"\n                contextLevel=\"module\" [contextInstanceId]=\"module.id\" [courseId]=\"courseId\" />\n            <core-empty-box *ngIf=\"!pageContent\" icon=\"fas-file-lines\" [message]=\"'addon.mod_wiki.nocontent' | translate\" />\n        </article>\n\n        <div class=\"ion-margin-top\" *ngIf=\"tagsEnabled && tags.length > 0\">\n            <strong>{{ 'core.tag.tags' | translate }}:</strong>\n            <core-tag-list [tags]=\"tags\" />\n        </div>\n    </div>\n</core-loading>\n\n<core-course-module-navigation collapsible-footer *ngIf=\"isMainPage\" [hidden]=\"showLoading\" [courseId]=\"courseId\"\n    [currentModuleId]=\"module.id\" />\n\n<ion-fab slot=\"fixed\" core-fab vertical=\"bottom\" horizontal=\"end\" *ngIf=\"canEdit\">\n    <ion-fab-button (click)=\"goToNewPage()\" [attr.aria-label]=\"'addon.mod_wiki.createpage' | translate\">\n        <ion-icon name=\"fas-plus\" aria-hidden=\"true\" />\n        <span class=\"sr-only\">{{ 'addon.mod_wiki.createpage' | translate }}</span>\n    </ion-fab-button>\n</ion-fab>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}