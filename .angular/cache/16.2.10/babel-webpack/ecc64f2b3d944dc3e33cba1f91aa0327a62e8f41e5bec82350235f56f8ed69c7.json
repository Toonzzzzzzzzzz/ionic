{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { makeSingleton, Translate } from '@singletons';\nimport { AddonModWorkshopAssessmentStrategyCommentsComponent } from '../component/comments';\nimport { AddonModWorkshopAssessmentStrategyCommentsHandlerService } from './handler';\nimport * as i0 from \"@angular/core\";\n/**\n * Handler for comments assessment strategy plugin.\n */\nexport class AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService extends AddonModWorkshopAssessmentStrategyCommentsHandlerService {\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return _asyncToGenerator(function* () {\n      return true;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getComponent() {\n    return AddonModWorkshopAssessmentStrategyCommentsComponent;\n  }\n  /**\n   * @inheritdoc\n   */\n  getOriginalValues(form) {\n    return _asyncToGenerator(function* () {\n      const originalValues = [];\n      form.fields.forEach((field, n) => {\n        field.dimtitle = Translate.instant('addon.mod_workshop_assessment_comments.dimensionnumber', {\n          $a: field.number\n        });\n        if (!form.current[n]) {\n          form.current[n] = {};\n        }\n        originalValues[n] = {};\n        originalValues[n].peercomment = form.current[n].peercomment || '';\n        originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n      });\n\n      return originalValues;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  hasDataChanged(originalValues, currentValues) {\n    for (const x in originalValues) {\n      if (originalValues[x].peercomment != currentValues[x].peercomment) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * @inheritdoc\n   */\n  prepareAssessmentData(currentValues, form) {\n    return _asyncToGenerator(function* () {\n      const data = {};\n      const errors = {};\n      let hasErrors = false;\n      form.fields.forEach((field, idx) => {\n        if (idx < form.dimenssionscount) {\n          if (currentValues[idx].peercomment) {\n            data['peercomment__idx_' + idx] = currentValues[idx].peercomment;\n          } else {\n            errors['peercomment_' + idx] = Translate.instant('core.err_required');\n            hasErrors = true;\n          }\n          data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n          data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n        }\n      });\n      if (hasErrors) {\n        throw errors;\n      }\n      return data;\n    })();\n  }\n}\n_class = AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonModWorkshopAssessmentStrategyCommentsHandlerLazyService_BaseFactory;\n  return function AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService_Factory(t) {\n    return (ɵAddonModWorkshopAssessmentStrategyCommentsHandlerLazyService_BaseFactory || (ɵAddonModWorkshopAssessmentStrategyCommentsHandlerLazyService_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonModWorkshopAssessmentStrategyCommentsHandler = makeSingleton(AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService);","map":{"version":3,"names":["makeSingleton","Translate","AddonModWorkshopAssessmentStrategyCommentsComponent","AddonModWorkshopAssessmentStrategyCommentsHandlerService","AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService","isEnabled","_asyncToGenerator","getComponent","getOriginalValues","form","originalValues","fields","forEach","field","n","dimtitle","instant","$a","number","current","peercomment","hasDataChanged","currentValues","x","prepareAssessmentData","data","errors","hasErrors","idx","dimenssionscount","parseInt","gradeid","dimensionid","t","factory","ɵfac","providedIn","AddonModWorkshopAssessmentStrategyCommentsHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/workshop/assessment/comments/services/handler-lazy.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n    AddonModWorkshopAssessmentStrategyFieldErrors,\n} from '@addons/mod/workshop/components/assessment-strategy/assessment-strategy';\nimport { AddonWorkshopAssessmentStrategyHandler } from '@addons/mod/workshop/services/assessment-strategy-delegate';\nimport {\n    AddonModWorkshopGetAssessmentFormDefinitionData,\n    AddonModWorkshopGetAssessmentFormFieldsParsedData,\n} from '@addons/mod/workshop/services/workshop';\nimport { Injectable, Type } from '@angular/core';\nimport { makeSingleton, Translate } from '@singletons';\nimport { CoreFormFields } from '@singletons/form';\nimport { AddonModWorkshopAssessmentStrategyCommentsComponent } from '../component/comments';\nimport { AddonModWorkshopAssessmentStrategyCommentsHandlerService } from './handler';\n\n/**\n * Handler for comments assessment strategy plugin.\n */\n@Injectable({ providedIn: 'root' })\nexport class AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService\n    extends AddonModWorkshopAssessmentStrategyCommentsHandlerService\n    implements AddonWorkshopAssessmentStrategyHandler {\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabled(): Promise<boolean> {\n        return true;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getComponent(): Type<unknown> {\n        return AddonModWorkshopAssessmentStrategyCommentsComponent;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getOriginalValues(\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<AddonModWorkshopGetAssessmentFormFieldsParsedData[]> {\n        const originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[] = [];\n\n        form.fields.forEach((field, n) => {\n            field.dimtitle = Translate.instant('addon.mod_workshop_assessment_comments.dimensionnumber', { $a: field.number });\n\n            if (!form.current[n]) {\n                form.current[n] = {};\n            }\n\n            originalValues[n] = {};\n            originalValues[n].peercomment = form.current[n].peercomment || '';\n            originalValues[n].number = field.number; // eslint-disable-line id-blacklist\n        });\n\n        return originalValues;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    hasDataChanged(\n        originalValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n    ): boolean {\n        for (const x in originalValues) {\n            if (originalValues[x].peercomment != currentValues[x].peercomment) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async prepareAssessmentData(\n        currentValues: AddonModWorkshopGetAssessmentFormFieldsParsedData[],\n        form: AddonModWorkshopGetAssessmentFormDefinitionData,\n    ): Promise<CoreFormFields> {\n        const data: CoreFormFields = {};\n        const errors: AddonModWorkshopAssessmentStrategyFieldErrors = {};\n        let hasErrors = false;\n\n        form.fields.forEach((field, idx) => {\n            if (idx < form.dimenssionscount) {\n                if (currentValues[idx].peercomment) {\n                    data['peercomment__idx_' + idx] = currentValues[idx].peercomment;\n                } else {\n                    errors['peercomment_' + idx] = Translate.instant('core.err_required');\n                    hasErrors = true;\n                }\n\n                data['gradeid__idx_' + idx] = parseInt(form.current[idx].gradeid, 10) || 0;\n                data['dimensionid__idx_' + idx] = parseInt(field.dimensionid, 10);\n            }\n        });\n\n        if (hasErrors) {\n            throw errors;\n        }\n\n        return data;\n    }\n\n}\nexport const AddonModWorkshopAssessmentStrategyCommentsHandler =\n    makeSingleton(AddonModWorkshopAssessmentStrategyCommentsHandlerLazyService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}