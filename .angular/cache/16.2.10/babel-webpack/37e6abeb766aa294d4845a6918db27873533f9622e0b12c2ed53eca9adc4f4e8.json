{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreUser } from '@features/user/services/user';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport { AddonModH5PActivity, AddonModH5PActivityProvider } from '../../services/h5pactivity';\nimport { CoreTime } from '@singletons/time';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../../core/components/empty-box/empty-box\";\nimport * as i3 from \"../../../../../core/components/infinite-loading/infinite-loading\";\nimport * as i4 from \"../../../../../core/components/loading/loading\";\nimport * as i5 from \"../../../../../core/components/user-avatar/user-avatar\";\nimport * as i6 from \"../../../../../core/directives/format-text\";\nimport * as i7 from \"../../../../../core/directives/content\";\nimport * as i8 from \"@ionic/angular\";\nimport * as i9 from \"../../../../../core/pipes/format-date\";\nimport * as i10 from \"@ngx-translate/core\";\nfunction AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-format-text\", 9);\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"text\", ctx_r0.h5pActivity.name)(\"contextInstanceId\", ctx_r0.h5pActivity.coursemodule)(\"courseId\", ctx_r0.courseId);\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"coreFormatDate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const user_r4 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, user_r4.attempts[user_r4.attempts.length - 1].timemodified, \"strftimedatetimeshort\"), \" \");\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"-\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    $a: a0\n  };\n};\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const user_r4 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, \"core.percentagenumber\", i0.ɵɵpureFunction1(4, _c0, user_r4.score)), \" \");\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"-\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 15);\n    i0.ɵɵlistener(\"click\", function AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template_ion_item_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const user_r4 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.openUser(user_r4));\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelementStart(2, \"ion-label\")(3, \"ion-row\", 11)(4, \"ion-col\", 12)(5, \"p\");\n    i0.ɵɵelement(6, \"core-user-avatar\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"ion-col\", 12);\n    i0.ɵɵtemplate(9, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template, 3, 4, \"span\", 6);\n    i0.ɵɵtemplate(10, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template, 2, 0, \"span\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"ion-col\", 13);\n    i0.ɵɵtemplate(12, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template, 3, 6, \"span\", 6);\n    i0.ɵɵtemplate(13, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template, 2, 0, \"span\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"ion-col\", 13);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const user_r4 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"hide-detail\", !user_r4.attempts.length);\n    i0.ɵɵproperty(\"detail\", true)(\"button\", user_r4.attempts.length > 0);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind2(1, 13, \"addon.mod_h5pactivity.review_user_attempts\", i0.ɵɵpureFunction1(16, _c0, user_r4.attempts.length)));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"user\", user_r4.user)(\"courseId\", ctx_r3.courseId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", user_r4.user.fullname, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", user_r4.attempts.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !user_r4.attempts.length);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", user_r4.score !== undefined);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", user_r4.score === undefined);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", user_r4.attempts.length, \" \");\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\")(1, \"ion-item\", 10)(2, \"ion-label\")(3, \"ion-row\", 11)(4, \"ion-col\", 12);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-col\", 12);\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"ion-col\", 13);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"ion-col\", 13);\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"translate\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(16, AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template, 16, 18, \"ion-item\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"detail\", true);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 6, \"core.user\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 8, \"core.date\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(12, 10, \"addon.mod_h5pactivity.score\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(15, 12, \"addon.mod_h5pactivity.attempts\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.users);\n  }\n}\nfunction AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-empty-box\", 17);\n    i0.ɵɵpipe(1, \"translate\");\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"message\", i0.ɵɵpipeBind1(1, 1, \"addon.mod_h5pactivity.noparticipants\"));\n  }\n}\n/**\n * Page that displays all users that can attempt an H5P activity.\n */\nexport class AddonModH5PActivityUsersAttemptsPage {\n  constructor() {\n    var _this = this;\n    this.loaded = false;\n    this.users = [];\n    this.fetchMoreUsersFailed = false;\n    this.canLoadMore = false;\n    this.page = 0;\n    this.logView = CoreTime.once( /*#__PURE__*/_asyncToGenerator(function* () {\n      if (!_this.h5pActivity) {\n        return;\n      }\n      yield CoreUtils.ignoreErrors(AddonModH5PActivity.logViewReport(_this.h5pActivity.id));\n      CoreAnalytics.logEvent({\n        type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n        ws: 'mod_h5pactivity_log_report_viewed',\n        name: _this.h5pActivity.name,\n        data: {\n          id: _this.h5pActivity.id,\n          category: 'h5pactivity'\n        },\n        url: `/mod/h5pactivity/report.php?a=${_this.h5pActivity.id}`\n      });\n    }));\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        _this2.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n        _this2.cmId = CoreNavigator.getRequiredRouteNumberParam('cmId');\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n        CoreNavigator.back();\n        return;\n      }\n      _this2.fetchData();\n    })();\n  }\n  /**\n   * Refresh the data.\n   *\n   * @param refresher Refresher.\n   */\n  doRefresh(refresher) {\n    this.refreshData().finally(() => {\n      refresher.complete();\n    });\n  }\n  /**\n   * Get quiz data and attempt data.\n   *\n   * @param refresh Whether user is refreshing data.\n   * @returns Promise resolved when done.\n   */\n  fetchData(refresh) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        _this3.h5pActivity = yield AddonModH5PActivity.getH5PActivity(_this3.courseId, _this3.cmId);\n        yield Promise.all([_this3.fetchUsers(refresh)]);\n        _this3.logView();\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'Error loading attempts.');\n      } finally {\n        _this3.loaded = true;\n      }\n    })();\n  }\n  /**\n   * Get users.\n   *\n   * @param refresh Whether user is refreshing data.\n   * @returns Promise resolved when done.\n   */\n  fetchUsers(refresh) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this4.h5pActivity) {\n        return;\n      }\n      if (refresh) {\n        _this4.page = 0;\n      }\n      const result = yield AddonModH5PActivity.getUsersAttempts(_this4.h5pActivity.id, {\n        cmId: _this4.cmId,\n        page: _this4.page\n      });\n      const formattedUsers = yield _this4.formatUsers(_this4.h5pActivity, result.users);\n      if (_this4.page === 0) {\n        _this4.users = formattedUsers;\n      } else {\n        _this4.users = _this4.users.concat(formattedUsers);\n      }\n      _this4.canLoadMore = result.canLoadMore;\n      _this4.page++;\n    })();\n  }\n  /**\n   * Format users data.\n   *\n   * @param h5pActivity Activity data.\n   * @param users Users to format.\n   * @returns Formatted users.\n   */\n  formatUsers(h5pActivity, users) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      return Promise.all(users.map( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (user) {\n          var _user$scored;\n          user.user = yield CoreUser.getProfile(user.userid, _this5.courseId, true);\n          // Calculate the score of the user.\n          if (h5pActivity.grademethod === AddonModH5PActivityProvider.GRADEMANUAL) {\n            // No score.\n          } else if (h5pActivity.grademethod === AddonModH5PActivityProvider.GRADEAVERAGEATTEMPT) {\n            if (user.attempts.length) {\n              // Calculate the average.\n              const sumScores = user.attempts.reduce((sumScores, attempt) => sumScores + attempt.rawscore * 100 / attempt.maxscore, 0);\n              user.score = Math.round(sumScores / user.attempts.length);\n            }\n          } else if ((_user$scored = user.scored) !== null && _user$scored !== void 0 && _user$scored.attempts[0]) {\n            // Only a single attempt used to calculate the grade. Use it.\n            user.score = Math.round(user.scored.attempts[0].rawscore * 100 / user.scored.attempts[0].maxscore);\n          }\n          return user;\n        });\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }()));\n    })();\n  }\n  /**\n   * Load a new batch of users.\n   *\n   * @param complete Completion callback.\n   */\n  fetchMoreUsers(complete) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this6.fetchUsers(false);\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'Error loading more users');\n        _this6.fetchMoreUsersFailed = true;\n      }\n      complete();\n    })();\n  }\n  /**\n   * Refresh the data.\n   *\n   * @returns Promise resolved when done.\n   */\n  refreshData() {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      const promises = [AddonModH5PActivity.invalidateActivityData(_this7.courseId)];\n      if (_this7.h5pActivity) {\n        promises.push(AddonModH5PActivity.invalidateAllUsersAttempts(_this7.h5pActivity.id));\n      }\n      yield CoreUtils.ignoreErrors(Promise.all(promises));\n      yield _this7.fetchData(true);\n    })();\n  }\n  /**\n   * Open the page to view a user attempts.\n   *\n   * @param user User to open.\n   */\n  openUser(user) {\n    if (!user.attempts.length) {\n      return;\n    }\n    CoreNavigator.navigate(`../userattempts/${user.userid}`);\n  }\n}\n_class = AddonModH5PActivityUsersAttemptsPage;\n_class.ɵfac = function AddonModH5PActivityUsersAttemptsPage_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-mod-h5pactivity-users-attempts\"]],\n  decls: 16,\n  vars: 13,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\", 4, \"ngIf\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [4, \"ngIf\"], [\"icon\", \"fas-chart-bar\", 3, \"message\", 4, \"ngIf\"], [3, \"enabled\", \"error\", \"action\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [1, \"addon-mod_h5pactivity-table-header\", \"hide-detail\", \"font-bold\", 3, \"detail\"], [1, \"ion-align-items-center\"], [\"size\", \"4\", 1, \"ion-text-center\"], [\"size\", \"2\", 1, \"ion-text-center\"], [\"class\", \"ion-text-wrap addon-mod_h5pactivity-table-row\", 3, \"detail\", \"hide-detail\", \"button\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"ion-text-wrap\", \"addon-mod_h5pactivity-table-row\", 3, \"detail\", \"button\", \"click\"], [3, \"user\", \"courseId\"], [\"icon\", \"fas-chart-bar\", 3, \"message\"]],\n  template: function AddonModH5PActivityUsersAttemptsPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵtemplate(7, AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template, 1, 3, \"core-format-text\", 2);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(8, \"ion-content\")(9, \"ion-refresher\", 3);\n      i0.ɵɵlistener(\"ionRefresh\", function AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener($event) {\n        return ctx.doRefresh($event.target);\n      });\n      i0.ɵɵelement(10, \"ion-refresher-content\", 4);\n      i0.ɵɵpipe(11, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"core-loading\", 5);\n      i0.ɵɵtemplate(13, AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template, 17, 14, \"ion-list\", 6);\n      i0.ɵɵtemplate(14, AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template, 2, 3, \"core-empty-box\", 7);\n      i0.ɵɵelementStart(15, \"core-infinite-loading\", 8);\n      i0.ɵɵlistener(\"action\", function AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_15_listener($event) {\n        return ctx.fetchMoreUsers($event);\n      });\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 9, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", ctx.h5pActivity);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"disabled\", !ctx.loaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵpropertyInterpolate(\"pullingText\", i0.ɵɵpipeBind1(11, 11, \"core.pulltorefresh\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hideUntil\", ctx.loaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.users.length);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.users.length && !ctx.canLoadMore);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"enabled\", ctx.loaded && ctx.canLoadMore)(\"error\", ctx.fetchMoreUsersFailed);\n    }\n  },\n  dependencies: [i1.NgForOf, i1.NgIf, i2.CoreEmptyBoxComponent, i3.CoreInfiniteLoadingComponent, i4.CoreLoadingComponent, i5.CoreUserAvatarComponent, i6.CoreFormatTextDirective, i7.CoreContentDirective, i8.IonButtons, i8.IonCol, i8.IonContent, i8.IonHeader, i8.IonItem, i8.IonLabel, i8.IonList, i8.IonRefresher, i8.IonRefresherContent, i8.IonRow, i8.IonTitle, i8.IonToolbar, i8.IonBackButton, i9.CoreFormatDatePipe, i10.TranslatePipe],\n  styles: [\"[_nghost-%COMP%]   .addon-mod_h5pactivity-table-header[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%] {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hZGRvbnMvbW9kL2g1cGFjdGl2aXR5L3BhZ2VzL3VzZXJzLWF0dGVtcHRzL3VzZXJzLWF0dGVtcHRzLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0k7RUFDSSxnQkFBQTtFQUNBLHVCQUFBO0FBQVIiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XG4gICAgLmFkZG9uLW1vZF9oNXBhY3Rpdml0eS10YWJsZS1oZWFkZXIgaW9uLWNvbCB7XG4gICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"names":["CoreUser","CoreNavigator","CoreDomUtils","CoreUtils","AddonModH5PActivity","AddonModH5PActivityProvider","CoreTime","CoreAnalytics","CoreAnalyticsEventType","i0","ɵɵelement","ɵɵproperty","ctx_r0","h5pActivity","name","coursemodule","courseId","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate1","ɵɵpipeBind2","user_r4","attempts","length","timemodified","ɵɵpureFunction1","_c0","score","ɵɵlistener","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template_ion_item_click_0_listener","restoredCtx","ɵɵrestoreView","_r12","$implicit","ctx_r11","ɵɵnextContext","ɵɵresetView","openUser","ɵɵtemplate","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_9_Template","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_10_Template","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_12_Template","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_span_13_Template","ɵɵclassProp","ɵɵattribute","user","ctx_r3","fullname","undefined","AddonModH5PActivityUsersAttemptsPage_ion_list_13_ion_item_16_Template","ɵɵtextInterpolate","ɵɵpipeBind1","ctx_r1","users","AddonModH5PActivityUsersAttemptsPage","constructor","_this","loaded","fetchMoreUsersFailed","canLoadMore","page","logView","once","_asyncToGenerator","ignoreErrors","logViewReport","id","logEvent","type","VIEW_ITEM_LIST","ws","data","category","url","ngOnInit","_this2","getRequiredRouteNumberParam","cmId","error","showErrorModal","back","fetchData","doRefresh","refresher","refreshData","finally","complete","refresh","_this3","getH5PActivity","Promise","all","fetchUsers","showErrorModalDefault","_this4","result","getUsersAttempts","formattedUsers","formatUsers","concat","_this5","map","_ref2","_user$scored","getProfile","userid","grademethod","GRADEMANUAL","GRADEAVERAGEATTEMPT","sumScores","reduce","attempt","rawscore","maxscore","Math","round","scored","_x","apply","arguments","fetchMoreUsers","_this6","_this7","promises","invalidateActivityData","push","invalidateAllUsersAttempts","navigate","selectors","decls","vars","consts","template","AddonModH5PActivityUsersAttemptsPage_Template","rf","ctx","AddonModH5PActivityUsersAttemptsPage_core_format_text_7_Template","AddonModH5PActivityUsersAttemptsPage_Template_ion_refresher_ionRefresh_9_listener","$event","target","AddonModH5PActivityUsersAttemptsPage_ion_list_13_Template","AddonModH5PActivityUsersAttemptsPage_core_empty_box_14_Template","AddonModH5PActivityUsersAttemptsPage_Template_core_infinite_loading_action_15_listener","ɵɵpropertyInterpolate"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/h5pactivity/pages/users-attempts/users-attempts.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/h5pactivity/pages/users-attempts/users-attempts.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit } from '@angular/core';\nimport { CoreUser, CoreUserProfile } from '@features/user/services/user';\n\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUtils } from '@services/utils/utils';\nimport {\n    AddonModH5PActivity,\n    AddonModH5PActivityData,\n    AddonModH5PActivityProvider,\n    AddonModH5PActivityUserAttempts,\n} from '../../services/h5pactivity';\nimport { CoreTime } from '@singletons/time';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\n\n/**\n * Page that displays all users that can attempt an H5P activity.\n */\n@Component({\n    selector: 'page-addon-mod-h5pactivity-users-attempts',\n    templateUrl: 'users-attempts.html',\n    styleUrls: ['users-attempts.scss'],\n})\nexport class AddonModH5PActivityUsersAttemptsPage implements OnInit {\n\n    loaded = false;\n    courseId!: number;\n    cmId!: number;\n    h5pActivity?: AddonModH5PActivityData;\n    users: AddonModH5PActivityUserAttemptsFormatted[] = [];\n    fetchMoreUsersFailed = false;\n    canLoadMore = false;\n\n    protected page = 0;\n    protected logView: () => void;\n\n    constructor() {\n        this.logView = CoreTime.once(async () => {\n            if (!this.h5pActivity) {\n                return;\n            }\n\n            await CoreUtils.ignoreErrors(AddonModH5PActivity.logViewReport(this.h5pActivity.id));\n\n            CoreAnalytics.logEvent({\n                type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n                ws: 'mod_h5pactivity_log_report_viewed',\n                name: this.h5pActivity.name,\n                data: { id: this.h5pActivity.id, category: 'h5pactivity' },\n                url: `/mod/h5pactivity/report.php?a=${this.h5pActivity.id}`,\n            });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        try {\n            this.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n            this.cmId = CoreNavigator.getRequiredRouteNumberParam('cmId');\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n\n            CoreNavigator.back();\n\n            return;\n        }\n\n        this.fetchData();\n    }\n\n    /**\n     * Refresh the data.\n     *\n     * @param refresher Refresher.\n     */\n    doRefresh(refresher: HTMLIonRefresherElement): void {\n        this.refreshData().finally(() => {\n            refresher.complete();\n        });\n    }\n\n    /**\n     * Get quiz data and attempt data.\n     *\n     * @param refresh Whether user is refreshing data.\n     * @returns Promise resolved when done.\n     */\n    protected async fetchData(refresh?: boolean): Promise<void> {\n        try {\n            this.h5pActivity = await AddonModH5PActivity.getH5PActivity(this.courseId, this.cmId);\n\n            await Promise.all([\n                this.fetchUsers(refresh),\n            ]);\n\n            this.logView();\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading attempts.');\n        } finally {\n            this.loaded = true;\n        }\n    }\n\n    /**\n     * Get users.\n     *\n     * @param refresh Whether user is refreshing data.\n     * @returns Promise resolved when done.\n     */\n    protected async fetchUsers(refresh?: boolean): Promise<void> {\n        if (!this.h5pActivity) {\n            return;\n        }\n\n        if (refresh) {\n            this.page = 0;\n        }\n\n        const result = await AddonModH5PActivity.getUsersAttempts(this.h5pActivity.id, {\n            cmId: this.cmId,\n            page: this.page,\n        });\n\n        const formattedUsers = await this.formatUsers(this.h5pActivity, result.users);\n\n        if (this.page === 0) {\n            this.users = formattedUsers;\n        } else {\n            this.users = this.users.concat(formattedUsers);\n        }\n\n        this.canLoadMore = result.canLoadMore;\n        this.page++;\n    }\n\n    /**\n     * Format users data.\n     *\n     * @param h5pActivity Activity data.\n     * @param users Users to format.\n     * @returns Formatted users.\n     */\n    protected async formatUsers(\n        h5pActivity: AddonModH5PActivityData,\n        users: AddonModH5PActivityUserAttempts[],\n    ): Promise<AddonModH5PActivityUserAttemptsFormatted[]> {\n        return Promise.all(users.map(async (user: AddonModH5PActivityUserAttemptsFormatted) => {\n            user.user = await CoreUser.getProfile(user.userid, this.courseId, true);\n\n            // Calculate the score of the user.\n            if (h5pActivity.grademethod === AddonModH5PActivityProvider.GRADEMANUAL) {\n                // No score.\n            } else if (h5pActivity.grademethod === AddonModH5PActivityProvider.GRADEAVERAGEATTEMPT) {\n                if (user.attempts.length) {\n                    // Calculate the average.\n                    const sumScores = user.attempts.reduce((sumScores, attempt) =>\n                        sumScores + attempt.rawscore * 100 / attempt.maxscore, 0);\n\n                    user.score = Math.round(sumScores / user.attempts.length);\n                }\n            } else if (user.scored?.attempts[0]) {\n                // Only a single attempt used to calculate the grade. Use it.\n                user.score = Math.round(user.scored.attempts[0].rawscore * 100 / user.scored.attempts[0].maxscore);\n            }\n\n            return user;\n        }));\n    }\n\n    /**\n     * Load a new batch of users.\n     *\n     * @param complete Completion callback.\n     */\n    async fetchMoreUsers(complete: () => void): Promise<void> {\n        try {\n            await this.fetchUsers(false);\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Error loading more users');\n\n            this.fetchMoreUsersFailed = true;\n        }\n\n        complete();\n    }\n\n    /**\n     * Refresh the data.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async refreshData(): Promise<void> {\n        const promises = [\n            AddonModH5PActivity.invalidateActivityData(this.courseId),\n        ];\n\n        if (this.h5pActivity) {\n            promises.push(AddonModH5PActivity.invalidateAllUsersAttempts(this.h5pActivity.id));\n        }\n\n        await CoreUtils.ignoreErrors(Promise.all(promises));\n\n        await this.fetchData(true);\n    }\n\n    /**\n     * Open the page to view a user attempts.\n     *\n     * @param user User to open.\n     */\n    openUser(user: AddonModH5PActivityUserAttemptsFormatted): void {\n        if (!user.attempts.length) {\n            return;\n        }\n\n        CoreNavigator.navigate(`../userattempts/${user.userid}`);\n    }\n\n}\n\n/**\n * User attempts data with some calculated data.\n */\ntype AddonModH5PActivityUserAttemptsFormatted = AddonModH5PActivityUserAttempts & {\n    user?: CoreUserProfile;\n    score?: number;\n};\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>\n                <core-format-text *ngIf=\"h5pActivity\" [text]=\"h5pActivity.name\" contextLevel=\"module\"\n                    [contextInstanceId]=\"h5pActivity.coursemodule\" [courseId]=\"courseId\" />\n            </h1>\n        </ion-title>\n    </ion-toolbar>\n</ion-header>\n<ion-content>\n    <ion-refresher slot=\"fixed\" [disabled]=\"!loaded\" (ionRefresh)=\"doRefresh($event.target)\">\n        <ion-refresher-content pullingText=\"{{ 'core.pulltorefresh' | translate }}\" />\n    </ion-refresher>\n    <core-loading [hideUntil]=\"loaded\">\n        <ion-list *ngIf=\"users.length\">\n            <!-- \"Header\" of the table -->\n            <ion-item class=\"addon-mod_h5pactivity-table-header hide-detail font-bold\" [detail]=\"true\">\n                <ion-label>\n                    <ion-row class=\"ion-align-items-center\">\n                        <ion-col class=\"ion-text-center\" size=\"4\">{{ 'core.user' | translate }}</ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"4\">{{ 'core.date' | translate }}</ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"2\">{{ 'addon.mod_h5pactivity.score' | translate }}</ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"2\">{{ 'addon.mod_h5pactivity.attempts' | translate }}</ion-col>\n                    </ion-row>\n                </ion-label>\n            </ion-item>\n\n            <!-- List of users. -->\n            <ion-item class=\"ion-text-wrap addon-mod_h5pactivity-table-row\" *ngFor=\"let user of users\" [detail]=\"true\"\n                [attr.aria-label]=\"'addon.mod_h5pactivity.review_user_attempts' | translate:{$a: user.attempts.length}\"\n                (click)=\"openUser(user)\" [class.hide-detail]=\"!user.attempts.length\" [button]=\"user.attempts.length > 0\">\n\n                <ion-label>\n                    <ion-row class=\"ion-align-items-center\">\n                        <ion-col class=\"ion-text-center\" size=\"4\">\n                            <p>\n                                <core-user-avatar [user]=\"user.user\" [courseId]=\"courseId\" />\n                            </p>\n                            {{ user.user.fullname }}\n                        </ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"4\">\n                            <span *ngIf=\"user.attempts.length\">\n                                {{ user.attempts[user.attempts.length - 1].timemodified | coreFormatDate:'strftimedatetimeshort' }}\n                            </span>\n                            <span *ngIf=\"!user.attempts.length\">-</span>\n                        </ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"2\">\n                            <span *ngIf=\"user.score !== undefined\">\n                                {{ 'core.percentagenumber' | translate: {$a: user.score} }}\n                            </span>\n                            <span *ngIf=\"user.score === undefined\">-</span>\n                        </ion-col>\n                        <ion-col class=\"ion-text-center\" size=\"2\">\n                            {{user.attempts.length}}\n                        </ion-col>\n                    </ion-row>\n                </ion-label>\n            </ion-item>\n        </ion-list>\n\n        <!-- No attempts. -->\n        <core-empty-box *ngIf=\"!users.length && !canLoadMore\" icon=\"fas-chart-bar\"\n            [message]=\"'addon.mod_h5pactivity.noparticipants' | translate\" />\n\n        <core-infinite-loading [enabled]=\"loaded && canLoadMore\" [error]=\"fetchMoreUsersFailed\" (action)=\"fetchMoreUsers($event)\" />\n    </core-loading>\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}