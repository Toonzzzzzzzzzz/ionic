{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n/**\n * Database variables for CorePushNotificationsProvider service.\n * Keep \"addon\" in some names for backwards compatibility.\n */\nexport const BADGE_TABLE_NAME = 'addon_pushnotifications_badge';\nexport const PENDING_UNREGISTER_TABLE_NAME = 'addon_pushnotifications_pending_unregister';\nexport const REGISTERED_DEVICES_TABLE_NAME = 'addon_pushnotifications_registered_devices_2';\nexport const APP_SCHEMA = {\n  name: 'CorePushNotificationsProvider',\n  version: 1,\n  tables: [{\n    name: BADGE_TABLE_NAME,\n    columns: [{\n      name: 'siteid',\n      type: 'TEXT'\n    }, {\n      name: 'addon',\n      type: 'TEXT'\n    }, {\n      name: 'number',\n      type: 'INTEGER'\n    }],\n    primaryKeys: ['siteid', 'addon']\n  }, {\n    name: PENDING_UNREGISTER_TABLE_NAME,\n    columns: [{\n      name: 'siteid',\n      type: 'TEXT',\n      primaryKey: true\n    }, {\n      name: 'siteurl',\n      type: 'TEXT'\n    }, {\n      name: 'token',\n      type: 'TEXT'\n    }, {\n      name: 'info',\n      type: 'TEXT'\n    }]\n  }]\n};\nexport const SITE_SCHEMA = {\n  name: 'AddonPushNotificationsProvider',\n  version: 2,\n  tables: [{\n    name: REGISTERED_DEVICES_TABLE_NAME,\n    columns: [{\n      name: 'appid',\n      type: 'TEXT'\n    }, {\n      name: 'uuid',\n      type: 'TEXT'\n    }, {\n      name: 'name',\n      type: 'TEXT'\n    }, {\n      name: 'model',\n      type: 'TEXT'\n    }, {\n      name: 'platform',\n      type: 'TEXT'\n    }, {\n      name: 'version',\n      type: 'TEXT'\n    }, {\n      name: 'pushid',\n      type: 'TEXT'\n    }, {\n      name: 'publickey',\n      type: 'TEXT'\n    }],\n    primaryKeys: ['appid', 'uuid']\n  }],\n  migrate(db, oldVersion) {\n    return _asyncToGenerator(function* () {\n      if (oldVersion < 2) {\n        // Schema changed in v4.2.\n        yield db.migrateTable('addon_pushnotifications_registered_devices', REGISTERED_DEVICES_TABLE_NAME);\n      }\n    })();\n  }\n};","map":{"version":3,"names":["BADGE_TABLE_NAME","PENDING_UNREGISTER_TABLE_NAME","REGISTERED_DEVICES_TABLE_NAME","APP_SCHEMA","name","version","tables","columns","type","primaryKeys","primaryKey","SITE_SCHEMA","migrate","db","oldVersion","_asyncToGenerator","migrateTable"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/pushnotifications/services/database/pushnotifications.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { SQLiteDB } from '@classes/sqlitedb';\nimport { CoreAppSchema } from '@services/app';\nimport { CoreSiteSchema } from '@services/sites';\n\n/**\n * Database variables for CorePushNotificationsProvider service.\n * Keep \"addon\" in some names for backwards compatibility.\n */\nexport const BADGE_TABLE_NAME = 'addon_pushnotifications_badge';\nexport const PENDING_UNREGISTER_TABLE_NAME = 'addon_pushnotifications_pending_unregister';\nexport const REGISTERED_DEVICES_TABLE_NAME = 'addon_pushnotifications_registered_devices_2';\nexport const APP_SCHEMA: CoreAppSchema = {\n    name: 'CorePushNotificationsProvider',\n    version: 1,\n    tables: [\n        {\n            name: BADGE_TABLE_NAME,\n            columns: [\n                {\n                    name: 'siteid',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'addon',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'number',\n                    type: 'INTEGER',\n                },\n            ],\n            primaryKeys: ['siteid', 'addon'],\n        },\n        {\n            name: PENDING_UNREGISTER_TABLE_NAME,\n            columns: [\n                {\n                    name: 'siteid',\n                    type: 'TEXT',\n                    primaryKey: true,\n                },\n                {\n                    name: 'siteurl',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'token',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'info',\n                    type: 'TEXT',\n                },\n            ],\n        },\n    ],\n};\nexport const SITE_SCHEMA: CoreSiteSchema = {\n    name: 'AddonPushNotificationsProvider',\n    version: 2,\n    tables: [\n        {\n            name: REGISTERED_DEVICES_TABLE_NAME,\n            columns: [\n                {\n                    name: 'appid',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'uuid',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'name',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'model',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'platform',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'version',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'pushid',\n                    type: 'TEXT',\n                },\n                {\n                    name: 'publickey',\n                    type: 'TEXT',\n                },\n            ],\n            primaryKeys: ['appid', 'uuid'],\n        },\n    ],\n    async migrate(db: SQLiteDB, oldVersion: number): Promise<void> {\n        if (oldVersion < 2) {\n            // Schema changed in v4.2.\n            await db.migrateTable('addon_pushnotifications_registered_devices', REGISTERED_DEVICES_TABLE_NAME);\n        }\n    },\n};\n\n/**\n * Data stored in DB for badge.\n */\nexport type CorePushNotificationsBadgeDBRecord = {\n    siteid: string;\n    addon: string;\n    number: number; // eslint-disable-line id-blacklist\n};\n\n/**\n * Data stored in DB for pending unregisters.\n */\nexport type CorePushNotificationsPendingUnregisterDBRecord = {\n    siteid: string;\n    siteurl: string;\n    token: string;\n    info: string;\n};\n\n/**\n * Data stored in DB for registered devices.\n */\nexport type CorePushNotificationsRegisteredDeviceDBRecord = {\n    appid: string; // App ID.\n    uuid: string; // Device UUID.\n    name: string; // Device name.\n    model: string; // Device model.\n    platform: string; // Device platform.\n    version: string; // Device version.\n    pushid: string; // Push ID.\n    publickey?: string; // Public key.\n};\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;;;;AAIA,OAAO,MAAMA,gBAAgB,GAAG,+BAA+B;AAC/D,OAAO,MAAMC,6BAA6B,GAAG,4CAA4C;AACzF,OAAO,MAAMC,6BAA6B,GAAG,8CAA8C;AAC3F,OAAO,MAAMC,UAAU,GAAkB;EACrCC,IAAI,EAAE,+BAA+B;EACrCC,OAAO,EAAE,CAAC;EACVC,MAAM,EAAE,CACJ;IACIF,IAAI,EAAEJ,gBAAgB;IACtBO,OAAO,EAAE,CACL;MACIH,IAAI,EAAE,QAAQ;MACdI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,OAAO;MACbI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,QAAQ;MACdI,IAAI,EAAE;KACT,CACJ;IACDC,WAAW,EAAE,CAAC,QAAQ,EAAE,OAAO;GAClC,EACD;IACIL,IAAI,EAAEH,6BAA6B;IACnCM,OAAO,EAAE,CACL;MACIH,IAAI,EAAE,QAAQ;MACdI,IAAI,EAAE,MAAM;MACZE,UAAU,EAAE;KACf,EACD;MACIN,IAAI,EAAE,SAAS;MACfI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,OAAO;MACbI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,MAAM;MACZI,IAAI,EAAE;KACT;GAER;CAER;AACD,OAAO,MAAMG,WAAW,GAAmB;EACvCP,IAAI,EAAE,gCAAgC;EACtCC,OAAO,EAAE,CAAC;EACVC,MAAM,EAAE,CACJ;IACIF,IAAI,EAAEF,6BAA6B;IACnCK,OAAO,EAAE,CACL;MACIH,IAAI,EAAE,OAAO;MACbI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,MAAM;MACZI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,MAAM;MACZI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,OAAO;MACbI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,UAAU;MAChBI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,SAAS;MACfI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,QAAQ;MACdI,IAAI,EAAE;KACT,EACD;MACIJ,IAAI,EAAE,WAAW;MACjBI,IAAI,EAAE;KACT,CACJ;IACDC,WAAW,EAAE,CAAC,OAAO,EAAE,MAAM;GAChC,CACJ;EACKG,OAAOA,CAACC,EAAY,EAAEC,UAAkB;IAAA,OAAAC,iBAAA;MAC1C,IAAID,UAAU,GAAG,CAAC,EAAE;QAChB;QACA,MAAMD,EAAE,CAACG,YAAY,CAAC,4CAA4C,EAAEd,6BAA6B,CAAC;;IACrG;EACL;CACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}