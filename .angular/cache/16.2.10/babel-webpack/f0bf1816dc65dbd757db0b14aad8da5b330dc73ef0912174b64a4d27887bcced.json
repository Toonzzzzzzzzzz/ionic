{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreBlockDelegate } from '../../services/block-delegate';\nimport { CoreDynamicComponent } from '@components/dynamic-component/dynamic-component';\nimport * as i0 from \"@angular/core\";\nfunction CoreBlockComponent_ion_card_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\", 1);\n    i0.ɵɵelement(1, \"core-dynamic-component\", 2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassMap(ctx_r0.class);\n    i0.ɵɵattribute(\"aria-labelledby\", ctx_r0.labelledBy ? ctx_r0.labelledBy : null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"component\", ctx_r0.componentClass)(\"data\", ctx_r0.data);\n  }\n}\n/**\n * Component to render a block.\n */\nexport class CoreBlockComponent {\n  constructor() {\n    this.data = {}; // Data to pass to the component.\n    this.loaded = false;\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnChanges(changes) {\n    var _this$block;\n    if (changes.block && (_this$block = this.block) !== null && _this$block !== void 0 && _this$block.visible) {\n      this.updateBlock();\n    }\n    if (this.data && changes.extraData) {\n      this.data = Object.assign(this.data, this.extraData || {});\n    }\n  }\n  /**\n   * Get block display data and initialises or updates the block. If the block is not supported at the moment, try again if the\n   * available blocks are updated (because it comes from a site plugin).\n   */\n  updateBlock() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const data = yield CoreBlockDelegate.getBlockDisplayData(_this.block, _this.contextLevel, _this.instanceId);\n        if (!data) {\n          // Block not supported, don't render it. But, site plugins might not have finished loading.\n          // Subscribe to the observable in block delegate that will tell us if blocks are updated.\n          // We can retry init later if that happens.\n          _this.blockSubscription = CoreBlockDelegate.blocksUpdateObservable.subscribe(() => {\n            var _this$blockSubscripti;\n            (_this$blockSubscripti = _this.blockSubscription) === null || _this$blockSubscripti === void 0 || _this$blockSubscripti.unsubscribe();\n            delete _this.blockSubscription;\n            _this.updateBlock();\n          });\n          return;\n        }\n        _this.class = data.class;\n        _this.componentClass = data.component;\n        // Set up the data needed by the block component.\n        _this.data = Object.assign({\n          title: data.title,\n          block: _this.block,\n          contextLevel: _this.contextLevel,\n          instanceId: _this.instanceId,\n          link: data.link || null,\n          linkParams: data.linkParams || null,\n          navOptions: data.navOptions || null\n        }, _this.extraData || {}, data.componentData || {});\n      } catch (_unused) {\n        // Ignore errors.\n      }\n      _this.loaded = true;\n    })();\n  }\n  /**\n   * On destroy of the component, clear up any subscriptions.\n   */\n  ngOnDestroy() {\n    var _this$blockSubscripti2;\n    (_this$blockSubscripti2 = this.blockSubscription) === null || _this$blockSubscripti2 === void 0 || _this$blockSubscripti2.unsubscribe();\n    delete this.blockSubscription;\n  }\n  /**\n   * Invalidate some data.\n   *\n   * @returns Promise resolved when done.\n   */\n  invalidate() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (_this2.dynamicComponent) {\n        yield _this2.dynamicComponent.callComponentMethod('invalidateContent');\n      }\n    })();\n  }\n}\n_class = CoreBlockComponent;\n_class.ɵfac = function CoreBlockComponent_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"core-block\"]],\n  viewQuery: function CoreBlockComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(CoreDynamicComponent, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dynamicComponent = _t.first);\n    }\n  },\n  inputs: {\n    block: \"block\",\n    contextLevel: \"contextLevel\",\n    instanceId: \"instanceId\",\n    extraData: \"extraData\",\n    labelledBy: \"labelledBy\"\n  },\n  features: [i0.ɵɵNgOnChangesFeature],\n  decls: 1,\n  vars: 1,\n  consts: [[\"role\", \"region\", 3, \"class\", 4, \"ngIf\"], [\"role\", \"region\"], [3, \"component\", \"data\"]],\n  template: function CoreBlockComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, CoreBlockComponent_ion_card_0_Template, 2, 6, \"ion-card\", 0);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.loaded && ctx.componentClass && ctx.block && ctx.block.visible);\n    }\n  },\n  styles: [\"[_nghost-%COMP%] {\\n  position: relative;\\n  display: flex;\\n  flex-direction: column;\\n  background: var(--background);\\n}\\n[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%] {\\n  --border-radius: var(--radius-sm);\\n}\\n[_nghost-%COMP%]     ion-item-divider {\\n  min-height: var(--item-divider-min-height);\\n}\\n[_nghost-%COMP%]     core-loading {\\n  --loading-inline-min-height: 44px;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb3JlL2ZlYXR1cmVzL2Jsb2NrL2NvbXBvbmVudHMvYmxvY2svYmxvY2suc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGtCQUFBO0VBQ0EsYUFBQTtFQUNBLHNCQUFBO0VBQ0EsNkJBQUE7QUFDSjtBQUNJO0VBQ0ksaUNBQUE7QUFDUjtBQUVJO0VBQ0ksMENBQUE7QUFBUjtBQUdJO0VBQ0ksaUNBQUE7QUFEUiIsInNvdXJjZXNDb250ZW50IjpbIjpob3N0IHtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgIGJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQpO1xuXG4gICAgaW9uLWNhcmQge1xuICAgICAgICAtLWJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1zbSk7XG4gICAgfVxuXG4gICAgOjpuZy1kZWVwIGlvbi1pdGVtLWRpdmlkZXIge1xuICAgICAgICBtaW4taGVpZ2h0OiB2YXIoLS1pdGVtLWRpdmlkZXItbWluLWhlaWdodCk7XG4gICAgfVxuXG4gICAgOjpuZy1kZWVwIGNvcmUtbG9hZGluZyB7XG4gICAgICAgIC0tbG9hZGluZy1pbmxpbmUtbWluLWhlaWdodDogNDRweDtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"names":["CoreBlockDelegate","CoreDynamicComponent","i0","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","ɵɵclassMap","ctx_r0","class","ɵɵattribute","labelledBy","ɵɵadvance","ɵɵproperty","componentClass","data","CoreBlockComponent","constructor","loaded","ngOnChanges","changes","_this$block","block","visible","updateBlock","extraData","Object","assign","_this","_asyncToGenerator","getBlockDisplayData","contextLevel","instanceId","blockSubscription","blocksUpdateObservable","subscribe","_this$blockSubscripti","unsubscribe","component","title","link","linkParams","navOptions","componentData","_unused","ngOnDestroy","_this$blockSubscripti2","invalidate","_this2","dynamicComponent","callComponentMethod","selectors","viewQuery","CoreBlockComponent_Query","rf","ctx","ɵɵtemplate","CoreBlockComponent_ion_card_0_Template"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/block/components/block/block.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/block/components/block/core-block.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, Input, ViewChild, OnDestroy, Type, OnChanges, SimpleChanges } from '@angular/core';\nimport { CoreBlockDelegate } from '../../services/block-delegate';\nimport { CoreDynamicComponent } from '@components/dynamic-component/dynamic-component';\nimport { Subscription } from 'rxjs';\nimport { CoreCourseBlock } from '@/core/features/course/services/course';\nimport type { ICoreBlockComponent } from '@features/block/classes/base-block-component';\n\n/**\n * Component to render a block.\n */\n@Component({\n    selector: 'core-block',\n    templateUrl: 'core-block.html',\n    styleUrls: ['block.scss'],\n})\nexport class CoreBlockComponent implements OnChanges, OnDestroy {\n\n    @ViewChild(CoreDynamicComponent) dynamicComponent?: CoreDynamicComponent<ICoreBlockComponent>;\n\n    @Input() block!: CoreCourseBlock; // The block to render.\n    @Input() contextLevel!: string; // The context where the block will be used.\n    @Input() instanceId!: number; // The instance ID associated with the context level.\n    @Input() extraData!: Record<string, unknown>; // Any extra data to be passed to the block.\n    @Input() labelledBy?: string;\n\n    componentClass?: Type<ICoreBlockComponent>; // The class of the component to render.\n    data: Record<string, unknown> = {}; // Data to pass to the component.\n    class?: string; // CSS class to apply to the block.\n    loaded = false;\n    blockSubscription?: Subscription;\n\n    /**\n     * @inheritdoc\n     */\n    ngOnChanges(changes: SimpleChanges): void {\n        if (changes.block && this.block?.visible) {\n            this.updateBlock();\n        }\n\n        if (this.data && changes.extraData) {\n            this.data = Object.assign(this.data, this.extraData || {});\n        }\n    }\n\n    /**\n     * Get block display data and initialises or updates the block. If the block is not supported at the moment, try again if the\n     * available blocks are updated (because it comes from a site plugin).\n     */\n    async updateBlock(): Promise<void> {\n        try {\n            const data = await CoreBlockDelegate.getBlockDisplayData(this.block, this.contextLevel, this.instanceId);\n\n            if (!data) {\n                // Block not supported, don't render it. But, site plugins might not have finished loading.\n                // Subscribe to the observable in block delegate that will tell us if blocks are updated.\n                // We can retry init later if that happens.\n                this.blockSubscription = CoreBlockDelegate.blocksUpdateObservable.subscribe(\n                    (): void => {\n                        this.blockSubscription?.unsubscribe();\n                        delete this.blockSubscription;\n                        this.updateBlock();\n                    },\n                );\n\n                return;\n            }\n\n            this.class = data.class;\n            this.componentClass = data.component;\n\n            // Set up the data needed by the block component.\n            this.data = Object.assign({\n                title: data.title,\n                block: this.block,\n                contextLevel: this.contextLevel,\n                instanceId: this.instanceId,\n                link: data.link || null,\n                linkParams: data.linkParams || null,\n                navOptions: data.navOptions || null,\n            }, this.extraData || {}, data.componentData || {});\n        } catch {\n            // Ignore errors.\n        }\n\n        this.loaded = true;\n    }\n\n    /**\n     * On destroy of the component, clear up any subscriptions.\n     */\n    ngOnDestroy(): void {\n        this.blockSubscription?.unsubscribe();\n        delete this.blockSubscription;\n    }\n\n    /**\n     * Invalidate some data.\n     *\n     * @returns Promise resolved when done.\n     */\n    async invalidate(): Promise<void> {\n        if (this.dynamicComponent) {\n            await this.dynamicComponent.callComponentMethod('invalidateContent');\n        }\n    }\n\n}\n","<!-- Only render the block if it's supported. -->\n<ion-card *ngIf=\"loaded && componentClass && block && block.visible\" class=\"{{class}}\" role=\"region\"\n    [attr.aria-labelledby]=\"labelledBy ? labelledBy : null\">\n    <core-dynamic-component [component]=\"componentClass\" [data]=\"data\" />\n</ion-card>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}