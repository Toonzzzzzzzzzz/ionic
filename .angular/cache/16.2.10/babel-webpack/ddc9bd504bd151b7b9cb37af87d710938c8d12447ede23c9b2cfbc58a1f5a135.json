{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreSheetModalComponent } from '@components/sheet-modal/sheet-modal';\nimport { AngularFrameworkDelegate, makeSingleton } from '@singletons';\nimport { CoreDirectivesRegistry } from '@singletons/directives-registry';\nimport * as i0 from \"@angular/core\";\n/**\n * Handles application modals.\n */\nexport class CoreModalsService {\n  /**\n   * Get index of the overlay on top of the stack.\n   *\n   * @returns Z-index of the overlay on top.\n   */\n  getTopOverlayIndex() {\n    // This has to be done manually because Ionic's overlay mechanisms are not exposed externally, thus making it more difficult\n    // to implement custom overlays.\n    //\n    // eslint-disable-next-line max-len\n    // See https://github.com/ionic-team/ionic-framework/blob/a9b12a5aa4c150a1f8a80a826dda0df350bc0092/core/src/utils/overlays.ts#L39\n    const overlays = document.querySelectorAll('ion-action-sheet, ion-alert, ion-loading, ion-modal, ion-picker, ion-popover, ion-toast');\n    return Array.from(overlays).reduce((maxIndex, element) => {\n      const index = parseInt(element.style.zIndex);\n      if (isNaN(index)) {\n        return maxIndex;\n      }\n      return Math.max(maxIndex, index % 10000);\n    }, 0);\n  }\n  /**\n   * Open a sheet modal component.\n   *\n   * @param component Component to render inside the modal.\n   * @returns Modal result once it's been closed.\n   */\n  openSheet(component) {\n    return _asyncToGenerator(function* () {\n      var _document$querySelect;\n      const container = (_document$querySelect = document.querySelector('ion-app')) !== null && _document$querySelect !== void 0 ? _document$querySelect : document.body;\n      const viewContainer = container.querySelector('ion-router-outlet, ion-nav, #ion-view-container-root');\n      const element = yield AngularFrameworkDelegate.attachViewToDom(container, CoreSheetModalComponent, {\n        component\n      });\n      const sheetModal = CoreDirectivesRegistry.require(element, CoreSheetModalComponent);\n      const modal = yield sheetModal.show();\n      viewContainer === null || viewContainer === void 0 || viewContainer.setAttribute('aria-hidden', 'true');\n      modal.result.finally( /*#__PURE__*/_asyncToGenerator(function* () {\n        yield sheetModal.hide();\n        yield AngularFrameworkDelegate.removeViewFromDom(container, element);\n        viewContainer === null || viewContainer === void 0 || viewContainer.removeAttribute('aria-hidden');\n      }));\n      return modal.result;\n    })();\n  }\n}\n_class = CoreModalsService;\n_class.ɵfac = function CoreModalsService_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const CoreModals = makeSingleton(CoreModalsService);","map":{"version":3,"names":["CoreSheetModalComponent","AngularFrameworkDelegate","makeSingleton","CoreDirectivesRegistry","CoreModalsService","getTopOverlayIndex","overlays","document","querySelectorAll","Array","from","reduce","maxIndex","element","index","parseInt","style","zIndex","isNaN","Math","max","openSheet","component","_asyncToGenerator","_document$querySelect","container","querySelector","body","viewContainer","attachViewToDom","sheetModal","require","modal","show","setAttribute","result","finally","hide","removeViewFromDom","removeAttribute","factory","ɵfac","providedIn","CoreModals"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/services/modals.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Constructor } from '@/core/utils/types';\nimport { Injectable } from '@angular/core';\nimport { CoreModalComponent } from '@classes/modal-component';\nimport { CoreSheetModalComponent } from '@components/sheet-modal/sheet-modal';\nimport { AngularFrameworkDelegate, makeSingleton } from '@singletons';\nimport { CoreDirectivesRegistry } from '@singletons/directives-registry';\n\n/**\n * Handles application modals.\n */\n@Injectable({ providedIn: 'root' })\nexport class CoreModalsService {\n\n    /**\n     * Get index of the overlay on top of the stack.\n     *\n     * @returns Z-index of the overlay on top.\n     */\n    getTopOverlayIndex(): number {\n        // This has to be done manually because Ionic's overlay mechanisms are not exposed externally, thus making it more difficult\n        // to implement custom overlays.\n        //\n        // eslint-disable-next-line max-len\n        // See https://github.com/ionic-team/ionic-framework/blob/a9b12a5aa4c150a1f8a80a826dda0df350bc0092/core/src/utils/overlays.ts#L39\n\n        const overlays = document.querySelectorAll<HTMLElement>(\n            'ion-action-sheet, ion-alert, ion-loading, ion-modal, ion-picker, ion-popover, ion-toast',\n        );\n\n        return Array.from(overlays).reduce((maxIndex, element) => {\n            const index = parseInt(element.style.zIndex);\n\n            if (isNaN(index)) {\n                return maxIndex;\n            }\n\n            return Math.max(maxIndex, index % 10000);\n        }, 0);\n    }\n\n    /**\n     * Open a sheet modal component.\n     *\n     * @param component Component to render inside the modal.\n     * @returns Modal result once it's been closed.\n     */\n    async openSheet<T>(component: Constructor<CoreModalComponent<T>>): Promise<T> {\n        const container = document.querySelector('ion-app') ?? document.body;\n        const viewContainer = container.querySelector('ion-router-outlet, ion-nav, #ion-view-container-root');\n        const element = await AngularFrameworkDelegate.attachViewToDom(\n            container,\n            CoreSheetModalComponent,\n            { component },\n        );\n        const sheetModal = CoreDirectivesRegistry.require<CoreSheetModalComponent<CoreModalComponent<T>>>(\n            element,\n            CoreSheetModalComponent,\n        );\n        const modal = await sheetModal.show();\n\n        viewContainer?.setAttribute('aria-hidden', 'true');\n\n        modal.result.finally(async () => {\n            await sheetModal.hide();\n            await AngularFrameworkDelegate.removeViewFromDom(container, element);\n\n            viewContainer?.removeAttribute('aria-hidden');\n        });\n\n        return modal.result;\n    }\n\n}\n\nexport const CoreModals = makeSingleton(CoreModalsService);\n"],"mappings":";;AAiBA,SAASA,uBAAuB,QAAQ,qCAAqC;AAC7E,SAASC,wBAAwB,EAAEC,aAAa,QAAQ,aAAa;AACrE,SAASC,sBAAsB,QAAQ,iCAAiC;;AAExE;;;AAIA,OAAM,MAAOC,iBAAiB;EAE1B;;;;;EAKAC,kBAAkBA,CAAA;IACd;IACA;IACA;IACA;IACA;IAEA,MAAMC,QAAQ,GAAGC,QAAQ,CAACC,gBAAgB,CACtC,yFAAyF,CAC5F;IAED,OAAOC,KAAK,CAACC,IAAI,CAACJ,QAAQ,CAAC,CAACK,MAAM,CAAC,CAACC,QAAQ,EAAEC,OAAO,KAAI;MACrD,MAAMC,KAAK,GAAGC,QAAQ,CAACF,OAAO,CAACG,KAAK,CAACC,MAAM,CAAC;MAE5C,IAAIC,KAAK,CAACJ,KAAK,CAAC,EAAE;QACd,OAAOF,QAAQ;;MAGnB,OAAOO,IAAI,CAACC,GAAG,CAACR,QAAQ,EAAEE,KAAK,GAAG,KAAK,CAAC;IAC5C,CAAC,EAAE,CAAC,CAAC;EACT;EAEA;;;;;;EAMMO,SAASA,CAAIC,SAA6C;IAAA,OAAAC,iBAAA;MAAA,IAAAC,qBAAA;MAC5D,MAAMC,SAAS,IAAAD,qBAAA,GAAGjB,QAAQ,CAACmB,aAAa,CAAC,SAAS,CAAC,cAAAF,qBAAA,cAAAA,qBAAA,GAAIjB,QAAQ,CAACoB,IAAI;MACpE,MAAMC,aAAa,GAAGH,SAAS,CAACC,aAAa,CAAC,sDAAsD,CAAC;MACrG,MAAMb,OAAO,SAASZ,wBAAwB,CAAC4B,eAAe,CAC1DJ,SAAS,EACTzB,uBAAuB,EACvB;QAAEsB;MAAS,CAAE,CAChB;MACD,MAAMQ,UAAU,GAAG3B,sBAAsB,CAAC4B,OAAO,CAC7ClB,OAAO,EACPb,uBAAuB,CAC1B;MACD,MAAMgC,KAAK,SAASF,UAAU,CAACG,IAAI,EAAE;MAErCL,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEM,YAAY,CAAC,aAAa,EAAE,MAAM,CAAC;MAElDF,KAAK,CAACG,MAAM,CAACC,OAAO,eAAAb,iBAAA,CAAC,aAAW;QAC5B,MAAMO,UAAU,CAACO,IAAI,EAAE;QACvB,MAAMpC,wBAAwB,CAACqC,iBAAiB,CAACb,SAAS,EAAEZ,OAAO,CAAC;QAEpEe,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEW,eAAe,CAAC,aAAa,CAAC;MACjD,CAAC,EAAC;MAEF,OAAOP,KAAK,CAACG,MAAM;IAAC;EACxB;;SA3DS/B,iBAAiB;;mBAAjBA,MAAiB;AAAA;;SAAjBA,MAAiB;EAAAoC,OAAA,EAAjBpC,MAAiB,CAAAqC,IAAA;EAAAC,UAAA,EADJ;AAAM;AAgEhC,OAAO,MAAMC,UAAU,GAAGzC,aAAa,CAACE,iBAAiB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}