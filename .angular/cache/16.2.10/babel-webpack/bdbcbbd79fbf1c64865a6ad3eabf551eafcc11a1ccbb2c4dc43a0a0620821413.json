{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CorePromisedValue } from '@classes/promised-value';\nimport { CoreSitePlugins } from '@features/siteplugins/services/siteplugins';\nimport { CoreUserDelegateService } from '@features/user/services/user-delegate';\nimport { CoreNavigator } from '@services/navigator';\nimport { Md5 } from 'ts-md5';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\n/**\n * Handler to display a site plugin in the user profile.\n */\nexport class CoreSitePluginsUserProfileHandler extends CoreSitePluginsBaseHandler {\n  constructor(name, title, plugin, handlerSchema, initResult) {\n    super(name);\n    this.title = title;\n    this.plugin = plugin;\n    this.handlerSchema = handlerSchema;\n    this.initResult = initResult;\n    this.priority = handlerSchema.priority || 0;\n    // Only support TYPE_COMMUNICATION and TYPE_NEW_PAGE.\n    this.type = handlerSchema.type != CoreUserDelegateService.TYPE_COMMUNICATION ? CoreUserDelegateService.TYPE_NEW_PAGE : CoreUserDelegateService.TYPE_COMMUNICATION;\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForContext(context, courseId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      var _this$initResult;\n      // Check if it's enabled for the course.\n      return CoreSitePlugins.isHandlerEnabledForCourse(courseId, _this.handlerSchema.restricttoenrolledcourses, (_this$initResult = _this.initResult) === null || _this$initResult === void 0 ? void 0 : _this$initResult.restrict);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForUser(user) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      var _this2$initResult;\n      return CoreSitePlugins.isHandlerEnabledForUser(user.id, _this2.handlerSchema.restricttocurrentuser, (_this2$initResult = _this2.initResult) === null || _this2$initResult === void 0 ? void 0 : _this2$initResult.restrict);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData() {\n    var _this$handlerSchema$d, _this$handlerSchema$d2;\n    return {\n      title: this.title,\n      icon: (_this$handlerSchema$d = this.handlerSchema.displaydata) === null || _this$handlerSchema$d === void 0 ? void 0 : _this$handlerSchema$d.icon,\n      class: (_this$handlerSchema$d2 = this.handlerSchema.displaydata) === null || _this$handlerSchema$d2 === void 0 ? void 0 : _this$handlerSchema$d2.class,\n      action: (event, user, context, contextId) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const args = {\n          courseid: contextId,\n          userid: user.id\n        };\n        const hash = Md5.hashAsciiStr(JSON.stringify(args));\n        CoreNavigator.navigateToSitePath(`siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${hash}`, {\n          params: {\n            title: this.title,\n            args,\n            initResult: this.initResult,\n            ptrEnabled: this.handlerSchema.ptrenabled\n          }\n        });\n      }\n    };\n  }\n  /**\n   * Set init result.\n   *\n   * @param result Result to set.\n   */\n  setInitResult(result) {\n    var _this$updatingDefer;\n    this.initResult = result;\n    (_this$updatingDefer = this.updatingDefer) === null || _this$updatingDefer === void 0 || _this$updatingDefer.resolve();\n    delete this.updatingDefer;\n  }\n  /**\n   * Mark init being updated.\n   */\n  updatingInit() {\n    this.updatingDefer = new CorePromisedValue();\n  }\n}","map":{"version":3,"names":["CorePromisedValue","CoreSitePlugins","CoreUserDelegateService","CoreNavigator","Md5","CoreSitePluginsBaseHandler","CoreSitePluginsUserProfileHandler","constructor","name","title","plugin","handlerSchema","initResult","priority","type","TYPE_COMMUNICATION","TYPE_NEW_PAGE","isEnabledForContext","context","courseId","_this","_asyncToGenerator","_this$initResult","isHandlerEnabledForCourse","restricttoenrolledcourses","restrict","isEnabledForUser","user","_this2","_this2$initResult","isHandlerEnabledForUser","id","restricttocurrentuser","getDisplayData","_this$handlerSchema$d","_this$handlerSchema$d2","icon","displaydata","class","action","event","contextId","preventDefault","stopPropagation","args","courseid","userid","hash","hashAsciiStr","JSON","stringify","navigateToSitePath","component","method","params","ptrEnabled","ptrenabled","setInitResult","result","_this$updatingDefer","updatingDefer","resolve","updatingInit"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/siteplugins/classes/handlers/user-handler.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CorePromisedValue } from '@classes/promised-value';\nimport {\n    CoreSitePlugins,\n    CoreSitePluginsContent,\n    CoreSitePluginsPlugin,\n    CoreSitePluginsUserHandlerData,\n} from '@features/siteplugins/services/siteplugins';\nimport { CoreUserProfile } from '@features/user/services/user';\nimport {\n    CoreUserDelegateContext,\n    CoreUserDelegateService,\n    CoreUserProfileHandler,\n    CoreUserProfileHandlerData,\n} from '@features/user/services/user-delegate';\nimport { CoreNavigator } from '@services/navigator';\nimport { Md5 } from 'ts-md5';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\n\n/**\n * Handler to display a site plugin in the user profile.\n */\nexport class CoreSitePluginsUserProfileHandler extends CoreSitePluginsBaseHandler implements CoreUserProfileHandler {\n\n    priority: number;\n    type: string;\n\n    protected updatingDefer?: CorePromisedValue<void>;\n\n    constructor(\n        name: string,\n        protected title: string,\n        protected plugin: CoreSitePluginsPlugin,\n        protected handlerSchema: CoreSitePluginsUserHandlerData,\n        protected initResult: CoreSitePluginsContent | null,\n    ) {\n        super(name);\n\n        this.priority = handlerSchema.priority || 0;\n\n        // Only support TYPE_COMMUNICATION and TYPE_NEW_PAGE.\n        this.type = handlerSchema.type != CoreUserDelegateService.TYPE_COMMUNICATION ?\n            CoreUserDelegateService.TYPE_NEW_PAGE : CoreUserDelegateService.TYPE_COMMUNICATION;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForContext(context: CoreUserDelegateContext, courseId: number): Promise<boolean> {\n        // Check if it's enabled for the course.\n        return CoreSitePlugins.isHandlerEnabledForCourse(\n            courseId,\n            this.handlerSchema.restricttoenrolledcourses,\n            this.initResult?.restrict,\n        );\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForUser(\n        user: CoreUserProfile,\n    ): Promise<boolean> {\n        return CoreSitePlugins.isHandlerEnabledForUser(\n            user.id,\n            this.handlerSchema.restricttocurrentuser,\n            this.initResult?.restrict,\n        );\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getDisplayData(): CoreUserProfileHandlerData {\n        return {\n            title: this.title,\n            icon: this.handlerSchema.displaydata?.icon,\n            class: this.handlerSchema.displaydata?.class,\n            action: (event, user, context, contextId): void => {\n                event.preventDefault();\n                event.stopPropagation();\n\n                const args = {\n                    courseid: contextId,\n                    userid: user.id,\n                };\n                const hash = <string> Md5.hashAsciiStr(JSON.stringify(args));\n\n                CoreNavigator.navigateToSitePath(\n                    `siteplugins/content/${this.plugin.component}/${this.handlerSchema.method}/${hash}`,\n                    {\n                        params: {\n                            title: this.title,\n                            args,\n                            initResult: this.initResult,\n                            ptrEnabled: this.handlerSchema.ptrenabled,\n                        },\n                    },\n                );\n            },\n        };\n    }\n\n    /**\n     * Set init result.\n     *\n     * @param result Result to set.\n     */\n    setInitResult(result: CoreSitePluginsContent | null): void {\n        this.initResult = result;\n\n        this.updatingDefer?.resolve();\n        delete this.updatingDefer;\n    }\n\n    /**\n     * Mark init being updated.\n     */\n    updatingInit(): void {\n        this.updatingDefer = new CorePromisedValue();\n    }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}