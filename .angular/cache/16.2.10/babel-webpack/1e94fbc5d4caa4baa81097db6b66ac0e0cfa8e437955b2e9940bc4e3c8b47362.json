{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { FormGroup, Validators } from '@angular/forms';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreGradesHelper } from '@features/grades/services/grades-helper';\nimport { CoreUser } from '@features/user/services/user';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreSync } from '@services/sync';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { Translate } from '@singletons';\nimport { CoreEvents } from '@singletons/events';\nimport { CoreForms } from '@singletons/form';\nimport { AddonModWorkshop, AddonModWorkshopPhase, AddonModWorkshopProvider } from '../../services/workshop';\nimport { AddonModWorkshopHelper } from '../../services/workshop-helper';\nimport { AddonModWorkshopOffline } from '../../services/workshop-offline';\nimport { AddonModWorkshopSyncProvider } from '../../services/workshop-sync';\nimport { CoreTime } from '@singletons/time';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { ADDON_MOD_WORKSHOP_COMPONENT } from '@addons/mod/workshop/constants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../../../core/components/loading/loading\";\nimport * as i4 from \"../../../../../core/components/mark-required/mark-required\";\nimport * as i5 from \"../../../../../core/components/user-avatar/user-avatar\";\nimport * as i6 from \"../../../../../core/directives/format-text\";\nimport * as i7 from \"../../../../../core/directives/content\";\nimport * as i8 from \"../../../../../core/directives/update-non-reactive-attributes\";\nimport * as i9 from \"@ionic/angular\";\nimport * as i10 from \"../../components/assessment-strategy/assessment-strategy\";\nimport * as i11 from \"../../../../../core/features/editor/components/rich-text-editor/rich-text-editor\";\nimport * as i12 from \"@ngx-translate/core\";\nconst _c0 = [\"evaluateFormEl\"];\nfunction AddonModWorkshopAssessmentPage_ion_refresher_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-refresher\", 15);\n    i0.ɵɵlistener(\"ionRefresh\", function AddonModWorkshopAssessmentPage_ion_refresher_13_Template_ion_refresher_ionRefresh_0_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.refreshAssessment($event.target));\n    });\n    i0.ɵɵelement(1, \"ion-refresher-content\", 16);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.loaded);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"pullingText\", i0.ɵɵpipeBind1(2, 2, \"core.pulltorefresh\"));\n  }\n}\nfunction AddonModWorkshopAssessmentPage_core_user_avatar_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-user-avatar\", 17);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"user\", ctx_r1.profile)(\"courseId\", ctx_r1.courseId)(\"userId\", ctx_r1.profile.id);\n  }\n}\nfunction AddonModWorkshopAssessmentPage_h2_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r2.profile.fullname);\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    $a: a0\n  };\n};\nfunction AddonModWorkshopAssessmentPage_p_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", i0.ɵɵpipeBind2(2, 2, \"addon.mod_workshop.submissiongradeof\", i0.ɵɵpureFunction1(5, _c1, ctx_r3.workshop.grade)), \": \", ctx_r3.assessment.grade, \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_p_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"core-has-overriden-grade\", ctx_r4.showGrade(ctx_r4.assessment.gradinggrade));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", i0.ɵɵpipeBind2(2, 4, \"addon.mod_workshop.gradinggradeof\", i0.ɵɵpureFunction1(7, _c1, ctx_r4.workshop.gradinggrade)), \": \", ctx_r4.assessment.gradinggrade, \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_p_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", i0.ɵɵpipeBind1(2, 2, \"addon.mod_workshop.gradinggradeover\"), \": \", ctx_r5.assessment.gradinggradeover, \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_p_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, \"addon.mod_workshop.weightinfo\", i0.ɵɵpureFunction1(4, _c1, ctx_r6.assessment.weight)), \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_ion_badge_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-badge\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"addon.mod_workshop.notassessed\"), \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_addon_mod_workshop_assessment_strategy_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"addon-mod-workshop-assessment-strategy\", 20);\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"workshop\", ctx_r8.workshop)(\"access\", ctx_r8.access)(\"assessmentId\", ctx_r8.assessmentId)(\"userId\", ctx_r8.profile && ctx_r8.profile.id)(\"strategy\", ctx_r8.strategy);\n  }\n}\nfunction AddonModWorkshopAssessmentPage_form_25_ion_item_7_ion_select_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-select-option\", 29);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const w_r18 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", w_r18);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(w_r18);\n  }\n}\nconst _c2 = function (a0) {\n  return {\n    header: a0\n  };\n};\nfunction AddonModWorkshopAssessmentPage_form_25_ion_item_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 7)(1, \"ion-label\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"ion-select\", 27);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵpipe(7, \"translate\");\n    i0.ɵɵtemplate(8, AddonModWorkshopAssessmentPage_form_25_ion_item_7_ion_select_option_8_Template, 2, 2, \"ion-select-option\", 28);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(4, 4, \"addon.mod_workshop.assessmentweight\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"cancelText\", i0.ɵɵpipeBind1(6, 6, \"core.cancel\"))(\"interfaceOptions\", i0.ɵɵpureFunction1(10, _c2, i0.ɵɵpipeBind1(7, 8, \"addon.mod_workshop.assessmentweight\")));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r14.weights);\n  }\n}\nfunction AddonModWorkshopAssessmentPage_form_25_ion_item_15_ion_select_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-select-option\", 29);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const grade_r20 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", grade_r20.value);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", grade_r20.label, \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_form_25_ion_item_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 7)(1, \"ion-label\", 25);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-select\", 30);\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵtemplate(7, AddonModWorkshopAssessmentPage_form_25_ion_item_15_ion_select_option_7_Template, 2, 2, \"ion-select-option\", 28);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r15 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 4, \"addon.mod_workshop.gradinggradeover\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"cancelText\", i0.ɵɵpipeBind1(5, 6, \"core.cancel\"))(\"interfaceOptions\", i0.ɵɵpureFunction1(10, _c2, i0.ɵɵpipeBind1(6, 8, \"addon.mod_workshop.gradinggradeover\")));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r15.evaluationGrades);\n  }\n}\nconst _c3 = function (a0) {\n  return {\n    asid: a0\n  };\n};\nfunction AddonModWorkshopAssessmentPage_form_25_ion_item_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\", 25);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"core-rich-text-editor\", 31);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r16 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 5, \"addon.mod_workshop.feedbackreviewer\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"control\", ctx_r16.evaluateForm.controls[\"text\"])(\"autoSave\", true)(\"contextInstanceId\", ctx_r16.workshop == null ? null : ctx_r16.workshop.coursemodule)(\"draftExtraParams\", i0.ɵɵpureFunction1(7, _c3, ctx_r16.assessmentId));\n  }\n}\nfunction AddonModWorkshopAssessmentPage_form_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"form\", 21, 22)(2, \"ion-item\", 7)(3, \"ion-label\")(4, \"h3\", 23);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(7, AddonModWorkshopAssessmentPage_form_25_ion_item_7_Template, 9, 12, \"ion-item\", 24);\n    i0.ɵɵelementStart(8, \"ion-item\", 7)(9, \"ion-label\")(10, \"h3\", 23);\n    i0.ɵɵtext(11);\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(15, AddonModWorkshopAssessmentPage_form_25_ion_item_15_Template, 8, 12, \"ion-item\", 24);\n    i0.ɵɵtemplate(16, AddonModWorkshopAssessmentPage_form_25_ion_item_16_Template, 5, 9, \"ion-item\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r9.evaluateForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 7, \"addon.mod_workshop.assessmentsettings\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.access == null ? null : ctx_r9.access.canallocate);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(12, 9, \"addon.mod_workshop.gradinggradecalculated\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r9.gradingGrade);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.access == null ? null : ctx_r9.access.canoverridegrades);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.access == null ? null : ctx_r9.access.canoverridegrades);\n  }\n}\nfunction AddonModWorkshopAssessmentPage_ion_list_26_core_user_avatar_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-user-avatar\", 17);\n  }\n  if (rf & 2) {\n    const ctx_r21 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"user\", ctx_r21.evaluateByProfile)(\"courseId\", ctx_r21.courseId)(\"userId\", ctx_r21.evaluateByProfile.id);\n  }\n}\nfunction AddonModWorkshopAssessmentPage_ion_list_26_h3_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h3\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r22 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, \"addon.mod_workshop.feedbackby\", i0.ɵɵpureFunction1(4, _c1, ctx_r22.evaluateByProfile.fullname)), \" \");\n  }\n}\nfunction AddonModWorkshopAssessmentPage_ion_list_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\")(1, \"ion-item\", 7);\n    i0.ɵɵtemplate(2, AddonModWorkshopAssessmentPage_ion_list_26_core_user_avatar_2_Template, 1, 3, \"core-user-avatar\", 8);\n    i0.ɵɵelementStart(3, \"ion-label\");\n    i0.ɵɵtemplate(4, AddonModWorkshopAssessmentPage_ion_list_26_h3_4_Template, 3, 6, \"h3\", 32);\n    i0.ɵɵelement(5, \"core-format-text\", 2);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.evaluateByProfile);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.evaluateByProfile && ctx_r10.evaluateByProfile.fullname);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"text\", ctx_r10.evaluate.text)(\"contextInstanceId\", ctx_r10.workshop == null ? null : ctx_r10.workshop.coursemodule)(\"courseId\", ctx_r10.courseId);\n  }\n}\n/**\n * Page that displays a workshop assessment.\n */\nexport class AddonModWorkshopAssessmentPage {\n  constructor(fb) {\n    var _this = this;\n    this.fb = fb;\n    this.evaluating = false;\n    this.loaded = false;\n    this.title = '';\n    this.evaluate = {\n      text: '',\n      grade: -1,\n      weight: 1\n    };\n    this.weights = [];\n    this.evaluationGrades = [];\n    this.originalEvaluation = {\n      text: '',\n      grade: -1,\n      weight: 1\n    };\n    this.hasOffline = false;\n    this.isDestroyed = false;\n    this.forceLeave = false;\n    this.siteId = CoreSites.getCurrentSiteId();\n    this.currentUserId = CoreSites.getCurrentSiteUserId();\n    this.showGrade = AddonModWorkshopHelper.showGrade;\n    this.evaluateForm = new FormGroup({});\n    this.evaluateForm.addControl('weight', this.fb.control('', Validators.required));\n    this.evaluateForm.addControl('grade', this.fb.control(''));\n    this.evaluateForm.addControl('text', this.fb.control(''));\n    // Refresh workshop on sync.\n    this.syncObserver = CoreEvents.on(AddonModWorkshopSyncProvider.AUTO_SYNCED, data => {\n      // Update just when all database is synced.\n      if (this.workshopId === data.workshopId) {\n        this.loaded = false;\n        this.refreshAllData();\n      }\n    }, this.siteId);\n    this.logView = CoreTime.once( /*#__PURE__*/_asyncToGenerator(function* () {\n      if (!_this.workshop) {\n        return;\n      }\n      CoreAnalytics.logEvent({\n        type: CoreAnalyticsEventType.VIEW_ITEM,\n        ws: 'mod_workshop_get_assessment',\n        name: _this.workshop.name,\n        data: {\n          id: _this.workshop.id,\n          assessmentid: _this.assessment.id,\n          category: 'workshop'\n        },\n        url: `/mod/workshop/assessment.php?asid=${_this.assessment.id}`\n      });\n    }));\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    try {\n      this.assessment = CoreNavigator.getRequiredRouteParam('assessment');\n      this.submission = CoreNavigator.getRequiredRouteParam('submission');\n      this.profile = CoreNavigator.getRouteParam('profile');\n      this.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n    } catch (error) {\n      CoreDomUtils.showErrorModal(error);\n      CoreNavigator.back();\n      return;\n    }\n    this.assessmentId = this.assessment.id;\n    this.workshopId = this.submission.workshopid;\n    this.fetchAssessmentData();\n  }\n  /**\n   * Check if we can leave the page or not.\n   *\n   * @returns Resolved if we can leave it, rejected if not.\n   */\n  canLeave() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (_this2.forceLeave || !_this2.evaluating) {\n        return true;\n      }\n      if (!_this2.hasEvaluationChanged()) {\n        return true;\n      }\n      // Show confirmation if some data has been modified.\n      yield CoreDomUtils.showConfirm(Translate.instant('core.confirmcanceledit'));\n      CoreForms.triggerFormCancelledEvent(_this2.formElement, _this2.siteId);\n      return true;\n    })();\n  }\n  /**\n   * Fetch the assessment data.\n   *\n   * @returns Resolved when done.\n   */\n  fetchAssessmentData() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        var _this3$profile, _this3$assessment$gra;\n        _this3.workshop = yield AddonModWorkshop.getWorkshopById(_this3.courseId, _this3.workshopId);\n        _this3.title = _this3.workshop.name;\n        _this3.strategy = _this3.workshop.strategy;\n        const gradeInfo = yield CoreCourse.getModuleBasicGradeInfo(_this3.workshop.coursemodule);\n        _this3.maxGrade = gradeInfo === null || gradeInfo === void 0 ? void 0 : gradeInfo.grade;\n        _this3.access = yield AddonModWorkshop.getWorkshopAccessInformation(_this3.workshopId, {\n          cmId: _this3.workshop.coursemodule\n        });\n        // Load Weights selector.\n        if (_this3.assessmentId && (_this3.access.canallocate || _this3.access.canoverridegrades)) {\n          if (!_this3.isDestroyed) {\n            // Block the workshop.\n            CoreSync.blockOperation(ADDON_MOD_WORKSHOP_COMPONENT, _this3.workshopId);\n          }\n          _this3.evaluating = true;\n        } else {\n          _this3.evaluating = false;\n        }\n        if (!_this3.evaluating && _this3.workshop.phase != AddonModWorkshopPhase.PHASE_CLOSED) {\n          return;\n        }\n        // Get all info of the assessment.\n        const assessment = yield AddonModWorkshopHelper.getReviewerAssessmentById(_this3.workshopId, _this3.assessmentId, {\n          userId: (_this3$profile = _this3.profile) === null || _this3$profile === void 0 ? void 0 : _this3$profile.id,\n          cmId: _this3.workshop.coursemodule\n        });\n        _this3.assessment = AddonModWorkshopHelper.realGradeValue(_this3.workshop, assessment);\n        _this3.evaluate.text = _this3.assessment.feedbackreviewer || '';\n        _this3.evaluate.weight = _this3.assessment.weight;\n        _this3.gradingGrade = (_this3$assessment$gra = _this3.assessment.gradinggrade) !== null && _this3$assessment$gra !== void 0 ? _this3$assessment$gra : '-';\n        if (_this3.evaluating) {\n          if (_this3.access.canallocate) {\n            _this3.weights = [];\n            for (let i = 16; i >= 0; i--) {\n              _this3.weights[i] = i;\n            }\n          }\n          if (_this3.access.canoverridegrades) {\n            const defaultGrade = Translate.instant('addon.mod_workshop.notoverridden');\n            _this3.evaluationGrades = yield CoreGradesHelper.makeGradesMenu(_this3.workshop.gradinggrade, undefined, defaultGrade, -1);\n          }\n          try {\n            const offlineAssess = yield AddonModWorkshopOffline.getEvaluateAssessment(_this3.workshopId, _this3.assessmentId);\n            _this3.hasOffline = true;\n            _this3.evaluate.weight = offlineAssess.weight;\n            if (_this3.access.canoverridegrades) {\n              _this3.evaluate.text = offlineAssess.feedbacktext || '';\n              _this3.evaluate.grade = parseInt(offlineAssess.gradinggradeover, 10) || -1;\n            }\n          } catch (_unused) {\n            _this3.hasOffline = false;\n            // No offline, load online.\n            if (_this3.access.canoverridegrades) {\n              _this3.evaluate.text = _this3.assessment.feedbackreviewer || '';\n              _this3.evaluate.grade = parseInt(String(_this3.assessment.gradinggradeover), 10) || -1;\n            }\n          } finally {\n            _this3.originalEvaluation.weight = _this3.evaluate.weight;\n            if (_this3.access.canoverridegrades) {\n              _this3.originalEvaluation.text = _this3.evaluate.text;\n              _this3.originalEvaluation.grade = _this3.evaluate.grade;\n            }\n            _this3.evaluateForm.controls['weight'].setValue(_this3.evaluate.weight);\n            if (_this3.access.canoverridegrades) {\n              _this3.evaluateForm.controls['grade'].setValue(_this3.evaluate.grade);\n              _this3.evaluateForm.controls['text'].setValue(_this3.evaluate.text);\n            }\n          }\n        } else if (_this3.workshop.phase == AddonModWorkshopPhase.PHASE_CLOSED && _this3.assessment.gradinggradeoverby) {\n          _this3.evaluateByProfile = yield CoreUser.getProfile(_this3.assessment.gradinggradeoverby, _this3.courseId, true);\n        }\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'core.course.errorgetmodule', true);\n      } finally {\n        _this3.loaded = true;\n      }\n    })();\n  }\n  /**\n   * Force leaving the page, without checking for changes.\n   */\n  forceLeavePage() {\n    this.forceLeave = true;\n    CoreNavigator.back();\n  }\n  /**\n   * Check if data has changed.\n   *\n   * @returns True if changed, false otherwise.\n   */\n  hasEvaluationChanged() {\n    if (!this.loaded || !this.evaluating) {\n      return false;\n    }\n    const inputData = this.evaluateForm.value;\n    if (this.originalEvaluation.weight != inputData.weight) {\n      return true;\n    }\n    if (this.access && this.access.canoverridegrades) {\n      if (this.originalEvaluation.text != inputData.text) {\n        return true;\n      }\n      if (this.originalEvaluation.grade != inputData.grade) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * Convenience function to refresh all the data.\n   *\n   * @returns Resolved when done.\n   */\n  refreshAllData() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      const promises = [];\n      promises.push(AddonModWorkshop.invalidateWorkshopData(_this4.courseId));\n      promises.push(AddonModWorkshop.invalidateWorkshopAccessInformationData(_this4.workshopId));\n      promises.push(AddonModWorkshop.invalidateReviewerAssesmentsData(_this4.workshopId));\n      if (_this4.assessmentId) {\n        promises.push(AddonModWorkshop.invalidateAssessmentFormData(_this4.workshopId, _this4.assessmentId));\n        promises.push(AddonModWorkshop.invalidateAssessmentData(_this4.workshopId, _this4.assessmentId));\n      }\n      try {\n        yield Promise.all(promises);\n      } finally {\n        CoreEvents.trigger(AddonModWorkshopProvider.ASSESSMENT_INVALIDATED, null, _this4.siteId);\n        yield _this4.fetchAssessmentData();\n      }\n    })();\n  }\n  /**\n   * Pull to refresh.\n   *\n   * @param refresher Refresher.\n   */\n  refreshAssessment(refresher) {\n    if (this.loaded) {\n      this.refreshAllData().finally(() => {\n        refresher === null || refresher === void 0 || refresher.complete();\n      });\n    }\n  }\n  /**\n   * Save the assessment evaluation.\n   */\n  saveEvaluation() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      // Check if data has changed.\n      if (_this5.hasEvaluationChanged()) {\n        yield _this5.sendEvaluation();\n      }\n      // Go back.\n      _this5.forceLeavePage();\n    })();\n  }\n  /**\n   * Sends the evaluation to be saved on the server.\n   *\n   * @returns Resolved when done.\n   */\n  sendEvaluation() {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      const modal = yield CoreDomUtils.showModalLoading('core.sending', true);\n      const inputData = _this6.evaluateForm.value;\n      const grade = inputData.grade >= 0 ? String(inputData.grade) : '';\n      // Add some HTML to the message if needed.\n      const text = CoreTextUtils.formatHtmlLines(inputData.text);\n      try {\n        // Try to send it to server.\n        const result = yield AddonModWorkshop.evaluateAssessment(_this6.workshopId, _this6.assessmentId, _this6.courseId, text, inputData.weight, grade);\n        CoreForms.triggerFormSubmittedEvent(_this6.formElement, !!result, _this6.siteId);\n        const data = {\n          workshopId: _this6.workshopId,\n          assessmentId: _this6.assessmentId,\n          userId: _this6.currentUserId\n        };\n        return AddonModWorkshop.invalidateAssessmentData(_this6.workshopId, _this6.assessmentId).finally(() => {\n          CoreEvents.trigger(AddonModWorkshopProvider.ASSESSMENT_SAVED, data, _this6.siteId);\n        });\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'Cannot save assessment evaluation');\n      } finally {\n        modal.dismiss();\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    var _this$syncObserver;\n    this.isDestroyed = true;\n    (_this$syncObserver = this.syncObserver) === null || _this$syncObserver === void 0 || _this$syncObserver.off();\n    // Restore original back functions.\n    CoreSync.unblockOperation(ADDON_MOD_WORKSHOP_COMPONENT, this.workshopId);\n  }\n}\n_class = AddonModWorkshopAssessmentPage;\n_class.ɵfac = function AddonModWorkshopAssessmentPage_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.FormBuilder));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-mod-workshop-assessment-page\"]],\n  viewQuery: function AddonModWorkshopAssessmentPage_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.formElement = _t.first);\n    }\n  },\n  decls: 27,\n  vars: 22,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\", 3, \"hidden\"], [\"fill\", \"clear\", 3, \"click\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\", 4, \"ngIf\"], [3, \"hideUntil\"], [1, \"ion-text-wrap\"], [\"slot\", \"start\", 3, \"user\", \"courseId\", \"userId\", 4, \"ngIf\"], [4, \"ngIf\"], [3, \"core-has-overriden-grade\", 4, \"ngIf\"], [\"class\", \"core-overriden-grade\", 4, \"ngIf\"], [\"color\", \"danger\", 4, \"ngIf\"], [3, \"workshop\", \"access\", \"assessmentId\", \"userId\", \"strategy\", 4, \"ngIf\"], [3, \"formGroup\", 4, \"ngIf\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [\"slot\", \"start\", 3, \"user\", \"courseId\", \"userId\"], [1, \"core-overriden-grade\"], [\"color\", \"danger\"], [3, \"workshop\", \"access\", \"assessmentId\", \"userId\", \"strategy\"], [3, \"formGroup\"], [\"evaluateFormEl\", \"\"], [1, \"item-heading\"], [\"class\", \"ion-text-wrap\", 4, \"ngIf\"], [\"position\", \"stacked\"], [\"core-mark-required\", \"true\"], [\"formControlName\", \"weight\", \"required\", \"true\", \"interface\", \"action-sheet\", 3, \"cancelText\", \"interfaceOptions\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"formControlName\", \"grade\", \"interface\", \"action-sheet\", 3, \"cancelText\", \"interfaceOptions\"], [\"name\", \"text\", \"contextLevel\", \"module\", \"elementId\", \"feedbackreviewer_editor\", 3, \"control\", \"autoSave\", \"contextInstanceId\", \"draftExtraParams\"], [\"class\", \"item-heading\", 4, \"ngIf\"]],\n  template: function AddonModWorkshopAssessmentPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵelement(7, \"core-format-text\", 2);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(8, \"ion-buttons\", 3)(9, \"ion-button\", 4);\n      i0.ɵɵlistener(\"click\", function AddonModWorkshopAssessmentPage_Template_ion_button_click_9_listener() {\n        return ctx.saveEvaluation();\n      });\n      i0.ɵɵtext(10);\n      i0.ɵɵpipe(11, \"translate\");\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelementStart(12, \"ion-content\");\n      i0.ɵɵtemplate(13, AddonModWorkshopAssessmentPage_ion_refresher_13_Template, 3, 4, \"ion-refresher\", 5);\n      i0.ɵɵelementStart(14, \"core-loading\", 6)(15, \"ion-item\", 7);\n      i0.ɵɵtemplate(16, AddonModWorkshopAssessmentPage_core_user_avatar_16_Template, 1, 3, \"core-user-avatar\", 8);\n      i0.ɵɵelementStart(17, \"ion-label\");\n      i0.ɵɵtemplate(18, AddonModWorkshopAssessmentPage_h2_18_Template, 2, 1, \"h2\", 9);\n      i0.ɵɵtemplate(19, AddonModWorkshopAssessmentPage_p_19_Template, 3, 7, \"p\", 9);\n      i0.ɵɵtemplate(20, AddonModWorkshopAssessmentPage_p_20_Template, 3, 9, \"p\", 10);\n      i0.ɵɵtemplate(21, AddonModWorkshopAssessmentPage_p_21_Template, 3, 4, \"p\", 11);\n      i0.ɵɵtemplate(22, AddonModWorkshopAssessmentPage_p_22_Template, 3, 6, \"p\", 9);\n      i0.ɵɵtemplate(23, AddonModWorkshopAssessmentPage_ion_badge_23_Template, 3, 3, \"ion-badge\", 12);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(24, AddonModWorkshopAssessmentPage_addon_mod_workshop_assessment_strategy_24_Template, 1, 5, \"addon-mod-workshop-assessment-strategy\", 13);\n      i0.ɵɵtemplate(25, AddonModWorkshopAssessmentPage_form_25_Template, 17, 11, \"form\", 14);\n      i0.ɵɵtemplate(26, AddonModWorkshopAssessmentPage_ion_list_26_Template, 6, 5, \"ion-list\", 9);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 18, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"text\", ctx.title)(\"contextInstanceId\", ctx.workshop && ctx.workshop.coursemodule)(\"courseId\", ctx.courseId);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"hidden\", !ctx.evaluating);\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(11, 20, \"core.save\"), \" \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", !ctx.evaluating);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"hideUntil\", ctx.loaded);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.profile);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.profile && ctx.profile.fullname);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.workshop && ctx.assessment && ctx.showGrade(ctx.assessment.grade));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.workshop && ctx.access && ctx.access.canviewallsubmissions && ctx.assessment && ctx.showGrade(ctx.assessment.gradinggrade));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.access && ctx.access.canviewallsubmissions && ctx.assessment && ctx.showGrade(ctx.assessment.gradinggradeover));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.assessment && ctx.assessment.weight && ctx.assessment.weight !== 1);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.assessment || !ctx.showGrade(ctx.assessment.grade));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.assessment && ctx.assessmentId && ctx.showGrade(ctx.assessment.grade) && ctx.workshop && ctx.access);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.evaluating);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.evaluating && ctx.evaluate && ctx.evaluate.text);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.CoreLoadingComponent, i4.CoreMarkRequiredComponent, i5.CoreUserAvatarComponent, i6.CoreFormatTextDirective, i7.CoreContentDirective, i8.CoreUpdateNonReactiveAttributesDirective, i1.ɵNgNoValidate, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i9.IonBadge, i9.IonButton, i9.IonButtons, i9.IonContent, i9.IonHeader, i9.IonItem, i9.IonLabel, i9.IonList, i9.IonRefresher, i9.IonRefresherContent, i9.IonSelect, i9.IonSelectOption, i9.IonTitle, i9.IonToolbar, i9.SelectValueAccessor, i9.IonBackButton, i1.FormGroupDirective, i1.FormControlName, i10.AddonModWorkshopAssessmentStrategyComponent, i11.CoreEditorRichTextEditorComponent, i12.TranslatePipe],\n  encapsulation: 2\n});","map":{"version":3,"names":["FormGroup","Validators","CoreCourse","CoreGradesHelper","CoreUser","CoreNavigator","CoreSites","CoreSync","CoreDomUtils","CoreTextUtils","Translate","CoreEvents","CoreForms","AddonModWorkshop","AddonModWorkshopPhase","AddonModWorkshopProvider","AddonModWorkshopHelper","AddonModWorkshopOffline","AddonModWorkshopSyncProvider","CoreTime","CoreAnalytics","CoreAnalyticsEventType","ADDON_MOD_WORKSHOP_COMPONENT","i0","ɵɵelementStart","ɵɵlistener","AddonModWorkshopAssessmentPage_ion_refresher_13_Template_ion_refresher_ionRefresh_0_listener","$event","ɵɵrestoreView","_r12","ctx_r11","ɵɵnextContext","ɵɵresetView","refreshAssessment","target","ɵɵelement","ɵɵelementEnd","ɵɵproperty","ctx_r0","loaded","ɵɵadvance","ɵɵpropertyInterpolate","ɵɵpipeBind1","ctx_r1","profile","courseId","id","ɵɵtext","ɵɵtextInterpolate","ctx_r2","fullname","ɵɵtextInterpolate2","ɵɵpipeBind2","ɵɵpureFunction1","_c1","ctx_r3","workshop","grade","assessment","ɵɵclassProp","ctx_r4","showGrade","gradinggrade","ctx_r5","gradinggradeover","ɵɵtextInterpolate1","ctx_r6","weight","ctx_r8","access","assessmentId","strategy","w_r18","ɵɵtemplate","AddonModWorkshopAssessmentPage_form_25_ion_item_7_ion_select_option_8_Template","_c2","ctx_r14","weights","grade_r20","value","label","AddonModWorkshopAssessmentPage_form_25_ion_item_15_ion_select_option_7_Template","ctx_r15","evaluationGrades","ctx_r16","evaluateForm","controls","coursemodule","_c3","AddonModWorkshopAssessmentPage_form_25_ion_item_7_Template","AddonModWorkshopAssessmentPage_form_25_ion_item_15_Template","AddonModWorkshopAssessmentPage_form_25_ion_item_16_Template","ctx_r9","canallocate","gradingGrade","canoverridegrades","ctx_r21","evaluateByProfile","ctx_r22","AddonModWorkshopAssessmentPage_ion_list_26_core_user_avatar_2_Template","AddonModWorkshopAssessmentPage_ion_list_26_h3_4_Template","ctx_r10","evaluate","text","AddonModWorkshopAssessmentPage","constructor","fb","_this","evaluating","title","originalEvaluation","hasOffline","isDestroyed","forceLeave","siteId","getCurrentSiteId","currentUserId","getCurrentSiteUserId","addControl","control","required","syncObserver","on","AUTO_SYNCED","data","workshopId","refreshAllData","logView","once","_asyncToGenerator","logEvent","type","VIEW_ITEM","ws","name","assessmentid","category","url","ngOnInit","getRequiredRouteParam","submission","getRouteParam","getRequiredRouteNumberParam","error","showErrorModal","back","workshopid","fetchAssessmentData","canLeave","_this2","hasEvaluationChanged","showConfirm","instant","triggerFormCancelledEvent","formElement","_this3","_this3$profile","_this3$assessment$gra","getWorkshopById","gradeInfo","getModuleBasicGradeInfo","maxGrade","getWorkshopAccessInformation","cmId","blockOperation","phase","PHASE_CLOSED","getReviewerAssessmentById","userId","realGradeValue","feedbackreviewer","i","defaultGrade","makeGradesMenu","undefined","offlineAssess","getEvaluateAssessment","feedbacktext","parseInt","_unused","String","setValue","gradinggradeoverby","getProfile","showErrorModalDefault","forceLeavePage","inputData","_this4","promises","push","invalidateWorkshopData","invalidateWorkshopAccessInformationData","invalidateReviewerAssesmentsData","invalidateAssessmentFormData","invalidateAssessmentData","Promise","all","trigger","ASSESSMENT_INVALIDATED","refresher","finally","complete","saveEvaluation","_this5","sendEvaluation","_this6","modal","showModalLoading","formatHtmlLines","result","evaluateAssessment","triggerFormSubmittedEvent","ASSESSMENT_SAVED","dismiss","ngOnDestroy","_this$syncObserver","off","unblockOperation","ɵɵdirectiveInject","i1","FormBuilder","selectors","viewQuery","AddonModWorkshopAssessmentPage_Query","rf","ctx","AddonModWorkshopAssessmentPage_Template_ion_button_click_9_listener","AddonModWorkshopAssessmentPage_ion_refresher_13_Template","AddonModWorkshopAssessmentPage_core_user_avatar_16_Template","AddonModWorkshopAssessmentPage_h2_18_Template","AddonModWorkshopAssessmentPage_p_19_Template","AddonModWorkshopAssessmentPage_p_20_Template","AddonModWorkshopAssessmentPage_p_21_Template","AddonModWorkshopAssessmentPage_p_22_Template","AddonModWorkshopAssessmentPage_ion_badge_23_Template","AddonModWorkshopAssessmentPage_addon_mod_workshop_assessment_strategy_24_Template","AddonModWorkshopAssessmentPage_form_25_Template","AddonModWorkshopAssessmentPage_ion_list_26_Template","canviewallsubmissions"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/workshop/pages/assessment/assessment.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/workshop/pages/assessment/assessment.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit, OnDestroy, ViewChild, ElementRef } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreGradesHelper, CoreGradesMenuItem } from '@features/grades/services/grades-helper';\nimport { CoreUser, CoreUserProfile } from '@features/user/services/user';\nimport { CanLeave } from '@guards/can-leave';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreSync } from '@services/sync';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { Translate } from '@singletons';\nimport { CoreEventObserver, CoreEvents } from '@singletons/events';\nimport { CoreForms } from '@singletons/form';\nimport {\n    AddonModWorkshop,\n    AddonModWorkshopAssessmentSavedChangedEventData,\n    AddonModWorkshopData,\n    AddonModWorkshopGetWorkshopAccessInformationWSResponse,\n    AddonModWorkshopPhase,\n    AddonModWorkshopProvider,\n    AddonModWorkshopSubmissionData,\n} from '../../services/workshop';\nimport { AddonModWorkshopHelper, AddonModWorkshopSubmissionAssessmentWithFormData } from '../../services/workshop-helper';\nimport { AddonModWorkshopOffline } from '../../services/workshop-offline';\nimport { AddonModWorkshopSyncProvider } from '../../services/workshop-sync';\nimport { CoreTime } from '@singletons/time';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { ADDON_MOD_WORKSHOP_COMPONENT } from '@addons/mod/workshop/constants';\n\n/**\n * Page that displays a workshop assessment.\n */\n@Component({\n    selector: 'page-addon-mod-workshop-assessment-page',\n    templateUrl: 'assessment.html',\n})\nexport class AddonModWorkshopAssessmentPage implements OnInit, OnDestroy, CanLeave {\n\n    @ViewChild('evaluateFormEl') formElement!: ElementRef;\n\n    assessment!: AddonModWorkshopSubmissionAssessmentWithFormData;\n    submission!: AddonModWorkshopSubmissionData;\n    profile?: CoreUserProfile;\n    courseId!: number;\n    access?: AddonModWorkshopGetWorkshopAccessInformationWSResponse;\n    assessmentId!: number;\n    evaluating = false;\n    loaded = false;\n    showGrade: (grade?: string | number) => boolean;\n    evaluateForm: FormGroup;\n    maxGrade?: number;\n    workshop?: AddonModWorkshopData;\n    strategy?: string;\n    title = '';\n    evaluate: AddonModWorkshopAssessmentEvaluation = {\n        text: '',\n        grade: -1,\n        weight: 1,\n    };\n\n    weights: number[] = [];\n    evaluateByProfile?: CoreUserProfile;\n    evaluationGrades: CoreGradesMenuItem[] = [];\n    gradingGrade?: string | number;\n\n    protected workshopId!: number;\n    protected originalEvaluation: AddonModWorkshopAssessmentEvaluation = {\n        text: '',\n        grade: -1,\n        weight: 1,\n    };\n\n    protected hasOffline = false;\n    protected syncObserver: CoreEventObserver;\n    protected isDestroyed = false;\n    protected siteId: string;\n    protected currentUserId: number;\n    protected forceLeave = false;\n    protected logView: () => void;\n\n    constructor(\n        protected fb: FormBuilder,\n    ) {\n        this.siteId = CoreSites.getCurrentSiteId();\n        this.currentUserId = CoreSites.getCurrentSiteUserId();\n\n        this.showGrade = AddonModWorkshopHelper.showGrade;\n\n        this.evaluateForm = new FormGroup({});\n        this.evaluateForm.addControl('weight', this.fb.control('', Validators.required));\n        this.evaluateForm.addControl('grade', this.fb.control(''));\n        this.evaluateForm.addControl('text', this.fb.control(''));\n\n        // Refresh workshop on sync.\n        this.syncObserver = CoreEvents.on(AddonModWorkshopSyncProvider.AUTO_SYNCED, (data) => {\n            // Update just when all database is synced.\n            if (this.workshopId === data.workshopId) {\n                this.loaded = false;\n                this.refreshAllData();\n            }\n        }, this.siteId);\n\n        this.logView = CoreTime.once(async () => {\n            if (!this.workshop) {\n                return;\n            }\n\n            CoreAnalytics.logEvent({\n                type: CoreAnalyticsEventType.VIEW_ITEM,\n                ws: 'mod_workshop_get_assessment',\n                name: this.workshop.name,\n                data: { id: this.workshop.id, assessmentid: this.assessment.id, category: 'workshop' },\n                url: `/mod/workshop/assessment.php?asid=${this.assessment.id}`,\n            });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        try {\n            this.assessment = CoreNavigator.getRequiredRouteParam<AddonModWorkshopSubmissionAssessmentWithFormData>('assessment');\n            this.submission = CoreNavigator.getRequiredRouteParam<AddonModWorkshopSubmissionData>('submission');\n            this.profile = CoreNavigator.getRouteParam<CoreUserProfile>('profile');\n            this.courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n\n            CoreNavigator.back();\n\n            return;\n        }\n\n        this.assessmentId = this.assessment.id;\n        this.workshopId = this.submission.workshopid;\n\n        this.fetchAssessmentData();\n    }\n\n    /**\n     * Check if we can leave the page or not.\n     *\n     * @returns Resolved if we can leave it, rejected if not.\n     */\n    async canLeave(): Promise<boolean> {\n        if (this.forceLeave || !this.evaluating) {\n            return true;\n        }\n\n        if (!this.hasEvaluationChanged()) {\n            return true;\n        }\n\n        // Show confirmation if some data has been modified.\n        await CoreDomUtils.showConfirm(Translate.instant('core.confirmcanceledit'));\n\n        CoreForms.triggerFormCancelledEvent(this.formElement, this.siteId);\n\n        return true;\n    }\n\n    /**\n     * Fetch the assessment data.\n     *\n     * @returns Resolved when done.\n     */\n    protected async fetchAssessmentData(): Promise<void> {\n        try {\n            this.workshop = await AddonModWorkshop.getWorkshopById(this.courseId, this.workshopId);\n            this.title = this.workshop.name;\n            this.strategy = this.workshop.strategy;\n\n            const gradeInfo = await CoreCourse.getModuleBasicGradeInfo(this.workshop.coursemodule);\n            this.maxGrade = gradeInfo?.grade;\n\n            this.access = await AddonModWorkshop.getWorkshopAccessInformation(\n                this.workshopId,\n                { cmId: this.workshop.coursemodule },\n            );\n\n            // Load Weights selector.\n            if (this.assessmentId && (this.access.canallocate || this.access.canoverridegrades)) {\n                if (!this.isDestroyed) {\n                    // Block the workshop.\n                    CoreSync.blockOperation(ADDON_MOD_WORKSHOP_COMPONENT, this.workshopId);\n                }\n\n                this.evaluating = true;\n            } else {\n                this.evaluating = false;\n            }\n\n            if (!this.evaluating && this.workshop.phase != AddonModWorkshopPhase.PHASE_CLOSED) {\n                return;\n            }\n\n            // Get all info of the assessment.\n            const assessment = await AddonModWorkshopHelper.getReviewerAssessmentById(this.workshopId, this.assessmentId, {\n                userId: this.profile?.id,\n                cmId: this.workshop.coursemodule,\n            });\n\n            this.assessment = AddonModWorkshopHelper.realGradeValue(this.workshop, assessment);\n            this.evaluate.text = this.assessment.feedbackreviewer || '';\n            this.evaluate.weight = this.assessment.weight;\n            this.gradingGrade = this.assessment.gradinggrade ?? '-';\n\n            if (this.evaluating) {\n                if (this.access.canallocate) {\n                    this.weights = [];\n                    for (let i = 16; i >= 0; i--) {\n                        this.weights[i] = i;\n                    }\n                }\n\n                if (this.access.canoverridegrades) {\n                    const defaultGrade = Translate.instant('addon.mod_workshop.notoverridden');\n                    this.evaluationGrades =\n                        await CoreGradesHelper.makeGradesMenu(this.workshop.gradinggrade, undefined, defaultGrade, -1);\n                }\n\n                try {\n                    const offlineAssess = await AddonModWorkshopOffline.getEvaluateAssessment(this.workshopId, this.assessmentId);\n                    this.hasOffline = true;\n                    this.evaluate.weight = offlineAssess.weight;\n                    if (this.access.canoverridegrades) {\n                        this.evaluate.text = offlineAssess.feedbacktext || '';\n                        this.evaluate.grade = parseInt(offlineAssess.gradinggradeover, 10) || -1;\n                    }\n                } catch {\n                    this.hasOffline = false;\n                    // No offline, load online.\n                    if (this.access.canoverridegrades) {\n                        this.evaluate.text = this.assessment.feedbackreviewer || '';\n                        this.evaluate.grade = parseInt(String(this.assessment.gradinggradeover), 10) || -1;\n                    }\n                } finally {\n                    this.originalEvaluation.weight = this.evaluate.weight;\n                    if (this.access.canoverridegrades) {\n                        this.originalEvaluation.text = this.evaluate.text;\n                        this.originalEvaluation.grade = this.evaluate.grade;\n                    }\n\n                    this.evaluateForm.controls['weight'].setValue(this.evaluate.weight);\n                    if (this.access.canoverridegrades) {\n                        this.evaluateForm.controls['grade'].setValue(this.evaluate.grade);\n                        this.evaluateForm.controls['text'].setValue(this.evaluate.text);\n                    }\n                }\n\n            } else if (this.workshop.phase == AddonModWorkshopPhase.PHASE_CLOSED && this.assessment.gradinggradeoverby) {\n                this.evaluateByProfile = await CoreUser.getProfile(this.assessment.gradinggradeoverby, this.courseId, true);\n            }\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'core.course.errorgetmodule', true);\n        } finally {\n            this.loaded = true;\n        }\n    }\n\n    /**\n     * Force leaving the page, without checking for changes.\n     */\n    protected forceLeavePage(): void {\n        this.forceLeave = true;\n        CoreNavigator.back();\n    }\n\n    /**\n     * Check if data has changed.\n     *\n     * @returns True if changed, false otherwise.\n     */\n    protected hasEvaluationChanged(): boolean {\n        if (!this.loaded || !this.evaluating) {\n            return false;\n        }\n\n        const inputData = this.evaluateForm.value;\n\n        if (this.originalEvaluation.weight != inputData.weight) {\n            return true;\n        }\n\n        if (this.access && this.access.canoverridegrades) {\n            if (this.originalEvaluation.text != inputData.text) {\n                return true;\n            }\n\n            if (this.originalEvaluation.grade != inputData.grade) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Convenience function to refresh all the data.\n     *\n     * @returns Resolved when done.\n     */\n    protected async refreshAllData(): Promise<void> {\n        const promises: Promise<void>[] = [];\n\n        promises.push(AddonModWorkshop.invalidateWorkshopData(this.courseId));\n        promises.push(AddonModWorkshop.invalidateWorkshopAccessInformationData(this.workshopId));\n        promises.push(AddonModWorkshop.invalidateReviewerAssesmentsData(this.workshopId));\n\n        if (this.assessmentId) {\n            promises.push(AddonModWorkshop.invalidateAssessmentFormData(this.workshopId, this.assessmentId));\n            promises.push(AddonModWorkshop.invalidateAssessmentData(this.workshopId, this.assessmentId));\n        }\n\n        try {\n            await Promise.all(promises);\n        } finally {\n            CoreEvents.trigger(AddonModWorkshopProvider.ASSESSMENT_INVALIDATED, null, this.siteId);\n\n            await this.fetchAssessmentData();\n        }\n    }\n\n    /**\n     * Pull to refresh.\n     *\n     * @param refresher Refresher.\n     */\n    refreshAssessment(refresher: HTMLIonRefresherElement): void {\n        if (this.loaded) {\n            this.refreshAllData().finally(() => {\n                refresher?.complete();\n            });\n        }\n    }\n\n    /**\n     * Save the assessment evaluation.\n     */\n    async saveEvaluation(): Promise<void> {\n        // Check if data has changed.\n        if (this.hasEvaluationChanged()) {\n            await this.sendEvaluation();\n        }\n\n        // Go back.\n        this.forceLeavePage();\n    }\n\n    /**\n     * Sends the evaluation to be saved on the server.\n     *\n     * @returns Resolved when done.\n     */\n    protected async sendEvaluation(): Promise<void> {\n        const modal = await CoreDomUtils.showModalLoading('core.sending', true);\n        const inputData: AddonModWorkshopAssessmentEvaluation = this.evaluateForm.value;\n\n        const grade = inputData.grade >= 0 ? String(inputData.grade) : '';\n        // Add some HTML to the message if needed.\n        const text = CoreTextUtils.formatHtmlLines(inputData.text);\n\n        try {\n            // Try to send it to server.\n            const result = await AddonModWorkshop.evaluateAssessment(\n                this.workshopId,\n                this.assessmentId,\n                this.courseId,\n                text,\n                inputData.weight,\n                grade,\n            );\n\n            CoreForms.triggerFormSubmittedEvent(this.formElement, !!result, this.siteId);\n\n            const data: AddonModWorkshopAssessmentSavedChangedEventData = {\n                workshopId: this.workshopId,\n                assessmentId: this.assessmentId,\n                userId: this.currentUserId,\n            };\n\n            return AddonModWorkshop.invalidateAssessmentData(this.workshopId, this.assessmentId).finally(() => {\n                CoreEvents.trigger(AddonModWorkshopProvider.ASSESSMENT_SAVED, data, this.siteId);\n            });\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Cannot save assessment evaluation');\n        } finally {\n            modal.dismiss();\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        this.isDestroyed = true;\n\n        this.syncObserver?.off();\n        // Restore original back functions.\n        CoreSync.unblockOperation(ADDON_MOD_WORKSHOP_COMPONENT, this.workshopId);\n    }\n\n}\n\ntype AddonModWorkshopAssessmentEvaluation = {\n    text: string;\n    grade: number;\n    weight: number;\n};\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>\n                <core-format-text [text]=\"title\" contextLevel=\"module\" [contextInstanceId]=\"workshop && workshop.coursemodule\"\n                    [courseId]=\"courseId\" />\n            </h1>\n        </ion-title>\n        <ion-buttons slot=\"end\" [hidden]=\"!evaluating\">\n            <ion-button fill=\"clear\" (click)=\"saveEvaluation()\">\n                {{ 'core.save' | translate }}\n            </ion-button>\n        </ion-buttons>\n    </ion-toolbar>\n</ion-header>\n<ion-content>\n    <ion-refresher slot=\"fixed\" [disabled]=\"!loaded\" (ionRefresh)=\"refreshAssessment($event.target)\" *ngIf=\"!evaluating\">\n        <ion-refresher-content pullingText=\"{{ 'core.pulltorefresh' | translate }}\" />\n    </ion-refresher>\n    <core-loading [hideUntil]=\"loaded\">\n\n        <ion-item class=\"ion-text-wrap\">\n            <core-user-avatar *ngIf=\"profile\" [user]=\"profile\" slot=\"start\" [courseId]=\"courseId\" [userId]=\"profile.id\" />\n\n            <ion-label>\n                <h2 *ngIf=\"profile && profile.fullname\">{{profile.fullname}}</h2>\n\n                <p *ngIf=\"workshop && assessment && showGrade(assessment.grade)\">\n                    {{ 'addon.mod_workshop.submissiongradeof' | translate:{$a: workshop.grade } }}: {{assessment.grade}}\n                </p>\n                <p *ngIf=\"workshop && access && access.canviewallsubmissions && assessment && showGrade(assessment.gradinggrade)\"\n                    [class.core-has-overriden-grade]=\" showGrade(assessment.gradinggrade)\">\n                    {{ 'addon.mod_workshop.gradinggradeof' | translate:{$a: workshop.gradinggrade } }}: {{assessment.gradinggrade}}\n                </p>\n                <p *ngIf=\"access && access.canviewallsubmissions && assessment && showGrade(assessment.gradinggradeover)\"\n                    class=\"core-overriden-grade\">\n                    {{ 'addon.mod_workshop.gradinggradeover' | translate }}: {{assessment.gradinggradeover}}\n                </p>\n                <p *ngIf=\"assessment && assessment.weight && assessment.weight !== 1\">\n                    {{ 'addon.mod_workshop.weightinfo' | translate:{$a: assessment.weight } }}\n                </p>\n                <ion-badge *ngIf=\"!assessment || !showGrade(assessment.grade)\" color=\"danger\">\n                    {{ 'addon.mod_workshop.notassessed' | translate }}\n                </ion-badge>\n            </ion-label>\n        </ion-item>\n\n        <addon-mod-workshop-assessment-strategy *ngIf=\"assessment && assessmentId && showGrade(assessment.grade) && workshop && access\"\n            [workshop]=\"workshop\" [access]=\"access\" [assessmentId]=\"assessmentId\" [userId]=\"profile && profile.id\" [strategy]=\"strategy\" />\n\n        <form [formGroup]=\"evaluateForm\" *ngIf=\"evaluating\" #evaluateFormEl>\n            <ion-item class=\"ion-text-wrap\">\n                <ion-label>\n                    <h3 class=\"item-heading\">{{ 'addon.mod_workshop.assessmentsettings' | translate }}</h3>\n                </ion-label>\n            </ion-item>\n            <ion-item class=\"ion-text-wrap\" *ngIf=\"access?.canallocate\">\n                <ion-label position=\"stacked\">\n                    <span core-mark-required=\"true\">\n                        {{ 'addon.mod_workshop.assessmentweight' | translate }}\n                    </span>\n                </ion-label>\n                <ion-select formControlName=\"weight\" required=\"true\" interface=\"action-sheet\" [cancelText]=\"'core.cancel' | translate\"\n                    [interfaceOptions]=\"{header: 'addon.mod_workshop.assessmentweight' | translate}\">\n                    <ion-select-option *ngFor=\"let w of weights\" [value]=\"w\">{{ w }}</ion-select-option>\n                </ion-select>\n            </ion-item>\n            <ion-item class=\"ion-text-wrap\">\n                <ion-label>\n                    <h3 class=\"item-heading\">{{ 'addon.mod_workshop.gradinggradecalculated' | translate }}</h3>\n                    <p>{{ gradingGrade }}</p>\n                </ion-label>\n            </ion-item>\n            <ion-item class=\"ion-text-wrap\" *ngIf=\"access?.canoverridegrades\">\n                <ion-label position=\"stacked\">{{ 'addon.mod_workshop.gradinggradeover' | translate }}</ion-label>\n                <ion-select formControlName=\"grade\" interface=\"action-sheet\" [cancelText]=\"'core.cancel' | translate\"\n                    [interfaceOptions]=\"{header: 'addon.mod_workshop.gradinggradeover' | translate}\">\n                    <ion-select-option *ngFor=\"let grade of evaluationGrades\" [value]=\"grade.value\">\n                        {{grade.label}}\n                    </ion-select-option>\n                </ion-select>\n            </ion-item>\n            <ion-item *ngIf=\"access?.canoverridegrades\">\n                <ion-label position=\"stacked\">{{ 'addon.mod_workshop.feedbackreviewer' | translate }}</ion-label>\n                <core-rich-text-editor [control]=\"evaluateForm.controls['text']\" name=\"text\" [autoSave]=\"true\" contextLevel=\"module\"\n                    [contextInstanceId]=\"workshop?.coursemodule\" elementId=\"feedbackreviewer_editor\"\n                    [draftExtraParams]=\"{asid: assessmentId}\" />\n            </ion-item>\n        </form>\n        <ion-list *ngIf=\"!evaluating && evaluate && evaluate.text\">\n            <ion-item class=\"ion-text-wrap\">\n                <core-user-avatar *ngIf=\"evaluateByProfile\" [user]=\"evaluateByProfile\" slot=\"start\" [courseId]=\"courseId\"\n                    [userId]=\"evaluateByProfile.id\" />\n                <ion-label>\n                    <h3 class=\"item-heading\" *ngIf=\"evaluateByProfile && evaluateByProfile.fullname\">\n                        {{ 'addon.mod_workshop.feedbackby' | translate : {$a: evaluateByProfile.fullname} }}\n                    </h3>\n                    <core-format-text [text]=\"evaluate.text\" contextLevel=\"module\" [contextInstanceId]=\"workshop?.coursemodule\"\n                        [courseId]=\"courseId\" />\n                </ion-label>\n            </ion-item>\n        </ion-list>\n    </core-loading>\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}