{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { COURSE_PAGE_NAME } from '@features/course/course.module';\nimport { CoreGrades } from '@features/grades/services/grades';\nimport { CoreUserDelegateContext, CoreUserDelegateService } from '@features/user/services/user-delegate';\nimport { PARTICIPANTS_PAGE_NAME } from '@features/user/user.module';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { makeSingleton } from '@singletons';\nimport { GRADES_PAGE_NAME } from '../grades-helper';\nimport * as i0 from \"@angular/core\";\n/**\n * Profile grades handler.\n */\nexport class CoreGradesUserHandlerService {\n  constructor() {\n    this.name = 'CoreGrades'; // This name doesn't match any disabled feature, they'll be checked in isEnabledForContext.\n    this.priority = 500;\n    this.type = CoreUserDelegateService.TYPE_NEW_PAGE;\n    this.cacheEnabled = true;\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return _asyncToGenerator(function* () {\n      return true;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForContext(context, courseId) {\n    return _asyncToGenerator(function* () {\n      // Check if feature is disabled.\n      const currentSite = CoreSites.getCurrentSite();\n      if (!currentSite) {\n        return false;\n      }\n      if (context === CoreUserDelegateContext.USER_MENU) {\n        // This option used to belong to main menu, check the original disabled feature value.\n        if (currentSite.isFeatureDisabled('CoreMainMenuDelegate_CoreGrades')) {\n          return false;\n        }\n      } else if (currentSite.isFeatureDisabled('CoreUserDelegate_CoreGrades:viewGrades')) {\n        return false;\n      }\n      if (context === CoreUserDelegateContext.COURSE) {\n        return CoreUtils.ignoreErrors(CoreGrades.isPluginEnabledForCourse(courseId), false);\n      } else {\n        return CoreGrades.isCourseGradesEnabled();\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForUser(user, context, contextId) {\n    return _asyncToGenerator(function* () {\n      if (context === CoreUserDelegateContext.COURSE) {\n        return CoreUtils.promiseWorks(CoreGrades.getCourseGradesTable(contextId, user.id));\n      }\n      // All course grades only available for the current user.\n      return user.id == CoreSites.getCurrentSiteUserId();\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData(user, context) {\n    if (context === CoreUserDelegateContext.COURSE) {\n      return {\n        icon: 'fas-chart-bar',\n        title: 'core.grades.grades',\n        class: 'core-grades-user-handler',\n        action: (event, user, context, contextId) => {\n          event.preventDefault();\n          event.stopPropagation();\n          CoreNavigator.navigateToSitePath([COURSE_PAGE_NAME, contextId, PARTICIPANTS_PAGE_NAME, user.id, GRADES_PAGE_NAME].join('/'));\n        }\n      };\n    } else {\n      return {\n        icon: 'fas-chart-bar',\n        title: 'core.grades.grades',\n        class: 'core-grades-coursesgrades-handler',\n        action: event => {\n          event.preventDefault();\n          event.stopPropagation();\n          CoreNavigator.navigateToSitePath(GRADES_PAGE_NAME);\n        }\n      };\n    }\n  }\n}\n_class = CoreGradesUserHandlerService;\n_class.ɵfac = function CoreGradesUserHandlerService_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const CoreGradesUserHandler = makeSingleton(CoreGradesUserHandlerService);","map":{"version":3,"names":["COURSE_PAGE_NAME","CoreGrades","CoreUserDelegateContext","CoreUserDelegateService","PARTICIPANTS_PAGE_NAME","CoreNavigator","CoreSites","CoreUtils","makeSingleton","GRADES_PAGE_NAME","CoreGradesUserHandlerService","constructor","name","priority","type","TYPE_NEW_PAGE","cacheEnabled","isEnabled","_asyncToGenerator","isEnabledForContext","context","courseId","currentSite","getCurrentSite","USER_MENU","isFeatureDisabled","COURSE","ignoreErrors","isPluginEnabledForCourse","isCourseGradesEnabled","isEnabledForUser","user","contextId","promiseWorks","getCourseGradesTable","id","getCurrentSiteUserId","getDisplayData","icon","title","class","action","event","preventDefault","stopPropagation","navigateToSitePath","join","factory","ɵfac","providedIn","CoreGradesUserHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/grades/services/handlers/user.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Injectable } from '@angular/core';\nimport { COURSE_PAGE_NAME } from '@features/course/course.module';\n\nimport { CoreGrades } from '@features/grades/services/grades';\nimport { CoreUserProfile } from '@features/user/services/user';\nimport {\n    CoreUserDelegateContext,\n    CoreUserDelegateService ,\n    CoreUserProfileHandler,\n    CoreUserProfileHandlerData,\n} from '@features/user/services/user-delegate';\nimport { PARTICIPANTS_PAGE_NAME } from '@features/user/user.module';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { makeSingleton } from '@singletons';\nimport { GRADES_PAGE_NAME } from '../grades-helper';\n\n/**\n * Profile grades handler.\n */\n@Injectable({ providedIn: 'root' })\nexport class CoreGradesUserHandlerService implements CoreUserProfileHandler {\n\n    name = 'CoreGrades'; // This name doesn't match any disabled feature, they'll be checked in isEnabledForContext.\n    priority = 500;\n    type = CoreUserDelegateService.TYPE_NEW_PAGE;\n    cacheEnabled = true;\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabled(): Promise<boolean> {\n        return true;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForContext(context: CoreUserDelegateContext, courseId: number): Promise<boolean> {\n        // Check if feature is disabled.\n        const currentSite = CoreSites.getCurrentSite();\n        if (!currentSite) {\n            return false;\n        }\n\n        if (context === CoreUserDelegateContext.USER_MENU) {\n            // This option used to belong to main menu, check the original disabled feature value.\n            if (currentSite.isFeatureDisabled('CoreMainMenuDelegate_CoreGrades')) {\n                return false;\n            }\n        } else if (currentSite.isFeatureDisabled('CoreUserDelegate_CoreGrades:viewGrades')) {\n            return false;\n        }\n\n        if (context === CoreUserDelegateContext.COURSE) {\n            return CoreUtils.ignoreErrors(CoreGrades.isPluginEnabledForCourse(courseId), false);\n        } else {\n            return CoreGrades.isCourseGradesEnabled();\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForUser(user: CoreUserProfile, context: CoreUserDelegateContext, contextId: number): Promise<boolean> {\n        if (context === CoreUserDelegateContext.COURSE) {\n            return CoreUtils.promiseWorks(CoreGrades.getCourseGradesTable(contextId, user.id));\n        }\n\n        // All course grades only available for the current user.\n        return user.id == CoreSites.getCurrentSiteUserId();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getDisplayData(user: CoreUserProfile, context: CoreUserDelegateContext): CoreUserProfileHandlerData {\n        if (context === CoreUserDelegateContext.COURSE) {\n            return {\n                icon: 'fas-chart-bar',\n                title: 'core.grades.grades',\n                class: 'core-grades-user-handler',\n                action: (event, user, context, contextId): void => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    CoreNavigator.navigateToSitePath(\n                        [COURSE_PAGE_NAME, contextId, PARTICIPANTS_PAGE_NAME, user.id, GRADES_PAGE_NAME].join('/'),\n                    );\n                },\n            };\n        } else {\n            return {\n                icon: 'fas-chart-bar',\n                title: 'core.grades.grades',\n                class: 'core-grades-coursesgrades-handler',\n                action: (event): void => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    CoreNavigator.navigateToSitePath(GRADES_PAGE_NAME);\n                },\n            };\n        }\n    }\n\n}\n\nexport const CoreGradesUserHandler = makeSingleton(CoreGradesUserHandlerService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}