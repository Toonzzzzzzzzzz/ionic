{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreApp } from '@services/app';\nimport { CoreSites } from '@services/sites';\nimport { Router } from '@singletons';\nimport { CoreConstants } from '../constants';\n/**\n * Guard to check if there is a pending redirect and trigger it.\n *\n * @returns True if there's no redirect, redirection route otherwise.\n */\nexport const redirectGuard = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* () {\n    var _redirect$redirectOpt;\n    const redirect = CoreApp.consumeMemoryRedirect();\n    if (!redirect) {\n      return true;\n    }\n    // Redirect to site path.\n    if (redirect.siteId && redirect.siteId !== CoreConstants.NO_SITE_ID) {\n      const redirectData = {\n        urlToOpen: redirect.urlToOpen\n      };\n      if (redirect.redirectPath !== 'main') {\n        // Only pass redirect path if the page to load isn't the main menu.\n        redirectData.redirectPath = redirect.redirectPath;\n        redirectData.redirectOptions = redirect.redirectOptions;\n      }\n      const loggedIn = yield CoreSites.loadSite(redirect.siteId, redirectData);\n      const route = Router.parseUrl('/main');\n      route.queryParams = redirectData;\n      return loggedIn ? route : true;\n    }\n    // Abort redirect.\n    if (!redirect.redirectPath) {\n      return true;\n    }\n    // Redirect to non-site path.\n    const route = Router.parseUrl(redirect.redirectPath);\n    route.queryParams = ((_redirect$redirectOpt = redirect.redirectOptions) === null || _redirect$redirectOpt === void 0 ? void 0 : _redirect$redirectOpt.params) || {};\n    return route;\n  });\n  return function redirectGuard() {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["CoreApp","CoreSites","Router","CoreConstants","redirectGuard","_ref","_asyncToGenerator","_redirect$redirectOpt","redirect","consumeMemoryRedirect","siteId","NO_SITE_ID","redirectData","urlToOpen","redirectPath","redirectOptions","loggedIn","loadSite","route","parseUrl","queryParams","params","apply","arguments"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/guards/redirect.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { CanActivateFn } from '@angular/router';\nimport { CoreApp } from '@services/app';\nimport { CoreRedirectPayload } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { Router } from '@singletons';\nimport { CoreConstants } from '../constants';\n\n/**\n * Guard to check if there is a pending redirect and trigger it.\n *\n * @returns True if there's no redirect, redirection route otherwise.\n */\nexport const redirectGuard: CanActivateFn = async () => {\n    const redirect = CoreApp.consumeMemoryRedirect();\n        if (!redirect) {\n            return true;\n        }\n\n        // Redirect to site path.\n        if (redirect.siteId && redirect.siteId !== CoreConstants.NO_SITE_ID) {\n            const redirectData: CoreRedirectPayload = {\n                urlToOpen: redirect.urlToOpen,\n            };\n\n            if (redirect.redirectPath !== 'main') {\n                // Only pass redirect path if the page to load isn't the main menu.\n                redirectData.redirectPath = redirect.redirectPath;\n                redirectData.redirectOptions = redirect.redirectOptions;\n            }\n\n            const loggedIn = await CoreSites.loadSite(\n                redirect.siteId,\n                redirectData,\n            );\n            const route = Router.parseUrl('/main');\n\n            route.queryParams = redirectData;\n\n            return loggedIn ? route : true;\n        }\n\n        // Abort redirect.\n        if (!redirect.redirectPath) {\n            return true;\n        }\n\n        // Redirect to non-site path.\n        const route = Router.parseUrl(redirect.redirectPath);\n        route.queryParams = redirect.redirectOptions?.params || {};\n\n        return route;\n};\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,SAASA,OAAO,QAAQ,eAAe;AAEvC,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,MAAM,QAAQ,aAAa;AACpC,SAASC,aAAa,QAAQ,cAAc;AAE5C;;;;;AAKA,OAAO,MAAMC,aAAa;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAkB,aAAW;IAAA,IAAAC,qBAAA;IACnD,MAAMC,QAAQ,GAAGR,OAAO,CAACS,qBAAqB,EAAE;IAC5C,IAAI,CAACD,QAAQ,EAAE;MACX,OAAO,IAAI;;IAGf;IACA,IAAIA,QAAQ,CAACE,MAAM,IAAIF,QAAQ,CAACE,MAAM,KAAKP,aAAa,CAACQ,UAAU,EAAE;MACjE,MAAMC,YAAY,GAAwB;QACtCC,SAAS,EAAEL,QAAQ,CAACK;OACvB;MAED,IAAIL,QAAQ,CAACM,YAAY,KAAK,MAAM,EAAE;QAClC;QACAF,YAAY,CAACE,YAAY,GAAGN,QAAQ,CAACM,YAAY;QACjDF,YAAY,CAACG,eAAe,GAAGP,QAAQ,CAACO,eAAe;;MAG3D,MAAMC,QAAQ,SAASf,SAAS,CAACgB,QAAQ,CACrCT,QAAQ,CAACE,MAAM,EACfE,YAAY,CACf;MACD,MAAMM,KAAK,GAAGhB,MAAM,CAACiB,QAAQ,CAAC,OAAO,CAAC;MAEtCD,KAAK,CAACE,WAAW,GAAGR,YAAY;MAEhC,OAAOI,QAAQ,GAAGE,KAAK,GAAG,IAAI;;IAGlC;IACA,IAAI,CAACV,QAAQ,CAACM,YAAY,EAAE;MACxB,OAAO,IAAI;;IAGf;IACA,MAAMI,KAAK,GAAGhB,MAAM,CAACiB,QAAQ,CAACX,QAAQ,CAACM,YAAY,CAAC;IACpDI,KAAK,CAACE,WAAW,GAAG,EAAAb,qBAAA,GAAAC,QAAQ,CAACO,eAAe,cAAAR,qBAAA,uBAAxBA,qBAAA,CAA0Bc,MAAM,KAAI,EAAE;IAE1D,OAAOH,KAAK;EACpB,CAAC;EAAA,gBAvCYd,aAAaA,CAAA;IAAA,OAAAC,IAAA,CAAAiB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAuCzB"},"metadata":{},"sourceType":"module","externalDependencies":[]}