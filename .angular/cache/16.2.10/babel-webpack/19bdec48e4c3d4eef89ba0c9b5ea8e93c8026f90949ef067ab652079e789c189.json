{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreCourseHelper } from '@features/course/services/course-helper';\nimport * as i0 from \"@angular/core\";\n/**\n * Directive to allow downloading and open the main file of a module.\n * When the item with this directive is clicked, the module will be downloaded (if needed) and opened.\n * This is meant for modules like mod_resource.\n *\n * This directive must receive either a module or a moduleId. If no files are provided, it will use module.contents.\n */\nexport class CoreCourseDownloadModuleMainFileDirective {\n  constructor(element) {\n    this.options = {};\n    this.element = element.nativeElement;\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this = this;\n    this.element.addEventListener('click', /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (ev) {\n        if (!_this.module && !_this.moduleId) {\n          return;\n        }\n        ev.preventDefault();\n        ev.stopPropagation();\n        const modal = yield CoreDomUtils.showModalLoading();\n        const courseId = _this.courseId ? Number(_this.courseId) : undefined;\n        try {\n          if (!_this.module) {\n            const moduleId = Number(_this.moduleId);\n            if (!moduleId) {\n              return;\n            }\n            _this.module = yield CoreCourse.getModule(moduleId, courseId);\n          }\n          const componentId = _this.componentId ? Number(_this.componentId) : _this.module.id;\n          yield CoreCourseHelper.downloadModuleAndOpenFile(_this.module, courseId !== null && courseId !== void 0 ? courseId : _this.module.course, _this.component, componentId, _this.files, undefined, _this.options);\n        } catch (error) {\n          CoreDomUtils.showErrorModalDefault(error, 'core.errordownloading', true);\n        } finally {\n          modal.dismiss();\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n}\n_class = CoreCourseDownloadModuleMainFileDirective;\n_class.ɵfac = function CoreCourseDownloadModuleMainFileDirective_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i0.ElementRef));\n};\n_class.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n  type: _class,\n  selectors: [[\"\", \"core-course-download-module-main-file\", \"\"]],\n  inputs: {\n    module: \"module\",\n    moduleId: \"moduleId\",\n    courseId: \"courseId\",\n    component: \"component\",\n    componentId: \"componentId\",\n    files: \"files\",\n    options: \"options\"\n  }\n});","map":{"version":3,"names":["CoreDomUtils","CoreCourse","CoreCourseHelper","CoreCourseDownloadModuleMainFileDirective","constructor","element","options","nativeElement","ngOnInit","_this","addEventListener","_ref","_asyncToGenerator","ev","module","moduleId","preventDefault","stopPropagation","modal","showModalLoading","courseId","Number","undefined","getModule","componentId","id","downloadModuleAndOpenFile","course","component","files","error","showErrorModalDefault","dismiss","_x","apply","arguments","i0","ɵɵdirectiveInject","ElementRef","selectors","inputs"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/course/directives/download-module-main-file.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Directive, Input, OnInit, ElementRef } from '@angular/core';\n\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreCourse, CoreCourseModuleContentFile } from '@features/course/services/course';\nimport { CoreCourseHelper, CoreCourseModuleData } from '@features/course/services/course-helper';\nimport { CoreUtilsOpenFileOptions } from '@services/utils/utils';\n\n/**\n * Directive to allow downloading and open the main file of a module.\n * When the item with this directive is clicked, the module will be downloaded (if needed) and opened.\n * This is meant for modules like mod_resource.\n *\n * This directive must receive either a module or a moduleId. If no files are provided, it will use module.contents.\n */\n@Directive({\n    selector: '[core-course-download-module-main-file]',\n})\nexport class CoreCourseDownloadModuleMainFileDirective implements OnInit {\n\n    @Input() module?: CoreCourseModuleData; // The module.\n    @Input() moduleId?: string | number; // The module ID. Required if module is not supplied.\n    @Input() courseId?: string | number; // The course ID.\n    @Input() component?: string; // Component to link the file to.\n    @Input() componentId?: string | number; // Component ID to use in conjunction with the component. If not defined, use moduleId.\n    @Input() files?: CoreCourseModuleContentFile[]; // List of files of the module. If not provided, use module.contents.\n    @Input() options?: CoreUtilsOpenFileOptions = {};\n\n    protected element: HTMLElement;\n\n    constructor(element: ElementRef) {\n        this.element = element.nativeElement;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnInit(): void {\n        this.element.addEventListener('click', async (ev: Event) => {\n            if (!this.module && !this.moduleId) {\n                return;\n            }\n\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            const modal = await CoreDomUtils.showModalLoading();\n            const courseId = this.courseId ? Number(this.courseId) : undefined;\n\n            try {\n                if (!this.module) {\n                    const moduleId = Number(this.moduleId);\n                    if (!moduleId) {\n                        return;\n                    }\n\n                    this.module = await CoreCourse.getModule(moduleId, courseId);\n                }\n\n                const componentId = this.componentId ? Number(this.componentId) : this.module.id;\n\n                await CoreCourseHelper.downloadModuleAndOpenFile(\n                    this.module,\n                    courseId ?? this.module.course,\n                    this.component,\n                    componentId,\n                    this.files,\n                    undefined,\n                    this.options,\n                );\n            } catch (error) {\n                CoreDomUtils.showErrorModalDefault(error, 'core.errordownloading', true);\n            } finally {\n                modal.dismiss();\n            }\n        });\n    }\n\n}\n"],"mappings":";;AAgBA,SAASA,YAAY,QAAQ,qBAAqB;AAClD,SAASC,UAAU,QAAqC,kCAAkC;AAC1F,SAASC,gBAAgB,QAA8B,yCAAyC;;AAGhG;;;;;;;AAUA,OAAM,MAAOC,yCAAyC;EAYlDC,YAAYC,OAAmB;IAJtB,KAAAC,OAAO,GAA8B,EAAE;IAK5C,IAAI,CAACD,OAAO,GAAGA,OAAO,CAACE,aAAa;EACxC;EAEA;;;EAGAC,QAAQA,CAAA;IAAA,IAAAC,KAAA;IACJ,IAAI,CAACJ,OAAO,CAACK,gBAAgB,CAAC,OAAO;MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAE,WAAOC,EAAS,EAAI;QACvD,IAAI,CAACJ,KAAI,CAACK,MAAM,IAAI,CAACL,KAAI,CAACM,QAAQ,EAAE;UAChC;;QAGJF,EAAE,CAACG,cAAc,EAAE;QACnBH,EAAE,CAACI,eAAe,EAAE;QAEpB,MAAMC,KAAK,SAASlB,YAAY,CAACmB,gBAAgB,EAAE;QACnD,MAAMC,QAAQ,GAAGX,KAAI,CAACW,QAAQ,GAAGC,MAAM,CAACZ,KAAI,CAACW,QAAQ,CAAC,GAAGE,SAAS;QAElE,IAAI;UACA,IAAI,CAACb,KAAI,CAACK,MAAM,EAAE;YACd,MAAMC,QAAQ,GAAGM,MAAM,CAACZ,KAAI,CAACM,QAAQ,CAAC;YACtC,IAAI,CAACA,QAAQ,EAAE;cACX;;YAGJN,KAAI,CAACK,MAAM,SAASb,UAAU,CAACsB,SAAS,CAACR,QAAQ,EAAEK,QAAQ,CAAC;;UAGhE,MAAMI,WAAW,GAAGf,KAAI,CAACe,WAAW,GAAGH,MAAM,CAACZ,KAAI,CAACe,WAAW,CAAC,GAAGf,KAAI,CAACK,MAAM,CAACW,EAAE;UAEhF,MAAMvB,gBAAgB,CAACwB,yBAAyB,CAC5CjB,KAAI,CAACK,MAAM,EACXM,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAIX,KAAI,CAACK,MAAM,CAACa,MAAM,EAC9BlB,KAAI,CAACmB,SAAS,EACdJ,WAAW,EACXf,KAAI,CAACoB,KAAK,EACVP,SAAS,EACTb,KAAI,CAACH,OAAO,CACf;SACJ,CAAC,OAAOwB,KAAK,EAAE;UACZ9B,YAAY,CAAC+B,qBAAqB,CAACD,KAAK,EAAE,uBAAuB,EAAE,IAAI,CAAC;SAC3E,SAAS;UACNZ,KAAK,CAACc,OAAO,EAAE;;MAEvB,CAAC;MAAA,iBAAAC,EAAA;QAAA,OAAAtB,IAAA,CAAAuB,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;EACN;;SA1DShC,yCAAyC;;mBAAzCA,MAAyC,EAAAiC,EAAA,CAAAC,iBAAA,CAAAD,EAAA,CAAAE,UAAA;AAAA;;QAAzCnC,MAAyC;EAAAoC,SAAA;EAAAC,MAAA;IAAA1B,MAAA;IAAAC,QAAA;IAAAK,QAAA;IAAAQ,SAAA;IAAAJ,WAAA;IAAAK,KAAA;IAAAvB,OAAA;EAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}