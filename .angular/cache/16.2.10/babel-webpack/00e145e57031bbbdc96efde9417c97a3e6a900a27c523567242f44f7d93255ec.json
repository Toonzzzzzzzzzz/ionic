{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreModalComponent } from '@classes/modal-component';\nimport { CorePlatform } from '@services/platform';\nimport { Diagnostic, DomSanitizer, Translate } from '@singletons';\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\nimport { Mp3MediaRecorder } from 'mp3-mediarecorder';\nimport { map, shareReplay, tap } from 'rxjs/operators';\nimport { initAudioEncoderMessage } from '@features/fileuploader/utils/worker-messages';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CAPTURE_ERROR_NO_MEDIA_FILES, CoreCaptureError } from '@classes/errors/captureerror';\nimport { CoreFile, CoreFileProvider } from '@services/file';\nimport { CorePath } from '@singletons/path';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../components/chrono/chrono\";\nimport * as i3 from \"../../../../directives/fa-icon\";\nimport * as i4 from \"../../../../directives/update-non-reactive-attributes\";\nimport * as i5 from \"@ionic/angular\";\nimport * as i6 from \"@features/fileuploader/components/audio-histogram/audio-histogram\";\nimport * as i7 from \"@ngx-translate/core\";\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-button\", 5);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template_ion_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.startRecording());\n    });\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelement(6, \"ion-icon\", 6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 2, \"core.fileuploader.startrecordinginstructions\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(5, 4, \"core.fileuploader.startrecording\"));\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_core_audio_histogram_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-audio-histogram\", 16);\n  }\n  if (rf & 2) {\n    const analyser_r11 = ctx.ngIf;\n    const status_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵproperty(\"analyser\", analyser_r11)(\"paused\", status_r1 !== \"recording-ongoing\");\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 17);\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 0);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r13.pauseRecording());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelement(2, \"ion-icon\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 1, \"core.fileuploader.pauserecording\"));\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 19);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r15.resumeRecording());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelement(2, \"ion-icon\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 1, \"core.fileuploader.resumerecording\"));\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtemplate(1, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_core_audio_histogram_1_Template, 1, 2, \"core-audio-histogram\", 7);\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵelementStart(3, \"div\", 8)(4, \"div\", 9);\n    i0.ɵɵtemplate(5, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_div_5_Template, 1, 0, \"div\", 10);\n    i0.ɵɵelement(6, \"core-chrono\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 12);\n    i0.ɵɵtemplate(8, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template, 3, 3, \"ion-button\", 13);\n    i0.ɵɵtemplate(9, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template, 3, 3, \"ion-button\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 12)(11, \"ion-button\", 0);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template_ion_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.stopRecording());\n    });\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵelement(13, \"ion-icon\", 15);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const status_r1 = i0.ɵɵnextContext().ngIf;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 9, ctx_r3.histogramAnalyzer$));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", status_r1 === \"recording-ongoing\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵclassProp(\"recording\", status_r1 === \"recording-ongoing\");\n    i0.ɵɵproperty(\"running\", status_r1 === \"recording-ongoing\")(\"hours\", false);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", status_r1 === \"recording-ongoing\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", status_r1 === \"recording-paused\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(12, 11, \"core.fileuploader.stoprecording\"));\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_audio_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"audio\", 23);\n    i0.ɵɵelement(1, \"source\", 24);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const recordingUrl_r21 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", recordingUrl_r21, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtemplate(1, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_audio_1_Template, 2, 1, \"audio\", 20);\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵelementStart(3, \"div\", 8)(4, \"div\", 12)(5, \"ion-button\", 19);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r22 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r22.discardRecording());\n    });\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelement(7, \"ion-icon\", 21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 12)(9, \"ion-button\", 22);\n    i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r24 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r24.submit());\n    });\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"translate\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 3, ctx_r4.recordingUrl$));\n    i0.ɵɵadvance(4);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(6, 5, \"core.fileuploader.discardrecording\"));\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(11, 7, \"core.save\"), \" \");\n  }\n}\nfunction CoreFileUploaderAudioRecorderComponent_ng_container_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template, 7, 6, \"div\", 3);\n    i0.ɵɵtemplate(2, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template, 14, 13, \"div\", 3);\n    i0.ɵɵtemplate(3, CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template, 12, 9, \"div\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const status_r1 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", status_r1 === \"empty\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", status_r1.startsWith(\"recording\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", status_r1 === \"done\");\n  }\n}\nexport class CoreFileUploaderAudioRecorderComponent extends CoreModalComponent {\n  constructor(elementRef) {\n    super(elementRef);\n    this.recording = null;\n    this.media$ = new BehaviorSubject(null);\n    this.recording$ = this.media$.pipe(recorderAudioRecording(), shareReplay(), tap(recording => this.recording = recording));\n    this.recordingUrl$ = this.recording$.pipe(map(recording => recording && DomSanitizer.bypassSecurityTrustUrl(recording.url)));\n    this.histogramAnalyzer$ = this.media$.pipe(map(media => {\n      if (!(media !== null && media !== void 0 && media.analyser) || CorePlatform.prefersReducedMotion()) {\n        return null;\n      }\n      return media.analyser;\n    }));\n    this.status$ = combineLatest([this.media$.pipe(recorderStatus(), shareReplay()), this.recording$]).pipe(map(([recordingStatus, recording]) => {\n      if (recordingStatus === 'recording') {\n        return 'recording-ongoing';\n      }\n      if (recordingStatus === 'paused') {\n        return 'recording-paused';\n      }\n      if (recording) {\n        return 'done';\n      }\n      return 'empty';\n    }));\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    var _this$media$$value;\n    const recorder = (_this$media$$value = this.media$.value) === null || _this$media$$value === void 0 ? void 0 : _this$media$$value.recorder;\n    if (recorder && recorder.state !== 'inactive') {\n      recorder.stop();\n    }\n  }\n  /**\n   * Start recording.\n   */\n  startRecording() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const media = yield _this.createMedia();\n        _this.media$.next(media);\n        media.recorder.start();\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n      }\n    })();\n  }\n  /**\n   * Stop recording.\n   */\n  stopRecording() {\n    try {\n      var _this$media$$value2;\n      (_this$media$$value2 = this.media$.value) === null || _this$media$$value2 === void 0 || _this$media$$value2.recorder.stop();\n    } catch (error) {\n      CoreDomUtils.showErrorModal(error);\n    }\n  }\n  /**\n   * Stop recording.\n   */\n  pauseRecording() {\n    try {\n      var _this$media$$value3;\n      (_this$media$$value3 = this.media$.value) === null || _this$media$$value3 === void 0 || _this$media$$value3.recorder.pause();\n    } catch (error) {\n      CoreDomUtils.showErrorModal(error);\n    }\n  }\n  /**\n   * Stop recording.\n   */\n  resumeRecording() {\n    try {\n      var _this$media$$value4;\n      (_this$media$$value4 = this.media$.value) === null || _this$media$$value4 === void 0 || _this$media$$value4.recorder.resume();\n    } catch (error) {\n      CoreDomUtils.showErrorModal(error);\n    }\n  }\n  /**\n   * Discard recording.\n   */\n  discardRecording() {\n    this.media$.next(null);\n  }\n  /**\n   * Dismiss modal without a result.\n   */\n  cancel() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.close(new CoreCaptureError(CAPTURE_ERROR_NO_MEDIA_FILES));\n    })();\n  }\n  /**\n   * Dismiss the modal with the current recording as a result.\n   */\n  submit() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.recording) {\n        return;\n      }\n      try {\n        const fileName = yield CoreFile.getUniqueNameInFolder(CoreFileProvider.TMPFOLDER, 'recording.mp3');\n        const filePath = CorePath.concatenatePaths(CoreFileProvider.TMPFOLDER, fileName);\n        const fileEntry = yield CoreFile.writeFile(filePath, _this3.recording.blob);\n        _this3.close({\n          name: fileEntry.name,\n          fullPath: fileEntry.toURL(),\n          type: 'audio/mpeg'\n        });\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n      }\n    })();\n  }\n  /**\n   * Create media instances.\n   *\n   * @returns Media instances.\n   */\n  createMedia() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      yield _this4.prepareMicrophoneAuthorization();\n      const mediaStream = yield navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n      const audioContext = new window.AudioContext();\n      const source = audioContext.createMediaStreamSource(mediaStream);\n      const analyser = audioContext.createAnalyser();\n      analyser.fftSize = 2048;\n      source.connect(analyser);\n      return {\n        analyser,\n        recorder: new Mp3MediaRecorder(mediaStream, {\n          worker: _this4.startWorker(),\n          audioContext\n        })\n      };\n    })();\n  }\n  /**\n   * Make sure that microphone usage has been authorized.\n   */\n  prepareMicrophoneAuthorization() {\n    return _asyncToGenerator(function* () {\n      if (!CorePlatform.isMobile()) {\n        return;\n      }\n      const status = yield Diagnostic.requestMicrophoneAuthorization();\n      switch (status) {\n        case Diagnostic.permissionStatus.DENIED_ONCE:\n        case Diagnostic.permissionStatus.DENIED_ALWAYS:\n          throw new Error(Translate.instant('core.fileuploader.microphonepermissiondenied'));\n        case Diagnostic.permissionStatus.RESTRICTED:\n          throw new Error(Translate.instant('core.fileuploader.microphonepermissionrestricted'));\n      }\n    })();\n  }\n  /**\n   * Start worker script.\n   *\n   * @returns Worker.\n   */\n  startWorker() {\n    const worker = new Worker('./audio-recorder.worker', {\n      type: 'module'\n    });\n    worker.postMessage(initAudioEncoderMessage({\n      vmsgWasmUrl: `${document.head.baseURI}assets/lib/vmsg/vmsg.wasm`\n    }));\n    return worker;\n  }\n}\n/**\n * Observable operator that listens to a recorder and emits a recording file.\n *\n * @returns Operator.\n */\n_class = CoreFileUploaderAudioRecorderComponent;\n_class.ɵfac = function CoreFileUploaderAudioRecorderComponent_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i0.ElementRef));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"core-fileuploader-audio-recorder\"]],\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 10,\n  vars: 9,\n  consts: [[\"shape\", \"round\", \"fill\", \"clear\", 3, \"click\"], [\"slot\", \"icon-only\", \"name\", \"close\"], [4, \"ngIf\"], [\"class\", \"core-audio-recorder--wrapper\", 4, \"ngIf\"], [1, \"core-audio-recorder--wrapper\"], [\"shape\", \"round\", \"color\", \"danger\", 3, \"click\"], [\"slot\", \"icon-only\", \"name\", \"fas-microphone\"], [3, \"analyser\", \"paused\", 4, \"ngIf\"], [1, \"core-audio-recorder--controls\"], [1, \"core-audio-recorder--control\", \"chrono\"], [\"class\", \"core-audio-recorder--recording-marker\", 4, \"ngIf\"], [3, \"running\", \"hours\"], [1, \"core-audio-recorder--control\"], [\"shape\", \"round\", \"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [\"shape\", \"round\", \"fill\", \"clear\", \"color\", \"danger\", 3, \"click\", 4, \"ngIf\"], [\"slot\", \"icon-only\", \"name\", \"fa-check\"], [3, \"analyser\", \"paused\"], [1, \"core-audio-recorder--recording-marker\"], [\"slot\", \"icon-only\", \"name\", \"fas-circle-pause\"], [\"shape\", \"round\", \"fill\", \"clear\", \"color\", \"danger\", 3, \"click\"], [\"controls\", \"\", \"controlsList\", \"nodownload\", 4, \"ngIf\"], [\"slot\", \"icon-only\", \"name\", \"fas-trash\"], [3, \"click\"], [\"controls\", \"\", \"controlsList\", \"nodownload\"], [3, \"src\"]],\n  template: function CoreFileUploaderAudioRecorderComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"header\")(1, \"h1\");\n      i0.ɵɵtext(2);\n      i0.ɵɵpipe(3, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"ion-button\", 0);\n      i0.ɵɵlistener(\"click\", function CoreFileUploaderAudioRecorderComponent_Template_ion_button_click_4_listener() {\n        return ctx.cancel();\n      });\n      i0.ɵɵpipe(5, \"translate\");\n      i0.ɵɵelement(6, \"ion-icon\", 1);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelement(7, \"hr\");\n      i0.ɵɵtemplate(8, CoreFileUploaderAudioRecorderComponent_ng_container_8_Template, 4, 3, \"ng-container\", 2);\n      i0.ɵɵpipe(9, \"async\");\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 3, \"core.fileuploader.audiotitle\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(5, 5, \"core.close\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(9, 7, ctx.status$));\n    }\n  },\n  dependencies: [i1.NgIf, i2.CoreChronoComponent, i3.CoreFaIconDirective, i4.CoreUpdateNonReactiveAttributesDirective, i5.IonButton, i5.IonIcon, i6.CoreFileUploaderAudioHistogramComponent, i1.AsyncPipe, i7.TranslatePipe],\n  styles: [\"[_nghost-%COMP%] {\\n  color: var(--ion-text-color, #000);\\n}\\n[_nghost-%COMP%]   header[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n}\\n[_nghost-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%] {\\n  margin: 0;\\n  font-size: 16px;\\n  font-weight: 400;\\n  line-height: 24px;\\n  letter-spacing: 0.15px;\\n}\\n[_nghost-%COMP%]   header[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%] {\\n  --padding-start: 0;\\n  --padding-end: 0;\\n  --icon-size: 1.8em;\\n  margin: calc((var(--icon-size) - var(--a11y-min-target-size)) / 2);\\n}\\n[_nghost-%COMP%]   hr[_ngcontent-%COMP%] {\\n  background: var(--gray-300);\\n  margin: 16px 0;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\\n  font-size: 14px;\\n  font-weight: 400;\\n  line-height: 20px;\\n  letter-spacing: 0.25px;\\n  text-align: center;\\n  opacity: 0.6;\\n  margin-top: 0;\\n  margin-bottom: 16px;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   ion-button[shape=round][_ngcontent-%COMP%] {\\n  --border-radius: 99px;\\n  --padding-start: 16px;\\n  --padding-end: 16px;\\n  --padding-top: 16px;\\n  --padding-bottom: 16px;\\n  height: -webkit-max-content;\\n  height: max-content;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   core-audio-histogram[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 35px;\\n  display: block;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   audio[_ngcontent-%COMP%] {\\n  width: 100%;\\n  margin-bottom: 16px;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%] {\\n  width: 100%;\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  justify-content: space-between;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%] {\\n  width: 33%;\\n  text-align: center;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]:first-child {\\n  text-align: start;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]:last-child {\\n  text-align: end;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control.chrono[_ngcontent-%COMP%] {\\n  padding: 0 16px;\\n  display: flex;\\n  flex-direction: row;\\n  align-items: center;\\n  justify-content: flex-start;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%] {\\n  margin: 0;\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   .core-audio-recorder--recording-marker[_ngcontent-%COMP%] {\\n  width: 8px;\\n  height: 8px;\\n  -webkit-margin-end: 4px;\\n          margin-inline-end: 4px;\\n  border-radius: 4px;\\n  background: var(--danger);\\n}\\n[_nghost-%COMP%]   .core-audio-recorder--wrapper[_ngcontent-%COMP%]   .core-audio-recorder--controls[_ngcontent-%COMP%]   .core-audio-recorder--control[_ngcontent-%COMP%]   core-chrono.recording[_ngcontent-%COMP%] {\\n  color: var(--danger);\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb3JlL2ZlYXR1cmVzL2ZpbGV1cGxvYWRlci9jb21wb25lbnRzL2F1ZGlvLXJlY29yZGVyL2F1ZGlvLXJlY29yZGVyLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxrQ0FBQTtBQUNKO0FBQ0k7RUFDSSxhQUFBO0VBQ0EsOEJBQUE7RUFDQSxtQkFBQTtBQUNSO0FBQ1E7RUFDSSxTQUFBO0VBQ0EsZUFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7RUFDQSxzQkFBQTtBQUNaO0FBRVE7RUFDSSxrQkFBQTtFQUNBLGdCQUFBO0VBQ0Esa0JBQUE7RUFHQSxrRUFBQTtBQUZaO0FBT0k7RUFDSSwyQkFBQTtFQUNBLGNBQUE7QUFMUjtBQVFJO0VBQ0ksYUFBQTtFQUNBLHNCQUFBO0VBQ0EsbUJBQUE7QUFOUjtBQVFRO0VBQ0ksZUFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7RUFDQSxzQkFBQTtFQUNBLGtCQUFBO0VBQ0EsWUFBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtBQU5aO0FBU1E7RUFDSSxxQkFBQTtFQUNBLHFCQUFBO0VBQ0EsbUJBQUE7RUFDQSxtQkFBQTtFQUNBLHNCQUFBO0VBRUEsMkJBQUE7RUFBQSxtQkFBQTtBQVJaO0FBV1E7RUFDSSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGNBQUE7QUFUWjtBQVlRO0VBQ0ksV0FBQTtFQUNBLG1CQUFBO0FBVlo7QUFhUTtFQUNJLFdBQUE7RUFDQSxhQUFBO0VBQ0EsbUJBQUE7RUFDQSxtQkFBQTtFQUNBLDhCQUFBO0FBWFo7QUFhWTtFQUNJLFVBQUE7RUFDQSxrQkFBQTtBQVhoQjtBQWFnQjtFQUNJLGlCQUFBO0FBWHBCO0FBY2dCO0VBQ0ksZUFBQTtBQVpwQjtBQWVnQjtFQUNJLGVBQUE7RUFDQSxhQUFBO0VBQ0EsbUJBQUE7RUFDQSxtQkFBQTtFQUNBLDJCQUFBO0FBYnBCO0FBZ0JnQjtFQUNJLFNBQUE7QUFkcEI7QUFpQmdCO0VBQ0ksVUFBQTtFQUNBLFdBQUE7RUFDQSx1QkFBQTtVQUFBLHNCQUFBO0VBQ0Esa0JBQUE7RUFDQSx5QkFBQTtBQWZwQjtBQWtCZ0I7RUFDSSxvQkFBQTtBQWhCcEIiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XG4gICAgY29sb3I6IHZhcigtLWlvbi10ZXh0LWNvbG9yLCAjMDAwKTtcblxuICAgIGhlYWRlciB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcblxuICAgICAgICBoMSB7XG4gICAgICAgICAgICBtYXJnaW46IDA7XG4gICAgICAgICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICAgICAgICBmb250LXdlaWdodDogNDAwO1xuICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDI0cHg7XG4gICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogMC4xNXB4O1xuICAgICAgICB9XG5cbiAgICAgICAgaW9uLWJ1dHRvbiB7XG4gICAgICAgICAgICAtLXBhZGRpbmctc3RhcnQ6IDA7XG4gICAgICAgICAgICAtLXBhZGRpbmctZW5kOiAwO1xuICAgICAgICAgICAgLS1pY29uLXNpemU6IDEuOGVtO1xuXG4gICAgICAgICAgICAvLyBPZmZzZXQgcGFkZGluZyBmb3IgdmlzdWFsIGFsaWdubWVudC5cbiAgICAgICAgICAgIG1hcmdpbjogY2FsYygodmFyKC0taWNvbi1zaXplKSAtIHZhcigtLWExMXktbWluLXRhcmdldC1zaXplKSkgLyAyKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaHIge1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ncmF5LTMwMCk7XG4gICAgICAgIG1hcmdpbjogMTZweCAwO1xuICAgIH1cblxuICAgIC5jb3JlLWF1ZGlvLXJlY29yZGVyLS13cmFwcGVyIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcblxuICAgICAgICBwIHtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7XG4gICAgICAgICAgICBsaW5lLWhlaWdodDogMjBweDtcbiAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAwLjI1cHg7XG4gICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLjY7XG4gICAgICAgICAgICBtYXJnaW4tdG9wOiAwO1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlvbi1idXR0b25bc2hhcGU9XCJyb3VuZFwiXSB7XG4gICAgICAgICAgICAtLWJvcmRlci1yYWRpdXM6IDk5cHg7XG4gICAgICAgICAgICAtLXBhZGRpbmctc3RhcnQ6IDE2cHg7XG4gICAgICAgICAgICAtLXBhZGRpbmctZW5kOiAxNnB4O1xuICAgICAgICAgICAgLS1wYWRkaW5nLXRvcDogMTZweDtcbiAgICAgICAgICAgIC0tcGFkZGluZy1ib3R0b206IDE2cHg7XG5cbiAgICAgICAgICAgIGhlaWdodDogbWF4LWNvbnRlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb3JlLWF1ZGlvLWhpc3RvZ3JhbSB7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIGhlaWdodDogMzVweDtcbiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICB9XG5cbiAgICAgICAgYXVkaW8ge1xuICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNnB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLmNvcmUtYXVkaW8tcmVjb3JkZXItLWNvbnRyb2xzIHtcbiAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuXG4gICAgICAgICAgICAuY29yZS1hdWRpby1yZWNvcmRlci0tY29udHJvbCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IDMzJTtcbiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG5cbiAgICAgICAgICAgICAgICAmOmZpcnN0LWNoaWxkIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogc3RhcnQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJjpsYXN0LWNoaWxkIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogZW5kO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICYuY2hyb25vIHtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMCAxNnB4O1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogcm93O1xuICAgICAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaW9uLWJ1dHRvbiB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAuY29yZS1hdWRpby1yZWNvcmRlci0tcmVjb3JkaW5nLW1hcmtlciB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4cHg7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogOHB4O1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4taW5saW5lLWVuZDogNHB4O1xuICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWRhbmdlcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29yZS1jaHJvbm8ucmVjb3JkaW5nIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IHZhcigtLWRhbmdlcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"],\n  changeDetection: 0\n});\nfunction recorderAudioRecording() {\n  return source => new Observable(subscriber => {\n    let audioChunks = [];\n    let previousRecorder;\n    const onDataAvailable = event => audioChunks.push(event.data);\n    const onError = event => CoreDomUtils.showErrorModal(event.error);\n    const onStop = () => {\n      const blob = new Blob(audioChunks, {\n        type: 'audio/mpeg'\n      });\n      subscriber.next({\n        url: URL.createObjectURL(blob),\n        blob\n      });\n    };\n    const subscription = source.subscribe(media => {\n      var _previousRecorder, _previousRecorder2, _previousRecorder3;\n      (_previousRecorder = previousRecorder) === null || _previousRecorder === void 0 || _previousRecorder.removeEventListener('dataavailable', onDataAvailable);\n      (_previousRecorder2 = previousRecorder) === null || _previousRecorder2 === void 0 || _previousRecorder2.removeEventListener('error', onError);\n      (_previousRecorder3 = previousRecorder) === null || _previousRecorder3 === void 0 || _previousRecorder3.removeEventListener('stop', onStop);\n      media === null || media === void 0 || media.recorder.addEventListener('dataavailable', onDataAvailable);\n      media === null || media === void 0 || media.recorder.addEventListener('error', onError);\n      media === null || media === void 0 || media.recorder.addEventListener('stop', onStop);\n      audioChunks = [];\n      previousRecorder = media === null || media === void 0 ? void 0 : media.recorder;\n      subscriber.next(null);\n    });\n    subscriber.next(null);\n    return () => {\n      var _previousRecorder4, _previousRecorder5, _previousRecorder6;\n      subscription.unsubscribe();\n      (_previousRecorder4 = previousRecorder) === null || _previousRecorder4 === void 0 || _previousRecorder4.removeEventListener('dataavailable', onDataAvailable);\n      (_previousRecorder5 = previousRecorder) === null || _previousRecorder5 === void 0 || _previousRecorder5.removeEventListener('error', onError);\n      (_previousRecorder6 = previousRecorder) === null || _previousRecorder6 === void 0 || _previousRecorder6.removeEventListener('stop', onStop);\n    };\n  });\n}\n/**\n * Observable operator that listens to a recorder and emits its recording status.\n *\n * @returns Operator.\n */\nfunction recorderStatus() {\n  return source => new Observable(subscriber => {\n    let previousRecorder;\n    const onStart = () => subscriber.next('recording');\n    const onPause = () => subscriber.next('paused');\n    const onResume = () => subscriber.next('recording');\n    const onStop = () => subscriber.next('inactive');\n    const subscription = source.subscribe(media => {\n      var _previousRecorder7, _previousRecorder8, _previousRecorder9, _previousRecorder10, _media$recorder$state;\n      (_previousRecorder7 = previousRecorder) === null || _previousRecorder7 === void 0 || _previousRecorder7.removeEventListener('start', onStart);\n      (_previousRecorder8 = previousRecorder) === null || _previousRecorder8 === void 0 || _previousRecorder8.removeEventListener('pause', onPause);\n      (_previousRecorder9 = previousRecorder) === null || _previousRecorder9 === void 0 || _previousRecorder9.removeEventListener('resume', onResume);\n      (_previousRecorder10 = previousRecorder) === null || _previousRecorder10 === void 0 || _previousRecorder10.removeEventListener('stop', onStop);\n      media === null || media === void 0 || media.recorder.addEventListener('start', onStart);\n      media === null || media === void 0 || media.recorder.addEventListener('pause', onPause);\n      media === null || media === void 0 || media.recorder.addEventListener('resume', onResume);\n      media === null || media === void 0 || media.recorder.addEventListener('stop', onStop);\n      previousRecorder = media === null || media === void 0 ? void 0 : media.recorder;\n      subscriber.next((_media$recorder$state = media === null || media === void 0 ? void 0 : media.recorder.state) !== null && _media$recorder$state !== void 0 ? _media$recorder$state : 'inactive');\n    });\n    subscriber.next('inactive');\n    return () => {\n      var _previousRecorder11, _previousRecorder12, _previousRecorder13, _previousRecorder14;\n      subscription.unsubscribe();\n      (_previousRecorder11 = previousRecorder) === null || _previousRecorder11 === void 0 || _previousRecorder11.removeEventListener('start', onStart);\n      (_previousRecorder12 = previousRecorder) === null || _previousRecorder12 === void 0 || _previousRecorder12.removeEventListener('pause', onPause);\n      (_previousRecorder13 = previousRecorder) === null || _previousRecorder13 === void 0 || _previousRecorder13.removeEventListener('resume', onResume);\n      (_previousRecorder14 = previousRecorder) === null || _previousRecorder14 === void 0 || _previousRecorder14.removeEventListener('stop', onStop);\n    };\n  });\n}","map":{"version":3,"names":["CoreModalComponent","CorePlatform","Diagnostic","DomSanitizer","Translate","BehaviorSubject","combineLatest","Observable","Mp3MediaRecorder","map","shareReplay","tap","initAudioEncoderMessage","CoreDomUtils","CAPTURE_ERROR_NO_MEDIA_FILES","CoreCaptureError","CoreFile","CoreFileProvider","CorePath","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵlistener","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template_ion_button_click_4_listener","ɵɵrestoreView","_r6","ctx_r5","ɵɵnextContext","ɵɵresetView","startRecording","ɵɵelement","ɵɵadvance","ɵɵtextInterpolate","ɵɵpipeBind1","ɵɵattribute","ɵɵproperty","analyser_r11","status_r1","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template_ion_button_click_0_listener","_r14","ctx_r13","pauseRecording","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template_ion_button_click_0_listener","_r16","ctx_r15","resumeRecording","ɵɵtemplate","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_core_audio_histogram_1_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_div_5_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_8_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_ion_button_9_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template_ion_button_click_11_listener","_r18","ctx_r17","stopRecording","ctx_r3","histogramAnalyzer$","ɵɵclassProp","recordingUrl_r21","ɵɵsanitizeUrl","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_audio_1_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_5_listener","_r23","ctx_r22","discardRecording","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template_ion_button_click_9_listener","ctx_r24","submit","ctx_r4","recordingUrl$","ɵɵtextInterpolate1","ɵɵelementContainerStart","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_1_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_2_Template","CoreFileUploaderAudioRecorderComponent_ng_container_8_div_3_Template","ɵɵelementContainerEnd","startsWith","CoreFileUploaderAudioRecorderComponent","constructor","elementRef","recording","media$","recording$","pipe","recorderAudioRecording","bypassSecurityTrustUrl","url","media","analyser","prefersReducedMotion","status$","recorderStatus","recordingStatus","ngOnDestroy","_this$media$$value","recorder","value","state","stop","_this","_asyncToGenerator","createMedia","next","start","error","showErrorModal","_this$media$$value2","_this$media$$value3","pause","_this$media$$value4","resume","cancel","_this2","close","_this3","fileName","getUniqueNameInFolder","TMPFOLDER","filePath","concatenatePaths","fileEntry","writeFile","blob","name","fullPath","toURL","type","_this4","prepareMicrophoneAuthorization","mediaStream","navigator","mediaDevices","getUserMedia","audio","audioContext","window","AudioContext","source","createMediaStreamSource","createAnalyser","fftSize","connect","worker","startWorker","isMobile","status","requestMicrophoneAuthorization","permissionStatus","DENIED_ONCE","DENIED_ALWAYS","Error","instant","RESTRICTED","Worker","postMessage","vmsgWasmUrl","document","head","baseURI","_class","ɵɵdirectiveInject","ElementRef","selectors","features","ɵɵInheritDefinitionFeature","decls","vars","consts","template","CoreFileUploaderAudioRecorderComponent_Template","rf","ctx","CoreFileUploaderAudioRecorderComponent_Template_ion_button_click_4_listener","CoreFileUploaderAudioRecorderComponent_ng_container_8_Template","subscriber","audioChunks","previousRecorder","onDataAvailable","event","push","data","onError","onStop","Blob","URL","createObjectURL","subscription","subscribe","_previousRecorder","_previousRecorder2","_previousRecorder3","removeEventListener","addEventListener","_previousRecorder4","_previousRecorder5","_previousRecorder6","unsubscribe","onStart","onPause","onResume","_previousRecorder7","_previousRecorder8","_previousRecorder9","_previousRecorder10","_media$recorder$state","_previousRecorder11","_previousRecorder12","_previousRecorder13","_previousRecorder14"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/fileuploader/components/audio-recorder/audio-recorder.component.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/fileuploader/components/audio-recorder/audio-recorder.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { ChangeDetectionStrategy, Component, ElementRef, OnDestroy } from '@angular/core';\nimport { CoreModalComponent } from '@classes/modal-component';\nimport { CorePlatform } from '@services/platform';\nimport { Diagnostic, DomSanitizer, Translate } from '@singletons';\nimport { BehaviorSubject, combineLatest, Observable, OperatorFunction } from 'rxjs';\nimport { Mp3MediaRecorder } from 'mp3-mediarecorder';\nimport { map, shareReplay, tap } from 'rxjs/operators';\nimport { initAudioEncoderMessage } from '@features/fileuploader/utils/worker-messages';\nimport { SafeUrl } from '@angular/platform-browser';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CAPTURE_ERROR_NO_MEDIA_FILES, CoreCaptureError } from '@classes/errors/captureerror';\nimport { CoreFileUploaderAudioRecording } from '@features/fileuploader/services/fileuploader';\nimport { CoreFile, CoreFileProvider } from '@services/file';\nimport { CorePath } from '@singletons/path';\n\n@Component({\n    selector: 'core-fileuploader-audio-recorder',\n    styleUrls: ['./audio-recorder.scss'],\n    templateUrl: 'audio-recorder.html',\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CoreFileUploaderAudioRecorderComponent extends CoreModalComponent<CoreFileUploaderAudioRecording>\n    implements OnDestroy {\n\n    recordingUrl$: Observable<SafeUrl | null>;\n    histogramAnalyzer$: Observable<AnalyserNode | null>;\n    status$: Observable<'recording-ongoing' | 'recording-paused' | 'done' | 'empty'>;\n\n    protected recording: AudioRecording | null;\n    protected media$: BehaviorSubject<AudioRecorderMedia | null>;\n    protected recording$: Observable<AudioRecording | null>;\n\n    constructor(elementRef: ElementRef<HTMLElement>) {\n        super(elementRef);\n\n        this.recording = null;\n        this.media$ = new BehaviorSubject<AudioRecorderMedia | null>(null);\n        this.recording$ = this.media$.pipe(\n            recorderAudioRecording(),\n            shareReplay(),\n            tap(recording => this.recording = recording),\n        );\n        this.recordingUrl$ = this.recording$.pipe(\n            map(recording => recording && DomSanitizer.bypassSecurityTrustUrl(recording.url)),\n        );\n        this.histogramAnalyzer$ = this.media$.pipe(map(media => {\n            if (!media?.analyser || CorePlatform.prefersReducedMotion()) {\n                return null;\n            }\n\n            return media.analyser;\n        }));\n        this.status$ = combineLatest([this.media$.pipe(recorderStatus(), shareReplay()), this.recording$])\n            .pipe(map(([recordingStatus, recording]) => {\n                if (recordingStatus === 'recording') {\n                    return 'recording-ongoing';\n                }\n\n                if (recordingStatus === 'paused') {\n                    return 'recording-paused';\n                }\n\n                if (recording) {\n                    return 'done';\n                }\n\n                return 'empty';\n            }));\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        const recorder = this.media$.value?.recorder;\n\n        if (recorder && recorder.state !== 'inactive') {\n            recorder.stop();\n        }\n    }\n\n    /**\n     * Start recording.\n     */\n    async startRecording(): Promise<void> {\n        try {\n            const media = await this.createMedia();\n\n            this.media$.next(media);\n\n            media.recorder.start();\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        }\n    }\n\n    /**\n     * Stop recording.\n     */\n    stopRecording(): void {\n        try {\n            this.media$.value?.recorder.stop();\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        }\n    }\n\n    /**\n     * Stop recording.\n     */\n    pauseRecording(): void {\n        try {\n            this.media$.value?.recorder.pause();\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        }\n    }\n\n    /**\n     * Stop recording.\n     */\n    resumeRecording(): void {\n        try {\n            this.media$.value?.recorder.resume();\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        }\n    }\n\n    /**\n     * Discard recording.\n     */\n    discardRecording(): void {\n        this.media$.next(null);\n    }\n\n    /**\n     * Dismiss modal without a result.\n     */\n    async cancel(): Promise<void> {\n        this.close(new CoreCaptureError(CAPTURE_ERROR_NO_MEDIA_FILES));\n    }\n\n    /**\n     * Dismiss the modal with the current recording as a result.\n     */\n    async submit(): Promise<void> {\n        if (!this.recording) {\n            return;\n        }\n\n        try {\n            const fileName = await CoreFile.getUniqueNameInFolder(CoreFileProvider.TMPFOLDER, 'recording.mp3');\n            const filePath = CorePath.concatenatePaths(CoreFileProvider.TMPFOLDER, fileName);\n            const fileEntry = await CoreFile.writeFile(filePath, this.recording.blob);\n\n            this.close({\n                name: fileEntry.name,\n                fullPath: fileEntry.toURL(),\n                type: 'audio/mpeg',\n            });\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        }\n    }\n\n    /**\n     * Create media instances.\n     *\n     * @returns Media instances.\n     */\n    protected async createMedia(): Promise<AudioRecorderMedia> {\n        await this.prepareMicrophoneAuthorization();\n\n        const mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        const audioContext = new window.AudioContext();\n        const source = audioContext.createMediaStreamSource(mediaStream);\n        const analyser = audioContext.createAnalyser();\n\n        analyser.fftSize = 2048;\n        source.connect(analyser);\n\n        return {\n            analyser,\n            recorder: new Mp3MediaRecorder(mediaStream, { worker: this.startWorker(), audioContext }),\n        };\n    }\n\n    /**\n     * Make sure that microphone usage has been authorized.\n     */\n    protected async prepareMicrophoneAuthorization(): Promise<void> {\n        if (!CorePlatform.isMobile()) {\n            return;\n        }\n\n        const status = await Diagnostic.requestMicrophoneAuthorization();\n\n        switch (status) {\n            case Diagnostic.permissionStatus.DENIED_ONCE:\n            case Diagnostic.permissionStatus.DENIED_ALWAYS:\n                throw new Error(Translate.instant('core.fileuploader.microphonepermissiondenied'));\n            case Diagnostic.permissionStatus.RESTRICTED:\n                throw new Error(Translate.instant('core.fileuploader.microphonepermissionrestricted'));\n        }\n    }\n\n    /**\n     * Start worker script.\n     *\n     * @returns Worker.\n     */\n    protected startWorker(): Worker {\n        const worker = new Worker('./audio-recorder.worker', { type: 'module' });\n\n        worker.postMessage(\n            initAudioEncoderMessage({ vmsgWasmUrl: `${document.head.baseURI}assets/lib/vmsg/vmsg.wasm` }),\n        );\n\n        return worker;\n    }\n\n}\n\n/**\n * Audio recording data.\n */\ninterface AudioRecording {\n    url: string;\n    blob: Blob;\n}\n\n/**\n * Media instances.\n */\ninterface AudioRecorderMedia {\n    recorder: Mp3MediaRecorder;\n    analyser: AnalyserNode;\n}\n\n/**\n * Observable operator that listens to a recorder and emits a recording file.\n *\n * @returns Operator.\n */\nfunction recorderAudioRecording(): OperatorFunction<AudioRecorderMedia | null, AudioRecording | null> {\n    return source => new Observable(subscriber => {\n        let audioChunks: Blob[] = [];\n        let previousRecorder: Mp3MediaRecorder | undefined;\n        const onDataAvailable = event => audioChunks.push(event.data);\n        const onError = event => CoreDomUtils.showErrorModal(event.error);\n        const onStop = () => {\n            const blob = new Blob(audioChunks, { type: 'audio/mpeg' });\n\n            subscriber.next({\n                url: URL.createObjectURL(blob),\n                blob,\n            });\n        };\n        const subscription = source.subscribe(media => {\n            previousRecorder?.removeEventListener('dataavailable', onDataAvailable);\n            previousRecorder?.removeEventListener('error', onError);\n            previousRecorder?.removeEventListener('stop', onStop);\n\n            media?.recorder.addEventListener('dataavailable', onDataAvailable);\n            media?.recorder.addEventListener('error', onError);\n            media?.recorder.addEventListener('stop', onStop);\n\n            audioChunks = [];\n            previousRecorder = media?.recorder;\n\n            subscriber.next(null);\n        });\n\n        subscriber.next(null);\n\n        return () => {\n            subscription.unsubscribe();\n\n            previousRecorder?.removeEventListener('dataavailable', onDataAvailable);\n            previousRecorder?.removeEventListener('error', onError);\n            previousRecorder?.removeEventListener('stop', onStop);\n        };\n    });\n}\n\n/**\n * Observable operator that listens to a recorder and emits its recording status.\n *\n * @returns Operator.\n */\nfunction recorderStatus(): OperatorFunction<AudioRecorderMedia | null, RecordingState> {\n    return source => new Observable(subscriber => {\n        let previousRecorder: Mp3MediaRecorder | undefined;\n        const onStart = () => subscriber.next('recording');\n        const onPause = () => subscriber.next('paused');\n        const onResume = () => subscriber.next('recording');\n        const onStop = () => subscriber.next('inactive');\n        const subscription = source.subscribe(media => {\n            previousRecorder?.removeEventListener('start', onStart);\n            previousRecorder?.removeEventListener('pause', onPause);\n            previousRecorder?.removeEventListener('resume', onResume);\n            previousRecorder?.removeEventListener('stop', onStop);\n\n            media?.recorder.addEventListener('start', onStart);\n            media?.recorder.addEventListener('pause', onPause);\n            media?.recorder.addEventListener('resume', onResume);\n            media?.recorder.addEventListener('stop', onStop);\n\n            previousRecorder = media?.recorder;\n\n            subscriber.next(media?.recorder.state ?? 'inactive');\n        });\n\n        subscriber.next('inactive');\n\n        return () => {\n            subscription.unsubscribe();\n\n            previousRecorder?.removeEventListener('start', onStart);\n            previousRecorder?.removeEventListener('pause', onPause);\n            previousRecorder?.removeEventListener('resume', onResume);\n            previousRecorder?.removeEventListener('stop', onStop);\n        };\n    });\n}\n","<header>\n    <h1>{{ 'core.fileuploader.audiotitle' | translate }}</h1>\n\n    <ion-button shape=\"round\" fill=\"clear\" [attr.aria-label]=\"'core.close' | translate\" (click)=\"cancel()\">\n        <ion-icon slot=\"icon-only\" name=\"close\" />\n    </ion-button>\n</header>\n\n<hr>\n\n<ng-container *ngIf=\"(status$ | async) as status\">\n    <div *ngIf=\"status === 'empty'\" class=\"core-audio-recorder--wrapper\">\n        <p>{{ 'core.fileuploader.startrecordinginstructions' | translate }}</p>\n\n        <ion-button shape=\"round\" color=\"danger\" [attr.aria-label]=\"'core.fileuploader.startrecording' | translate\"\n            (click)=\"startRecording()\">\n            <ion-icon slot=\"icon-only\" name=\"fas-microphone\" />\n        </ion-button>\n    </div>\n\n    <div *ngIf=\"status.startsWith('recording')\" class=\"core-audio-recorder--wrapper\">\n        <core-audio-histogram *ngIf=\"(histogramAnalyzer$ | async) as analyser\" [analyser]=\"analyser\"\n            [paused]=\"status !== 'recording-ongoing'\" />\n\n        <div class=\"core-audio-recorder--controls\">\n            <div class=\"core-audio-recorder--control chrono\">\n                <div *ngIf=\"status === 'recording-ongoing'\" class=\"core-audio-recorder--recording-marker\"></div>\n                <core-chrono [class.recording]=\"status === 'recording-ongoing'\" [running]=\"status === 'recording-ongoing'\"\n                    [hours]=\"false\" />\n            </div>\n\n            <div class=\"core-audio-recorder--control\">\n                <ion-button *ngIf=\"status === 'recording-ongoing'\" shape=\"round\" fill=\"clear\"\n                    [attr.aria-label]=\"'core.fileuploader.pauserecording' | translate\" (click)=\"pauseRecording()\">\n                    <ion-icon slot=\"icon-only\" name=\"fas-circle-pause\" />\n                </ion-button>\n\n                <ion-button *ngIf=\"status === 'recording-paused'\" [attr.aria-label]=\"'core.fileuploader.resumerecording' | translate\"\n                    shape=\"round\" fill=\"clear\" color=\"danger\" (click)=\"resumeRecording()\">\n                    <ion-icon slot=\"icon-only\" name=\"fas-microphone\" />\n                </ion-button>\n            </div>\n\n            <div class=\"core-audio-recorder--control\">\n                <ion-button shape=\"round\" fill=\"clear\" [attr.aria-label]=\"'core.fileuploader.stoprecording' | translate\"\n                    (click)=\"stopRecording()\">\n                    <ion-icon slot=\"icon-only\" name=\"fa-check\" />\n                </ion-button>\n            </div>\n        </div>\n    </div>\n\n    <div *ngIf=\"status === 'done'\" class=\"core-audio-recorder--wrapper\">\n        <audio *ngIf=\"(recordingUrl$ | async) as recordingUrl\" controls controlsList=\"nodownload\">\n            <source [src]=\"recordingUrl\" />\n        </audio>\n\n        <div class=\"core-audio-recorder--controls\">\n            <div class=\"core-audio-recorder--control\">\n                <ion-button shape=\"round\" fill=\"clear\" color=\"danger\" [attr.aria-label]=\"'core.fileuploader.discardrecording' | translate\"\n                    (click)=\"discardRecording()\">\n                    <ion-icon slot=\"icon-only\" name=\"fas-trash\" />\n                </ion-button>\n            </div>\n\n            <div class=\"core-audio-recorder--control\">\n                <ion-button (click)=\"submit()\">\n                    {{ 'core.save' | translate }}\n                </ion-button>\n            </div>\n        </div>\n    </div>\n</ng-container>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}