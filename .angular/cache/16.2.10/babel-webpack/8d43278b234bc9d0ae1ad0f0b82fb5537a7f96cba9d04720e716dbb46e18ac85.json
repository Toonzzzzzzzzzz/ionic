{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreCourseModuleMainActivityPage } from '@features/course/classes/main-activity-page';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { Translate } from '@singletons';\nimport { AddonModH5PActivityIndexComponent } from '../../components/index';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../../core/directives/format-text\";\nimport * as i2 from \"../../../../../core/directives/collapsible-header\";\nimport * as i3 from \"../../../../../core/directives/content\";\nimport * as i4 from \"@ionic/angular\";\nimport * as i5 from \"../../components/index/index\";\nimport * as i6 from \"@ngx-translate/core\";\n/**\n * Page that displays an H5P activity.\n */\nexport class AddonModH5PActivityIndexPage extends CoreCourseModuleMainActivityPage {\n  constructor() {\n    super(...arguments);\n    this.canLeaveSafely = false;\n  }\n  /**\n   * @inheritdoc\n   */\n  canLeave() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      var _this$activityCompone;\n      if (!((_this$activityCompone = _this.activityComponent) !== null && _this$activityCompone !== void 0 && _this$activityCompone.playing) || _this.activityComponent.isOpeningPage || _this.activityComponent.saveStateEnabled) {\n        return true;\n      }\n      if (!_this.canLeaveSafely) {\n        try {\n          yield CoreDomUtils.showConfirm(Translate.instant('core.confirmleaveunknownchanges'));\n          return true;\n        } catch (_unused) {\n          return false;\n        }\n      }\n      return true;\n    })();\n  }\n  /**\n   * Set if this activity can be leaved safely (withow showing warning modal) if activity is finished\n   * 10 seconds before.\n   *\n   * @param isDone the H5P activity is done.\n   */\n  setCanleaveSafely(isDone) {\n    this.canLeaveSafely = isDone;\n    if (this.remainingTimeout) {\n      clearTimeout(this.remainingTimeout);\n    }\n    // When user finish an activity, he have 10 seconds to leave safely (without show alert).\n    this.remainingTimeout = window.setTimeout(() => {\n      this.canLeaveSafely = false;\n    }, 10000);\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    if (this.remainingTimeout) {\n      clearTimeout(this.remainingTimeout);\n    }\n  }\n}\n_class = AddonModH5PActivityIndexPage;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonModH5PActivityIndexPage_BaseFactory;\n  return function AddonModH5PActivityIndexPage_Factory(t) {\n    return (ɵAddonModH5PActivityIndexPage_BaseFactory || (ɵAddonModH5PActivityIndexPage_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-mod-h5pactivity-index\"]],\n  viewQuery: function AddonModH5PActivityIndexPage_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(AddonModH5PActivityIndexComponent, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.activityComponent = _t.first);\n    }\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 14,\n  vars: 12,\n  consts: [[\"collapsible\", \"\"], [\"slot\", \"start\"], [3, \"text\"], [\"contextLevel\", \"module\", 3, \"text\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"module\", \"courseId\", \"dataRetrieved\", \"onActivityFinish\"]],\n  template: function AddonModH5PActivityIndexPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1);\n      i0.ɵɵelement(3, \"ion-back-button\", 2);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵelement(7, \"core-format-text\", 3);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelement(8, \"ion-buttons\", 4);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(9, \"ion-content\")(10, \"ion-refresher\", 5);\n      i0.ɵɵlistener(\"ionRefresh\", function AddonModH5PActivityIndexPage_Template_ion_refresher_ionRefresh_10_listener($event) {\n        return ctx.activityComponent == null ? null : ctx.activityComponent.doRefresh($event.target);\n      });\n      i0.ɵɵelement(11, \"ion-refresher-content\", 6);\n      i0.ɵɵpipe(12, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"addon-mod-h5pactivity-index\", 7);\n      i0.ɵɵlistener(\"dataRetrieved\", function AddonModH5PActivityIndexPage_Template_addon_mod_h5pactivity_index_dataRetrieved_13_listener($event) {\n        return ctx.updateData($event);\n      })(\"onActivityFinish\", function AddonModH5PActivityIndexPage_Template_addon_mod_h5pactivity_index_onActivityFinish_13_listener($event) {\n        return ctx.setCanleaveSafely($event);\n      });\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 8, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"text\", ctx.title)(\"contextInstanceId\", ctx.module.id)(\"courseId\", ctx.courseId);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"disabled\", ctx.activityComponent == null ? null : ctx.activityComponent.showLoading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵpropertyInterpolate(\"pullingText\", i0.ɵɵpipeBind1(12, 10, \"core.pulltorefresh\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"module\", ctx.module)(\"courseId\", ctx.courseId);\n    }\n  },\n  dependencies: [i1.CoreFormatTextDirective, i2.CoreCollapsibleHeaderDirective, i3.CoreContentDirective, i4.IonButtons, i4.IonContent, i4.IonHeader, i4.IonRefresher, i4.IonRefresherContent, i4.IonTitle, i4.IonToolbar, i4.IonBackButton, i5.AddonModH5PActivityIndexComponent, i6.TranslatePipe],\n  encapsulation: 2\n});","map":{"version":3,"names":["CoreCourseModuleMainActivityPage","CoreDomUtils","Translate","AddonModH5PActivityIndexComponent","AddonModH5PActivityIndexPage","constructor","canLeaveSafely","canLeave","_this","_asyncToGenerator","_this$activityCompone","activityComponent","playing","isOpeningPage","saveStateEnabled","showConfirm","instant","_unused","setCanleaveSafely","isDone","remainingTimeout","clearTimeout","window","setTimeout","ngOnDestroy","t","selectors","viewQuery","AddonModH5PActivityIndexPage_Query","rf","ctx","i0","ɵɵelementStart","ɵɵelement","ɵɵelementEnd","ɵɵlistener","AddonModH5PActivityIndexPage_Template_ion_refresher_ionRefresh_10_listener","$event","doRefresh","target","AddonModH5PActivityIndexPage_Template_addon_mod_h5pactivity_index_dataRetrieved_13_listener","updateData","AddonModH5PActivityIndexPage_Template_addon_mod_h5pactivity_index_onActivityFinish_13_listener","ɵɵadvance","ɵɵproperty","ɵɵpipeBind1","title","module","id","courseId","showLoading","ɵɵpropertyInterpolate"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/h5pactivity/pages/index/index.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/h5pactivity/pages/index/index.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnDestroy, ViewChild } from '@angular/core';\n\nimport { CoreCourseModuleMainActivityPage } from '@features/course/classes/main-activity-page';\nimport { CanLeave } from '@guards/can-leave';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { Translate } from '@singletons';\nimport { AddonModH5PActivityIndexComponent } from '../../components/index';\n\n/**\n * Page that displays an H5P activity.\n */\n@Component({\n    selector: 'page-addon-mod-h5pactivity-index',\n    templateUrl: 'index.html',\n})\nexport class AddonModH5PActivityIndexPage extends CoreCourseModuleMainActivityPage<AddonModH5PActivityIndexComponent>\n    implements CanLeave, OnDestroy {\n\n    canLeaveSafely = false;\n    remainingTimeout?: number;\n\n    @ViewChild(AddonModH5PActivityIndexComponent) activityComponent?: AddonModH5PActivityIndexComponent;\n\n    /**\n     * @inheritdoc\n     */\n    async canLeave(): Promise<boolean> {\n        if (!this.activityComponent?.playing || this.activityComponent.isOpeningPage || this.activityComponent.saveStateEnabled) {\n            return true;\n        }\n\n        if (!this.canLeaveSafely) {\n            try {\n                await CoreDomUtils.showConfirm(Translate.instant('core.confirmleaveunknownchanges'));\n\n                return true;\n            } catch {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * Set if this activity can be leaved safely (withow showing warning modal) if activity is finished\n     * 10 seconds before.\n     *\n     * @param isDone the H5P activity is done.\n     */\n    setCanleaveSafely(isDone: boolean): void {\n        this.canLeaveSafely = isDone;\n        if (this.remainingTimeout) {\n            clearTimeout(this.remainingTimeout);\n        }\n        // When user finish an activity, he have 10 seconds to leave safely (without show alert).\n        this.remainingTimeout = window.setTimeout(() => {\n            this.canLeaveSafely = false;\n        }, 10000);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        if (this.remainingTimeout) {\n            clearTimeout(this.remainingTimeout);\n        }\n    }\n\n}\n","<ion-header collapsible>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>\n                <core-format-text [text]=\"title\" contextLevel=\"module\" [contextInstanceId]=\"module.id\" [courseId]=\"courseId\" />\n            </h1>\n        </ion-title>\n\n        <ion-buttons slot=\"end\" />\n    </ion-toolbar>\n</ion-header>\n<ion-content>\n    <ion-refresher slot=\"fixed\" [disabled]=\"activityComponent?.showLoading\" (ionRefresh)=\"activityComponent?.doRefresh($event.target)\">\n        <ion-refresher-content pullingText=\"{{ 'core.pulltorefresh' | translate }}\" />\n    </ion-refresher>\n\n    <addon-mod-h5pactivity-index [module]=\"module\" [courseId]=\"courseId\" (dataRetrieved)=\"updateData($event)\"\n        (onActivityFinish)=\"setCanleaveSafely($event)\" />\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}