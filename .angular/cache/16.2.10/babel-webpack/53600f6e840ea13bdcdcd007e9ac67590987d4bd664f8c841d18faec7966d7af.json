{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { Component, NgModule, NO_ERRORS_SCHEMA, createNgModule } from '@angular/core';\nimport { ActionSheetController, AlertController, LoadingController, ModalController, PopoverController, ToastController } from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { TranslatePipeForCompile } from '../pipes/translate';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreEvents } from '@singletons/events';\nimport { makeSingleton } from '@singletons';\n// Import core services.\nimport { CORE_SERVICES } from '@/core/core.module';\nimport { CORE_BLOCK_SERVICES } from '@features/block/block.module';\nimport { CORE_COMMENTS_SERVICES } from '@features/comments/comments.module';\nimport { CORE_CONTENTLINKS_SERVICES } from '@features/contentlinks/contentlinks.module';\nimport { CORE_COURSE_SERVICES } from '@features/course/course.module';\nimport { CORE_COURSES_SERVICES } from '@features/courses/courses.module';\nimport { CORE_EDITOR_SERVICES } from '@features/editor/editor.module';\nimport { CORE_ENROL_SERVICES } from '@features/enrol/enrol.module';\nimport { CORE_NATIVE_SERVICES } from '@features/native/native.module';\nimport { CORE_FILEUPLOADER_SERVICES } from '@features/fileuploader/fileuploader.module';\nimport { CORE_FILTER_SERVICES } from '@features/filter/filter.module';\nimport { CORE_GRADES_SERVICES } from '@features/grades/grades.module';\nimport { CORE_H5P_SERVICES } from '@features/h5p/h5p.module';\nimport { CORE_LOGIN_SERVICES } from '@features/login/login.module';\nimport { CORE_MAINMENU_SERVICES } from '@features/mainmenu/mainmenu.module';\nimport { CORE_PUSHNOTIFICATIONS_SERVICES } from '@features/pushnotifications/pushnotifications.module';\nimport { CORE_QUESTION_SERVICES } from '@features/question/question.module';\nimport { CORE_SHAREDFILES_SERVICES } from '@features/sharedfiles/sharedfiles.module';\nimport { CORE_RATING_SERVICES } from '@features/rating/rating.module';\nimport { CORE_SEARCH_SERVICES } from '@features/search/search.module';\nimport { CORE_SETTINGS_SERVICES } from '@features/settings/settings.module';\nimport { CORE_SITEHOME_SERVICES } from '@features/sitehome/sitehome.module';\nimport { CORE_TAG_SERVICES } from '@features/tag/tag.module';\nimport { CORE_STYLE_SERVICES } from '@features/styles/styles.module';\nimport { CORE_USER_SERVICES } from '@features/user/user.module';\nimport { CORE_XAPI_SERVICES } from '@features/xapi/xapi.module';\nimport { CoreSitePluginsProvider } from '@features/siteplugins/services/siteplugins';\n// Import other libraries and providers.\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\nimport { CoreConstants } from '@/core/constants';\nimport moment from 'moment-timezone';\nimport { Md5 } from 'ts-md5/dist/md5';\n// Import core classes that can be useful for site plugins.\nimport { CoreSyncBaseProvider } from '@classes/base-sync';\nimport { CoreArray } from '@singletons/array';\nimport { CoreComponentsRegistry } from '@singletons/components-registry';\nimport { CoreDirectivesRegistry } from '@singletons/directives-registry';\nimport { CoreDom } from '@singletons/dom';\nimport { CoreForms } from '@singletons/form';\nimport { CoreText } from '@singletons/text';\nimport { CoreTime } from '@singletons/time';\nimport { CoreUrl } from '@singletons/url';\nimport { CoreWindow } from '@singletons/window';\nimport { CoreCache } from '@classes/cache';\nimport { CoreDelegate } from '@classes/delegate';\nimport { CoreContentLinksHandlerBase } from '@features/contentlinks/classes/base-handler';\nimport { CoreContentLinksModuleGradeHandler } from '@features/contentlinks/classes/module-grade-handler';\nimport { CoreContentLinksModuleIndexHandler } from '@features/contentlinks/classes/module-index-handler';\nimport { CoreCourseActivityPrefetchHandlerBase } from '@features/course/classes/activity-prefetch-handler';\nimport { CoreCourseResourcePrefetchHandlerBase } from '@features/course/classes/resource-prefetch-handler';\nimport { CoreGeolocationError, CoreGeolocationErrorReason } from '@services/geolocation';\nimport { CORE_ERRORS_CLASSES } from '@classes/errors/errors';\nimport { CoreNetwork } from '@services/network';\n// Import all core modules that define components, directives and pipes.\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreCourseComponentsModule } from '@features/course/components/components.module';\nimport { CoreCourseDirectivesModule } from '@features/course/directives/directives.module';\nimport { CoreCoursesComponentsModule } from '@features/courses/components/components.module';\nimport { CoreSitePluginsDirectivesModule } from '@features/siteplugins/directives/directives.module';\nimport { CoreUserComponentsModule } from '@features/user/components/components.module';\nimport { CoreQuestionComponentsModule } from '@features/question/components/components.module';\nimport { CoreBlockComponentsModule } from '@features/block/components/components.module';\nimport { CoreEditorComponentsModule } from '@features/editor/components/components.module';\nimport { CoreSearchComponentsModule } from '@features/search/components/components.module';\n// Import some components so they can be injected dynamically.\nimport { CoreCourseUnsupportedModuleComponent } from '@features/course/components/unsupported-module/unsupported-module';\nimport { CoreCourseFormatSingleActivityComponent } from '@features/course/format/singleactivity/components/singleactivity';\nimport { CoreSitePluginsModuleIndexComponent } from '@features/siteplugins/components/module-index/module-index';\nimport { CoreSitePluginsBlockComponent } from '@features/siteplugins/components/block/block';\nimport { CoreSitePluginsCourseFormatComponent } from '@features/siteplugins/components/course-format/course-format';\nimport { CoreSitePluginsQuestionComponent } from '@features/siteplugins/components/question/question';\nimport { CoreSitePluginsQuestionBehaviourComponent } from '@features/siteplugins/components/question-behaviour/question-behaviour';\nimport { CoreSitePluginsUserProfileFieldComponent } from '@features/siteplugins/components/user-profile-field/user-profile-field';\nimport { CoreSitePluginsQuizAccessRuleComponent } from '@features/siteplugins/components/quiz-access-rule/quiz-access-rule';\nimport { CoreSitePluginsAssignFeedbackComponent } from '@features/siteplugins/components/assign-feedback/assign-feedback';\nimport { CoreSitePluginsAssignSubmissionComponent } from '@features/siteplugins/components/assign-submission/assign-submission';\n// Import addon providers. Do not import database module because it causes circular dependencies.\nimport { ADDON_BADGES_SERVICES } from '@addons/badges/badges.module';\nimport { ADDON_CALENDAR_SERVICES } from '@addons/calendar/calendar.module';\nimport { ADDON_COURSECOMPLETION_SERVICES } from '@addons/coursecompletion/coursecompletion.module';\nimport { ADDON_COMPETENCY_SERVICES } from '@addons/competency/competency.module';\nimport { ADDON_MESSAGEOUTPUT_SERVICES } from '@addons/messageoutput/messageoutput.module';\nimport { ADDON_MESSAGES_SERVICES } from '@addons/messages/messages.module';\nimport { ADDON_MOD_ASSIGN_SERVICES } from '@addons/mod/assign/assign.module';\nimport { ADDON_MOD_BOOK_SERVICES } from '@addons/mod/book/book.module';\nimport { ADDON_MOD_CHAT_SERVICES } from '@addons/mod/chat/chat.module';\nimport { ADDON_MOD_CHOICE_SERVICES } from '@addons/mod/choice/choice.module';\nimport { ADDON_MOD_FEEDBACK_SERVICES } from '@addons/mod/feedback/feedback.module';\nimport { ADDON_MOD_FOLDER_SERVICES } from '@addons/mod/folder/folder.module';\nimport { ADDON_MOD_FORUM_SERVICES } from '@addons/mod/forum/forum.module';\nimport { ADDON_MOD_GLOSSARY_SERVICES } from '@addons/mod/glossary/glossary.module';\nimport { ADDON_MOD_H5P_ACTIVITY_SERVICES } from '@addons/mod/h5pactivity/h5pactivity.module';\nimport { ADDON_MOD_IMSCP_SERVICES } from '@addons/mod/imscp/imscp.module';\nimport { ADDON_MOD_LESSON_SERVICES } from '@addons/mod/lesson/lesson.module';\nimport { ADDON_MOD_LTI_SERVICES } from '@addons/mod/lti/lti.module';\nimport { ADDON_MOD_PAGE_SERVICES } from '@addons/mod/page/page.module';\nimport { ADDON_MOD_QUIZ_SERVICES } from '@addons/mod/quiz/quiz.module';\nimport { ADDON_MOD_RESOURCE_SERVICES } from '@addons/mod/resource/resource.module';\nimport { ADDON_MOD_SCORM_SERVICES } from '@addons/mod/scorm/scorm.module';\nimport { ADDON_MOD_SURVEY_SERVICES } from '@addons/mod/survey/survey.module';\nimport { ADDON_MOD_URL_SERVICES } from '@addons/mod/url/url.module';\nimport { ADDON_MOD_WIKI_SERVICES } from '@addons/mod/wiki/wiki.module';\nimport { getWorkshopComponentModules, getWorkshopServices } from '@addons/mod/workshop/workshop.module';\nimport { ADDON_NOTES_SERVICES } from '@addons/notes/notes.module';\nimport { ADDON_NOTIFICATIONS_SERVICES } from '@addons/notifications/notifications.module';\nimport { ADDON_PRIVATEFILES_SERVICES } from '@addons/privatefiles/privatefiles.module';\n// Import some addon modules that define components, directives and pipes. Only import the important ones.\nimport { AddonModAssignComponentsModule } from '@addons/mod/assign/components/components.module';\nimport { CorePromisedValue } from '@classes/promised-value';\nimport { CorePlatform } from '@services/platform';\nimport { CoreAutoLogoutService } from '@features/autologout/services/autologout';\nimport '@angular/compiler';\nimport * as i0 from \"@angular/core\";\n/**\n * Service to provide functionalities regarding compiling dynamic HTML and Javascript.\n */\nexport class CoreCompileProvider {\n  constructor(injector) {\n    this.injector = injector;\n    // Other Ionic/Angular providers that don't depend on where they are injected.\n    this.OTHER_SERVICES = [TranslateService, HttpClient, DomSanitizer, ActionSheetController, AlertController, LoadingController, ModalController, PopoverController, ToastController, FormBuilder];\n    // List of imports for dynamic module. Since the template can have any component we need to import all core components modules.\n    this.IMPORTS = [CoreSharedModule, CoreCourseComponentsModule, CoreCoursesComponentsModule, CoreUserComponentsModule, CoreCourseDirectivesModule, CoreQuestionComponentsModule, AddonModAssignComponentsModule, CoreBlockComponentsModule, CoreEditorComponentsModule, CoreSearchComponentsModule, CoreSitePluginsDirectivesModule];\n    this.LAZY_IMPORTS = [getWorkshopComponentModules];\n    this.logger = CoreLogger.getInstance('CoreCompileProvider');\n  }\n  /**\n   * Create and compile a dynamic component.\n   *\n   * @param template The template of the component.\n   * @param componentClass The JS class of the component.\n   * @param viewContainerRef View container reference to inject the component.\n   * @param extraImports Extra imported modules if needed and not imported by this class.\n   * @returns Promise resolved with the component reference.\n   */\n  createAndCompileComponent(template, componentClass, viewContainerRef, extraImports = []) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      // Create the component using the template and the class.\n      const component = Component({\n        template\n      })(componentClass);\n      const lazyImports = yield Promise.all(_this.LAZY_IMPORTS.map(getModules => getModules()));\n      const imports = [...CoreArray.flatten(lazyImports), ..._this.IMPORTS, ...extraImports, TranslatePipeForCompile];\n      try {\n        viewContainerRef.clear();\n        // Now create the module containing the component.\n        const ngModuleRef = createNgModule(NgModule({\n          imports,\n          declarations: [component],\n          schemas: [NO_ERRORS_SCHEMA]\n        })(class {}), _this.injector);\n        return viewContainerRef.createComponent(component, {\n          environmentInjector: ngModuleRef\n        });\n      } catch (error) {\n        _this.logger.error('Error compiling template', template);\n        _this.logger.error(error);\n        error.message = 'Template has some errors and cannot be displayed.';\n        throw error;\n      }\n    })();\n  }\n  /**\n   * Eval some javascript using the context of the function.\n   *\n   * @param javascript The javascript to eval.\n   * @returns Result of the eval.\n   */\n  evalInContext(javascript) {\n    // eslint-disable-next-line no-eval\n    return eval(javascript);\n  }\n  /**\n   * Execute some javascript code, using a certain instance as the context.\n   *\n   * @param instance Instance to use as the context. In the JS code, \"this\" will be this instance.\n   * @param javascript The javascript code to eval.\n   * @returns Result of the javascript execution.\n   */\n  executeJavascript(instance, javascript) {\n    try {\n      return this.evalInContext.call(instance, javascript);\n    } catch (ex) {\n      this.logger.error('Error evaluating javascript', ex);\n    }\n  }\n  /**\n   * Inject all the core libraries in a certain object.\n   *\n   * @param instance The instance where to inject the libraries.\n   * @param extraProviders Extra imported providers if needed and not imported by this class.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  injectLibraries(instance, extraProviders = []) {\n    const providers = [...CORE_SERVICES, CoreAutoLogoutService, ...CORE_BLOCK_SERVICES, ...CORE_COMMENTS_SERVICES, ...CORE_CONTENTLINKS_SERVICES, ...CORE_COURSE_SERVICES, ...CORE_COURSES_SERVICES, ...CORE_EDITOR_SERVICES, ...CORE_ENROL_SERVICES, ...CORE_FILEUPLOADER_SERVICES, ...CORE_FILTER_SERVICES, ...CORE_GRADES_SERVICES, ...CORE_H5P_SERVICES, ...CORE_MAINMENU_SERVICES, ...CORE_LOGIN_SERVICES, ...CORE_QUESTION_SERVICES, ...CORE_PUSHNOTIFICATIONS_SERVICES, ...CORE_RATING_SERVICES, ...CORE_SEARCH_SERVICES, ...CORE_SETTINGS_SERVICES, ...CORE_SHAREDFILES_SERVICES, ...CORE_SITEHOME_SERVICES, CoreSitePluginsProvider, ...CORE_TAG_SERVICES, ...CORE_STYLE_SERVICES, ...CORE_USER_SERVICES, ...CORE_XAPI_SERVICES, ...CORE_NATIVE_SERVICES, ...this.OTHER_SERVICES, ...extraProviders, ...ADDON_BADGES_SERVICES, ...ADDON_CALENDAR_SERVICES, ...ADDON_COURSECOMPLETION_SERVICES, ...ADDON_COMPETENCY_SERVICES, ...ADDON_MESSAGEOUTPUT_SERVICES, ...ADDON_MESSAGES_SERVICES, ...ADDON_MOD_ASSIGN_SERVICES, ...ADDON_MOD_BOOK_SERVICES, ...ADDON_MOD_CHAT_SERVICES, ...ADDON_MOD_CHOICE_SERVICES, ...ADDON_MOD_FEEDBACK_SERVICES, ...ADDON_MOD_FOLDER_SERVICES, ...ADDON_MOD_FORUM_SERVICES, ...ADDON_MOD_GLOSSARY_SERVICES, ...ADDON_MOD_H5P_ACTIVITY_SERVICES, ...ADDON_MOD_IMSCP_SERVICES, ...ADDON_MOD_LESSON_SERVICES, ...ADDON_MOD_LTI_SERVICES, ...ADDON_MOD_PAGE_SERVICES, ...ADDON_MOD_QUIZ_SERVICES, ...ADDON_MOD_RESOURCE_SERVICES, ...ADDON_MOD_SCORM_SERVICES, ...ADDON_MOD_SURVEY_SERVICES, ...ADDON_MOD_URL_SERVICES, ...ADDON_MOD_WIKI_SERVICES, ...ADDON_NOTES_SERVICES, ...ADDON_NOTIFICATIONS_SERVICES, ...ADDON_PRIVATEFILES_SERVICES];\n    // We cannot inject anything to this constructor. Use the Injector to inject all the providers into the instance.\n    for (const i in providers) {\n      const providerDef = providers[i];\n      if (typeof providerDef === 'function' && providerDef.name) {\n        try {\n          // Inject the provider to the instance. We use the class name as the property name.\n          instance[providerDef.name.replace(/DelegateService$/, 'Delegate')] = this.injector.get(providerDef);\n        } catch (ex) {\n          this.logger.error('Error injecting provider', providerDef.name, ex);\n        }\n      }\n    }\n    // Inject current service.\n    instance['CoreCompileProvider'] = this;\n    // Add some final classes.\n    instance['injector'] = this.injector;\n    instance['Validators'] = Validators;\n    instance['CoreConstants'] = CoreConstants;\n    instance['CoreConfigConstants'] = CoreConstants.CONFIG;\n    instance['CoreEventsProvider'] = CoreEvents;\n    instance['CoreLoggerProvider'] = CoreLogger;\n    instance['moment'] = moment;\n    instance['Md5'] = Md5;\n    instance['Network'] = CoreNetwork.instance; // @deprecated since 4.1, plugins should use CoreNetwork instead.\n    instance['Platform'] = CorePlatform.instance; // @deprecated since 4.1, plugins should use CorePlatform instead.\n    instance['CoreSyncBaseProvider'] = CoreSyncBaseProvider;\n    instance['CoreArray'] = CoreArray;\n    // eslint-disable-next-line deprecation/deprecation\n    instance['CoreComponentsRegistry'] = CoreComponentsRegistry;\n    instance['CoreDirectivesRegistry'] = CoreDirectivesRegistry;\n    instance['CoreNetwork'] = CoreNetwork.instance;\n    instance['CorePlatform'] = CorePlatform.instance;\n    instance['CoreDom'] = CoreDom;\n    instance['CoreForms'] = CoreForms;\n    instance['CoreText'] = CoreText;\n    instance['CoreTime'] = CoreTime;\n    instance['CoreUrl'] = CoreUrl;\n    instance['CoreWindow'] = CoreWindow;\n    instance['CoreCache'] = CoreCache; // @deprecated since 4.4, plugins should use plain objects instead.\n    instance['CoreDelegate'] = CoreDelegate;\n    instance['CorePromisedValue'] = CorePromisedValue;\n    instance['CoreContentLinksHandlerBase'] = CoreContentLinksHandlerBase;\n    instance['CoreContentLinksModuleGradeHandler'] = CoreContentLinksModuleGradeHandler;\n    instance['CoreContentLinksModuleIndexHandler'] = CoreContentLinksModuleIndexHandler;\n    instance['CoreCourseActivityPrefetchHandlerBase'] = CoreCourseActivityPrefetchHandlerBase;\n    instance['CoreCourseResourcePrefetchHandlerBase'] = CoreCourseResourcePrefetchHandlerBase;\n    instance['CoreCourseUnsupportedModuleComponent'] = CoreCourseUnsupportedModuleComponent;\n    instance['CoreCourseFormatSingleActivityComponent'] = CoreCourseFormatSingleActivityComponent;\n    instance['CoreSitePluginsModuleIndexComponent'] = CoreSitePluginsModuleIndexComponent;\n    instance['CoreSitePluginsBlockComponent'] = CoreSitePluginsBlockComponent;\n    instance['CoreSitePluginsCourseFormatComponent'] = CoreSitePluginsCourseFormatComponent;\n    instance['CoreSitePluginsQuestionComponent'] = CoreSitePluginsQuestionComponent;\n    instance['CoreSitePluginsQuestionBehaviourComponent'] = CoreSitePluginsQuestionBehaviourComponent;\n    instance['CoreSitePluginsUserProfileFieldComponent'] = CoreSitePluginsUserProfileFieldComponent;\n    instance['CoreSitePluginsQuizAccessRuleComponent'] = CoreSitePluginsQuizAccessRuleComponent;\n    instance['CoreSitePluginsAssignFeedbackComponent'] = CoreSitePluginsAssignFeedbackComponent;\n    instance['CoreSitePluginsAssignSubmissionComponent'] = CoreSitePluginsAssignSubmissionComponent;\n    instance['CoreGeolocationError'] = CoreGeolocationError;\n    instance['CoreGeolocationErrorReason'] = CoreGeolocationErrorReason;\n    CORE_ERRORS_CLASSES.forEach(classDef => {\n      instance[classDef.name] = classDef;\n    });\n  }\n  /**\n   * Get lazy libraries to inject.\n   *\n   * @returns Lazy libraries.\n   */\n  getLazyLibraries() {\n    return _asyncToGenerator(function* () {\n      const ADDON_MOD_WORKSHOP_SERVICES = yield getWorkshopServices();\n      return [...ADDON_MOD_WORKSHOP_SERVICES];\n    })();\n  }\n}\n_class = CoreCompileProvider;\n_class.ɵfac = function CoreCompileProvider_Factory(t) {\n  return new (t || _class)(i0.ɵɵinject(i0.Injector));\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const CoreCompile = makeSingleton(CoreCompileProvider);","map":{"version":3,"names":["Component","NgModule","NO_ERRORS_SCHEMA","createNgModule","ActionSheetController","AlertController","LoadingController","ModalController","PopoverController","ToastController","TranslateService","TranslatePipeForCompile","CoreLogger","CoreEvents","makeSingleton","CORE_SERVICES","CORE_BLOCK_SERVICES","CORE_COMMENTS_SERVICES","CORE_CONTENTLINKS_SERVICES","CORE_COURSE_SERVICES","CORE_COURSES_SERVICES","CORE_EDITOR_SERVICES","CORE_ENROL_SERVICES","CORE_NATIVE_SERVICES","CORE_FILEUPLOADER_SERVICES","CORE_FILTER_SERVICES","CORE_GRADES_SERVICES","CORE_H5P_SERVICES","CORE_LOGIN_SERVICES","CORE_MAINMENU_SERVICES","CORE_PUSHNOTIFICATIONS_SERVICES","CORE_QUESTION_SERVICES","CORE_SHAREDFILES_SERVICES","CORE_RATING_SERVICES","CORE_SEARCH_SERVICES","CORE_SETTINGS_SERVICES","CORE_SITEHOME_SERVICES","CORE_TAG_SERVICES","CORE_STYLE_SERVICES","CORE_USER_SERVICES","CORE_XAPI_SERVICES","CoreSitePluginsProvider","DomSanitizer","FormBuilder","Validators","HttpClient","CoreConstants","moment","Md5","CoreSyncBaseProvider","CoreArray","CoreComponentsRegistry","CoreDirectivesRegistry","CoreDom","CoreForms","CoreText","CoreTime","CoreUrl","CoreWindow","CoreCache","CoreDelegate","CoreContentLinksHandlerBase","CoreContentLinksModuleGradeHandler","CoreContentLinksModuleIndexHandler","CoreCourseActivityPrefetchHandlerBase","CoreCourseResourcePrefetchHandlerBase","CoreGeolocationError","CoreGeolocationErrorReason","CORE_ERRORS_CLASSES","CoreNetwork","CoreSharedModule","CoreCourseComponentsModule","CoreCourseDirectivesModule","CoreCoursesComponentsModule","CoreSitePluginsDirectivesModule","CoreUserComponentsModule","CoreQuestionComponentsModule","CoreBlockComponentsModule","CoreEditorComponentsModule","CoreSearchComponentsModule","CoreCourseUnsupportedModuleComponent","CoreCourseFormatSingleActivityComponent","CoreSitePluginsModuleIndexComponent","CoreSitePluginsBlockComponent","CoreSitePluginsCourseFormatComponent","CoreSitePluginsQuestionComponent","CoreSitePluginsQuestionBehaviourComponent","CoreSitePluginsUserProfileFieldComponent","CoreSitePluginsQuizAccessRuleComponent","CoreSitePluginsAssignFeedbackComponent","CoreSitePluginsAssignSubmissionComponent","ADDON_BADGES_SERVICES","ADDON_CALENDAR_SERVICES","ADDON_COURSECOMPLETION_SERVICES","ADDON_COMPETENCY_SERVICES","ADDON_MESSAGEOUTPUT_SERVICES","ADDON_MESSAGES_SERVICES","ADDON_MOD_ASSIGN_SERVICES","ADDON_MOD_BOOK_SERVICES","ADDON_MOD_CHAT_SERVICES","ADDON_MOD_CHOICE_SERVICES","ADDON_MOD_FEEDBACK_SERVICES","ADDON_MOD_FOLDER_SERVICES","ADDON_MOD_FORUM_SERVICES","ADDON_MOD_GLOSSARY_SERVICES","ADDON_MOD_H5P_ACTIVITY_SERVICES","ADDON_MOD_IMSCP_SERVICES","ADDON_MOD_LESSON_SERVICES","ADDON_MOD_LTI_SERVICES","ADDON_MOD_PAGE_SERVICES","ADDON_MOD_QUIZ_SERVICES","ADDON_MOD_RESOURCE_SERVICES","ADDON_MOD_SCORM_SERVICES","ADDON_MOD_SURVEY_SERVICES","ADDON_MOD_URL_SERVICES","ADDON_MOD_WIKI_SERVICES","getWorkshopComponentModules","getWorkshopServices","ADDON_NOTES_SERVICES","ADDON_NOTIFICATIONS_SERVICES","ADDON_PRIVATEFILES_SERVICES","AddonModAssignComponentsModule","CorePromisedValue","CorePlatform","CoreAutoLogoutService","CoreCompileProvider","constructor","injector","OTHER_SERVICES","IMPORTS","LAZY_IMPORTS","logger","getInstance","createAndCompileComponent","template","componentClass","viewContainerRef","extraImports","_this","_asyncToGenerator","component","lazyImports","Promise","all","map","getModules","imports","flatten","clear","ngModuleRef","declarations","schemas","createComponent","environmentInjector","error","message","evalInContext","javascript","eval","executeJavascript","instance","call","ex","injectLibraries","extraProviders","providers","i","providerDef","name","replace","get","CONFIG","forEach","classDef","getLazyLibraries","ADDON_MOD_WORKSHOP_SERVICES","i0","ɵɵinject","Injector","factory","ɵfac","providedIn","CoreCompile"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/compile/services/compile.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {\n    Injectable,\n    Injector,\n    Component,\n    NgModule,\n    ComponentRef,\n    NO_ERRORS_SCHEMA,\n    Type,\n    Provider,\n    createNgModule,\n    ViewContainerRef,\n} from '@angular/core';\nimport {\n    ActionSheetController,\n    AlertController,\n    LoadingController,\n    ModalController,\n    PopoverController,\n    ToastController,\n} from '@ionic/angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { TranslatePipeForCompile } from '../pipes/translate';\n\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreEvents } from '@singletons/events';\nimport { makeSingleton } from '@singletons';\n\n// Import core services.\nimport { CORE_SERVICES } from '@/core/core.module';\nimport { CORE_BLOCK_SERVICES } from '@features/block/block.module';\nimport { CORE_COMMENTS_SERVICES } from '@features/comments/comments.module';\nimport { CORE_CONTENTLINKS_SERVICES } from '@features/contentlinks/contentlinks.module';\nimport { CORE_COURSE_SERVICES } from '@features/course/course.module';\nimport { CORE_COURSES_SERVICES } from '@features/courses/courses.module';\nimport { CORE_EDITOR_SERVICES } from '@features/editor/editor.module';\nimport { CORE_ENROL_SERVICES } from '@features/enrol/enrol.module';\nimport { CORE_NATIVE_SERVICES } from '@features/native/native.module';\nimport { CORE_FILEUPLOADER_SERVICES } from '@features/fileuploader/fileuploader.module';\nimport { CORE_FILTER_SERVICES } from '@features/filter/filter.module';\nimport { CORE_GRADES_SERVICES } from '@features/grades/grades.module';\nimport { CORE_H5P_SERVICES } from '@features/h5p/h5p.module';\nimport { CORE_LOGIN_SERVICES } from '@features/login/login.module';\nimport { CORE_MAINMENU_SERVICES } from '@features/mainmenu/mainmenu.module';\nimport { CORE_PUSHNOTIFICATIONS_SERVICES } from '@features/pushnotifications/pushnotifications.module';\nimport { CORE_QUESTION_SERVICES } from '@features/question/question.module';\nimport { CORE_SHAREDFILES_SERVICES } from '@features/sharedfiles/sharedfiles.module';\nimport { CORE_RATING_SERVICES } from '@features/rating/rating.module';\nimport { CORE_SEARCH_SERVICES } from '@features/search/search.module';\nimport { CORE_SETTINGS_SERVICES } from '@features/settings/settings.module';\nimport { CORE_SITEHOME_SERVICES } from '@features/sitehome/sitehome.module';\nimport { CORE_TAG_SERVICES } from '@features/tag/tag.module';\nimport { CORE_STYLE_SERVICES } from '@features/styles/styles.module';\nimport { CORE_USER_SERVICES } from '@features/user/user.module';\nimport { CORE_XAPI_SERVICES } from '@features/xapi/xapi.module';\nimport { CoreSitePluginsProvider } from '@features/siteplugins/services/siteplugins';\n\n// Import other libraries and providers.\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\nimport { CoreConstants } from '@/core/constants';\nimport moment from 'moment-timezone';\nimport { Md5 } from 'ts-md5/dist/md5';\n\n// Import core classes that can be useful for site plugins.\nimport { CoreSyncBaseProvider } from '@classes/base-sync';\nimport { CoreArray } from '@singletons/array';\nimport { CoreComponentsRegistry } from '@singletons/components-registry';\nimport { CoreDirectivesRegistry } from '@singletons/directives-registry';\nimport { CoreDom } from '@singletons/dom';\nimport { CoreForms } from '@singletons/form';\nimport { CoreText } from '@singletons/text';\nimport { CoreTime } from '@singletons/time';\nimport { CoreUrl } from '@singletons/url';\nimport { CoreWindow } from '@singletons/window';\nimport { CoreCache } from '@classes/cache';\nimport { CoreDelegate } from '@classes/delegate';\nimport { CoreContentLinksHandlerBase } from '@features/contentlinks/classes/base-handler';\nimport { CoreContentLinksModuleGradeHandler } from '@features/contentlinks/classes/module-grade-handler';\nimport { CoreContentLinksModuleIndexHandler } from '@features/contentlinks/classes/module-index-handler';\nimport { CoreCourseActivityPrefetchHandlerBase } from '@features/course/classes/activity-prefetch-handler';\nimport { CoreCourseResourcePrefetchHandlerBase } from '@features/course/classes/resource-prefetch-handler';\nimport { CoreGeolocationError, CoreGeolocationErrorReason } from '@services/geolocation';\nimport { CORE_ERRORS_CLASSES } from '@classes/errors/errors';\nimport { CoreNetwork } from '@services/network';\n\n// Import all core modules that define components, directives and pipes.\nimport { CoreSharedModule } from '@/core/shared.module';\nimport { CoreCourseComponentsModule } from '@features/course/components/components.module';\nimport { CoreCourseDirectivesModule } from '@features/course/directives/directives.module';\nimport { CoreCoursesComponentsModule } from '@features/courses/components/components.module';\nimport { CoreSitePluginsDirectivesModule } from '@features/siteplugins/directives/directives.module';\nimport { CoreUserComponentsModule } from '@features/user/components/components.module';\nimport { CoreQuestionComponentsModule } from '@features/question/components/components.module';\nimport { CoreBlockComponentsModule } from '@features/block/components/components.module';\nimport { CoreEditorComponentsModule } from '@features/editor/components/components.module';\nimport { CoreSearchComponentsModule } from '@features/search/components/components.module';\n\n// Import some components so they can be injected dynamically.\nimport { CoreCourseUnsupportedModuleComponent } from '@features/course/components/unsupported-module/unsupported-module';\nimport { CoreCourseFormatSingleActivityComponent } from '@features/course/format/singleactivity/components/singleactivity';\nimport { CoreSitePluginsModuleIndexComponent } from '@features/siteplugins/components/module-index/module-index';\nimport { CoreSitePluginsBlockComponent } from '@features/siteplugins/components/block/block';\nimport { CoreSitePluginsCourseFormatComponent } from '@features/siteplugins/components/course-format/course-format';\nimport { CoreSitePluginsQuestionComponent } from '@features/siteplugins/components/question/question';\nimport { CoreSitePluginsQuestionBehaviourComponent } from '@features/siteplugins/components/question-behaviour/question-behaviour';\nimport { CoreSitePluginsUserProfileFieldComponent } from '@features/siteplugins/components/user-profile-field/user-profile-field';\nimport { CoreSitePluginsQuizAccessRuleComponent } from '@features/siteplugins/components/quiz-access-rule/quiz-access-rule';\nimport { CoreSitePluginsAssignFeedbackComponent } from '@features/siteplugins/components/assign-feedback/assign-feedback';\nimport { CoreSitePluginsAssignSubmissionComponent } from '@features/siteplugins/components/assign-submission/assign-submission';\n\n// Import addon providers. Do not import database module because it causes circular dependencies.\nimport { ADDON_BADGES_SERVICES } from '@addons/badges/badges.module';\nimport { ADDON_CALENDAR_SERVICES } from '@addons/calendar/calendar.module';\nimport { ADDON_COURSECOMPLETION_SERVICES } from '@addons/coursecompletion/coursecompletion.module';\nimport { ADDON_COMPETENCY_SERVICES } from '@addons/competency/competency.module';\nimport { ADDON_MESSAGEOUTPUT_SERVICES } from '@addons/messageoutput/messageoutput.module';\nimport { ADDON_MESSAGES_SERVICES } from '@addons/messages/messages.module';\nimport { ADDON_MOD_ASSIGN_SERVICES } from '@addons/mod/assign/assign.module';\nimport { ADDON_MOD_BOOK_SERVICES } from '@addons/mod/book/book.module';\nimport { ADDON_MOD_CHAT_SERVICES } from '@addons/mod/chat/chat.module';\nimport { ADDON_MOD_CHOICE_SERVICES } from '@addons/mod/choice/choice.module';\nimport { ADDON_MOD_FEEDBACK_SERVICES } from '@addons/mod/feedback/feedback.module';\nimport { ADDON_MOD_FOLDER_SERVICES } from '@addons/mod/folder/folder.module';\nimport { ADDON_MOD_FORUM_SERVICES } from '@addons/mod/forum/forum.module';\nimport { ADDON_MOD_GLOSSARY_SERVICES } from '@addons/mod/glossary/glossary.module';\nimport { ADDON_MOD_H5P_ACTIVITY_SERVICES } from '@addons/mod/h5pactivity/h5pactivity.module';\nimport { ADDON_MOD_IMSCP_SERVICES } from '@addons/mod/imscp/imscp.module';\nimport { ADDON_MOD_LESSON_SERVICES } from '@addons/mod/lesson/lesson.module';\nimport { ADDON_MOD_LTI_SERVICES } from '@addons/mod/lti/lti.module';\nimport { ADDON_MOD_PAGE_SERVICES } from '@addons/mod/page/page.module';\nimport { ADDON_MOD_QUIZ_SERVICES } from '@addons/mod/quiz/quiz.module';\nimport { ADDON_MOD_RESOURCE_SERVICES } from '@addons/mod/resource/resource.module';\nimport { ADDON_MOD_SCORM_SERVICES } from '@addons/mod/scorm/scorm.module';\nimport { ADDON_MOD_SURVEY_SERVICES } from '@addons/mod/survey/survey.module';\nimport { ADDON_MOD_URL_SERVICES } from '@addons/mod/url/url.module';\nimport { ADDON_MOD_WIKI_SERVICES } from '@addons/mod/wiki/wiki.module';\nimport { getWorkshopComponentModules, getWorkshopServices } from '@addons/mod/workshop/workshop.module';\nimport { ADDON_NOTES_SERVICES } from '@addons/notes/notes.module';\nimport { ADDON_NOTIFICATIONS_SERVICES } from '@addons/notifications/notifications.module';\nimport { ADDON_PRIVATEFILES_SERVICES } from '@addons/privatefiles/privatefiles.module';\n\n// Import some addon modules that define components, directives and pipes. Only import the important ones.\nimport { AddonModAssignComponentsModule } from '@addons/mod/assign/components/components.module';\nimport { CorePromisedValue } from '@classes/promised-value';\nimport { CorePlatform } from '@services/platform';\nimport { CoreAutoLogoutService } from '@features/autologout/services/autologout';\n\nimport '@angular/compiler';\n\n/**\n * Service to provide functionalities regarding compiling dynamic HTML and Javascript.\n */\n@Injectable({ providedIn: 'root' })\nexport class CoreCompileProvider {\n\n    protected logger: CoreLogger;\n\n    // Other Ionic/Angular providers that don't depend on where they are injected.\n    protected readonly OTHER_SERVICES: unknown[] = [\n        TranslateService, HttpClient, DomSanitizer, ActionSheetController, AlertController, LoadingController,\n        ModalController, PopoverController, ToastController, FormBuilder,\n    ];\n\n    // List of imports for dynamic module. Since the template can have any component we need to import all core components modules.\n    protected readonly IMPORTS = [\n        CoreSharedModule, CoreCourseComponentsModule, CoreCoursesComponentsModule, CoreUserComponentsModule,\n        CoreCourseDirectivesModule, CoreQuestionComponentsModule, AddonModAssignComponentsModule,\n        CoreBlockComponentsModule, CoreEditorComponentsModule, CoreSearchComponentsModule, CoreSitePluginsDirectivesModule,\n    ];\n\n    protected readonly LAZY_IMPORTS = [\n        getWorkshopComponentModules,\n    ];\n\n    constructor(protected injector: Injector) {\n        this.logger = CoreLogger.getInstance('CoreCompileProvider');\n    }\n\n    /**\n     * Create and compile a dynamic component.\n     *\n     * @param template The template of the component.\n     * @param componentClass The JS class of the component.\n     * @param viewContainerRef View container reference to inject the component.\n     * @param extraImports Extra imported modules if needed and not imported by this class.\n     * @returns Promise resolved with the component reference.\n     */\n    async createAndCompileComponent<T = unknown>(\n        template: string,\n        componentClass: Type<T>,\n        viewContainerRef: ViewContainerRef,\n        extraImports: any[] = [], // eslint-disable-line @typescript-eslint/no-explicit-any\n    ): Promise<ComponentRef<T> | undefined> {\n\n        // Create the component using the template and the class.\n        const component = Component({ template })(componentClass);\n\n        const lazyImports = await Promise.all(this.LAZY_IMPORTS.map(getModules => getModules()));\n        const imports = [\n            ...CoreArray.flatten(lazyImports),\n            ...this.IMPORTS,\n            ...extraImports,\n            TranslatePipeForCompile,\n        ];\n\n        try {\n            viewContainerRef.clear();\n\n            // Now create the module containing the component.\n            const ngModuleRef = createNgModule(\n                NgModule({ imports, declarations: [component], schemas: [NO_ERRORS_SCHEMA] })(class {}),\n                this.injector,\n            );\n\n            return viewContainerRef.createComponent(\n                component,\n                {\n                    environmentInjector: ngModuleRef,\n                },\n            );\n        } catch (error) {\n            this.logger.error('Error compiling template', template);\n            this.logger.error(error);\n            error.message = 'Template has some errors and cannot be displayed.';\n\n            throw error;\n        }\n    }\n\n    /**\n     * Eval some javascript using the context of the function.\n     *\n     * @param javascript The javascript to eval.\n     * @returns Result of the eval.\n     */\n    protected evalInContext(javascript: string): unknown {\n        // eslint-disable-next-line no-eval\n        return eval(javascript);\n    }\n\n    /**\n     * Execute some javascript code, using a certain instance as the context.\n     *\n     * @param instance Instance to use as the context. In the JS code, \"this\" will be this instance.\n     * @param javascript The javascript code to eval.\n     * @returns Result of the javascript execution.\n     */\n    executeJavascript(instance: unknown, javascript: string): unknown {\n        try {\n            return this.evalInContext.call(instance, javascript);\n        } catch (ex) {\n            this.logger.error('Error evaluating javascript', ex);\n        }\n    }\n\n    /**\n     * Inject all the core libraries in a certain object.\n     *\n     * @param instance The instance where to inject the libraries.\n     * @param extraProviders Extra imported providers if needed and not imported by this class.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    injectLibraries(instance: any, extraProviders: Type<unknown>[] = []): void {\n        const providers = [\n            ...CORE_SERVICES,\n            CoreAutoLogoutService,\n            ...CORE_BLOCK_SERVICES,\n            ...CORE_COMMENTS_SERVICES,\n            ...CORE_CONTENTLINKS_SERVICES,\n            ...CORE_COURSE_SERVICES,\n            ...CORE_COURSES_SERVICES,\n            ...CORE_EDITOR_SERVICES,\n            ...CORE_ENROL_SERVICES,\n            ...CORE_FILEUPLOADER_SERVICES,\n            ...CORE_FILTER_SERVICES,\n            ...CORE_GRADES_SERVICES,\n            ...CORE_H5P_SERVICES,\n            ...CORE_MAINMENU_SERVICES,\n            ...CORE_LOGIN_SERVICES,\n            ...CORE_QUESTION_SERVICES,\n            ...CORE_PUSHNOTIFICATIONS_SERVICES,\n            ...CORE_RATING_SERVICES,\n            ...CORE_SEARCH_SERVICES,\n            ...CORE_SETTINGS_SERVICES,\n            ...CORE_SHAREDFILES_SERVICES,\n            ...CORE_SITEHOME_SERVICES,\n            CoreSitePluginsProvider,\n            ...CORE_TAG_SERVICES,\n            ...CORE_STYLE_SERVICES,\n            ...CORE_USER_SERVICES,\n            ...CORE_XAPI_SERVICES,\n            ...CORE_NATIVE_SERVICES,\n            ...this.OTHER_SERVICES,\n            ...extraProviders,\n            ...ADDON_BADGES_SERVICES,\n            ...ADDON_CALENDAR_SERVICES,\n            ...ADDON_COURSECOMPLETION_SERVICES,\n            ...ADDON_COMPETENCY_SERVICES,\n            ...ADDON_MESSAGEOUTPUT_SERVICES,\n            ...ADDON_MESSAGES_SERVICES,\n            ...ADDON_MOD_ASSIGN_SERVICES,\n            ...ADDON_MOD_BOOK_SERVICES,\n            ...ADDON_MOD_CHAT_SERVICES,\n            ...ADDON_MOD_CHOICE_SERVICES,\n            ...ADDON_MOD_FEEDBACK_SERVICES,\n            ...ADDON_MOD_FOLDER_SERVICES,\n            ...ADDON_MOD_FORUM_SERVICES,\n            ...ADDON_MOD_GLOSSARY_SERVICES,\n            ...ADDON_MOD_H5P_ACTIVITY_SERVICES,\n            ...ADDON_MOD_IMSCP_SERVICES,\n            ...ADDON_MOD_LESSON_SERVICES,\n            ...ADDON_MOD_LTI_SERVICES,\n            ...ADDON_MOD_PAGE_SERVICES,\n            ...ADDON_MOD_QUIZ_SERVICES,\n            ...ADDON_MOD_RESOURCE_SERVICES,\n            ...ADDON_MOD_SCORM_SERVICES,\n            ...ADDON_MOD_SURVEY_SERVICES,\n            ...ADDON_MOD_URL_SERVICES,\n            ...ADDON_MOD_WIKI_SERVICES,\n            ...ADDON_NOTES_SERVICES,\n            ...ADDON_NOTIFICATIONS_SERVICES,\n            ...ADDON_PRIVATEFILES_SERVICES,\n        ];\n\n        // We cannot inject anything to this constructor. Use the Injector to inject all the providers into the instance.\n        for (const i in providers) {\n            const providerDef = providers[i];\n            if (typeof providerDef === 'function' && providerDef.name) {\n                try {\n                    // Inject the provider to the instance. We use the class name as the property name.\n                    instance[providerDef.name.replace(/DelegateService$/, 'Delegate')] = this.injector.get<Provider>(providerDef);\n                } catch (ex) {\n                    this.logger.error('Error injecting provider', providerDef.name, ex);\n                }\n            }\n        }\n\n        // Inject current service.\n        instance['CoreCompileProvider'] = this;\n\n        // Add some final classes.\n        instance['injector'] = this.injector;\n        instance['Validators'] = Validators;\n        instance['CoreConstants'] = CoreConstants;\n        instance['CoreConfigConstants'] = CoreConstants.CONFIG;\n        instance['CoreEventsProvider'] = CoreEvents;\n        instance['CoreLoggerProvider'] = CoreLogger;\n        instance['moment'] = moment;\n        instance['Md5'] = Md5;\n        instance['Network'] = CoreNetwork.instance; // @deprecated since 4.1, plugins should use CoreNetwork instead.\n        instance['Platform'] = CorePlatform.instance; // @deprecated since 4.1, plugins should use CorePlatform instead.\n        instance['CoreSyncBaseProvider'] = CoreSyncBaseProvider;\n        instance['CoreArray'] = CoreArray;\n        // eslint-disable-next-line deprecation/deprecation\n        instance['CoreComponentsRegistry'] = CoreComponentsRegistry;\n        instance['CoreDirectivesRegistry'] = CoreDirectivesRegistry;\n        instance['CoreNetwork'] = CoreNetwork.instance;\n        instance['CorePlatform'] = CorePlatform.instance;\n        instance['CoreDom'] = CoreDom;\n        instance['CoreForms'] = CoreForms;\n        instance['CoreText'] = CoreText;\n        instance['CoreTime'] = CoreTime;\n        instance['CoreUrl'] = CoreUrl;\n        instance['CoreWindow'] = CoreWindow;\n        instance['CoreCache'] = CoreCache; // @deprecated since 4.4, plugins should use plain objects instead.\n        instance['CoreDelegate'] = CoreDelegate;\n        instance['CorePromisedValue'] = CorePromisedValue;\n        instance['CoreContentLinksHandlerBase'] = CoreContentLinksHandlerBase;\n        instance['CoreContentLinksModuleGradeHandler'] = CoreContentLinksModuleGradeHandler;\n        instance['CoreContentLinksModuleIndexHandler'] = CoreContentLinksModuleIndexHandler;\n        instance['CoreCourseActivityPrefetchHandlerBase'] = CoreCourseActivityPrefetchHandlerBase;\n        instance['CoreCourseResourcePrefetchHandlerBase'] = CoreCourseResourcePrefetchHandlerBase;\n        instance['CoreCourseUnsupportedModuleComponent'] = CoreCourseUnsupportedModuleComponent;\n        instance['CoreCourseFormatSingleActivityComponent'] = CoreCourseFormatSingleActivityComponent;\n        instance['CoreSitePluginsModuleIndexComponent'] = CoreSitePluginsModuleIndexComponent;\n        instance['CoreSitePluginsBlockComponent'] = CoreSitePluginsBlockComponent;\n        instance['CoreSitePluginsCourseFormatComponent'] = CoreSitePluginsCourseFormatComponent;\n        instance['CoreSitePluginsQuestionComponent'] = CoreSitePluginsQuestionComponent;\n        instance['CoreSitePluginsQuestionBehaviourComponent'] = CoreSitePluginsQuestionBehaviourComponent;\n        instance['CoreSitePluginsUserProfileFieldComponent'] = CoreSitePluginsUserProfileFieldComponent;\n        instance['CoreSitePluginsQuizAccessRuleComponent'] = CoreSitePluginsQuizAccessRuleComponent;\n        instance['CoreSitePluginsAssignFeedbackComponent'] = CoreSitePluginsAssignFeedbackComponent;\n        instance['CoreSitePluginsAssignSubmissionComponent'] = CoreSitePluginsAssignSubmissionComponent;\n        instance['CoreGeolocationError'] = CoreGeolocationError;\n        instance['CoreGeolocationErrorReason'] = CoreGeolocationErrorReason;\n        CORE_ERRORS_CLASSES.forEach((classDef) => {\n            instance[classDef.name] = classDef;\n        });\n    }\n\n    /**\n     * Get lazy libraries to inject.\n     *\n     * @returns Lazy libraries.\n     */\n    async getLazyLibraries(): Promise<Type<unknown>[]> {\n        const ADDON_MOD_WORKSHOP_SERVICES = await getWorkshopServices();\n\n        return [\n            ...ADDON_MOD_WORKSHOP_SERVICES,\n        ];\n    }\n\n}\n\nexport const CoreCompile = makeSingleton(CoreCompileProvider);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}