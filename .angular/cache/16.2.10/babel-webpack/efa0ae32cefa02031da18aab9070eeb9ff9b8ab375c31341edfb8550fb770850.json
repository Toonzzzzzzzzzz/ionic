{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreEvents } from '@singletons/events';\nimport { CoreSites } from '@services/sites';\nimport { CoreComments, CoreCommentsProvider } from '@features/comments/services/comments';\nimport { CoreCommentsSync, CoreCommentsSyncProvider } from '@features/comments/services/comments-sync';\nimport { IonContent } from '@ionic/angular';\nimport { CoreConstants } from '@/core/constants';\nimport { CoreNavigator } from '@services/navigator';\nimport { NgZone, Translate } from '@singletons';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreDomUtils, ToastDuration } from '@services/utils/dom';\nimport { CoreUser } from '@features/user/services/user';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { CoreError } from '@classes/errors/error';\nimport { CoreCommentsOffline } from '@features/comments/services/comments-offline';\nimport { CoreTimeUtils } from '@services/utils/time';\nimport { CoreApp } from '@services/app';\nimport { CoreNetwork } from '@services/network';\nimport moment from 'moment-timezone';\nimport { CoreAnimations } from '@components/animations';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../../components/context-menu/context-menu\";\nimport * as i4 from \"../../../../components/context-menu/context-menu-item\";\nimport * as i5 from \"../../../../components/empty-box/empty-box\";\nimport * as i6 from \"../../../../components/infinite-loading/infinite-loading\";\nimport * as i7 from \"../../../../components/loading/loading\";\nimport * as i8 from \"../../../../components/message/message\";\nimport * as i9 from \"../../../../components/send-message-form/send-message-form\";\nimport * as i10 from \"../../../../directives/fa-icon\";\nimport * as i11 from \"../../../../directives/format-text\";\nimport * as i12 from \"../../../../directives/content\";\nimport * as i13 from \"../../../../directives/update-non-reactive-attributes\";\nimport * as i14 from \"@ionic/angular\";\nimport * as i15 from \"../../../../pipes/format-date\";\nimport * as i16 from \"@ngx-translate/core\";\nfunction CoreCommentsViewerPage_ion_button_9_ion_icon_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"ion-icon\", 19);\n  }\n}\nfunction CoreCommentsViewerPage_ion_button_9_ion_icon_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"ion-icon\", 20);\n  }\n}\nfunction CoreCommentsViewerPage_ion_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function CoreCommentsViewerPage_ion_button_9_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.toggleDelete());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵtemplate(2, CoreCommentsViewerPage_ion_button_9_ion_icon_2_Template, 1, 0, \"ion-icon\", 17);\n    i0.ɵɵtemplate(3, CoreCommentsViewerPage_ion_button_9_ion_icon_3_Template, 1, 0, \"ion-icon\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 3, \"core.toggledelete\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.showDelete);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showDelete);\n  }\n}\nfunction CoreCommentsViewerPage_core_empty_box_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-empty-box\", 21);\n    i0.ɵɵpipe(1, \"translate\");\n  }\n  if (rf & 2) {\n    i0.ɵɵproperty(\"message\", i0.ɵɵpipeBind1(1, 1, \"core.comments.nocomments\"));\n  }\n}\nfunction CoreCommentsViewerPage_ng_container_23_p_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"coreFormatDate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const comment_r10 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, comment_r10.timecreated * 1000, \"strftimedayshort\"), \" \");\n  }\n}\nfunction CoreCommentsViewerPage_ng_container_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CoreCommentsViewerPage_ng_container_23_p_1_Template, 3, 4, \"p\", 22);\n    i0.ɵɵelementStart(2, \"core-message\", 23);\n    i0.ɵɵlistener(\"onDeleteMessage\", function CoreCommentsViewerPage_ng_container_23_Template_core_message_onDeleteMessage_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const comment_r10 = restoredCtx.$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.deleteComment(comment_r10));\n    })(\"onUndoDeleteMessage\", function CoreCommentsViewerPage_ng_container_23_Template_core_message_onUndoDeleteMessage_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const comment_r10 = restoredCtx.$implicit;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.undoDeleteComment(comment_r10));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const comment_r10 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", comment_r10.showDate);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"message\", comment_r10)(\"text\", comment_r10.content)(\"time\", comment_r10.timecreated * 1000)(\"user\", comment_r10)(\"showDelete\", ctx_r2.showDelete)(\"contextLevel\", ctx_r2.contextLevel)(\"instanceId\", ctx_r2.instanceId)(\"courseId\", ctx_r2.courseId);\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    $a: a0\n  };\n};\nfunction CoreCommentsViewerPage_ion_badge_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-badge\", 25);\n    i0.ɵɵelement(1, \"ion-icon\", 26);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵpipe(4, \"lowercase\");\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(3, 1, \"core.thereisdatatosync\", i0.ɵɵpureFunction1(8, _c0, i0.ɵɵpipeBind1(4, 4, i0.ɵɵpipeBind1(5, 6, \"core.comments.comments\")))), \" \");\n  }\n}\nfunction CoreCommentsViewerPage_core_message_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-message\", 27);\n    i0.ɵɵlistener(\"onDeleteMessage\", function CoreCommentsViewerPage_core_message_25_Template_core_message_onDeleteMessage_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.deleteComment(ctx_r18.offlineComment));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"message\", ctx_r4.offlineComment)(\"text\", ctx_r4.offlineComment.content)(\"user\", ctx_r4.offlineComment)(\"showDelete\", ctx_r4.showDelete)(\"contextLevel\", ctx_r4.contextLevel)(\"instanceId\", ctx_r4.instanceId)(\"courseId\", ctx_r4.courseId);\n  }\n}\nfunction CoreCommentsViewerPage_ion_footer_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-footer\", 28)(1, \"ion-toolbar\")(2, \"core-send-message-form\", 29);\n    i0.ɵɵlistener(\"onSubmit\", function CoreCommentsViewerPage_ion_footer_26_Template_core_send_message_form_onSubmit_2_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.addComment($event));\n    });\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"sendDisabled\", ctx_r5.sending)(\"message\", ctx_r5.newComment)(\"placeholder\", i0.ɵɵpipeBind1(3, 3, \"core.comments.addcomment\"));\n  }\n}\n/**\n * Page that displays comments.\n */\nexport class CoreCommentsViewerPage {\n  constructor(route) {\n    this.route = route;\n    this.comments = [];\n    this.commentsLoaded = false;\n    this.itemId = 0;\n    this.area = '';\n    this.page = 0;\n    this.title = '';\n    this.canLoadMore = false;\n    this.loadMoreError = false;\n    this.canAddComments = false;\n    this.canDeleteComments = false;\n    this.showDelete = false;\n    this.hasOffline = false;\n    this.refreshIcon = CoreConstants.ICON_LOADING;\n    this.syncIcon = CoreConstants.ICON_LOADING;\n    this.sending = false;\n    this.newComment = '';\n    this.addDeleteCommentsAvailable = false;\n    this.viewDestroyed = false;\n    this.currentUserId = CoreSites.getCurrentSiteUserId();\n    // Refresh data if comments are synchronized automatically.\n    this.syncObserver = CoreEvents.on(CoreCommentsSyncProvider.AUTO_SYNCED, data => {\n      if (data.contextLevel == this.contextLevel && data.instanceId == this.instanceId && data.componentName == this.componentName && data.itemId == this.itemId && data.area == this.area) {\n        // Show the sync warnings.\n        this.showSyncWarnings(data.warnings);\n        // Refresh the data.\n        this.commentsLoaded = false;\n        this.refreshIcon = CoreConstants.ICON_LOADING;\n        this.syncIcon = CoreConstants.ICON_LOADING;\n        this.page = 0;\n        this.comments = [];\n        this.fetchComments(false);\n      }\n    }, CoreSites.getCurrentSiteId());\n    this.isOnline = CoreNetwork.isOnline();\n    this.onlineObserver = CoreNetwork.onChange().subscribe(() => {\n      // Execute the callback in the Angular zone, so change detection doesn't stop working.\n      NgZone.run(() => {\n        this.isOnline = CoreNetwork.isOnline();\n      });\n    });\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        _this.contextLevel = CoreNavigator.getRequiredRouteParam('contextLevel');\n        _this.instanceId = CoreNavigator.getRequiredRouteNumberParam('instanceId');\n        _this.componentName = CoreNavigator.getRequiredRouteParam('componentName');\n        _this.itemId = CoreNavigator.getRequiredRouteNumberParam('itemId');\n        _this.area = CoreNavigator.getRouteParam('area') || '';\n        _this.title = CoreNavigator.getRouteParam('title') || Translate.instant('core.comments.comments');\n        _this.courseId = CoreNavigator.getRouteNumberParam('courseId');\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n        CoreNavigator.back();\n        return;\n      }\n      // Is implicit the user can delete if he can add.\n      _this.addDeleteCommentsAvailable = yield CoreComments.isAddCommentsAvailable();\n      _this.currentUserId = CoreSites.getCurrentSiteUserId();\n      _this.commentsLoaded = false;\n      yield _this.fetchComments(true);\n    })();\n  }\n  /**\n   * Fetches the comments.\n   *\n   * @param sync When to resync comments.\n   * @param showErrors When to display errors or not.\n   * @returns Resolved when done.\n   */\n  fetchComments(sync, showErrors = false) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.loadMoreError = false;\n      if (sync) {\n        yield CoreUtils.ignoreErrors(_this2.syncComments(showErrors));\n      }\n      try {\n        // Get comments data.\n        const commentsResponse = yield CoreComments.getComments(_this2.contextLevel, _this2.instanceId, _this2.componentName, _this2.itemId, _this2.area, _this2.page);\n        _this2.canAddComments = _this2.addDeleteCommentsAvailable && !!commentsResponse.canpost;\n        let comments = commentsResponse.comments.sort((a, b) => a.timecreated - b.timecreated);\n        if (commentsResponse.count !== undefined) {\n          _this2.canLoadMore = _this2.comments.length + comments.length < commentsResponse.count;\n        } else {\n          // Old style.\n          _this2.canLoadMore = commentsResponse.comments.length > 0 && commentsResponse.comments.length >= CoreCommentsProvider.pageSize;\n        }\n        comments = yield Promise.all(comments.map(comment => _this2.loadCommentProfile(comment)));\n        _this2.comments = comments.concat(_this2.comments);\n        _this2.comments.forEach((comment, index) => _this2.calculateCommentData(comment, _this2.comments[index - 1]));\n        _this2.canDeleteComments = _this2.addDeleteCommentsAvailable && (_this2.hasOffline || _this2.comments.some(comment => !!comment.delete));\n        yield _this2.loadOfflineData();\n      } catch (error) {\n        _this2.loadMoreError = true; // Set to prevent infinite calls with infinite-loading.\n        if (error && _this2.componentName == 'assignsubmission_comments') {\n          CoreDomUtils.showAlertTranslated('core.notice', 'core.comments.commentsnotworking');\n        } else {\n          CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.error') + ': get_comments');\n        }\n      } finally {\n        _this2.commentsLoaded = true;\n        _this2.refreshIcon = CoreConstants.ICON_REFRESH;\n        _this2.syncIcon = CoreConstants.ICON_SYNC;\n        if (_this2.page == 0) {\n          _this2.scrollToBottom();\n        }\n      }\n    })();\n  }\n  /**\n   * Calculate some comment data.\n   *\n   * @param comment Comment.\n   * @param prevComment Previous comment.\n   */\n  calculateCommentData(comment, prevComment) {\n    var _comment$delete;\n    comment.showDate = this.showDate(comment, prevComment);\n    comment.showUserData = this.showUserData(comment, prevComment);\n    comment.showTail = this.showTail(comment, prevComment);\n    comment.delete = (_comment$delete = comment.delete) !== null && _comment$delete !== void 0 ? _comment$delete : false; // If this property is undefined, core-message assumes comment can be deleted.\n  }\n  /**\n   * Function to load more commemts.\n   *\n   * @param infiniteComplete Infinite scroll complete function. Only used from core-infinite-loading.\n   * @returns Resolved when done.\n   */\n  loadPrevious(infiniteComplete) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.page++;\n      _this3.canLoadMore = false;\n      try {\n        yield _this3.fetchComments(true);\n      } finally {\n        infiniteComplete && infiniteComplete();\n      }\n    })();\n  }\n  /**\n   * Refresh the comments.\n   *\n   * @param showErrors Whether to display errors or not.\n   * @param refresher Refresher.\n   * @returns Resolved when done.\n   */\n  refreshComments(showErrors, refresher) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      _this4.commentsLoaded = false;\n      _this4.refreshIcon = CoreConstants.ICON_LOADING;\n      _this4.syncIcon = CoreConstants.ICON_LOADING;\n      yield CoreUtils.ignoreErrors(_this4.invalidateComments());\n      _this4.page = 0;\n      _this4.comments = [];\n      try {\n        yield _this4.fetchComments(true, showErrors);\n      } finally {\n        refresher === null || refresher === void 0 || refresher.complete();\n      }\n    })();\n  }\n  /**\n   * Show sync warnings if any.\n   *\n   * @param warnings the warnings\n   */\n  showSyncWarnings(warnings) {\n    const message = CoreTextUtils.buildMessage(warnings);\n    if (message) {\n      CoreDomUtils.showAlert(undefined, message);\n    }\n  }\n  /**\n   * Tries to synchronize comments.\n   *\n   * @param showErrors Whether to display errors or not.\n   * @returns Promise resolved if sync is successful, rejected otherwise.\n   */\n  syncComments(showErrors) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const result = yield CoreCommentsSync.syncComments(_this5.contextLevel, _this5.instanceId, _this5.componentName, _this5.itemId, _this5.area);\n        _this5.showSyncWarnings((result === null || result === void 0 ? void 0 : result.warnings) || []);\n      } catch (error) {\n        if (showErrors) {\n          CoreDomUtils.showErrorModalDefault(error, 'core.errorsync', true);\n        }\n        throw new CoreError(error);\n      }\n    })();\n  }\n  /**\n   * Send the comment or store it offline.\n   *\n   * @param text Comment text to add.\n   */\n  addComment(text) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      CoreApp.closeKeyboard();\n      const loadingModal = yield CoreDomUtils.showModalLoading('core.sending', true);\n      // Freeze the add comment button.\n      _this6.sending = true;\n      try {\n        const commentsResponse = yield CoreComments.addComment(text, _this6.contextLevel, _this6.instanceId, _this6.componentName, _this6.itemId, _this6.area);\n        CoreDomUtils.showToast(commentsResponse ? 'core.comments.eventcommentcreated' : 'core.datastoredoffline', true, ToastDuration.LONG);\n        if (commentsResponse) {\n          _this6.invalidateComments();\n          const addedComment = yield _this6.loadCommentProfile(commentsResponse);\n          _this6.calculateCommentData(addedComment, _this6.comments[_this6.comments.length - 1]);\n          // Add the comment to the top.\n          _this6.comments = _this6.comments.concat([addedComment]);\n          _this6.canDeleteComments = _this6.addDeleteCommentsAvailable;\n          CoreEvents.trigger(CoreCommentsProvider.COMMENTS_COUNT_CHANGED_EVENT, {\n            contextLevel: _this6.contextLevel,\n            instanceId: _this6.instanceId,\n            component: _this6.componentName,\n            itemId: _this6.itemId,\n            area: _this6.area,\n            countChange: 1\n          }, CoreSites.getCurrentSiteId());\n          _this6.refreshInBackground();\n        } else if (commentsResponse === false) {\n          // Comments added in offline mode.\n          yield _this6.loadOfflineData();\n        }\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n      } finally {\n        loadingModal.dismiss();\n        _this6.sending = false;\n        // New comments.\n        _this6.scrollToBottom();\n      }\n    })();\n  }\n  /**\n   * Delete a comment.\n   *\n   * @param comment Comment to delete.\n   */\n  deleteComment(comment) {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      const modified = 'lastmodified' in comment ? comment.lastmodified : comment.timecreated;\n      const time = CoreTimeUtils.userDate(modified * 1000, 'core.strftimerecentfull');\n      const deleteComment = {\n        contextlevel: _this7.contextLevel,\n        instanceid: _this7.instanceId,\n        component: _this7.componentName,\n        itemid: _this7.itemId,\n        area: _this7.area,\n        content: comment.content,\n        id: 'id' in comment ? comment.id : undefined\n      };\n      try {\n        yield CoreDomUtils.showDeleteConfirm('core.comments.deletecommentbyon', {\n          $a: {\n            user: comment.fullname || '',\n            time: time\n          }\n        });\n      } catch (_unused) {\n        // User cancelled, nothing to do.\n        return;\n      }\n      try {\n        const deletedOnline = yield CoreComments.deleteComment(deleteComment);\n        _this7.showDelete = false;\n        if (deletedOnline && 'id' in comment) {\n          const index = _this7.comments.findIndex(commentinList => commentinList.id == comment.id);\n          if (index >= 0) {\n            _this7.comments.splice(index, 1);\n            CoreEvents.trigger(CoreCommentsProvider.COMMENTS_COUNT_CHANGED_EVENT, {\n              contextLevel: _this7.contextLevel,\n              instanceId: _this7.instanceId,\n              component: _this7.componentName,\n              itemId: _this7.itemId,\n              area: _this7.area,\n              countChange: -1\n            }, CoreSites.getCurrentSiteId());\n            _this7.refreshInBackground();\n          }\n        } else {\n          _this7.loadOfflineData();\n        }\n        _this7.invalidateComments();\n        CoreDomUtils.showToast('core.comments.eventcommentdeleted', true, ToastDuration.LONG);\n      } catch (error) {\n        CoreDomUtils.showErrorModalDefault(error, 'Delete comment failed.');\n      }\n    })();\n  }\n  /**\n   * Invalidate comments.\n   *\n   * @returns Resolved when done.\n   */\n  invalidateComments() {\n    return CoreComments.invalidateCommentsData(this.contextLevel, this.instanceId, this.componentName, this.itemId, this.area);\n  }\n  /**\n   * Loads the profile info onto the comment object.\n   *\n   * @param comment Comment object.\n   * @returns Promise resolved with modified comment when done.\n   */\n  loadCommentProfile(comment) {\n    return _asyncToGenerator(function* () {\n      if (!comment.userid) {\n        return comment;\n      }\n      try {\n        // Get the user profile image.\n        const user = yield CoreUser.getProfile(comment.userid, undefined, true);\n        comment.profileimageurl = user.profileimageurl;\n        comment.fullname = user.fullname;\n      } catch (_unused2) {\n        // Ignore errors.\n      }\n      return comment;\n    })();\n  }\n  /**\n   * Check if the user info should be displayed for the current message.\n   * User data is only displayed if the previous message was from another user.\n   *\n   * @param comment Comment object.\n   * @param prevComment Previous comment object.\n   * @returns Whether user data should be shown.\n   */\n  showUserData(comment, prevComment) {\n    return comment.userid != this.currentUserId && (!prevComment || prevComment.userid != comment.userid || !!comment.showDate);\n  }\n  /**\n   * Check if a css tail should be shown.\n   *\n   * @param comment Comment object.\n   * @param nextComment Previous comment object.\n   * @returns Whether user data should be shown.\n   */\n  showTail(comment, nextComment) {\n    return !nextComment || nextComment.userid != comment.userid || !!nextComment.showDate;\n  }\n  /**\n   * Check if the date should be displayed between messages (when the day changes at midnight for example).\n   *\n   * @param comment Comment object.\n   * @param prevComment Previous comment object.\n   * @returns True if messages are from diferent days, false othetwise.\n   */\n  showDate(comment, prevComment) {\n    if (!prevComment) {\n      return true;\n    }\n    // Check if day has changed.\n    return !moment(comment.timecreated * 1000).isSame(prevComment.timecreated * 1000, 'day');\n  }\n  /**\n   * Load offline comments.\n   *\n   * @returns Promise resolved when done.\n   */\n  loadOfflineData() {\n    var _this8 = this;\n    return _asyncToGenerator(function* () {\n      const promises = [];\n      let hasDeletedComments = false;\n      // Load the only offline comment allowed if any.\n      promises.push(CoreCommentsOffline.getComment(_this8.contextLevel, _this8.instanceId, _this8.componentName, _this8.itemId, _this8.area).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (offlineComment) {\n          _this8.offlineComment = offlineComment;\n          if (!_this8.offlineComment) {\n            return;\n          }\n          if (_this8.newComment == '') {\n            _this8.newComment = _this8.offlineComment.content;\n          }\n          _this8.offlineComment.userid = _this8.currentUserId;\n          _this8.offlineComment.pending = true;\n          return;\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()));\n      // Load deleted comments offline.\n      promises.push(CoreCommentsOffline.getDeletedComments(_this8.contextLevel, _this8.instanceId, _this8.componentName, _this8.itemId, _this8.area).then(deletedComments => {\n        hasDeletedComments = deletedComments && deletedComments.length > 0;\n        if (hasDeletedComments) {\n          deletedComments.forEach(deletedComment => {\n            const comment = _this8.comments.find(comment => comment.id == deletedComment.commentid);\n            if (comment) {\n              comment.deleted = !!deletedComment.deleted;\n            }\n          });\n        }\n        return;\n      }));\n      yield Promise.all(promises);\n      _this8.hasOffline = !!_this8.offlineComment || hasDeletedComments;\n    })();\n  }\n  /**\n   * Restore a comment.\n   *\n   * @param comment Comment to delete.\n   */\n  undoDeleteComment(comment) {\n    var _this9 = this;\n    return _asyncToGenerator(function* () {\n      yield CoreCommentsOffline.undoDeleteComment(comment.id);\n      comment.deleted = false;\n      _this9.showDelete = false;\n    })();\n  }\n  /**\n   * Scroll bottom when render has finished.\n   */\n  scrollToBottom() {\n    // Need a timeout to leave time to the view to be rendered.\n    setTimeout(() => {\n      if (!this.viewDestroyed) {\n        var _this$content;\n        (_this$content = this.content) === null || _this$content === void 0 || _this$content.scrollToBottom();\n      }\n    }, 100);\n  }\n  /**\n   * Toggle delete.\n   */\n  toggleDelete() {\n    this.showDelete = !this.showDelete;\n  }\n  /**\n   * Refresh cached data in background.\n   */\n  refreshInBackground() {\n    var _this10 = this;\n    return _asyncToGenerator(function* () {\n      yield CoreUtils.ignoreErrors(_this10.invalidateComments());\n      const promises = [];\n      for (let i = 0; i <= _this10.page; i++) {\n        promises.push(CoreComments.getComments(_this10.contextLevel, _this10.instanceId, _this10.componentName, _this10.itemId, _this10.area, i));\n      }\n      yield Promise.all(promises);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnDestroy() {\n    var _this$syncObserver;\n    (_this$syncObserver = this.syncObserver) === null || _this$syncObserver === void 0 || _this$syncObserver.off();\n    this.onlineObserver.unsubscribe();\n    this.viewDestroyed = true;\n  }\n}\n_class = CoreCommentsViewerPage;\n_class.ɵfac = function CoreCommentsViewerPage_Factory(t) {\n  return new (t || _class)(i0.ɵɵdirectiveInject(i1.ActivatedRoute));\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-core-comments-viewer\"]],\n  viewQuery: function CoreCommentsViewerPage_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(IonContent, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.content = _t.first);\n    }\n  },\n  decls: 27,\n  vars: 34,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [3, \"text\", \"contextLevel\", \"contextInstanceId\", \"courseId\"], [\"slot\", \"end\"], [\"slot\", \"end\", \"fill\", \"clear\", 3, \"click\", 4, \"ngIf\"], [3, \"hidden\", \"priority\", \"content\", \"iconAction\", \"closeOnClick\", \"action\"], [\"slot\", \"fixed\", 3, \"disabled\", \"ionRefresh\"], [3, \"pullingText\"], [3, \"hideUntil\"], [\"icon\", \"fas-comments\", 3, \"message\", 4, \"ngIf\"], [\"position\", \"top\", 3, \"enabled\", \"error\", \"action\"], [1, \"addon-messages-discussion-container\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"ion-text-wrap\", \"color\", \"info\", 4, \"ngIf\"], [3, \"message\", \"text\", \"user\", \"showDelete\", \"contextLevel\", \"instanceId\", \"courseId\", \"onDeleteMessage\", 4, \"ngIf\"], [\"class\", \"footer-adjustable\", 4, \"ngIf\"], [\"slot\", \"end\", \"fill\", \"clear\", 3, \"click\"], [\"name\", \"fas-pen\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [\"name\", \"fas-check\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [\"name\", \"fas-pen\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"name\", \"fas-check\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"icon\", \"fas-comments\", 3, \"message\"], [\"class\", \"ion-text-center addon-messages-date\", 4, \"ngIf\"], [3, \"message\", \"text\", \"time\", \"user\", \"showDelete\", \"contextLevel\", \"instanceId\", \"courseId\", \"onDeleteMessage\", \"onUndoDeleteMessage\"], [1, \"ion-text-center\", \"addon-messages-date\"], [\"color\", \"info\", 1, \"ion-text-wrap\"], [\"name\", \"fas-triangle-exclamation\", \"aria-hidden\", \"true\"], [3, \"message\", \"text\", \"user\", \"showDelete\", \"contextLevel\", \"instanceId\", \"courseId\", \"onDeleteMessage\"], [1, \"footer-adjustable\"], [3, \"sendDisabled\", \"message\", \"placeholder\", \"onSubmit\"]],\n  template: function CoreCommentsViewerPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\")(6, \"h1\");\n      i0.ɵɵelement(7, \"core-format-text\", 2);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(8, \"ion-buttons\", 3);\n      i0.ɵɵtemplate(9, CoreCommentsViewerPage_ion_button_9_Template, 4, 5, \"ion-button\", 4);\n      i0.ɵɵelementStart(10, \"core-context-menu\")(11, \"core-context-menu-item\", 5);\n      i0.ɵɵlistener(\"action\", function CoreCommentsViewerPage_Template_core_context_menu_item_action_11_listener() {\n        return ctx.refreshComments(false);\n      });\n      i0.ɵɵpipe(12, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"core-context-menu-item\", 5);\n      i0.ɵɵlistener(\"action\", function CoreCommentsViewerPage_Template_core_context_menu_item_action_13_listener() {\n        return ctx.refreshComments(true);\n      });\n      i0.ɵɵpipe(14, \"translate\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(15, \"ion-content\")(16, \"ion-refresher\", 6);\n      i0.ɵɵlistener(\"ionRefresh\", function CoreCommentsViewerPage_Template_ion_refresher_ionRefresh_16_listener($event) {\n        return ctx.refreshComments(false, $event.target);\n      });\n      i0.ɵɵelement(17, \"ion-refresher-content\", 7);\n      i0.ɵɵpipe(18, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(19, \"core-loading\", 8);\n      i0.ɵɵtemplate(20, CoreCommentsViewerPage_core_empty_box_20_Template, 2, 3, \"core-empty-box\", 9);\n      i0.ɵɵelementStart(21, \"core-infinite-loading\", 10);\n      i0.ɵɵlistener(\"action\", function CoreCommentsViewerPage_Template_core_infinite_loading_action_21_listener($event) {\n        return ctx.loadPrevious($event);\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"ion-list\", 11);\n      i0.ɵɵtemplate(23, CoreCommentsViewerPage_ng_container_23_Template, 3, 9, \"ng-container\", 12);\n      i0.ɵɵtemplate(24, CoreCommentsViewerPage_ion_badge_24_Template, 6, 10, \"ion-badge\", 13);\n      i0.ɵɵtemplate(25, CoreCommentsViewerPage_core_message_25_Template, 1, 7, \"core-message\", 14);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(26, CoreCommentsViewerPage_ion_footer_26_Template, 4, 5, \"ion-footer\", 15);\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 26, \"core.back\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"text\", ctx.title)(\"contextLevel\", ctx.contextLevel)(\"contextInstanceId\", ctx.instanceId)(\"courseId\", ctx.courseId);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.canDeleteComments);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hidden\", !(ctx.commentsLoaded && !ctx.hasOffline))(\"priority\", 100)(\"content\", i0.ɵɵpipeBind1(12, 28, \"core.refresh\"))(\"iconAction\", ctx.refreshIcon)(\"closeOnClick\", true);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hidden\", !(ctx.commentsLoaded && ctx.hasOffline && ctx.isOnline))(\"priority\", 100)(\"content\", i0.ɵɵpipeBind1(14, 30, \"core.settings.synchronizenow\"))(\"iconAction\", ctx.syncIcon)(\"closeOnClick\", false);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"disabled\", !ctx.commentsLoaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵpropertyInterpolate(\"pullingText\", i0.ɵɵpipeBind1(18, 32, \"core.pulltorefresh\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"hideUntil\", ctx.commentsLoaded);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !(ctx.comments == null ? null : ctx.comments.length) && !ctx.offlineComment);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"enabled\", ctx.canLoadMore)(\"error\", ctx.loadMoreError);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.comments);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.hasOffline);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.hasOffline && ctx.offlineComment);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.commentsLoaded && ctx.canAddComments);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.CoreContextMenuComponent, i4.CoreContextMenuItemComponent, i5.CoreEmptyBoxComponent, i6.CoreInfiniteLoadingComponent, i7.CoreLoadingComponent, i8.CoreMessageComponent, i9.CoreSendMessageFormComponent, i10.CoreFaIconDirective, i11.CoreFormatTextDirective, i12.CoreContentDirective, i13.CoreUpdateNonReactiveAttributesDirective, i14.IonBadge, i14.IonButton, i14.IonButtons, i14.IonContent, i14.IonFooter, i14.IonHeader, i14.IonIcon, i14.IonList, i14.IonRefresher, i14.IonRefresherContent, i14.IonTitle, i14.IonToolbar, i14.IonBackButton, i2.LowerCasePipe, i15.CoreFormatDatePipe, i16.TranslatePipe],\n  styles: [\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n.ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child {\\n  padding-bottom: 4px;\\n  min-height: 0;\\n}\\n\\nion-content[_ngcontent-%COMP%] {\\n  --content-background: var(--background-alternative);\\n  --background: var(--content-background);\\n}\\nion-content[_ngcontent-%COMP%]::part(scroll) {\\n  padding-bottom: 0 !important;\\n}\\n\\n.addon-messages-discussion-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  padding-bottom: 16px !important;\\n  background: var(--content-background);\\n}\\n\\n.addon-messages-date[_ngcontent-%COMP%] {\\n  font-weight: normal;\\n  font-size: 0.9rem;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9nbG9iYWxzLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvdGhlbWUvaGVscGVycy9pb25pYy5mdW5jdGlvbnMuc3RyaW5nLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvdGhlbWUvaGVscGVycy9pb25pYy5mdW5jdGlvbnMuY29sb3Iuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9oZWxwZXJzL2lvbmljLm1peGlucy5zY3NzIiwid2VicGFjazovLy4vc3JjL3RoZW1lL2hlbHBlcnMvaW9uaWMuY29tcG9uZW50cy5taXhpbnMuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9oZWxwZXJzL2N1c3RvbS5taXhpbnMuc2NzcyIsIndlYnBhY2s6Ly8uL3NyYy90aGVtZS9nbG9iYWxzLmN1c3RvbS5zY3NzIiwid2VicGFjazovLy4vc3JjL3RoZW1lL2dsb2JhbHMudmFyaWFibGVzLnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvdGhlbWUvY29tcG9uZW50cy9kaXNjdXNzaW9uLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7RUFBQTtBQ0FBOzs7OztFQUFBO0FDQUE7Ozs7O0VBQUE7QUNBQTs7Ozs7RUFBQTtBQ0FBOzs7Ozs7RUFBQTtBQ0VBOzs7O0VBQUE7QUE0R0E7O0VBQUE7QUM5R0E7Ozs7RUFBQTtBQ0FBOzs7O0VBQUE7QUErREE7Ozs7RUFBQTtBQzVESTtFQUNJLG1CQUFBO0VBQ0EsYUFBQTtBQW1EUjs7QUEvQ0E7RUFDSSxtREFBQTtFQUNBLHVDQUFBO0FBa0RKO0FBaERJO0VBQ0ksNEJBQUE7QUFrRFI7O0FBOUNBO0VBQ0ksYUFBQTtFQUNBLHNCQUFBO0VBQ0EsK0JBQUE7RUFDQSxxQ0FBQTtBQWlESjs7QUE5Q0E7RUFDSSxtQkFBQTtFQUNBLGlCQUFBO0FBaURKIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBcHAgR2xvYmFsIHZhcmlhYmxlcyBTQ1NTXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBQbGFjZSBoZXJlIHRoZSBkaWZmZXJlbnQgZmlsZXMgeW91IHNob3VsZCBpbXBvcnQgdG8gdXNlIGdsb2JhbCB2YXJpYWJsZXMuXG4gKi9cblxuJGZvbnQtcGF0aDogXCIuLi9hc3NldHMvZm9udHNcIjtcbiRhc3NldHMtcGF0aDogXCIuLi9hc3NldHNcIjtcblxuQGltcG9ydCBcIi4vaGVscGVycy9oZWxwZXJzLnNjc3NcIjtcbkBpbXBvcnQgXCIuL2dsb2JhbHMuY3VzdG9tLnNjc3NcIjtcbkBpbXBvcnQgXCIuL2dsb2JhbHMudmFyaWFibGVzLnNjc3NcIjtcbiIsIi8qKlxuICogSW1wb3J0ZWQgaW9uaWMgc3RyaW5nIGZ1bmN0aW9ucyBmb3IgU0NTU1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogRXh0cmFjdGVkIGZyb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL2lvbmljLWZyYW1ld29yay9ibG9iL21hc3Rlci9jb3JlL3NyYy90aGVtZXMvaW9uaWMuZnVuY3Rpb25zLnN0cmluZy5zY3NzXG4gKi9cblxuXG4vLyBTdHJpbmcgVXRpbGl0eSBGdW5jdGlvbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIFN0cmluZyBSZXBsYWNlIEZ1bmN0aW9uXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AZnVuY3Rpb24gc3RyLXJlcGxhY2UoJHN0cmluZywgJHNlYXJjaCwgJHJlcGxhY2U6IFwiXCIpIHtcbiAgJGluZGV4OiBzdHItaW5kZXgoJHN0cmluZywgJHNlYXJjaCk7XG5cbiAgQGlmICRpbmRleCB7XG4gICAgQHJldHVybiBzdHItc2xpY2UoJHN0cmluZywgMSwgJGluZGV4IC0gMSkgKyAkcmVwbGFjZSArIHN0ci1yZXBsYWNlKHN0ci1zbGljZSgkc3RyaW5nLCAkaW5kZXggKyBzdHItbGVuZ3RoKCRzZWFyY2gpKSwgJHNlYXJjaCwgJHJlcGxhY2UpO1xuICB9XG5cbiAgQHJldHVybiAkc3RyaW5nO1xufVxuXG4vLyBTdHJpbmcgU3BsaXQgRnVuY3Rpb25cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblxuQGZ1bmN0aW9uIHN0ci1zcGxpdCgkc3RyaW5nLCAkc2VwYXJhdG9yKSB7XG4gIC8vIGVtcHR5IGFycmF5L2xpc3RcbiAgJHNwbGl0LWFycjogKCk7XG4gIC8vIGZpcnN0IGluZGV4IG9mIHNlcGFyYXRvciBpbiBzdHJpbmdcbiAgJGluZGV4OiBzdHItaW5kZXgoJHN0cmluZywgJHNlcGFyYXRvcik7XG4gIC8vIGxvb3AgdGhyb3VnaCBzdHJpbmdcbiAgQHdoaWxlICRpbmRleCAhPSBudWxsIHtcbiAgICAvLyBnZXQgdGhlIHN1YnN0cmluZyBmcm9tIHRoZSBmaXJzdCBjaGFyYWN0ZXIgdG8gdGhlIHNlcGFyYXRvclxuICAgICRpdGVtOiBzdHItc2xpY2UoJHN0cmluZywgMSwgJGluZGV4IC0gMSk7XG4gICAgLy8gcHVzaCBpdGVtIHRvIGFycmF5XG4gICAgJHNwbGl0LWFycjogYXBwZW5kKCRzcGxpdC1hcnIsICRpdGVtKTtcbiAgICAvLyByZW1vdmUgaXRlbSBhbmQgc2VwYXJhdG9yIGZyb20gc3RyaW5nXG4gICAgJHN0cmluZzogc3RyLXNsaWNlKCRzdHJpbmcsICRpbmRleCArIDEpO1xuICAgIC8vIGZpbmQgbmV3IGluZGV4IG9mIHNlcGFyYXRvclxuICAgICRpbmRleDogc3RyLWluZGV4KCRzdHJpbmcsICRzZXBhcmF0b3IpO1xuICB9XG4gIC8vIGFkZCB0aGUgcmVtYWluaW5nIHN0cmluZyB0byBsaXN0ICh0aGUgbGFzdCBpdGVtKVxuICAkc3BsaXQtYXJyOiBhcHBlbmQoJHNwbGl0LWFyciwgJHN0cmluZyk7XG5cbiAgQHJldHVybiAkc3BsaXQtYXJyO1xufVxuXG5cbi8vIFN0cmluZyBFeHRyYWN0IEZ1bmN0aW9uXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AZnVuY3Rpb24gc3RyLWV4dHJhY3QoJHN0cmluZywgJHN0YXJ0LCAkZW5kKSB7XG4gICRzdGFydC1pbmRleDogc3RyLWluZGV4KCRzdHJpbmcsICRzdGFydCk7XG5cbiAgQGlmICRzdGFydC1pbmRleCB7XG4gICAgJHBvc3Q6IHN0ci1zbGljZSgkc3RyaW5nLCAkc3RhcnQtaW5kZXggKyBzdHItbGVuZ3RoKCRzdGFydCkpO1xuICAgICRlbmQtaW5kZXg6IHN0ci1pbmRleCgkcG9zdCwgJGVuZCk7XG5cbiAgICBAaWYgJGVuZC1pbmRleCB7XG4gICAgICBAcmV0dXJuIHN0ci1zbGljZSgkcG9zdCwgMSwgJGVuZC1pbmRleCAtIDEpO1xuICAgIH1cbiAgfVxuXG4gIEByZXR1cm4gbnVsbDtcbn1cblxuXG4vLyBTdHJpbmcgQ29udGFpbnMgRnVuY3Rpb25cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBmdW5jdGlvbiBzdHItY29udGFpbnMoJHN0cmluZywgJG5lZWRsZSkge1xuICBAaWYgKHR5cGUtb2YoJHN0cmluZykgPT0gc3RyaW5nKSB7XG4gICAgQHJldHVybiBzdHItaW5kZXgoJHN0cmluZywgJG5lZWRsZSkgIT0gbnVsbDtcbiAgfVxuXG4gIEByZXR1cm4gZmFsc2U7XG59XG5cblxuLy8gVVJMIEVuY29kZSBGdW5jdGlvblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQGZ1bmN0aW9uIHVybC1lbmNvZGUoJHZhbCkge1xuICAkc3BhY2VzOiBzdHItcmVwbGFjZSgkdmFsLCBcIiBcIiwgXCIlMjBcIik7XG4gICRlbmNvZGVkOiBzdHItcmVwbGFjZSgkc3BhY2VzLCBcIiNcIiwgXCIlMjNcIik7XG4gIEByZXR1cm4gJGVuY29kZWQ7XG59XG5cblxuLy8gQWRkIFJvb3QgU2VsZWN0b3Jcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBBZGRzIGEgcm9vdCBzZWxlY3RvciB1c2luZyBob3N0IGJhc2VkIG9uIHRoZSBzZWxlY3RvciBwYXNzZWRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBmdW5jdGlvbiBhZGQtcm9vdC1zZWxlY3Rvcigkcm9vdCwgJGFkZEhvc3RTZWxlY3Rvcikge1xuICAkc2VsZWN0b3JzOiBzdHItc3BsaXQoJHJvb3QsIFwiLFwiKTtcblxuICAkbGlzdDogKCk7XG5cbiAgQGVhY2ggJHNlbGVjdG9yIGluICRzZWxlY3RvcnMge1xuICAgIC8vIElmIHRoZSBzZWxlY3RvciBjb250YWlucyA6aG9zdCggaXQgbWVhbnMgaXQgaXMgdGFyZ2V0aW5nIGEgY2xhc3Mgb24gdGhlIGhvc3RcbiAgICAvLyBlbGVtZW50IHNvIHdlIG5lZWQgdG8gY2hhbmdlIGhvdyB3ZSB0YXJnZXQgaXQ6XG4gICAgLy8gQGluY2x1ZGUgYWRkLXJvb3Qtc2VsZWN0b3IoXCI6aG9zdCguZml4ZWQpXCIsIFwiW2Rpcj1ydGxdXCIpXG4gICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKTpob3N0KC5maXhlZClcbiAgICAvLyAtLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pLmZpeGVkXG4gICAgQGlmIHN0ci1jb250YWlucygkc2VsZWN0b3IsIFwiOmhvc3QoXCIpIHtcbiAgICAgIC8vIEBpbmNsdWRlIGFkZC1yb290LXNlbGVjdG9yKFwiOmhvc3QoLmZpeGVkKVwiLCBcIltkaXI9cnRsXVwiKVxuICAgICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKTpob3N0KC5maXhlZClcbiAgICAgICRzaGFkb3ctZWxlbWVudDogc3RyLXJlcGxhY2UoJHNlbGVjdG9yLCBcIjpob3N0KFwiLCBcIjpob3N0LWNvbnRleHQoI3skYWRkSG9zdFNlbGVjdG9yfSk6aG9zdChcIik7XG4gICAgICAkbGlzdDogYXBwZW5kKCRsaXN0LCAkc2hhZG93LWVsZW1lbnQsIGNvbW1hKTtcblxuICAgICAgJG5ldy1lbGVtZW50OiAoKTtcbiAgICAgICRlbGVtZW50czogc3RyLXNwbGl0KCRzZWxlY3RvciwgXCIgXCIpO1xuXG4gICAgICBAZWFjaCAkZWxlbWVudCBpbiAkZWxlbWVudHMge1xuICAgICAgICBAaWYgc3RyLWNvbnRhaW5zKCRlbGVtZW50LCBcIjpob3N0KFwiKSB7XG4gICAgICAgICAgJHNjb3BlZC1lbGVtZW50OiAkZWxlbWVudDtcblxuICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIDpob3N0KCBhbmQgKSBzbyBhbGwgd2UgaGF2ZSBsZWZ0IGlzIHRoZSBjbGFzc1xuICAgICAgICAgIC8vIGluc2lkZSBvZiBpdDpcbiAgICAgICAgICAvLyA6aG9zdCguZml4ZWQpIC0+IC5maXhlZFxuICAgICAgICAgICRzY29wZWQtZWxlbWVudDogc3RyLXJlcGxhY2UoJHNjb3BlZC1lbGVtZW50LCBcIilcIiwgXCJcIik7XG4gICAgICAgICAgJHNjb3BlZC1lbGVtZW50OiBzdHItcmVwbGFjZSgkc2NvcGVkLWVsZW1lbnQsIFwiOmhvc3QoXCIsIFwiXCIpO1xuXG4gICAgICAgICAgLy8gQWRkIHRoZSBjbGFzcyBiYWNrIGluc2lkZSBvZiBob3N0IHdpdGggdGhlIHJ0bCBzZWxlY3RvcjpcbiAgICAgICAgICAvLyAuZml4ZWQgLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pLmZpeGVkXG4gICAgICAgICAgJHNjb3BlZC1lbGVtZW50OiBzdHItcmVwbGFjZSgkc2NvcGVkLWVsZW1lbnQsICRzY29wZWQtZWxlbWVudCwgXCI6aG9zdC1jb250ZXh0KCN7JGFkZEhvc3RTZWxlY3Rvcn0pI3skc2NvcGVkLWVsZW1lbnR9XCIpO1xuXG4gICAgICAgICAgLy8gQGluY2x1ZGUgYWRkLXJvb3Qtc2VsZWN0b3IoXCI6aG9zdCguZml4ZWQpXCIsIFwiW2Rpcj1ydGxdXCIpXG4gICAgICAgICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKS5maXhlZFxuICAgICAgICAgICRuZXctZWxlbWVudDogYXBwZW5kKCRuZXctZWxlbWVudCwgJHNjb3BlZC1lbGVtZW50LCBzcGFjZSk7XG4gICAgICAgIH0gQGVsc2Uge1xuICAgICAgICAgIC8vIEFkZCBiYWNrIGFueSBzZWxlY3RvcnMgdGhhdCBmb2xsb3dlZCB0aGUgaG9zdCBhZnRlciB0cmFuc2Zvcm1pbmcgdGhlXG4gICAgICAgICAgLy8gZmlyc3Qgc2VsZWN0b3I6XG4gICAgICAgICAgLy8gOmhvc3QoLmZpeGVkKSA6OnNsb3R0ZWQoaW9uLWljb24pXG4gICAgICAgICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKTpob3N0KC5maXhlZCkgOjpzbG90dGVkKGlvbi1pY29uKVxuICAgICAgICAgIC8vIC0tPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSkuZml4ZWQgOjpzbG90dGVkKGlvbi1pY29uKVxuICAgICAgICAgICRuZXctZWxlbWVudDogYXBwZW5kKCRuZXctZWxlbWVudCwgJGVsZW1lbnQsIHNwYWNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkbGlzdDogYXBwZW5kKCRsaXN0LCAkbmV3LWVsZW1lbnQsIGNvbW1hKTtcbiAgICAvLyBJZiB0aGUgc2VsZWN0b3IgY29udGFpbnMgOmhvc3Qgd2l0aG91dCBhIHBhcmFudGhlc2VzXG4gICAgLy8gaXQgbWVhbnMgaXQgaXMgdGFyZ2V0aW5nIGp1c3QgdGhlIGhvc3RcbiAgICAvLyBlbGVtZW50IHNvIHdlIGNhbiBjaGFuZ2UgaXQgdG8gbG9vayBmb3IgaG9zdC1jb250ZXh0XG4gICAgLy8gQGluY2x1ZGUgYWRkLXJvb3Qtc2VsZWN0b3IoXCI6aG9zdFwiLCBcIltkaXI9cnRsXVwiKVxuICAgIC8vIC0tPiA6aG9zdC1jb250ZXh0KFtkaXI9cnRsXSlcbiAgICAvLyAtLT4gOmhvc3Q6ZGlyKHJ0bClcbiAgICB9IEBlbHNlIGlmIHN0ci1jb250YWlucygkc2VsZWN0b3IsIFwiOmhvc3RcIikge1xuICAgICAgJG5ldy1lbGVtZW50OiAoKTtcbiAgICAgICRlbGVtZW50czogc3RyLXNwbGl0KCRzZWxlY3RvciwgXCIgXCIpO1xuXG4gICAgICBAZWFjaCAkZWxlbWVudCBpbiAkZWxlbWVudHMge1xuICAgICAgICBAaWYgc3RyLWNvbnRhaW5zKCRlbGVtZW50LCBcIjpob3N0XCIpIHtcbiAgICAgICAgICAvLyBSZXBsYWNlIHRoZSA6aG9zdCB3aXRoIHRoZSBhZGRIb3N0U2VsZWN0b3I6XG4gICAgICAgICAgLy8gOmhvc3QgLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pXG4gICAgICAgICAgJHVwZGF0ZWQtZWxlbWVudDogc3RyLXJlcGxhY2UoJGVsZW1lbnQsIFwiOmhvc3RcIiwgXCI6aG9zdC1jb250ZXh0KCN7JGFkZEhvc3RTZWxlY3Rvcn0pXCIpO1xuXG4gICAgICAgICAgLy8gQWRkIHRoZSBmaW5hbCBzZWxlY3RvciBhZnRlciBhbGwgdHJhbnNmb3JtYXRpb25zOlxuICAgICAgICAgIC8vIDpob3N0IC0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKVxuICAgICAgICAgICRuZXctZWxlbWVudDogYXBwZW5kKCRuZXctZWxlbWVudCwgJHVwZGF0ZWQtZWxlbWVudCwgc3BhY2UpO1xuICAgICAgICB9IEBlbHNlIHtcbiAgICAgICAgICAvLyBBZGQgYmFjayBhbnkgc2VsZWN0b3JzIHRoYXQgZm9sbG93ZWQgdGhlIGhvc3QgYWZ0ZXIgdHJhbnNmb3JtaW5nIHRoZVxuICAgICAgICAgIC8vIGZpcnN0IHNlbGVjdG9yOlxuICAgICAgICAgIC8vIDpob3N0IDo6c2xvdHRlZChpb24taWNvbikgLT4gOmhvc3QtY29udGV4dChbZGlyPXJ0bF0pIDo6c2xvdHRlZChpb24taWNvbilcbiAgICAgICAgICAkbmV3LWVsZW1lbnQ6IGFwcGVuZCgkbmV3LWVsZW1lbnQsICRlbGVtZW50LCBzcGFjZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJGxpc3Q6IGFwcGVuZCgkbGlzdCwgJG5ldy1lbGVtZW50LCBjb21tYSk7XG4gICAgLy8gSWYgdGhlIHNlbGVjdG9yIGRvZXMgbm90IGNvbnRhaW4gaG9zdCBhdCBhbGwgaXQgaXMgZWl0aGVyIGEgc2hhZG93XG4gICAgLy8gb3Igbm9ybWFsIGVsZW1lbnQgc28gYXBwZW5kIGJvdGggdGhlIGFkZEhvc3RTZWxlY3RvciBhbmQgaG9zdC1jb250ZXh0XG4gICAgLy8gQGluY2x1ZGUgYWRkLXJvb3Qtc2VsZWN0b3IoXCJpb24tY29tcG9uZW50XCIsIFwiW2Rpcj1ydGxdXCIpXG4gICAgLy8gLS0+IDpob3N0LWNvbnRleHQoW2Rpcj1ydGxdKSBpb24tY29tcG9uZW50XG4gICAgLy8gLS0+IFtkaXI9cnRsXSBpb24tY29tcG9uZW50XG4gICAgfSBAZWxzZSB7XG4gICAgICAkbGlzdDogYXBwZW5kKCRsaXN0LCBcIiN7JGFkZEhvc3RTZWxlY3Rvcn0gI3skc2VsZWN0b3J9XCIsIGNvbW1hKTtcbiAgICAgICRsaXN0OiBhcHBlbmQoJGxpc3QsIFwiOmhvc3QtY29udGV4dCgjeyRhZGRIb3N0U2VsZWN0b3J9KSAjeyRzZWxlY3Rvcn1cIiwgY29tbWEpO1xuICAgIH1cbiAgfVxuXG4gIEByZXR1cm4gJGxpc3Q7XG59XG4iLCIvKipcbiAqIEltcG9ydGVkIGlvbmljIGNvbG9yIGZ1bmN0aW9ucyBmb3IgU0NTU1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogRXh0cmFjdGVkIGZyb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL2lvbmljLWZyYW1ld29yay9ibG9iL21hc3Rlci9jb3JlL3NyYy90aGVtZXMvaW9uaWMuZnVuY3Rpb25zLmNvbG9yLnNjc3NcbiAqL1xuXG4vLyBHZXRzIHRoZSBhY3RpdmUgY29sb3IncyBjc3MgdmFyaWFibGUgZnJvbSBhIHZhcmlhdGlvbi4gQWxwaGEgaXMgb3B0aW9uYWwuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRXhhbXBsZSB1c2FnZTpcbi8vIGN1cnJlbnQtY29sb3IoYmFzZSkgPT4gdmFyKC0taW9uLWNvbG9yLWJhc2UpXG4vLyBjdXJyZW50LWNvbG9yKGNvbnRyYXN0LCAwLjEpID0+IHJnYmEodmFyKC0taW9uLWNvbG9yLWNvbnRyYXN0LXJnYiksIDAuMSlcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AZnVuY3Rpb24gY3VycmVudC1jb2xvcigkdmFyaWF0aW9uLCAkYWxwaGE6IG51bGwpIHtcbiAgQGlmICRhbHBoYSA9PSBudWxsIHtcbiAgICBAcmV0dXJuIHZhcigtLWlvbi1jb2xvci0jeyR2YXJpYXRpb259KTtcbiAgfSBAZWxzZSB7XG4gICAgQHJldHVybiByZ2JhKHZhcigtLWlvbi1jb2xvci0jeyR2YXJpYXRpb259LXJnYiksICN7JGFscGhhfSk7XG4gIH1cbn1cblxuLy8gR2V0cyB0aGUgc3BlY2lmaWMgY29sb3IncyBjc3MgdmFyaWFibGUgZnJvbSB0aGUgbmFtZSBhbmQgdmFyaWF0aW9uLiBBbHBoYS9yZ2IgYXJlIG9wdGlvbmFsLlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEV4YW1wbGUgdXNhZ2U6XG4vLyBpb24tY29sb3IocHJpbWFyeSwgYmFzZSkgPT4gdmFyKC0taW9uLWNvbG9yLXByaW1hcnksICMzODgwZmYpXG4vLyBpb24tY29sb3Ioc2Vjb25kYXJ5LCBjb250cmFzdCkgPT4gdmFyKC0taW9uLWNvbG9yLXNlY29uZGFyeS1jb250cmFzdClcbi8vIGlvbi1jb2xvcihwcmltYXJ5LCBiYXNlLCAwLjUpID0+IHJnYmEodmFyKC0taW9uLWNvbG9yLXByaW1hcnktcmdiLCA1NiwgMTI4LCAyNTUpLCAwLjUpXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQGZ1bmN0aW9uIGlvbi1jb2xvcigkbmFtZSwgJHZhcmlhdGlvbiwgJGFscGhhOiBudWxsLCAkcmdiOiBudWxsKSB7XG4gICR2YWx1ZXM6IG1hcC1nZXQoJGNvbG9ycywgJG5hbWUpO1xuICAkdmFsdWU6IG1hcC1nZXQoJHZhbHVlcywgJHZhcmlhdGlvbik7XG4gICR2YXJpYWJsZTogLS1pb24tY29sb3ItI3skbmFtZX0tI3skdmFyaWF0aW9ufTtcblxuICBAaWYgKCR2YXJpYXRpb24gPT0gYmFzZSkge1xuICAgICR2YXJpYWJsZTogLS1pb24tY29sb3ItI3skbmFtZX07XG4gIH1cblxuICBAaWYgKCRhbHBoYSkge1xuICAgICR2YWx1ZTogY29sb3ItdG8tcmdiLWxpc3QoJHZhbHVlKTtcbiAgICBAcmV0dXJuIHJnYmEodmFyKCN7JHZhcmlhYmxlfS1yZ2IsICR2YWx1ZSksICRhbHBoYSk7XG4gIH1cbiAgQGlmICgkcmdiKSB7XG4gICAgJHZhbHVlOiBjb2xvci10by1yZ2ItbGlzdCgkdmFsdWUpO1xuICAgICR2YXJpYWJsZTogI3skdmFyaWFibGV9LXJnYjtcbiAgfVxuXG4gIEByZXR1cm4gdmFyKCN7JHZhcmlhYmxlfSwgJHZhbHVlKTtcbn1cblxuLy8gTWl4ZXMgYSBjb2xvciB3aXRoIGJsYWNrIHRvIGNyZWF0ZSBpdHMgc2hhZGUuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQGZ1bmN0aW9uIGdldC1jb2xvci1zaGFkZSgkY29sb3IpIHtcbiAgQHJldHVybiBtaXgoIzAwMCwgJGNvbG9yLCAxMiUpO1xufVxuXG4vLyBNaXhlcyBhIGNvbG9yIHdpdGggd2hpdGUgdG8gY3JlYXRlIGl0cyB0aW50LlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBmdW5jdGlvbiBnZXQtY29sb3ItdGludCgkY29sb3IpIHtcbiAgQHJldHVybiBtaXgoI2ZmZiwgJGNvbG9yLCAxMCUpO1xufVxuXG4vLyBDb252ZXJ0cyBhIGNvbG9yIHRvIGEgY29tbWEgc2VwYXJhdGVkIHJnYi5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AZnVuY3Rpb24gY29sb3ItdG8tcmdiLWxpc3QoJGNvbG9yKSB7XG4gIEByZXR1cm4gI3tyZWQoJGNvbG9yKX0sI3tncmVlbigkY29sb3IpfSwje2JsdWUoJGNvbG9yKX07XG59XG4iLCIvKipcbiAqIEltcG9ydGVkIGlvbmljIG1peGlucyBmb3IgU0NTU1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogRXh0cmFjdGVkIGZyb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL2lvbmljLWZyYW1ld29yay9ibG9iL21hc3Rlci9jb3JlL3NyYy90aGVtZXMvaW9uaWMubWl4aW5zLnNjc3NcbiAqL1xuXG5AbWl4aW4gaW5wdXQtY292ZXIoKSB7XG4gIEBpbmNsdWRlIHBvc2l0aW9uKDAsIG51bGwsIG51bGwsIDApO1xuICBAaW5jbHVkZSBtYXJnaW4oMCk7XG5cbiAgcG9zaXRpb246IGFic29sdXRlO1xuXG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG5cbiAgYm9yZGVyOiAwO1xuICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuXG4gIGFwcGVhcmFuY2U6IG5vbmU7XG4gIG91dGxpbmU6IG5vbmU7XG5cbiAgJjo6LW1vei1mb2N1cy1pbm5lciB7XG4gICAgYm9yZGVyOiAwO1xuICB9XG59XG5cbkBtaXhpbiB2aXN1YWxseS1oaWRkZW4oKSB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcblxuICB0b3A6IDA7XG4gIGxlZnQ6IDA7XG4gIHJpZ2h0OiAwO1xuICBib3R0b206IDA7XG5cbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcblxuICBtYXJnaW46IDA7XG4gIHBhZGRpbmc6IDA7XG5cbiAgYm9yZGVyOiAwO1xuICBvdXRsaW5lOiAwO1xuICBjbGlwOiByZWN0KDAgMCAwIDApO1xuXG4gIG9wYWNpdHk6IDA7XG4gIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lO1xuICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7XG59XG5cbkBtaXhpbiB0ZXh0LWluaGVyaXQoKSB7XG4gIGZvbnQtZmFtaWx5OiBpbmhlcml0O1xuICBmb250LXNpemU6IGluaGVyaXQ7XG4gIGZvbnQtc3R5bGU6IGluaGVyaXQ7XG4gIGZvbnQtd2VpZ2h0OiBpbmhlcml0O1xuICBsZXR0ZXItc3BhY2luZzogaW5oZXJpdDtcbiAgdGV4dC1kZWNvcmF0aW9uOiBpbmhlcml0O1xuICB0ZXh0LWluZGVudDogaW5oZXJpdDtcbiAgdGV4dC1vdmVyZmxvdzogaW5oZXJpdDtcbiAgdGV4dC10cmFuc2Zvcm06IGluaGVyaXQ7XG4gIHRleHQtYWxpZ246IGluaGVyaXQ7XG4gIHdoaXRlLXNwYWNlOiBpbmhlcml0O1xuICBjb2xvcjogaW5oZXJpdDtcbn1cblxuQG1peGluIGJ1dHRvbi1zdGF0ZSgpIHtcbiAgQGluY2x1ZGUgcG9zaXRpb24oMCwgMCwgMCwgMCk7XG5cbiAgcG9zaXRpb246IGFic29sdXRlO1xuXG4gIGNvbnRlbnQ6IFwiXCI7XG5cbiAgb3BhY2l0eTogMDtcbn1cblxuLy8gRm9udCBzbW9vdGhpbmdcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBtaXhpbiBmb250LXNtb290aGluZygpIHtcbiAgLW1vei1vc3gtZm9udC1zbW9vdGhpbmc6IGdyYXlzY2FsZTtcbiAgLXdlYmtpdC1mb250LXNtb290aGluZzogYW50aWFsaWFzZWQ7XG59XG5cbi8vIEdldCB0aGUga2V5IGZyb20gYSBtYXAgYmFzZWQgb24gdGhlIGluZGV4XG5AZnVuY3Rpb24gaW5kZXgtdG8ta2V5KCRtYXAsICRpbmRleCkge1xuICAka2V5czogbWFwLWtleXMoJG1hcCk7XG5cbiAgQHJldHVybiBudGgoJGtleXMsICRpbmRleCk7XG59XG5cblxuLy8gQnJlYWtwb2ludCBNaXhpbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vLyBCcmVha3BvaW50IHZpZXdwb3J0IHNpemVzIGFuZCBtZWRpYSBxdWVyaWVzLlxuLy9cbi8vIEJyZWFrcG9pbnRzIGFyZSBkZWZpbmVkIGFzIGEgbWFwIG9mIChuYW1lOiBtaW5pbXVtIHdpZHRoKSwgb3JkZXIgZnJvbSBzbWFsbCB0byBsYXJnZTpcbi8vXG4vLyAgICAoeHM6IDAsIHNtOiA1NzZweCwgbWQ6IDc2OHB4LCBsZzogOTkycHgsIHhsOiAxMjAwcHgpXG4vL1xuLy8gVGhlIG1hcCBkZWZpbmVkIGluIHRoZSBgJHNjcmVlbi1icmVha3BvaW50c2AgZ2xvYmFsIHZhcmlhYmxlIGlzIHVzZWQgYXMgdGhlIGAkYnJlYWtwb2ludHNgIGFyZ3VtZW50IGJ5IGRlZmF1bHQuXG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vLyBNaW5pbXVtIGJyZWFrcG9pbnQgd2lkdGguIE51bGwgZm9yIHRoZSBzbWFsbGVzdCAoZmlyc3QpIGJyZWFrcG9pbnQuXG4vL1xuLy8gICAgPj4gYnJlYWtwb2ludC1taW4oc20sICh4czogMCwgc206IDU3NnB4LCBtZDogNzY4cHgsIGxnOiA5OTJweCwgeGw6IDEyMDBweCkpXG4vLyAgICA1NzZweFxuQGZ1bmN0aW9uIGJyZWFrcG9pbnQtbWluKCRuYW1lLCAkYnJlYWtwb2ludHM6ICRzY3JlZW4tYnJlYWtwb2ludHMpIHtcbiAgJG1pbjogbWFwLWdldCgkYnJlYWtwb2ludHMsICRuYW1lKTtcblxuICBAcmV0dXJuIGlmKCRuYW1lICE9IGluZGV4LXRvLWtleSgkYnJlYWtwb2ludHMsIDEpLCAkbWluLCBudWxsKTtcbn1cblxuLy8gUmV0dXJucyBhIGJsYW5rIHN0cmluZyBpZiBzbWFsbGVzdCBicmVha3BvaW50LCBvdGhlcndpc2UgcmV0dXJucyB0aGUgbmFtZSB3aXRoIGEgZGFzaCBpbmZyb250LlxuLy8gVXNlZnVsIGZvciBtYWtpbmcgcmVzcG9uc2l2ZSB1dGlsaXRpZXMuXG4vL1xuLy8gICAgPj4gYnJlYWtwb2ludC1pbmZpeCh4cywgKHhzOiAwLCBzbTogNTc2cHgsIG1kOiA3NjhweCwgbGc6IDk5MnB4LCB4bDogMTIwMHB4KSlcbi8vICAgIFwiXCIgIChSZXR1cm5zIGEgYmxhbmsgc3RyaW5nKVxuLy8gICAgPj4gYnJlYWtwb2ludC1pbmZpeChzbSwgKHhzOiAwLCBzbTogNTc2cHgsIG1kOiA3NjhweCwgbGc6IDk5MnB4LCB4bDogMTIwMHB4KSlcbi8vICAgIFwiLXNtXCJcbkBmdW5jdGlvbiBicmVha3BvaW50LWluZml4KCRuYW1lLCAkYnJlYWtwb2ludHM6ICRzY3JlZW4tYnJlYWtwb2ludHMpIHtcbiAgQHJldHVybiBpZihicmVha3BvaW50LW1pbigkbmFtZSwgJGJyZWFrcG9pbnRzKSA9PSBudWxsLCBcIlwiLCBcIi0jeyRuYW1lfVwiKTtcbn1cblxuLy8gTWVkaWEgb2YgYXQgbGVhc3QgdGhlIG1pbmltdW0gYnJlYWtwb2ludCB3aWR0aC4gTm8gcXVlcnkgZm9yIHRoZSBzbWFsbGVzdCBicmVha3BvaW50LlxuLy8gTWFrZXMgdGhlIEBjb250ZW50IGFwcGx5IHRvIHRoZSBnaXZlbiBicmVha3BvaW50IGFuZCB3aWRlci5cbkBtaXhpbiBtZWRpYS1icmVha3BvaW50LXVwKCRuYW1lLCAkYnJlYWtwb2ludHM6ICRzY3JlZW4tYnJlYWtwb2ludHMpIHtcbiAgJG1pbjogYnJlYWtwb2ludC1taW4oJG5hbWUsICRicmVha3BvaW50cyk7XG4gIEBpZiAkbWluIHtcbiAgICBAbWVkaWEgKG1pbi13aWR0aDogJG1pbikge1xuICAgICAgQGNvbnRlbnQ7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAY29udGVudDtcbiAgfVxufVxuXG4vLyBOYW1lIG9mIHRoZSBuZXh0IGJyZWFrcG9pbnQsIG9yIG51bGwgZm9yIHRoZSBsYXN0IGJyZWFrcG9pbnQuXG4vL1xuLy8gICAgPj4gYnJlYWtwb2ludC1uZXh0KHNtKVxuLy8gICAgbWRcbi8vICAgID4+IGJyZWFrcG9pbnQtbmV4dChzbSwgKHhzOiAwLCBzbTogNTc2cHgsIG1kOiA3NjhweCwgbGc6IDk5MnB4LCB4bDogMTIwMHB4KSlcbi8vICAgIG1kXG4vLyAgICA+PiBicmVha3BvaW50LW5leHQoc20sICRicmVha3BvaW50LW5hbWVzOiAoeHMgc20gbWQgbGcgeGwpKVxuLy8gICAgbWRcbkBmdW5jdGlvbiBicmVha3BvaW50LW5leHQoJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cywgJGJyZWFrcG9pbnQtbmFtZXM6IG1hcC1rZXlzKCRicmVha3BvaW50cykpIHtcbiAgJG46IGluZGV4KCRicmVha3BvaW50LW5hbWVzLCAkbmFtZSk7XG4gIEByZXR1cm4gaWYoJG4gPCBsZW5ndGgoJGJyZWFrcG9pbnQtbmFtZXMpLCBudGgoJGJyZWFrcG9pbnQtbmFtZXMsICRuICsgMSksIG51bGwpO1xufVxuXG4vLyBNYXhpbXVtIGJyZWFrcG9pbnQgd2lkdGguIE51bGwgZm9yIHRoZSBzbWFsbGVzdCAoZmlyc3QpIGJyZWFrcG9pbnQuXG4vLyBUaGUgbWF4aW11bSB2YWx1ZSBpcyByZWR1Y2VkIGJ5IDAuMDJweCB0byB3b3JrIGFyb3VuZCB0aGUgbGltaXRhdGlvbnMgb2Zcbi8vIGBtaW4tYCBhbmQgYG1heC1gIHByZWZpeGVzIGFuZCB2aWV3cG9ydHMgd2l0aCBmcmFjdGlvbmFsIHdpZHRocy5cbi8vXG4vLyBTZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL21lZGlhcXVlcmllcy00LyNtcS1taW4tbWF4XG4vLyBVc2VzIDAuMDJweCByYXRoZXIgdGhhbiAwLjAxcHggdG8gd29yayBhcm91bmQgYSBjdXJyZW50IHJvdW5kaW5nIGJ1ZyBpbiBTYWZhcmkuXHQvLyBVc2VzIDAuMDJweCByYXRoZXIgdGhhbiAwLjAxcHggdG8gd29yayBhcm91bmQgYSBjdXJyZW50IHJvdW5kaW5nIGJ1ZyBpbiBTYWZhcmkuXG4vLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE3ODI2MVx0Ly8gU2VlIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0xNzgyNjFcbi8vXG4vLyAgICA+PiBicmVha3BvaW50LW1heChtZCwgKHhzOiAwLCBzbTogNTc2cHgsIG1kOiA3NjhweCwgbGc6IDk5MnB4LCB4bDogMTIwMHB4KSlcbi8vICAgIDc2Ny45OHB4XG5AZnVuY3Rpb24gYnJlYWtwb2ludC1tYXgoJG5hbWUsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICAkbWF4OiBtYXAtZ2V0KCRicmVha3BvaW50cywgJG5hbWUpO1xuICBAcmV0dXJuIGlmKCRtYXggYW5kICRtYXggPiAwLCAkbWF4IC0gLjAyLCBudWxsKTtcbn1cblxuLy8gTWVkaWEgb2YgYXQgbW9zdCB0aGUgbWF4aW11bSBicmVha3BvaW50IHdpZHRoLiBObyBxdWVyeSBmb3IgdGhlIGxhcmdlc3QgYnJlYWtwb2ludC5cbi8vIE1ha2VzIHRoZSBAY29udGVudCBhcHBseSB0byB0aGUgZ2l2ZW4gYnJlYWtwb2ludCBhbmQgbmFycm93ZXIuXG5AbWl4aW4gbWVkaWEtYnJlYWtwb2ludC1kb3duKCRuYW1lLCAkYnJlYWtwb2ludHM6ICRzY3JlZW4tYnJlYWtwb2ludHMpIHtcbiAgJG1heDogYnJlYWtwb2ludC1tYXgoJG5hbWUsICRicmVha3BvaW50cyk7XG4gIEBpZiAkbWF4IHtcbiAgICBAbWVkaWEgKG1heC13aWR0aDogJG1heCkge1xuICAgICAgQGNvbnRlbnQ7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAY29udGVudDtcbiAgfVxufVxuXG5cbi8vIFRleHQgRGlyZWN0aW9uIC0gbHRyIC8gcnRsXG4vL1xuLy8gQ1NTIGRlZmF1bHRzIHRvIHVzZSB0aGUgbHRyIGNzcywgYW5kIGFkZHMgW2Rpcj1ydGxdIHNlbGVjdG9yc1xuLy8gdG8gb3ZlcnJpZGUgbHRyIGRlZmF1bHRzLlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AbWl4aW4gbXVsdGktZGlyKCkge1xuICBAY29udGVudDtcblxuICAvLyAkcm9vdDogI3smfTtcbiAgLy8gQGF0LXJvb3QgW2Rpcl0ge1xuICAvLyAgICN7JHJvb3R9IHtcbiAgLy8gICAgIEBjb250ZW50O1xuICAvLyAgIH1cbiAgLy8gfVxufVxuXG5AbWl4aW4gcnRsKCkge1xuICAkcm9vdDogI3smfTtcblxuICAkcm9vdFNwbGl0OiBzdHItc3BsaXQoJHJvb3QsIFwiLFwiKTtcbiAgJHNlbGVjdG9yczogI3thZGQtcm9vdC1zZWxlY3Rvcigkcm9vdCwgXCJbZGlyPXJ0bF1cIil9O1xuICAkc2VsZWN0b3JzU3BsaXQ6IHN0ci1zcGxpdCgkc2VsZWN0b3JzLCBcIixcIik7XG5cbiAgJGhvc3RDb250ZXh0U2VsZWN0b3JzOiAoKTtcbiAgJHJlc3RTZWxlY3RvcnM6ICgpO1xuICAkZGlyU2VsZWN0b3JzOiAoKTtcblxuICAvLyBTZWxlY3RvcnMgbXVzdCBiZSBzcGxpdCBpbnRvIGluZGl2aWR1YWwgc2VsZWN0b3JzIGluIGNhc2UgdGhlIGJyb3dzZXJcbiAgLy8gZG9lc24ndCBzdXBwb3J0IGEgc3BlY2lmaWMgc2VsZWN0b3IuXG4gIC8vIEZvciBleGFtcGxlLCBGaXJlZm94IGFuZCBTYWZhcmkgZG9lc24ndCBzdXBwb3J0IGA6aG9zdC1jb250ZXh0KClgLlxuICAvLyBJZiBhbiBpbnZhbGlkIHNlbGVjdG9yIGlzIHVzZWQsIHRoZW4gdGhlIGVudGlyZSBncm91cCBvZiBzZWxlY3RvcnNcbiAgLy8gd2lsbCBiZSBpZ25vcmVkLlxuICAvLyBAbGluayBodHRwczovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLTMvI2dyb3VwaW5nXG4gIEBlYWNoICRzZWxlY3RvciBpbiAkc2VsZWN0b3JzU3BsaXQge1xuICAgIC8vIEdyb3VwIHRoZSBzZWxlY3RvcnMgYmFjayBpbnRvIGEgc2luZ2xlIHNlbGVjdG9yIHRvIG9wdGltaXplIHRoZSBvdXRwdXQuXG4gICAgQGlmIHN0ci1pbmRleCgkc2VsZWN0b3IsIFwiOmhvc3QtY29udGV4dFwiKSB7XG4gICAgICAkaG9zdENvbnRleHRTZWxlY3RvcnM6IGFwcGVuZCgkaG9zdENvbnRleHRTZWxlY3RvcnMsICRzZWxlY3RvciwgY29tbWEpO1xuICAgIH0gQGVsc2Uge1xuICAgICAgLy8gR3JvdXAgdGhlIHNlbGVjdG9ycyBiYWNrIGludG8gYSBzaW5nbGUgc2VsZWN0b3IgdG8gb3B0aW1pemUgdGhlIG91dHB1dC5cbiAgICAgICRyZXN0U2VsZWN0b3JzOiBhcHBlbmQoJHJlc3RTZWxlY3RvcnMsICRzZWxlY3RvciwgY29tbWEpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFN1cHBvcnRlZCBieSBDaHJvbWUuXG4gIEBpZiBsZW5ndGgoJGhvc3RDb250ZXh0U2VsZWN0b3JzKSA+IDAge1xuICAgIEBhdC1yb290ICN7JGhvc3RDb250ZXh0U2VsZWN0b3JzfSB7XG4gICAgICBAY29udGVudDtcbiAgICB9XG4gIH1cblxuICAvLyBTdXBwb3J0ZWQgYnkgYWxsIGJyb3dzZXJzLlxuICBAaWYgbGVuZ3RoKCRyZXN0U2VsZWN0b3JzKSA+IDAge1xuICAgIEBhdC1yb290ICN7JHJlc3RTZWxlY3RvcnN9IHtcbiAgICAgIEBjb250ZW50O1xuICAgIH1cbiAgfVxuXG4gIC8vIElmIGJyb3dzZXIgY2FuIHN1cHBvcnQgYDpkaXIoKWAsIHRoZW4gYWRkIHRoZSBgOmRpcigpYCBzZWxlY3RvcnMuXG4gIC8vIEBzdXBwb3J0cyBzZWxlY3Rvcig6ZGlyKHJ0bCkpIHsgLy8gQCBJTVBPVEFOVCBOT1RFOiBUaGlzIGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBzZWxlY3RvciBmdW5jdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGluIGN1cnJlbnQgU0NTU1xuICAvLyBBZGRpbmcgOmRpcigpIGluIGNhc2UgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IGA6aG9zdC1jb250ZXh0KClgIGFuZCBkb2VzIHN1cHBvcnQgYDpkaXIoKWAuXG4gIC8vIGA6aG9zdC1jb250ZXh0KClgIGlzIGFkZGVkOlxuICAvLyAtIHRocm91Z2ggdGhlIGBhZGQtcm9vdC1zZWxlY3RvcigpYCBmdW5jdGlvbi5cbiAgLy8gLSBmaXJzdCBzbyB0aGF0IGl0IHRha2VzIHByZWNlZGVuY2Ugb3ZlciBgOmRpcigpYC5cbiAgLy8gRm9yIGV4YW1wbGUsXG4gIC8vIC0gRmlyZWZveCBkb2Vzbid0IHN1cHBvcnQgYDpob3N0LWNvbnRleHQoKWAsIGJ1dCBkb2VzIHN1cHBvcnQgYDpkaXIoKWAuXG4gIC8vIC0gU2FmYXJpIGRvZXNuJ3Qgc3VwcG9ydCBgOmhvc3QtY29udGV4dCgpYCwgYnV0IFNhZmFyaSAxNi40KyBzdXBwb3J0cyBgOmRpcigpYFxuICAvLyBAbGluayBodHRwczovL3dlYmtpdC5vcmcvYmxvZy8xMzk2Ni93ZWJraXQtZmVhdHVyZXMtaW4tc2FmYXJpLTE2LTQvXG4gIEBlYWNoICRzZWxlY3RvciBpbiAkcm9vdFNwbGl0IHtcbiAgICAkZGlyU2VsZWN0b3I6IFwiI3skc2VsZWN0b3J9OmRpcihydGwpXCI7XG4gICAgLy8gR3JvdXAgdGhlIHNlbGVjdG9ycyBiYWNrIGludG8gYSBzaW5nbGUgc2VsZWN0b3IgdG8gb3B0aW1pemUgdGhlIG91dHB1dC5cbiAgICAkZGlyU2VsZWN0b3JzOiBhcHBlbmQoJGRpclNlbGVjdG9ycywgJGRpclNlbGVjdG9yLCBjb21tYSk7XG4gIH1cblxuICAvLyBTdXBwb3J0ZWQgYnkgRmlyZWZveC5cbiAgQGlmIGxlbmd0aCgkZGlyU2VsZWN0b3JzKSA+IDAge1xuICAgIEBhdC1yb290ICN7JGRpclNlbGVjdG9yc30ge1xuICAgICAgQGNvbnRlbnQ7XG4gICAgfVxuICB9XG4gIC8vfVxufVxuXG5AbWl4aW4gbHRyKCkge1xuICBAY29udGVudDtcbn1cblxuXG4vLyBTVkcgQmFja2dyb3VuZCBJbWFnZSBNaXhpblxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdmdcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBzdmctYmFja2dyb3VuZC1pbWFnZSgkc3ZnLCAkZmxpcC1ydGw6IGZhbHNlKSB7XG4gICR1cmw6IHVybC1lbmNvZGUoJHN2Zyk7XG4gICR2aWV3Qm94OiBzdHItc3BsaXQoc3RyLWV4dHJhY3QoJHN2ZywgXCJ2aWV3Qm94PSdcIiwgXCInXCIpLCBcIiBcIik7XG5cbiAgQGlmICRmbGlwLXJ0bCAhPSB0cnVlIG9yICR2aWV3Qm94ID09IG51bGwge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChcImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PXV0Zi04LCN7JHVybH1cIik7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICAkdHJhbnNmb3JtOiBcInRyYW5zZm9ybT0ndHJhbnNsYXRlKCN7bnRoKCR2aWV3Qm94LCAzKX0sIDApIHNjYWxlKC0xLCAxKSdcIjtcbiAgICAkZmxpcHBlZC11cmw6ICRzdmc7XG4gICAgJGZsaXBwZWQtdXJsOiBzdHItcmVwbGFjZSgkZmxpcHBlZC11cmwsIFwiPHBhdGhcIiwgXCI8cGF0aCAjeyR0cmFuc2Zvcm19XCIpO1xuICAgICRmbGlwcGVkLXVybDogc3RyLXJlcGxhY2UoJGZsaXBwZWQtdXJsLCBcIjxsaW5lXCIsIFwiPGxpbmUgI3skdHJhbnNmb3JtfVwiKTtcbiAgICAkZmxpcHBlZC11cmw6IHN0ci1yZXBsYWNlKCRmbGlwcGVkLXVybCwgXCI8cG9seWdvblwiLCBcIjxwb2x5Z29uICN7JHRyYW5zZm9ybX1cIik7XG4gICAgJGZsaXBwZWQtdXJsOiB1cmwtZW5jb2RlKCRmbGlwcGVkLXVybCk7XG5cbiAgICBAaW5jbHVkZSBsdHIgKCkge1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFwiZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLTgsI3skdXJsfVwiKTtcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFwiZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLTgsI3skZmxpcHBlZC11cmx9XCIpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBBZGQgcHJvcGVydHkgaG9yaXpvbnRhbFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRlbmRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBwcm9wZXJ0eS1ob3Jpem9udGFsKCRwcm9wLCAkc3RhcnQsICRlbmQ6ICRzdGFydCkge1xuICBAaWYgJHN0YXJ0ID09IDAgYW5kICRlbmQgPT0gMCB7XG4gICAgI3skcHJvcH0tbGVmdDogJHN0YXJ0O1xuICAgICN7JHByb3B9LXJpZ2h0OiAkZW5kO1xuXG4gIH0gQGVsc2Uge1xuICAgIC13ZWJraXQtI3skcHJvcH0tc3RhcnQ6ICRzdGFydDtcbiAgICAjeyRwcm9wfS1pbmxpbmUtc3RhcnQ6ICRzdGFydDtcbiAgICAtd2Via2l0LSN7JHByb3B9LWVuZDogJGVuZDtcbiAgICAjeyRwcm9wfS1pbmxpbmUtZW5kOiAkZW5kO1xuICB9XG59XG5cbi8vIEFkZCBwcm9wZXJ0eSBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkcHJvcFxuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3Bcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gQHBhcmFtIHtib29sZWFufSAkY29udGVudCBpbmNsdWRlIGNvbnRlbnQgb3IgdXNlIGRlZmF1bHRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBwcm9wZXJ0eSgkcHJvcCwgJHRvcCwgJGVuZDogJHRvcCwgJGJvdHRvbTogJHRvcCwgJHN0YXJ0OiAkZW5kKSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5LWhvcml6b250YWwoJHByb3AsICRzdGFydCwgJGVuZCk7XG4gICN7JHByb3B9LXRvcDogJHRvcDtcbiAgI3skcHJvcH0tYm90dG9tOiAkYm90dG9tO1xufVxuXG4vLyBBZGQgcGFkZGluZyBob3Jpem9udGFsXG4vLyBAcGFyYW0ge3N0cmluZ30gJHN0YXJ0XG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHBhZGRpbmctaG9yaXpvbnRhbCgkc3RhcnQsICRlbmQ6ICRzdGFydCkge1xuICBAaW5jbHVkZSBwcm9wZXJ0eS1ob3Jpem9udGFsKHBhZGRpbmcsICRzdGFydCwgJGVuZCk7XG59XG5cbi8vIEFkZCBwYWRkaW5nIGZvciBhbGwgZGlyZWN0aW9uc1xuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3Bcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbVxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHBhZGRpbmcoJHRvcCwgJGVuZDogJHRvcCwgJGJvdHRvbTogJHRvcCwgJHN0YXJ0OiAkZW5kKSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5KHBhZGRpbmcsICR0b3AsICRlbmQsICRib3R0b20sICRzdGFydCk7XG59XG5cbi8vIEFkZCBtYXJnaW4gaG9yaXpvbnRhbFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRzdGFydFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRlbmRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBtYXJnaW4taG9yaXpvbnRhbCgkc3RhcnQsICRlbmQ6ICRzdGFydCkge1xuICBAaW5jbHVkZSBwcm9wZXJ0eS1ob3Jpem9udGFsKG1hcmdpbiwgJHN0YXJ0LCAkZW5kKTtcbn1cblxuLy8gQWRkIG1hcmdpbiBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkdG9wXG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRib3R0b21cbi8vIEBwYXJhbSB7c3RyaW5nfSAkc3RhcnRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBtYXJnaW4oJHRvcCwgJGVuZDogJHRvcCwgJGJvdHRvbTogJHRvcCwgJHN0YXJ0OiAkZW5kKSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5KG1hcmdpbiwgJHRvcCwgJGVuZCwgJGJvdHRvbSwgJHN0YXJ0KTtcbn1cblxuLy8gQWRkIHBvc2l0aW9uIGhvcml6b250YWxcbi8vIEBwYXJhbSB7c3RyaW5nfSAkc3RhcnQgLSBhbW91bnQgdG8gcG9zaXRpb24gc3RhcnRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZW5kIC0gYW1vdW50IHRvIGxlZnQ6IDA7IGVuZFxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuQG1peGluIHBvc2l0aW9uLWhvcml6b250YWwoJHN0YXJ0OiBudWxsLCAkZW5kOiBudWxsKSB7XG4gIEBpZiAkc3RhcnQgPT0gJGVuZCB7XG4gICAgQGluY2x1ZGUgbXVsdGktZGlyKCkge1xuICAgICAgbGVmdDogJHN0YXJ0O1xuICAgICAgcmlnaHQ6ICRlbmQ7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAYXQtcm9vdCB7XG4gICAgICBAc3VwcG9ydHMgKGluc2V0LWlubGluZS1zdGFydDogMCkge1xuICAgICAgICAmIHtcbiAgICAgICAgICBpbnNldC1pbmxpbmUtc3RhcnQ6ICRzdGFydDtcbiAgICAgICAgICBpbnNldC1pbmxpbmUtZW5kOiAkZW5kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVE9ETyBGVy0zNzY2XG4gICAgQGF0LXJvb3Qge1xuICAgICAgQHN1cHBvcnRzIG5vdCAoaW5zZXQtaW5saW5lLXN0YXJ0OiAwKSB7XG4gICAgICAgICYge1xuICAgICAgICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgICAgICAgIGxlZnQ6ICRzdGFydDtcbiAgICAgICAgICAgIHJpZ2h0OiAkZW5kO1xuICAgICAgICAgIH1cbiAgICAgICAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICAgICAgICBsZWZ0OiB1bnNldDtcbiAgICAgICAgICAgIHJpZ2h0OiB1bnNldDtcblxuICAgICAgICAgICAgbGVmdDogJGVuZDtcbiAgICAgICAgICAgIHJpZ2h0OiAkc3RhcnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8vIEFkZCBwb3NpdGlvbiBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkdG9wXG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRib3R0b21cbi8vIEBwYXJhbSB7c3RyaW5nfSAkc3RhcnRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBwb3NpdGlvbigkdG9wOiBudWxsLCAkZW5kOiBudWxsLCAkYm90dG9tOiBudWxsLCAkc3RhcnQ6IG51bGwpIHtcbiAgQGluY2x1ZGUgcG9zaXRpb24taG9yaXpvbnRhbCgkc3RhcnQsICRlbmQpO1xuICB0b3A6ICR0b3A7XG4gIGJvdHRvbTogJGJvdHRvbTtcbn1cblxuLy8gQWRkIGJvcmRlciBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkdG9wXG4vLyBAcGFyYW0ge3N0cmluZ30gJGVuZFxuLy8gQHBhcmFtIHtzdHJpbmd9ICRib3R0b21cbi8vIEBwYXJhbSB7c3RyaW5nfSAkc3RhcnRcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBtaXhpbiBib3JkZXIoJHRvcCwgJGVuZDogJHRvcCwgJGJvdHRvbTogJHRvcCwgJHN0YXJ0OiAkZW5kKSB7XG4gIEBpbmNsdWRlIHByb3BlcnR5KGJvcmRlciwgJHRvcCwgJGVuZCwgJGJvdHRvbSwgJHN0YXJ0KTtcbn1cblxuLy8gQWRkIGJvcmRlciByYWRpdXMgZm9yIGFsbCBkaXJlY3Rpb25zXG4vLyBAcGFyYW0ge3N0cmluZ30gJHRvcC1zdGFydFxuLy8gQHBhcmFtIHtzdHJpbmd9ICR0b3AtZW5kXG4vLyBAcGFyYW0ge3N0cmluZ30gJGJvdHRvbS1lbmRcbi8vIEBwYXJhbSB7c3RyaW5nfSAkYm90dG9tLXN0YXJ0XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AbWl4aW4gYm9yZGVyLXJhZGl1cygkdG9wLXN0YXJ0LCAkdG9wLWVuZDogJHRvcC1zdGFydCwgJGJvdHRvbS1lbmQ6ICR0b3Atc3RhcnQsICRib3R0b20tc3RhcnQ6ICR0b3AtZW5kKSB7XG4gIEBpZiAkdG9wLXN0YXJ0ID09ICR0b3AtZW5kIGFuZCAkdG9wLXN0YXJ0ID09ICRib3R0b20tZW5kIGFuZCAkdG9wLXN0YXJ0ID09ICRib3R0b20tc3RhcnQge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIGJvcmRlci1yYWRpdXM6ICR0b3Atc3RhcnQ7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAaW5jbHVkZSBsdHIoKSB7XG4gICAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAkdG9wLXN0YXJ0O1xuICAgICAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6ICR0b3AtZW5kO1xuICAgICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6ICRib3R0b20tZW5kO1xuICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogJGJvdHRvbS1zdGFydDtcbiAgICB9XG5cbiAgICBAaW5jbHVkZSBydGwoKSB7XG4gICAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAkdG9wLWVuZDtcbiAgICAgIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAkdG9wLXN0YXJ0O1xuICAgICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6ICRib3R0b20tc3RhcnQ7XG4gICAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAkYm90dG9tLWVuZDtcbiAgICB9XG4gIH1cbn1cblxuLy8gQWRkIGRpcmVjdGlvbiBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZGlyIC0gRGlyZWN0aW9uIG9uIExUUlxuQG1peGluIGRpcmVjdGlvbigkZGlyKSB7XG4gICRvdGhlci1kaXI6IG51bGw7XG5cbiAgQGlmICRkaXIgPT0gbHRyIHtcbiAgICAkb3RoZXItZGlyOiBydGw7XG4gIH0gQGVsc2Uge1xuICAgICRvdGhlci1kaXI6IGx0cjtcbiAgfVxuXG4gIEBpbmNsdWRlIGx0cigpIHtcbiAgICBkaXJlY3Rpb246ICRkaXI7XG4gIH1cbiAgQGluY2x1ZGUgcnRsKCkge1xuICAgIGRpcmVjdGlvbjogJG90aGVyLWRpcjtcbiAgfVxufVxuXG4vLyBBZGQgZmxvYXQgZm9yIGFsbCBkaXJlY3Rpb25zXG4vLyBAcGFyYW0ge3N0cmluZ30gJHNpZGVcbi8vIEBwYXJhbSB7c3RyaW5nfSAkZGVjb3JhdG9yIC0gIWltcG9ydGFudFxuQG1peGluIGZsb2F0KCRzaWRlLCAkZGVjb3JhdG9yOiBudWxsKSB7XG4gIEBpZiAkc2lkZSA9PSBzdGFydCB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgZmxvYXQ6IGxlZnQgJGRlY29yYXRvcjtcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgZmxvYXQ6IHJpZ2h0ICRkZWNvcmF0b3I7XG4gICAgfVxuICB9IEBlbHNlIGlmICRzaWRlID09IGVuZCB7XG4gICAgQGluY2x1ZGUgbHRyKCkge1xuICAgICAgZmxvYXQ6IHJpZ2h0ICRkZWNvcmF0b3I7XG4gICAgfVxuICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgIGZsb2F0OiBsZWZ0ICRkZWNvcmF0b3I7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAaW5jbHVkZSBtdWx0aS1kaXIoKSB7XG4gICAgICBmbG9hdDogJHNpZGUgJGRlY29yYXRvcjtcbiAgICB9XG4gIH1cbn1cblxuQG1peGluIGJhY2tncm91bmQtcG9zaXRpb24oJGhvcml6b250YWwsICRob3Jpem9udGFsLWFtb3VudDogbnVsbCwgJHZlcnRpY2FsOiBudWxsLCAkdmVydGljYWwtYW1vdW50OiBudWxsKSB7XG4gIEBpZiAkaG9yaXpvbnRhbCA9PSBzdGFydCBvciAkaG9yaXpvbnRhbCA9PSBlbmQge1xuICAgICRob3Jpem9udGFsLWx0cjogbnVsbDtcbiAgICAkaG9yaXpvbnRhbC1ydGw6IG51bGw7XG4gICAgQGlmICRob3Jpem9udGFsID09IHN0YXJ0IHtcbiAgICAgICRob3Jpem9udGFsLWx0cjogbGVmdDtcbiAgICAgICRob3Jpem9udGFsLXJ0bDogcmlnaHQ7XG4gICAgfSBAZWxzZSB7XG4gICAgICAkaG9yaXpvbnRhbC1sdHI6IHJpZ2h0O1xuICAgICAgJGhvcml6b250YWwtcnRsOiBsZWZ0O1xuICAgIH1cblxuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246ICRob3Jpem9udGFsLWx0ciAkaG9yaXpvbnRhbC1hbW91bnQgJHZlcnRpY2FsICR2ZXJ0aWNhbC1hbW91bnQ7XG4gICAgfVxuICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246ICRob3Jpem9udGFsLXJ0bCAkaG9yaXpvbnRhbC1hbW91bnQgJHZlcnRpY2FsICR2ZXJ0aWNhbC1hbW91bnQ7XG4gICAgfVxuICB9IEBlbHNlIHtcbiAgICBAaW5jbHVkZSBtdWx0aS1kaXIoKSB7XG4gICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAkaG9yaXpvbnRhbCAkaG9yaXpvbnRhbC1hbW91bnQgJHZlcnRpY2FsICR2ZXJ0aWNhbC1hbW91bnQ7XG4gICAgfVxuICB9XG59XG5cbkBtaXhpbiB0cmFuc2Zvcm0tb3JpZ2luKCR4LWF4aXMsICR5LWF4aXM6IG51bGwpIHtcbiAgQGlmICR4LWF4aXMgPT0gc3RhcnQge1xuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGxlZnQgJHktYXhpcztcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogcmlnaHQgJHktYXhpcztcbiAgICB9XG4gIH0gQGVsc2UgaWYgJHgtYXhpcyA9PSBlbmQge1xuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IHJpZ2h0ICR5LWF4aXM7XG4gICAgfVxuICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGxlZnQgJHktYXhpcztcbiAgICB9XG4gIH0gQGVsc2UgaWYgJHgtYXhpcyA9PSBsZWZ0IG9yICR4LWF4aXMgPT0gcmlnaHQge1xuICAgIEBpbmNsdWRlIG11bHRpLWRpcigpIHtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46ICR4LWF4aXMgJHktYXhpcztcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46ICR4LWF4aXMgJHktYXhpcztcbiAgICB9XG4gICAgQGluY2x1ZGUgcnRsKCkge1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogY2FsYygxMDAlIC0gI3skeC1heGlzfSkgJHktYXhpcztcbiAgICB9XG4gIH1cbn1cblxuLy8gQWRkIHRyYW5zZm9ybSBmb3IgYWxsIGRpcmVjdGlvbnNcbi8vIEBwYXJhbSB7c3RyaW5nfSAkdHJhbnNmb3JtcyAtIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIHRyYW5zZm9ybXNcbkBtaXhpbiB0cmFuc2Zvcm0oJHRyYW5zZm9ybXMuLi4pIHtcbiAgJGV4dHJhOiBudWxsO1xuXG4gICR4OiBudWxsO1xuICAkbHRyLXRyYW5zbGF0ZTogbnVsbDtcbiAgJHJ0bC10cmFuc2xhdGU6IG51bGw7XG5cbiAgQGVhY2ggJHRyYW5zZm9ybSBpbiAkdHJhbnNmb3JtcyB7XG4gICAgQGlmIChzdHItaW5kZXgoJHRyYW5zZm9ybSwgdHJhbnNsYXRlM2QpKSB7XG4gICAgICAkdHJhbnNmb3JtOiBzdHItcmVwbGFjZSgkdHJhbnNmb3JtLCAndHJhbnNsYXRlM2QoJyk7XG4gICAgICAkdHJhbnNmb3JtOiBzdHItcmVwbGFjZSgkdHJhbnNmb3JtLCAnKScpO1xuXG4gICAgICAkY29vcmRpbmF0ZXM6IHN0ci1zcGxpdCgkdHJhbnNmb3JtLCAnLCcpO1xuXG4gICAgICAkeDogbnRoKCRjb29yZGluYXRlcywgMSk7XG4gICAgICAkeTogbnRoKCRjb29yZGluYXRlcywgMik7XG4gICAgICAkejogbnRoKCRjb29yZGluYXRlcywgMyk7XG5cbiAgICAgICRsdHItdHJhbnNsYXRlOiB0cmFuc2xhdGUzZCgkeCwgJHksICR6KTtcbiAgICAgICRydGwtdHJhbnNsYXRlOiB0cmFuc2xhdGUzZChjYWxjKC0xICogI3skeH0pLCAkeSwgJHopO1xuICAgIH0gQGVsc2Uge1xuICAgICAgQGlmICRleHRyYSA9PSBudWxsIHtcbiAgICAgICAgJGV4dHJhOiAkdHJhbnNmb3JtO1xuICAgICAgfSBAZWxzZSB7XG4gICAgICAgICRleHRyYTogJGV4dHJhICR0cmFuc2Zvcm07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgQGlmICR4ID09ICcwJyBvciAkeCA9PSBudWxsIHtcbiAgICBAaW5jbHVkZSBtdWx0aS1kaXIoKSB7XG4gICAgICB0cmFuc2Zvcm06ICRsdHItdHJhbnNsYXRlICRleHRyYTtcbiAgICB9XG4gIH0gQGVsc2Uge1xuICAgIEBpbmNsdWRlIGx0cigpIHtcbiAgICAgIHRyYW5zZm9ybTogJGx0ci10cmFuc2xhdGUgJGV4dHJhO1xuICAgIH1cblxuICAgIEBpbmNsdWRlIHJ0bCgpIHtcbiAgICAgIHRyYW5zZm9ybTogJHJ0bC10cmFuc2xhdGUgJGV4dHJhO1xuICAgIH1cbiAgfVxufVxuIiwiLyoqXG4gKiBJbXBvcnRlZCBpb25pYyBtaXhpbnMgZm9yIFNDU1MgZnJvbSBkaWZmZXJlbnQgY29tcG9uZW50c1xuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogRXh0cmFjdGVkIGZyb21cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL2lvbmljLWZyYW1ld29yay9ibG9iL21hc3Rlci9jb3JlL3NyYy9jb21wb25lbnRzL2dyaWQvZ3JpZC5taXhpbnMuc2Nzc1xuICogaHR0cHM6Ly9naXRodWIuY29tL2lvbmljLXRlYW0vaW9uaWMtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2NvcmUvc3JjL2NvbXBvbmVudHMvaXRlbS9pdGVtLm1peGlucy5zY3NzXG4gKi9cblxuLy8gUmVzcG9uc2l2ZSBNaXhpbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblxuLy8gQ3JlYXRlcyBhIGZpeGVkIHdpZHRoIGZvciB0aGUgZ3JpZCBiYXNlZCBvbiB0aGUgc2NyZWVuIHNpemVcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5AbWl4aW4gbWFrZS1ncmlkLXdpZHRocygkd2lkdGhzOiAkZ3JpZC13aWR0aHMsICRicmVha3BvaW50czogJHNjcmVlbi1icmVha3BvaW50cykge1xuICBAZWFjaCAkYnJlYWtwb2ludCwgJHdpZHRoIGluICR3aWR0aHMge1xuICAgIEBpbmNsdWRlIG1lZGlhLWJyZWFrcG9pbnQtdXAoJGJyZWFrcG9pbnQsICRicmVha3BvaW50cykge1xuICAgICAgd2lkdGg6ICR3aWR0aDtcbiAgICB9XG4gIH1cblxuICBtYXgtd2lkdGg6IDEwMCU7XG59XG5cblxuLy8gQWRkcyBwYWRkaW5nIHRvIHRoZSBlbGVtZW50IGJhc2VkIG9uIGJyZWFrcG9pbnRzXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuQG1peGluIG1ha2UtYnJlYWtwb2ludC1wYWRkaW5nKCRwYWRkaW5ncykge1xuICBAZWFjaCAkYnJlYWtwb2ludCBpbiBtYXAta2V5cygkcGFkZGluZ3MpIHtcbiAgICBAaW5jbHVkZSBtZWRpYS1icmVha3BvaW50LXVwKCRicmVha3BvaW50KSB7XG4gICAgICAkcGFkZGluZzogbWFwLWdldCgkcGFkZGluZ3MsICRicmVha3BvaW50KTtcblxuICAgICAgQGluY2x1ZGUgcGFkZGluZygkcGFkZGluZyk7XG4gICAgfVxuICB9XG59XG5cblxuLy8gSXRlbSBNaXhpbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkBtaXhpbiBpdGVtLXB1c2gtc3ZnLXVybCgkZmlsbCkge1xuICAkaXRlbS1kZXRhaWwtcHVzaC1zdmc6IFwiPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMiAyMCc+PHBhdGggZD0nTTIsMjBsLTItMmw4LThMMCwybDItMmwxMCwxMEwyLDIweicgZmlsbD0nI3skZmlsbH0nLz48L3N2Zz5cIjtcblxuICBAaW5jbHVkZSBzdmctYmFja2dyb3VuZC1pbWFnZSgkaXRlbS1kZXRhaWwtcHVzaC1zdmcsIHRydWUpO1xufVxuIiwiQHVzZSBcInNhc3M6bWF0aFwiIGFzIG1hdGg7XG5cbi8qKlxuICogQXBwIGN1c3RvbSBtaXhpbnMgZm9yIFNDU1NcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFBsYWNlIGhlcmUgb3VyIGN1c3RvbSBtaXhpbnMuXG4gKi9cblxuLy8gTWl4ZXMgYSBjb2xvciB3aXRoIGJsYWNrIHRvIGNyZWF0ZSBpdHMgc2hhZGUuXG4vLyBEZWZhdWx0IHRvIGJvb3RzdHJhcCBsZXZlbCA2LlxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbkBmdW5jdGlvbiBnZXQtY29sb3Itc2hhZGUtcGVyY2VudCgkY29sb3IsICRwZXJjZW50OiA0OCUpIHtcbiAgICBAcmV0dXJuIG1peCgjMDAwLCAkY29sb3IsICRwZXJjZW50KTtcbn1cblxuLy8gTWl4ZXMgYSBjb2xvciB3aXRoIHdoaXRlIHRvIGNyZWF0ZSBpdHMgdGludC5cbi8vIERlZmF1bHQgdG8gYm9vdHN0cmFwIGxldmVsIC0xMC5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5AZnVuY3Rpb24gZ2V0LWNvbG9yLXRpbnQtcGVyY2VudCgkY29sb3IsICRwZXJjZW50OiA4MCUpIHtcbiAgICBAcmV0dXJuIG1peCgjZmZmLCAkY29sb3IsICRwZXJjZW50KTtcbn1cblxuLy8gSW9uaWMgQ29sb3JzXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gR2VuZXJhdGVzIHRoZSBjb2xvciBjbGFzc2VzIGFuZCB2YXJpYWJsZXMgYmFzZWQgb24gdGhlXG4vLyBjb2xvcnMgbWFwXG5cbkBtaXhpbiBnZW5lcmF0ZS1jb2xvcigkY29sb3ItbmFtZSwgJGNvbG9ycywgJHRoZW1lKSB7XG4gICAgJGNvbG9yLXRoZW1lczogbWFwLWdldCgkY29sb3JzLCAkY29sb3ItbmFtZSk7XG4gICAgJGJhc2U6IG1hcC1nZXQoJGNvbG9yLXRoZW1lcywgJHRoZW1lKTtcblxuICAgIEBpZiAkdGhlbWUgPT0gJ2RhcmsnIHtcbiAgICAgICAgJGJhc2U6IG1peChtYXAtZ2V0KCRjb2xvci10aGVtZXMsICdsaWdodCcpLCB3aGl0ZSwgODAlKSAhZGVmYXVsdDtcbiAgICB9XG5cbiAgICBAaW5jbHVkZSBnZW5lcmF0ZS1jb2xvci12YXJpYW50cygkY29sb3ItbmFtZSwgJGJhc2UpO1xufVxuXG5AbWl4aW4gZ2VuZXJhdGUtY29sb3ItdmFyaWFudHMoJGNvbG9yLW5hbWUsICRiYXNlKSB7XG4gICAgJGNvbnRyYXN0OiBnZXRfY29udHJhc3RfY29sb3IoJGJhc2UpO1xuICAgICRzaGFkZTogZ2V0LWNvbG9yLXNoYWRlLXBlcmNlbnQoJGJhc2UpO1xuICAgICR0aW50OiBnZXQtY29sb3ItdGludC1wZXJjZW50KCRiYXNlKTtcblxuICAgIC0tI3skY29sb3ItbmFtZX06ICN7JGJhc2V9O1xuICAgIC0tI3skY29sb3ItbmFtZX0tc2hhZGU6ICN7JHNoYWRlfTtcbiAgICAtLSN7JGNvbG9yLW5hbWV9LXRpbnQ6ICN7JHRpbnR9O1xuICAgIC0tI3skY29sb3ItbmFtZX0tY29udHJhc3Q6ICN7JGNvbnRyYXN0fTtcblxuICAgIC8vIEludGVybmFsIGlvbmljIHVzZSBvbmx5LlxuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9OiB2YXIoLS0jeyRjb2xvci1uYW1lfSk7XG4gICAgLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tYmFzZTogdmFyKC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9KTtcbiAgICAtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1yZ2I6ICN7Y29sb3ItdG8tcmdiLWxpc3QoJGJhc2UpfTtcbiAgICAtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1jb250cmFzdDogI3skY29udHJhc3R9O1xuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LWNvbnRyYXN0LXJnYjogI3tjb2xvci10by1yZ2ItbGlzdCgkY29udHJhc3QpfTtcbiAgICAtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1zaGFkZTogI3skc2hhZGV9O1xuICAgIC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXRpbnQ6ICN7JHRpbnR9O1xuXG4gICAgLmlvbi1jb2xvci0jeyRjb2xvci1uYW1lfSB7XG4gICAgICAgIC0taW9uLWNvbG9yOiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0pO1xuICAgICAgICAtLWlvbi1jb2xvci1iYXNlOiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tYmFzZSk7XG4gICAgICAgIC0taW9uLWNvbG9yLXJnYjogdmFyKC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXJnYik7XG4gICAgICAgIC0taW9uLWNvbG9yLWNvbnRyYXN0OiB2YXIoLS1pb24tY29sb3ItI3skY29sb3ItbmFtZX0tY29udHJhc3QpO1xuICAgICAgICAtLWlvbi1jb2xvci1jb250cmFzdC1yZ2I6IHZhcigtLWlvbi1jb2xvci0jeyRjb2xvci1uYW1lfS1jb250cmFzdC1yZ2IpO1xuICAgICAgICAtLWlvbi1jb2xvci1zaGFkZTogdmFyKC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXNoYWRlKTtcbiAgICAgICAgLS1pb24tY29sb3ItdGludDogdmFyKC0taW9uLWNvbG9yLSN7JGNvbG9yLW5hbWV9LXRpbnQpO1xuICAgIH1cbn1cblxuQG1peGluIGNvcmUtZm9jdXMoKSB7XG4gICAgb3V0bGluZTogbm9uZTtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgJjo6YWZ0ZXIge1xuICAgICAgICBAaW5jbHVkZSBwb3NpdGlvbigwLCAwLCAwLCAwKTtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICBjb250ZW50OiBcIlwiO1xuICAgICAgICBvcGFjaXR5OiAxO1xuICAgICAgICB6LWluZGV4OiAxO1xuICAgICAgICBAaW5jbHVkZSBjb3JlLWZvY3VzLXN0eWxlKCk7XG4gICAgfVxufVxuXG5AbWl4aW4gY29yZS1mb2N1cy1zdHlsZSgpIHtcbiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgdmFyKC0tYTExeS1mb2N1cy13aWR0aCkgMXB4IHZhcigtLWExMXktZm9jdXMtY29sb3IpO1xuICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLWJvcmRlci1yYWRpdXMpO1xuICAgIC8vIFRoaWNrZXIgb3B0aW9uOlxuICAgIC8vIGJvcmRlcjogdmFyKC0tYTExeS1mb2N1cy13aWR0aCkgc29saWQgdmFyKC0tYTExeS1mb2N1cy1jb2xvcik7XG59XG5cbkBtaXhpbiBjb3JlLXRyYW5zaXRpb24oJHByb3BlcnRpZXM6IGFsbCwgJGR1cmF0aW9uOiA1MDBtcywgJHRpbWluZy1mdW5jdGlvbjogZWFzZS1pbi1vdXQpIHtcbiAgICAkdHJhbnNpdGlvbnM6ICgpO1xuICAgIEBlYWNoICRwcm9wZXJ0eSBpbiAkcHJvcGVydGllcyB7XG4gICAgICAkdHJhbnNpdGlvbnM6IGFwcGVuZCgkdHJhbnNpdGlvbnMsICRwcm9wZXJ0eSAkZHVyYXRpb24gJHRpbWluZy1mdW5jdGlvbiwgY29tbWEpO1xuICAgIH1cblxuICAgIC13ZWJraXQtdHJhbnNpdGlvbjogJHRyYW5zaXRpb25zO1xuICAgIHRyYW5zaXRpb246ICR0cmFuc2l0aW9ucztcbn1cblxuQG1peGluIHNyLW9ubHkoKSB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHdpZHRoOiAxcHg7XG4gICAgaGVpZ2h0OiAxcHg7XG4gICAgcGFkZGluZzogMDtcbiAgICBtYXJnaW46IC0xcHg7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICBjbGlwOiByZWN0KDAsIDAsIDAsIDApO1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gICAgYm9yZGVyOiAwO1xufVxuXG4vKipcbiAqIFNhbWUgYXMgaXRlbS1wdXNoLXN2Zy11cmwgYnV0IGFkbWl0cyBmbGlwLXJ0bFxuICovXG5AbWl4aW4gcHVzaC1hcnJvdy1jb2xvcigkZmlsbDogNjI2MjYyLCAkZmxpcC1ydGw6IGZhbHNlKSB7XG4gICAgJGl0ZW0tZGV0YWlsLXB1c2gtc3ZnOiBcIjxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTIgMjAnPjxwYXRoIGQ9J00yLDIwbC0yLTJsOC04TDAsMmwyLTJsMTAsMTBMMiwyMHonIGZpbGw9JyN7JGZpbGx9Jy8+PC9zdmc+XCI7XG5cbiAgICBAaW5jbHVkZSBzdmctYmFja2dyb3VuZC1pbWFnZSgkaXRlbS1kZXRhaWwtcHVzaC1zdmcsICRmbGlwLXJ0bCk7XG59XG5cbkBtaXhpbiBib3JkZXItc3RhcnQoJHB4LCAkdHlwZTogbnVsbCwgJGNvbG9yOiBudWxsKSB7XG4gICAgQGluY2x1ZGUgcHJvcGVydHktaG9yaXpvbnRhbChib3JkZXIsICRweCAkdHlwZSAkY29sb3IsIG51bGwpO1xufVxuXG5AbWl4aW4gYm9yZGVyLWVuZCgkcHgsICR0eXBlOiBudWxsLCAkY29sb3I6IG51bGwpIHtcbiAgICBAaW5jbHVkZSBwcm9wZXJ0eS1ob3Jpem9udGFsKGJvcmRlciwgbnVsbCwgJHB4ICR0eXBlICRjb2xvcik7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtYm9yZGVyLXN0YXJ0KCRweCwgJHR5cGUsICRjb2xvcikge1xuICAgICRzYWZlLWFyZWEtcG9zaXRpb246IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1sZWZ0KSArICN7JHB4fSk7XG5cbiAgICBAaW5jbHVkZSBib3JkZXItc3RhcnQoJHNhZmUtYXJlYS1wb3NpdGlvbiwgJHR5cGUsICRjb2xvcik7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtYm9yZGVyLWVuZCgkcHgsICR0eXBlLCAkY29sb3IpIHtcbiAgICAkc2FmZS1hcmVhLXBvc2l0aW9uOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skcHh9KTtcblxuICAgIEBpbmNsdWRlIGJvcmRlci1lbmQoJHNhZmUtYXJlYS1wb3NpdGlvbiwgJHR5cGUsICRjb2xvcik7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtbWFyZ2luLWhvcml6b250YWwoJHN0YXJ0LCAkZW5kOiAkc3RhcnQpIHtcbiAgICAkc2FmZS1hcmVhLWVuZDogbnVsbDtcbiAgICAkc2FmZS1hcmVhLXN0YXJ0OiBudWxsO1xuXG4gICAgQGlmICgkZW5kKSB7XG4gICAgICAgICRzYWZlLWFyZWEtZW5kOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skZW5kfSk7XG4gICAgfVxuICAgIEBpZiAoJHN0YXJ0KSB7XG4gICAgICAgICRzYWZlLWFyZWEtc3RhcnQ6IGNhbGModmFyKC0taW9uLXNhZmUtYXJlYS1sZWZ0KSArICN7JHN0YXJ0fSk7XG4gICAgfVxuXG4gICAgQGluY2x1ZGUgbWFyZ2luLWhvcml6b250YWwoJHNhZmUtYXJlYS1zdGFydCwgJHNhZmUtYXJlYS1lbmQpO1xufVxuXG5AbWl4aW4gc2FmZS1hcmVhLW1hcmdpbi1zdGFydCgkc3RhcnQsICRlbmQpIHtcbiAgICAkc2FmZS1hcmVhLXN0YXJ0OiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtbGVmdCkgKyAjeyRzdGFydH0pO1xuXG4gICAgQGluY2x1ZGUgbWFyZ2luLWhvcml6b250YWwoJHNhZmUtYXJlYS1zdGFydCwgJGVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtbWFyZ2luLWVuZCgkc3RhcnQsICRlbmQpIHtcbiAgICAkc2FmZS1hcmVhLWVuZDogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLXJpZ2h0KSArICN7JGVuZH0pO1xuXG4gICAgQGluY2x1ZGUgbWFyZ2luLWhvcml6b250YWwoJHN0YXJ0LCAkc2FmZS1hcmVhLWVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtcGFkZGluZy1ob3Jpem9udGFsKCRzdGFydCwgJGVuZDogJHN0YXJ0KSB7XG4gICAgJHNhZmUtYXJlYS1lbmQ6IG51bGw7XG4gICAgJHNhZmUtYXJlYS1zdGFydDogbnVsbDtcblxuICAgIEBpZiAoJGVuZCkge1xuICAgICAgICAkc2FmZS1hcmVhLWVuZDogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLXJpZ2h0KSArICN7JGVuZH0pO1xuICAgIH1cbiAgICBAaWYgKCRzdGFydCkge1xuICAgICAgICAkc2FmZS1hcmVhLXN0YXJ0OiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtbGVmdCkgKyAjeyRzdGFydH0pO1xuICAgIH1cblxuICAgIEBpbmNsdWRlIHBhZGRpbmctaG9yaXpvbnRhbCgkc2FmZS1hcmVhLXN0YXJ0LCAkc2FmZS1hcmVhLWVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtcGFkZGluZy1zdGFydCgkc3RhcnQsICRlbmQpIHtcbiAgICAkc2FmZS1hcmVhLXN0YXJ0OiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtbGVmdCkgKyAjeyRzdGFydH0pO1xuXG4gICAgQGluY2x1ZGUgcGFkZGluZy1ob3Jpem9udGFsKCRzYWZlLWFyZWEtc3RhcnQsICRlbmQpO1xufVxuXG5AbWl4aW4gc2FmZS1hcmVhLXBhZGRpbmctZW5kKCRzdGFydCwgJGVuZCkge1xuICAgICRzYWZlLWFyZWEtZW5kOiBjYWxjKHZhcigtLWlvbi1zYWZlLWFyZWEtcmlnaHQpICsgI3skZW5kfSk7XG5cbiAgICBAaW5jbHVkZSBwYWRkaW5nLWhvcml6b250YWwoJHN0YXJ0LCAkc2FmZS1hcmVhLWVuZCk7XG59XG5cbkBtaXhpbiBzYWZlLWFyZWEtcG9zaXRpb24oJHRvcDogbnVsbCwgJGVuZDogbnVsbCwgJGJvdHRvbTogbnVsbCwgJHN0YXJ0OiBudWxsKSB7XG4gICAgJHNhZmUtYXJlYS1zdGFydDogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLWxlZnQpICsgI3skc3RhcnR9KTtcbiAgICAkc2FmZS1hcmVhLWVuZDogY2FsYyh2YXIoLS1pb24tc2FmZS1hcmVhLXJpZ2h0KSArICN7JGVuZH0pO1xuXG4gICAgQGluY2x1ZGUgcG9zaXRpb24oJHRvcCwgJHNhZmUtYXJlYS1lbmQsICRib3R0b20sICRzYWZlLWFyZWEtc3RhcnQpO1xufVxuXG5AbWl4aW4gY29yZS1oZWFkaW5ncygpIHtcbiAgICBoMSB7XG4gICAgICAgIGZvbnQtc2l6ZTogMjZweDtcbiAgICB9XG4gICAgaDIsIC5pdGVtLWhlYWRpbmcge1xuICAgICAgICBmb250LXNpemU6IDI0cHg7XG4gICAgfVxuICAgIGgzIHtcbiAgICAgICAgZm9udC1zaXplOiAyMnB4O1xuICAgIH1cbiAgICBoNCB7XG4gICAgICAgIGZvbnQtc2l6ZTogMjBweDtcbiAgICB9XG4gICAgaDUge1xuICAgICAgICBmb250LXNpemU6IDE4cHg7XG4gICAgfVxuICAgIGg2IHtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cbn1cblxuQG1peGluIGRhcmttb2RlKCkge1xuICAgICRyb290OiAjeyZ9O1xuXG4gICAgQGF0LXJvb3QgI3thZGQtcm9vdC1zZWxlY3Rvcigkcm9vdCwgXCJodG1sLmRhcmtcIil9IHtcbiAgICAgICAgQGNvbnRlbnQ7XG4gICAgfVxufVxuXG5AbWl4aW4gaG9yaXpvbnRhbF9zY3JvbGxfaXRlbSgkd2lkdGgsICRtaW4td2lkdGgsICRtYXgtd2lkdGgpIHtcbiAgICBmbGV4OiAwIDAgJHdpZHRoO1xuICAgIG1pbi13aWR0aDogJG1pbi13aWR0aDtcbiAgICBtYXgtd2lkdGg6ICRtYXgtd2lkdGg7XG4gICAgYWxpZ24tc2VsZjogc3RyZXRjaDtcbiAgICBkaXNwbGF5OiBibG9jaztcblxuICAgIGlvbi1jYXJkIHtcbiAgICAgICAgLS12ZXJ0aWNhbC1tYXJnaW46IDEwcHg7XG4gICAgICAgIC0taG9yaXpvbnRhbC1tYXJnaW46IDEwcHg7XG5cbiAgICAgICAgd2lkdGg6IGNhbGMoMTAwJSAtIHZhcigtLWhvcml6b250YWwtbWFyZ2luKSAtIHZhcigtLWhvcml6b250YWwtbWFyZ2luKSk7XG4gICAgICAgIGhlaWdodDogY2FsYygxMDAlIC0gdmFyKC0tdmVydGljYWwtbWFyZ2luKSAtIHZhcigtLXZlcnRpY2FsLW1hcmdpbikpO1xuICAgICAgICBtYXJnaW46IHZhcigtLXZlcnRpY2FsLW1hcmdpbikgdmFyKC0taG9yaXpvbnRhbC1tYXJnaW4pO1xuXG4gICAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiAzNjBweCkge1xuICAgICAgICAgICAgLS1ob3Jpem9udGFsLW1hcmdpbjogNnB4O1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBDb2xvciBtaXhpbnMuXG5AZnVuY3Rpb24gZ2V0X2JyaWdodG5lc3MoJGNvbG9yKSB7XG4gICAgQHJldHVybiBtYXRoLmRpdihyZWQoJGNvbG9yKSArIGdyZWVuKCRjb2xvcikgKyBibHVlKCRjb2xvciksIDMpO1xufVxuXG4vLyBHZXQgdGhlIGJldHRlciBjb2xvciBjb250cmFzdCB1c2luZyBXQ0FHIGFsZ29yeXRobS5cbkBmdW5jdGlvbiBnZXRfY29udHJhc3RfY29sb3IoJGNvbG9yKSB7XG4gICAgJGx1bWlhbmNlOiBsdW1pbmFuY2UoJGNvbG9yKTtcblxuICAgIC8vIFdoaXRlIGx1bWlhbmNlIGlzIDEuXG4gICAgJHdoaXRlQ29udHJhc3Q6IG1hdGguZGl2KCRsdW1pYW5jZSArIDAuMDUsIDEgKyAwLjA1KTtcbiAgICAvLyBXaGl0ZSBsdW1pYW5jZSBpcyAwLlxuICAgICRibGFja0NvbnRyYXN0OiBtYXRoLmRpdigwLjA1LCAkbHVtaWFuY2UgKyAwLjA1KTtcblxuICAgIEByZXR1cm4gaWYoJHdoaXRlQ29udHJhc3QgPCAkYmxhY2tDb250cmFzdCwgd2hpdGUsIGJsYWNrKTtcbn1cblxuLy8gQ29sb3IgY29udHJhc3QgdXNpbmcgeWlxIGFwcm94aW1hdGlvbiB3aXRoIDE1MCB0aHJlc2hvbGQuXG5AZnVuY3Rpb24gZ2V0X2NvbnRyYXN0X2NvbG9yX3lpcSgkY29sb3IsICRkYXJrOiBibGFjaywgJGxpZ2h0OiB3aGl0ZSkge1xuICAgICRyOiByZWQoJGNvbG9yKTtcbiAgICAkZzogZ3JlZW4oJGNvbG9yKTtcbiAgICAkYjogYmx1ZSgkY29sb3IpO1xuXG4gICAgJHlpcTogbWF0aC5kaXYoKCRyICogMjk5KSArICgkZyAqIDU4NykgKyAoJGIgKiAxMTQpLCAxMDAwKTtcblxuICAgIEByZXR1cm4gaWYoJHlpcSA+PSAxMjgsICRkYXJrLCAkbGlnaHQpO1xufVxuXG4vLyBXQ0FHIGNvbnRyYXN0IGFsZ29yaXRobVxuQGZ1bmN0aW9uIGNoZWNrLWNvbnRyYXN0KCRmb3JlZ3JvdW5kLCAkYmFja2dyb3VuZCkge1xuICAgICRmb3JlZ3JvdW5kTHVtaWFuY2U6IGx1bWluYW5jZSgkZm9yZWdyb3VuZCk7XG4gICAgJGJhY2tncm91bmRMdW1pbmFuY2U6IGx1bWluYW5jZSgkYmFja2dyb3VuZCk7XG5cbiAgICBAaWYgKCRiYWNrZ3JvdW5kTHVtaW5hbmNlIDwgJGZvcmVncm91bmRMdW1pYW5jZSkge1xuICAgICAgICBAcmV0dXJuIG1hdGguZGl2KCRiYWNrZ3JvdW5kTHVtaW5hbmNlICsgMC4wNSwgJGZvcmVncm91bmRMdW1pYW5jZSArIDAuMDUpO1xuICAgIH0gQGVsc2Uge1xuICAgICAgICBAcmV0dXJuIG1hdGguZGl2KCRmb3JlZ3JvdW5kTHVtaWFuY2UgKyAwLjA1LCAkYmFja2dyb3VuZEx1bWluYW5jZSArIDAuMDUpO1xuICAgIH1cbn1cblxuQGZ1bmN0aW9uIGx1bWluYW5jZSgkY29sb3IpIHtcbiAgICAkcjogcmVkKCRjb2xvcik7XG4gICAgJGc6IGdyZWVuKCRjb2xvcik7XG4gICAgJGI6IGJsdWUoJGNvbG9yKTtcblxuICAgICRyOiBjb21wb25lbnQtbHVtaW5hbmNlKCRyKTtcbiAgICAkZzogY29tcG9uZW50LWx1bWluYW5jZSgkZyk7XG4gICAgJGI6IGNvbXBvbmVudC1sdW1pbmFuY2UoJGIpO1xuXG4gICAgQHJldHVybiAkciAqIDAuMjEyNiArICRnICogMC43MTUyICsgJGIgKiAwLjA3MjI7XG59XG5cbkBmdW5jdGlvbiBjb21wb25lbnQtbHVtaW5hbmNlKCR2YWx1ZSkge1xuICAgICR2YWx1ZTogbWF0aC5kaXYoJHZhbHVlLCAyNTUpO1xuXG4gICAgQGlmICgkdmFsdWUgPD0gMC4wMzkyOCkge1xuICAgICAgICBAcmV0dXJuIG1hdGguZGl2KCR2YWx1ZSwgMTIuOTIpO1xuICAgIH0gQGVsc2Uge1xuICAgICAgICBAcmV0dXJuIG1hdGgucG93KG1hdGguZGl2KCR2YWx1ZSArIDAuMDU1LCAxLjA1NSksIDIuNCk7XG4gICAgfVxufVxuIiwiLypcbiAqIEFwcCBDdXN0b20gQXBwIHZhcmlhYmxlcyBTQ1NTXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBQbGFjZSBoZXJlIGFsbCBjdXN0b20gYXBwIHZhcmlhYmxlcy5cbiAqL1xuIiwiLypcbiAqIEFwcCBHbG9iYWwgdmFyaWFibGVzIFNDU1NcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFBsYWNlIGhlcmUgYWxsIGdsb2JhbCB2YXJpYWJsZXMuXG4gKi9cblxuJHdoaXRlOiAgICAgICAjZmZmZmZmICFkZWZhdWx0O1xuJGdyYXktMTAwOiAgICAjZjhmOWZhICFkZWZhdWx0O1xuJGdyYXktMjAwOiAgICAjZTllY2VmICFkZWZhdWx0O1xuJGdyYXktMzAwOiAgICAjZGVlMmU2ICFkZWZhdWx0OyAvLyBTdHJva2VcbiRncmF5LTQwMDogICAgI2NlZDRkYSAhZGVmYXVsdDtcbiRncmF5LTUwMDogICAgIzhmOTU5ZSAhZGVmYXVsdDsgLy8gU3Ryb2tlIG9uIGlucHV0c1xuJGdyYXktNjAwOiAgICAjNmE3MzdiICFkZWZhdWx0O1xuJGdyYXktNzAwOiAgICAjNDk1MDU3ICFkZWZhdWx0O1xuJGdyYXktODAwOiAgICAjMzQzYTQwICFkZWZhdWx0O1xuJGdyYXktOTAwOiAgICAjMjgyODI4ICFkZWZhdWx0OyAvLyBDb3B5IHRleHRcbiRibGFjazogICAgICAgIzAwMDAwMCAhZGVmYXVsdDsgLy8gQXZvaWQgdXNhZ2VcblxuJGJsdWU6ICAgICAgICAjMGY2Y2JmICFkZWZhdWx0O1xuJGN5YW46ICAgICAgICAjMDA4MTk2ICFkZWZhdWx0OyAvLyBOb3QgdXNlZC5cbiRncmVlbjogICAgICAgIzM1N2EzMiAhZGVmYXVsdDtcbiRyZWQ6ICAgICAgICAgI2NhMzEyMCAhZGVmYXVsdDtcbiR5ZWxsb3c6ICAgICAgI2YwYWQ0ZSAhZGVmYXVsdDtcblxuJGJyYW5kLWNvbG9yOiAjZjk4MDEyICFkZWZhdWx0O1xuXG4kdGV4dC1jb2xvcjogICAgICAgICAgICAgICAkZ3JheS05MDAgIWRlZmF1bHQ7XG4kdGV4dC1jb2xvci1yZ2I6ICAgICAgICAgICBjb2xvci10by1yZ2ItbGlzdCgkdGV4dC1jb2xvcikgIWRlZmF1bHQ7XG4kdGV4dC1jb2xvci1kYXJrOiAgICAgICAgICAkd2hpdGUgIWRlZmF1bHQ7XG4kdGV4dC1jb2xvci1kYXJrLXJnYjogICAgICBjb2xvci10by1yZ2ItbGlzdCgkdGV4dC1jb2xvci1kYXJrKSAhZGVmYXVsdDtcblxuJGJhY2tncm91bmQtY29sb3I6ICAgICAgICAgICR3aGl0ZSAhZGVmYXVsdDtcbiRiYWNrZ3JvdW5kLWNvbG9yLXJnYjogICAgICBjb2xvci10by1yZ2ItbGlzdCgkYmFja2dyb3VuZC1jb2xvcikgIWRlZmF1bHQ7XG4kYmFja2dyb3VuZC1jb2xvci1kYXJrOiAgICAgJGdyYXktOTAwICFkZWZhdWx0OyAvLyAjMWExYTFhXG4kYmFja2dyb3VuZC1jb2xvci1kYXJrLXJnYjogY29sb3ItdG8tcmdiLWxpc3QoJGJhY2tncm91bmQtY29sb3ItZGFyaykgIWRlZmF1bHQ7XG5cbiRpb24taXRlbS1iYWNrZ3JvdW5kOiAgICAgICR3aGl0ZSAhZGVmYXVsdDtcbiRpb24taXRlbS1iYWNrZ3JvdW5kLXJnYjogIGNvbG9yLXRvLXJnYi1saXN0KCRpb24taXRlbS1iYWNrZ3JvdW5kKSAhZGVmYXVsdDtcbiRpb24taXRlbS1iYWNrZ3JvdW5kLWRhcms6ICRncmF5LTkwMCAhZGVmYXVsdDtcbiRpb24taXRlbS1iYWNrZ3JvdW5kLWRhcmstcmdiOiBjb2xvci10by1yZ2ItbGlzdCgkaW9uLWl0ZW0tYmFja2dyb3VuZC1kYXJrKSAhZGVmYXVsdDtcblxuJHByaW1hcnk6ICAgICRicmFuZC1jb2xvciAhZGVmYXVsdDtcbiRzZWNvbmRhcnk6ICAkZ3JheS0zMDAgIWRlZmF1bHQ7XG4kZGFuZ2VyOiAgICAgJHJlZCAhZGVmYXVsdDtcbiR3YXJuaW5nOiAgICAkeWVsbG93ICFkZWZhdWx0O1xuJHN1Y2Nlc3M6ICAgICRncmVlbiAhZGVmYXVsdDtcbiRpbmZvOiAgICAgICAkYmx1ZSAhZGVmYXVsdDtcbiRsaWdodDogICAgICAkZ3JheS0xMDAgIWRlZmF1bHQ7XG4kbWVkaXVtOiAgICAgJGdyYXktNzAwICFkZWZhdWx0O1xuJGRhcms6ICAgICAgICRncmF5LTkwMCAhZGVmYXVsdDtcblxuJGNvbG9yczogIChcbiAgICBwcmltYXJ5OiAobGlnaHQ6ICRwcmltYXJ5LCBkYXJrOiAkcHJpbWFyeSksXG4gICAgc2Vjb25kYXJ5OiAobGlnaHQ6ICRzZWNvbmRhcnksIGRhcms6ICRncmF5LTcwMCksXG4gICAgc3VjY2VzczogKGxpZ2h0OiAkc3VjY2VzcyksXG4gICAgd2FybmluZzogKGxpZ2h0OiAkd2FybmluZyksXG4gICAgZGFuZ2VyOiAgKGxpZ2h0OiAkZGFuZ2VyKSxcbiAgICBpbmZvOiAobGlnaHQ6ICRpbmZvKSxcbiAgICBsaWdodDogKGxpZ2h0OiAkbGlnaHQsIGRhcms6ICRkYXJrKSxcbiAgICBtZWRpdW06IChsaWdodDogJG1lZGl1bSwgZGFyazogJGdyYXktMjAwKSxcbiAgICBkYXJrOiAobGlnaHQ6ICRkYXJrLCBkYXJrOiAkbGlnaHQpLFxuKSAhZGVmYXVsdDtcblxuLyoqXG4gKiBMYXlvdXQgQnJlYWtwb2ludHNcbiAqXG4gKiBodHRwczovL2lvbmljZnJhbWV3b3JrLmNvbS9kb2NzL2xheW91dC9ncmlkI2RlZmF1bHQtYnJlYWtwb2ludHNcbiAqL1xuXG4vLyBUaGUgbWluaW11bSBkaW1lbnNpb25zIGF0IHdoaWNoIHlvdXIgbGF5b3V0IHdpbGwgY2hhbmdlLFxuLy8gYWRhcHRpbmcgdG8gZGlmZmVyZW50IHNjcmVlbiBzaXplcywgZm9yIHVzZSBpbiBtZWRpYSBxdWVyaWVzXG4kc2NyZWVuLWJyZWFrcG9pbnRzOiAoXG4gICAgeHM6IDBweCxcbiAgICBzbTogNTc2cHgsXG4gICAgbWQ6IDc2OHB4LFxuICAgIGxnOiA5OTJweCxcbiAgICB0YWJsZXQ6IDk5MnB4LFxuICAgIHhsOiAxMjAwcHhcbikgIWRlZmF1bHQ7XG5cbiRjb3JlLWNvdXJzZS1pbWFnZS1iYWNrZ3JvdW5kOiAjODFlY2VjLCAjNzRiOWZmLCAjYTI5YmZlLCAjZGZlNmU5LCAjMDBiODk0LCAjMDk4NGUzLCAjYjJiZWMzLCAjZmRjYjZlLCAjZmQ3OWE4LCAjNmM1Y2U3ICFkZWZhdWx0O1xuJGNvcmUtZGQtcXVlc3Rpb24tY29sb3JzOiAjRkZGRkZGLCAjQjBDNERFLCAjRENEQ0RDLCAjRDhCRkQ4LCAjODdDRUZBLCAjREFBNTIwLCAjRkZENzAwLCAjRjBFNjhDICFkZWZhdWx0O1xuJGNvcmUtdGV4dC1oaWdodGxpZ2h0LWJhY2tncm91bmQtY29sb3I6IGxpZ2h0ZW4oJGJsdWUsIDQwJSkgIWRlZmF1bHQ7XG5cbiRjb3JlLWZpeGVkLXVybDogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1kYXNoYm9hcmQtbG9nbzogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1hbHdheXMtc2hvdy1tYWluLW1lbnU6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtZm9ybWF0LXRleHQtbmV2ZXItc2hvcnRlbjogZmFsc2UgIWRlZmF1bHQ7XG5cbiRjb3JlLWhpZGUtY291cnNlaW1hZ2Utb24tY291cnNlOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWhpZGUtcHJvZ3Jlc3Mtb24tY291cnNlOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWhpZGUtcHJvZ3Jlc3Mtb24tc2VjdGlvbi1zZWxlY3RvcjogZmFsc2UgIWRlZmF1bHQ7XG5cbiRjb3JlLWNvdXJzZS1oaWRlLXRodW1iLW9uLWNhcmRzOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLWNvdXJzZS10aHVtYi1vbi1jYXJkcy1iYWNrZ3JvdW5kOiBudWxsICFkZWZhdWx0O1xuJGNvcmUtY291cnNlLWhpZGUtcHJvZ3Jlc3Mtb24tY2FyZHM6IGZhbHNlICFkZWZhdWx0O1xuXG4vLyBDb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIGxvZ2luIHBhZ2UuXG4kY29yZS1sb2dpbi1idXR0b24tb3V0bGluZTogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1sb2dpbi1idXR0b24tb3V0bGluZS1kYXJrOiAkY29yZS1sb2dpbi1idXR0b24tb3V0bGluZSAhZGVmYXVsdDtcbiRjb3JlLWxvZ2luLWxvYWRpbmctY29sb3I6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtbG9naW4tbG9hZGluZy1jb2xvci1kYXJrOiAkdGV4dC1jb2xvci1kYXJrICFkZWZhdWx0O1xuJGNvcmUtbG9naW4taGlkZS1mb3Jnb3QtcGFzc3dvcmQ6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtbG9naW4taGlkZS1uZWVkLWhlbHA6IGZhbHNlICFkZWZhdWx0O1xuJGNvcmUtbG9naW4taGlkZS1xcmNvZGU6IGZhbHNlICFkZWZhdWx0O1xuXG4vLyBDb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIG1vcmUgcGFnZS4gKGRlcHJlY2F0ZWQgb24gNC4wKVxuJGNvcmUtbW9yZS1oaWRlLXNpdGVpbmZvOiBmYWxzZSAhZGVmYXVsdDtcbiRjb3JlLW1vcmUtaGlkZS1zaXRlbmFtZTogZmFsc2UgIWRlZmF1bHQ7XG4kY29yZS1tb3JlLWhpZGUtc2l0ZXVybDogZmFsc2UgIWRlZmF1bHQ7XG5cbi8vIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgdXNlciBwYWdlLlxuJGNvcmUtdXNlci1oaWRlLXNpdGVpbmZvOiAkY29yZS1tb3JlLWhpZGUtc2l0ZWluZm8gIWRlZmF1bHQ7XG4kY29yZS11c2VyLWhpZGUtc2l0ZW5hbWU6ICRjb3JlLW1vcmUtaGlkZS1zaXRlbmFtZSAhZGVmYXVsdDtcbiRjb3JlLXVzZXItaGlkZS1zaXRldXJsOiAkY29yZS1tb3JlLWhpZGUtc2l0ZXVybCAhZGVmYXVsdDtcblxuLy8gQWN0aXZpdHkgaWNvbiBiYWNrZ3JvdW5kIGNvbG9ycy5cbiRhY3Rpdml0eS1pY29uLWNvbG9yczogKFxuICAgIGFkbWluaXN0cmF0aW9uOiAjNWQ2M2Y2LFxuICAgIGFzc2Vzc21lbnQ6ICNlYjY2YTIsXG4gICAgY29sbGFib3JhdGlvbjogI2Y3NjM0ZCxcbiAgICBjb21tdW5pY2F0aW9uOiAjMTFhNjc2LFxuICAgIGNvbnRlbnQ6ICMzOTliZTIsXG4gICAgaW50ZXJmYWNlOiAjYTM3OGZmXG4pICFkZWZhdWx0O1xuXG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktY2F0ZWdvcnk6ICM4ZTI0YWEgIWRlZmF1bHQ7XG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktY291cnNlOiAkcmVkICFkZWZhdWx0O1xuJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LWdyb3VwOiAkeWVsbG93ICFkZWZhdWx0O1xuJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LXVzZXI6ICRibHVlICFkZWZhdWx0O1xuJGNhbGVuZGFyLWV2ZW50LWNhdGVnb3J5LXNpdGU6ICRncmVlbiAhZGVmYXVsdDtcblxuLy8gQ2FsZW5kYXIgZXZlbnQgY2F0ZWdvcnkgYmFja2dyb3VuZCBjb2xvcnMuXG4kY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktY29sb3JzOiAoXG4gICAgY2F0ZWdvcnk6ICRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1jYXRlZ29yeSxcbiAgICBjb3Vyc2U6ICRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1jb3Vyc2UsXG4gICAgZ3JvdXA6ICRjYWxlbmRhci1ldmVudC1jYXRlZ29yeS1ncm91cCxcbiAgICB1c2VyOiAkY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktdXNlcixcbiAgICBzaXRlOiAkY2FsZW5kYXItZXZlbnQtY2F0ZWdvcnktc2l0ZSxcbikgIWRlZmF1bHQ7XG4iLCJAdXNlIFwidGhlbWUvZ2xvYmFsc1wiIGFzICo7XG5cbjpob3N0LWNvbnRleHQoLmlvcykge1xuICAgIGlvbi1mb290ZXIgLnRvb2xiYXI6bGFzdC1jaGlsZCB7XG4gICAgICAgIHBhZGRpbmctYm90dG9tOiA0cHg7XG4gICAgICAgIG1pbi1oZWlnaHQ6IDA7XG4gICAgfVxufVxuXG5pb24tY29udGVudCB7XG4gICAgLS1jb250ZW50LWJhY2tncm91bmQ6IHZhcigtLWJhY2tncm91bmQtYWx0ZXJuYXRpdmUpO1xuICAgIC0tYmFja2dyb3VuZDogdmFyKC0tY29udGVudC1iYWNrZ3JvdW5kKTtcblxuICAgICY6OnBhcnQoc2Nyb2xsKSB7XG4gICAgICAgIHBhZGRpbmctYm90dG9tOiAwICFpbXBvcnRhbnQ7XG4gICAgfVxufVxuXG4uYWRkb24tbWVzc2FnZXMtZGlzY3Vzc2lvbi1jb250YWluZXIge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBwYWRkaW5nLWJvdHRvbTogMTZweCAhaW1wb3J0YW50O1xuICAgIGJhY2tncm91bmQ6IHZhcigtLWNvbnRlbnQtYmFja2dyb3VuZCk7XG59XG5cbi5hZGRvbi1tZXNzYWdlcy1kYXRlIHtcbiAgICBmb250LXdlaWdodDogbm9ybWFsO1xuICAgIGZvbnQtc2l6ZTogMC45cmVtO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\", \"ion-badge[_ngcontent-%COMP%] {\\n  margin: 8px auto;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb3JlL2ZlYXR1cmVzL2NvbW1lbnRzL3BhZ2VzL3ZpZXdlci92aWV3ZXIuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGdCQUFBO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpb24tYmFkZ2Uge1xuICAgIG1hcmdpbjogOHB4IGF1dG87XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"],\n  data: {\n    animation: [CoreAnimations.SLIDE_IN_OUT]\n  }\n});","map":{"version":3,"names":["CoreEvents","CoreSites","CoreComments","CoreCommentsProvider","CoreCommentsSync","CoreCommentsSyncProvider","IonContent","CoreConstants","CoreNavigator","NgZone","Translate","CoreUtils","CoreDomUtils","ToastDuration","CoreUser","CoreTextUtils","CoreError","CoreCommentsOffline","CoreTimeUtils","CoreApp","CoreNetwork","moment","CoreAnimations","i0","ɵɵelement","ɵɵelementStart","ɵɵlistener","CoreCommentsViewerPage_ion_button_9_Template_ion_button_click_0_listener","ɵɵrestoreView","_r9","ctx_r8","ɵɵnextContext","ɵɵresetView","toggleDelete","ɵɵtemplate","CoreCommentsViewerPage_ion_button_9_ion_icon_2_Template","CoreCommentsViewerPage_ion_button_9_ion_icon_3_Template","ɵɵelementEnd","ɵɵattribute","ɵɵpipeBind1","ɵɵadvance","ɵɵproperty","ctx_r0","showDelete","ɵɵtext","ɵɵtextInterpolate1","ɵɵpipeBind2","comment_r10","timecreated","ɵɵelementContainerStart","CoreCommentsViewerPage_ng_container_23_p_1_Template","CoreCommentsViewerPage_ng_container_23_Template_core_message_onDeleteMessage_2_listener","restoredCtx","_r16","$implicit","ctx_r15","deleteComment","CoreCommentsViewerPage_ng_container_23_Template_core_message_onUndoDeleteMessage_2_listener","ctx_r17","undoDeleteComment","ɵɵelementContainerEnd","showDate","content","ctx_r2","contextLevel","instanceId","courseId","ɵɵpureFunction1","_c0","CoreCommentsViewerPage_core_message_25_Template_core_message_onDeleteMessage_0_listener","_r19","ctx_r18","offlineComment","ctx_r4","CoreCommentsViewerPage_ion_footer_26_Template_core_send_message_form_onSubmit_2_listener","$event","_r21","ctx_r20","addComment","ctx_r5","sending","newComment","CoreCommentsViewerPage","constructor","route","comments","commentsLoaded","itemId","area","page","title","canLoadMore","loadMoreError","canAddComments","canDeleteComments","hasOffline","refreshIcon","ICON_LOADING","syncIcon","addDeleteCommentsAvailable","viewDestroyed","currentUserId","getCurrentSiteUserId","syncObserver","on","AUTO_SYNCED","data","componentName","showSyncWarnings","warnings","fetchComments","getCurrentSiteId","isOnline","onlineObserver","onChange","subscribe","run","ngOnInit","_this","_asyncToGenerator","getRequiredRouteParam","getRequiredRouteNumberParam","getRouteParam","instant","getRouteNumberParam","error","showErrorModal","back","isAddCommentsAvailable","sync","showErrors","_this2","ignoreErrors","syncComments","commentsResponse","getComments","canpost","sort","a","b","count","undefined","length","pageSize","Promise","all","map","comment","loadCommentProfile","concat","forEach","index","calculateCommentData","some","delete","loadOfflineData","showAlertTranslated","showErrorModalDefault","ICON_REFRESH","ICON_SYNC","scrollToBottom","prevComment","_comment$delete","showUserData","showTail","loadPrevious","infiniteComplete","_this3","refreshComments","refresher","_this4","invalidateComments","complete","message","buildMessage","showAlert","_this5","result","text","_this6","closeKeyboard","loadingModal","showModalLoading","showToast","LONG","addedComment","trigger","COMMENTS_COUNT_CHANGED_EVENT","component","countChange","refreshInBackground","dismiss","_this7","modified","lastmodified","time","userDate","contextlevel","instanceid","itemid","id","showDeleteConfirm","$a","user","fullname","_unused","deletedOnline","findIndex","commentinList","splice","invalidateCommentsData","userid","getProfile","profileimageurl","_unused2","nextComment","isSame","_this8","promises","hasDeletedComments","push","getComment","then","_ref","pending","_x","apply","arguments","getDeletedComments","deletedComments","deletedComment","find","commentid","deleted","_this9","setTimeout","_this$content","_this10","i","ngOnDestroy","_this$syncObserver","off","unsubscribe","ɵɵdirectiveInject","i1","ActivatedRoute","selectors","viewQuery","CoreCommentsViewerPage_Query","rf","ctx","CoreCommentsViewerPage_ion_button_9_Template","CoreCommentsViewerPage_Template_core_context_menu_item_action_11_listener","CoreCommentsViewerPage_Template_core_context_menu_item_action_13_listener","CoreCommentsViewerPage_Template_ion_refresher_ionRefresh_16_listener","target","CoreCommentsViewerPage_core_empty_box_20_Template","CoreCommentsViewerPage_Template_core_infinite_loading_action_21_listener","CoreCommentsViewerPage_ng_container_23_Template","CoreCommentsViewerPage_ion_badge_24_Template","CoreCommentsViewerPage_core_message_25_Template","CoreCommentsViewerPage_ion_footer_26_Template","ɵɵpropertyInterpolate","SLIDE_IN_OUT"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/comments/pages/viewer/viewer.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/comments/pages/viewer/viewer.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { CoreEventObserver, CoreEvents } from '@singletons/events';\nimport { ActivatedRoute } from '@angular/router';\nimport { CoreSites } from '@services/sites';\nimport {\n    CoreComments,\n    CoreCommentsCommentBasicData,\n    CoreCommentsData,\n    CoreCommentsProvider,\n} from '@features/comments/services/comments';\nimport {\n    CoreCommentsSync,\n    CoreCommentsSyncProvider,\n} from '@features/comments/services/comments-sync';\nimport { IonContent } from '@ionic/angular';\nimport { ContextLevel, CoreConstants } from '@/core/constants';\nimport { CoreNavigator } from '@services/navigator';\nimport { NgZone, Translate } from '@singletons';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreDomUtils, ToastDuration } from '@services/utils/dom';\nimport { CoreUser } from '@features/user/services/user';\nimport { CoreTextUtils } from '@services/utils/text';\nimport { CoreError } from '@classes/errors/error';\nimport { CoreCommentsOffline } from '@features/comments/services/comments-offline';\nimport { CoreCommentsDBRecord } from '@features/comments/services/database/comments';\nimport { CoreTimeUtils } from '@services/utils/time';\nimport { CoreApp } from '@services/app';\nimport { CoreNetwork } from '@services/network';\nimport moment from 'moment-timezone';\nimport { Subscription } from 'rxjs';\nimport { CoreAnimations } from '@components/animations';\n\n/**\n * Page that displays comments.\n */\n@Component({\n    selector: 'page-core-comments-viewer',\n    templateUrl: 'viewer.html',\n    animations: [CoreAnimations.SLIDE_IN_OUT],\n    styleUrls: ['../../../../../theme/components/discussion.scss', 'viewer.scss'],\n})\nexport class CoreCommentsViewerPage implements OnInit, OnDestroy {\n\n    @ViewChild(IonContent) content?: IonContent;\n\n    comments: CoreCommentsDataToDisplay[] = [];\n    commentsLoaded = false;\n    contextLevel!: ContextLevel;\n    instanceId!: number;\n    componentName!: string;\n    itemId = 0;\n    area = '';\n    page = 0;\n    title = '';\n    courseId?: number;\n    canLoadMore = false;\n    loadMoreError = false;\n    canAddComments = false;\n    canDeleteComments = false;\n    showDelete = false;\n    hasOffline = false;\n    refreshIcon = CoreConstants.ICON_LOADING;\n    syncIcon = CoreConstants.ICON_LOADING;\n    offlineComment?: CoreCommentsOfflineWithUser & { pending?: boolean };\n    currentUserId: number;\n    sending = false;\n    newComment = '';\n    isOnline: boolean;\n\n    protected addDeleteCommentsAvailable = false;\n    protected syncObserver?: CoreEventObserver;\n    protected onlineObserver: Subscription;\n    protected viewDestroyed = false;\n\n    constructor(\n        protected route: ActivatedRoute,\n    ) {\n        this.currentUserId = CoreSites.getCurrentSiteUserId();\n\n        // Refresh data if comments are synchronized automatically.\n        this.syncObserver = CoreEvents.on(CoreCommentsSyncProvider.AUTO_SYNCED, (data) => {\n            if (data.contextLevel == this.contextLevel && data.instanceId == this.instanceId &&\n                    data.componentName == this.componentName && data.itemId == this.itemId && data.area == this.area) {\n                // Show the sync warnings.\n                this.showSyncWarnings(data.warnings);\n\n                // Refresh the data.\n                this.commentsLoaded = false;\n                this.refreshIcon = CoreConstants.ICON_LOADING;\n                this.syncIcon = CoreConstants.ICON_LOADING;\n\n                this.page = 0;\n                this.comments = [];\n                this.fetchComments(false);\n            }\n        }, CoreSites.getCurrentSiteId());\n\n        this.isOnline = CoreNetwork.isOnline();\n        this.onlineObserver = CoreNetwork.onChange().subscribe(() => {\n            // Execute the callback in the Angular zone, so change detection doesn't stop working.\n            NgZone.run(() => {\n                this.isOnline = CoreNetwork.isOnline();\n            });\n        });\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        try {\n            this.contextLevel = CoreNavigator.getRequiredRouteParam<ContextLevel>('contextLevel');\n            this.instanceId = CoreNavigator.getRequiredRouteNumberParam('instanceId');\n            this.componentName = CoreNavigator.getRequiredRouteParam<string>('componentName');\n            this.itemId = CoreNavigator.getRequiredRouteNumberParam('itemId');\n            this.area = CoreNavigator.getRouteParam('area') || '';\n            this.title = CoreNavigator.getRouteParam('title') ||\n                Translate.instant('core.comments.comments');\n            this.courseId = CoreNavigator.getRouteNumberParam('courseId');\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n\n            CoreNavigator.back();\n\n            return;\n        }\n\n        // Is implicit the user can delete if he can add.\n        this.addDeleteCommentsAvailable = await CoreComments.isAddCommentsAvailable();\n        this.currentUserId = CoreSites.getCurrentSiteUserId();\n\n        this.commentsLoaded = false;\n\n        await this.fetchComments(true);\n    }\n\n    /**\n     * Fetches the comments.\n     *\n     * @param sync When to resync comments.\n     * @param showErrors When to display errors or not.\n     * @returns Resolved when done.\n     */\n    protected async fetchComments(sync: boolean, showErrors = false): Promise<void> {\n        this.loadMoreError = false;\n\n        if (sync) {\n            await CoreUtils.ignoreErrors(this.syncComments(showErrors));\n        }\n\n        try {\n            // Get comments data.\n            const commentsResponse = await CoreComments.getComments(\n                this.contextLevel,\n                this.instanceId,\n                this.componentName,\n                this.itemId,\n                this.area,\n                this.page,\n            );\n            this.canAddComments = this.addDeleteCommentsAvailable && !!commentsResponse.canpost;\n\n            let comments = commentsResponse.comments.sort((a, b) => a.timecreated - b.timecreated);\n            if (commentsResponse.count !== undefined) {\n                this.canLoadMore = (this.comments.length + comments.length) < commentsResponse.count;\n            } else {\n                // Old style.\n                this.canLoadMore = commentsResponse.comments.length > 0 &&\n                    commentsResponse.comments.length >= CoreCommentsProvider.pageSize;\n            }\n\n            comments = await Promise.all(comments.map((comment) => this.loadCommentProfile(comment)));\n\n            this.comments = comments.concat(this.comments);\n\n            this.comments.forEach((comment, index) => this.calculateCommentData(comment, this.comments[index - 1]));\n\n            this.canDeleteComments = this.addDeleteCommentsAvailable &&\n                (this.hasOffline || this.comments.some((comment) => !!comment.delete));\n\n            await this.loadOfflineData();\n        } catch (error) {\n            this.loadMoreError = true; // Set to prevent infinite calls with infinite-loading.\n            if (error && this.componentName == 'assignsubmission_comments') {\n                CoreDomUtils.showAlertTranslated('core.notice', 'core.comments.commentsnotworking');\n            } else {\n                CoreDomUtils.showErrorModalDefault(error, Translate.instant('core.error') + ': get_comments');\n            }\n        } finally {\n            this.commentsLoaded = true;\n            this.refreshIcon = CoreConstants.ICON_REFRESH;\n            this.syncIcon = CoreConstants.ICON_SYNC;\n\n            if (this.page == 0) {\n                this.scrollToBottom();\n            }\n        }\n\n    }\n\n    /**\n     * Calculate some comment data.\n     *\n     * @param comment Comment.\n     * @param prevComment Previous comment.\n     */\n    protected calculateCommentData(comment: CoreCommentsDataToDisplay, prevComment?: CoreCommentsDataToDisplay): void {\n        comment.showDate = this.showDate(comment, prevComment);\n        comment.showUserData = this.showUserData(comment, prevComment);\n        comment.showTail = this.showTail(comment, prevComment);\n        comment.delete = comment.delete ?? false; // If this property is undefined, core-message assumes comment can be deleted.\n    }\n\n    /**\n     * Function to load more commemts.\n     *\n     * @param infiniteComplete Infinite scroll complete function. Only used from core-infinite-loading.\n     * @returns Resolved when done.\n     */\n    async loadPrevious(infiniteComplete?: () => void): Promise<void> {\n        this.page++;\n        this.canLoadMore = false;\n\n        try {\n            await this.fetchComments(true);\n        } finally {\n            infiniteComplete && infiniteComplete();\n        }\n    }\n\n    /**\n     * Refresh the comments.\n     *\n     * @param showErrors Whether to display errors or not.\n     * @param refresher Refresher.\n     * @returns Resolved when done.\n     */\n    async refreshComments(showErrors: boolean, refresher?: HTMLIonRefresherElement): Promise<void> {\n        this.commentsLoaded = false;\n        this.refreshIcon = CoreConstants.ICON_LOADING;\n        this.syncIcon = CoreConstants.ICON_LOADING;\n\n        await CoreUtils.ignoreErrors(this.invalidateComments());\n\n        this.page = 0;\n        this.comments = [];\n\n        try {\n            await this.fetchComments(true, showErrors);\n        } finally {\n            refresher?.complete();\n        }\n    }\n\n    /**\n     * Show sync warnings if any.\n     *\n     * @param warnings the warnings\n     */\n    private showSyncWarnings(warnings: string[]): void {\n        const message = CoreTextUtils.buildMessage(warnings);\n        if (message) {\n            CoreDomUtils.showAlert(undefined, message);\n        }\n    }\n\n    /**\n     * Tries to synchronize comments.\n     *\n     * @param showErrors Whether to display errors or not.\n     * @returns Promise resolved if sync is successful, rejected otherwise.\n     */\n    private async syncComments(showErrors: boolean): Promise<void> {\n        try {\n            const result = await CoreCommentsSync.syncComments(\n                this.contextLevel,\n                this.instanceId,\n                this.componentName,\n                this.itemId,\n                this.area,\n            );\n            this.showSyncWarnings(result?.warnings || []);\n        } catch (error) {\n            if (showErrors) {\n                CoreDomUtils.showErrorModalDefault(error, 'core.errorsync', true);\n            }\n\n            throw new CoreError(error);\n        }\n    }\n\n    /**\n     * Send the comment or store it offline.\n     *\n     * @param text Comment text to add.\n     */\n    async addComment(text: string): Promise<void> {\n        CoreApp.closeKeyboard();\n        const loadingModal = await CoreDomUtils.showModalLoading('core.sending', true);\n        // Freeze the add comment button.\n        this.sending = true;\n        try {\n            const commentsResponse = await CoreComments.addComment(\n                text,\n                this.contextLevel,\n                this.instanceId,\n                this.componentName,\n                this.itemId,\n                this.area,\n            );\n\n            CoreDomUtils.showToast(\n                commentsResponse ? 'core.comments.eventcommentcreated' : 'core.datastoredoffline',\n                true,\n                ToastDuration.LONG,\n            );\n\n            if (commentsResponse) {\n                this.invalidateComments();\n\n                const addedComment = await this.loadCommentProfile(commentsResponse);\n                this.calculateCommentData(addedComment, this.comments[this.comments.length - 1]);\n\n                // Add the comment to the top.\n                this.comments = this.comments.concat([addedComment]);\n                this.canDeleteComments = this.addDeleteCommentsAvailable;\n\n                CoreEvents.trigger(CoreCommentsProvider.COMMENTS_COUNT_CHANGED_EVENT, {\n                    contextLevel: this.contextLevel,\n                    instanceId: this.instanceId,\n                    component: this.componentName,\n                    itemId: this.itemId,\n                    area: this.area,\n                    countChange: 1,\n                }, CoreSites.getCurrentSiteId());\n\n                this.refreshInBackground();\n\n            } else if (commentsResponse === false) {\n                // Comments added in offline mode.\n                await this.loadOfflineData();\n            }\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n        } finally {\n            loadingModal.dismiss();\n            this.sending = false;\n\n            // New comments.\n            this.scrollToBottom();\n        }\n    }\n\n    /**\n     * Delete a comment.\n     *\n     * @param comment Comment to delete.\n     */\n    async deleteComment(comment: CoreCommentsDataToDisplay | CoreCommentsOfflineWithUser): Promise<void> {\n        const modified = 'lastmodified' in comment\n            ? comment.lastmodified\n            : comment.timecreated;\n        const time = CoreTimeUtils.userDate(\n            modified * 1000,\n            'core.strftimerecentfull',\n        );\n\n        const deleteComment: CoreCommentsCommentBasicData = {\n            contextlevel: this.contextLevel,\n            instanceid: this.instanceId,\n            component: this.componentName,\n            itemid: this.itemId,\n            area: this.area,\n            content: comment.content,\n            id: 'id' in comment ? comment.id : undefined,\n        };\n\n        try {\n            await CoreDomUtils.showDeleteConfirm('core.comments.deletecommentbyon', {\n                $a:\n                    { user: comment.fullname || '', time: time },\n            });\n        } catch {\n            // User cancelled, nothing to do.\n            return;\n        }\n\n        try {\n            const deletedOnline = await CoreComments.deleteComment(deleteComment);\n            this.showDelete = false;\n\n            if (deletedOnline && 'id' in comment) {\n                const index = this.comments.findIndex((commentinList) => commentinList.id == comment.id);\n\n                if (index >= 0) {\n                    this.comments.splice(index, 1);\n\n                    CoreEvents.trigger(CoreCommentsProvider.COMMENTS_COUNT_CHANGED_EVENT, {\n                        contextLevel: this.contextLevel,\n                        instanceId: this.instanceId,\n                        component: this.componentName,\n                        itemId: this.itemId,\n                        area: this.area,\n                        countChange: -1,\n                    }, CoreSites.getCurrentSiteId());\n\n                    this.refreshInBackground();\n                }\n            } else {\n                this.loadOfflineData();\n            }\n\n            this.invalidateComments();\n\n            CoreDomUtils.showToast('core.comments.eventcommentdeleted', true, ToastDuration.LONG);\n        } catch (error) {\n            CoreDomUtils.showErrorModalDefault(error, 'Delete comment failed.');\n        }\n    }\n\n    /**\n     * Invalidate comments.\n     *\n     * @returns Resolved when done.\n     */\n    protected invalidateComments(): Promise<void> {\n        return CoreComments.invalidateCommentsData(\n            this.contextLevel,\n            this.instanceId,\n            this.componentName,\n            this.itemId,\n            this.area,\n        );\n    }\n\n    /**\n     * Loads the profile info onto the comment object.\n     *\n     * @param comment Comment object.\n     * @returns Promise resolved with modified comment when done.\n     */\n    protected async loadCommentProfile(comment: CoreCommentsDataToDisplay): Promise<CoreCommentsDataToDisplay> {\n        if (!comment.userid) {\n            return comment;\n        }\n\n        try {\n            // Get the user profile image.\n            const user = await CoreUser.getProfile(comment.userid, undefined, true);\n            comment.profileimageurl = user.profileimageurl;\n            comment.fullname = user.fullname;\n        } catch {\n            // Ignore errors.\n        }\n\n        return comment;\n\n    }\n\n    /**\n     * Check if the user info should be displayed for the current message.\n     * User data is only displayed if the previous message was from another user.\n     *\n     * @param comment Comment object.\n     * @param prevComment Previous comment object.\n     * @returns Whether user data should be shown.\n     */\n    protected showUserData(\n        comment: CoreCommentsDataToDisplay,\n        prevComment?: CoreCommentsDataToDisplay,\n    ): boolean {\n        return comment.userid != this.currentUserId && (!prevComment || prevComment.userid != comment.userid || !!comment.showDate);\n    }\n\n    /**\n     * Check if a css tail should be shown.\n     *\n     * @param comment Comment object.\n     * @param nextComment Previous comment object.\n     * @returns Whether user data should be shown.\n     */\n    protected showTail(\n        comment: CoreCommentsDataToDisplay,\n        nextComment?: CoreCommentsDataToDisplay,\n    ): boolean {\n        return !nextComment || nextComment.userid != comment.userid || !!nextComment.showDate;\n    }\n\n    /**\n     * Check if the date should be displayed between messages (when the day changes at midnight for example).\n     *\n     * @param comment Comment object.\n     * @param prevComment Previous comment object.\n     * @returns True if messages are from diferent days, false othetwise.\n     */\n    protected showDate(\n        comment: CoreCommentsDataToDisplay,\n        prevComment?: CoreCommentsDataToDisplay,\n    ): boolean {\n        if (!prevComment) {\n            return true;\n        }\n\n        // Check if day has changed.\n        return !moment(comment.timecreated * 1000).isSame(prevComment.timecreated * 1000, 'day');\n    }\n\n    /**\n     * Load offline comments.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async loadOfflineData(): Promise<void> {\n        const promises: Promise<void>[] = [];\n        let hasDeletedComments = false;\n\n        // Load the only offline comment allowed if any.\n        promises.push(CoreCommentsOffline.getComment(\n            this.contextLevel,\n            this.instanceId,\n            this.componentName,\n            this.itemId,\n            this.area,\n        ).then(async (offlineComment) => {\n            this.offlineComment = offlineComment;\n\n            if (!this.offlineComment) {\n                return;\n            }\n\n            if (this.newComment == '') {\n                this.newComment = this.offlineComment.content;\n            }\n\n            this.offlineComment.userid = this.currentUserId;\n            this.offlineComment.pending = true;\n\n            return;\n        }));\n\n        // Load deleted comments offline.\n        promises.push(CoreCommentsOffline.getDeletedComments(\n            this.contextLevel,\n            this.instanceId,\n            this.componentName,\n            this.itemId,\n            this.area,\n        ).then((deletedComments) => {\n            hasDeletedComments = deletedComments && deletedComments.length > 0;\n\n            if (hasDeletedComments) {\n                deletedComments.forEach((deletedComment) => {\n                    const comment = this.comments.find((comment) => comment.id == deletedComment.commentid);\n\n                    if (comment) {\n                        comment.deleted = !!deletedComment.deleted;\n                    }\n                });\n            }\n\n            return;\n        }));\n\n        await Promise.all(promises);\n\n        this.hasOffline = !!this.offlineComment || hasDeletedComments;\n    }\n\n    /**\n     * Restore a comment.\n     *\n     * @param comment Comment to delete.\n     */\n    async undoDeleteComment(comment: CoreCommentsDataToDisplay): Promise<void> {\n        await CoreCommentsOffline.undoDeleteComment(comment.id);\n\n        comment.deleted = false;\n        this.showDelete = false;\n    }\n\n    /**\n     * Scroll bottom when render has finished.\n     */\n    protected scrollToBottom(): void {\n        // Need a timeout to leave time to the view to be rendered.\n        setTimeout(() => {\n            if (!this.viewDestroyed) {\n                this.content?.scrollToBottom();\n            }\n        }, 100);\n    }\n\n    /**\n     * Toggle delete.\n     */\n    toggleDelete(): void {\n        this.showDelete = !this.showDelete;\n    }\n\n    /**\n     * Refresh cached data in background.\n     */\n    protected async refreshInBackground(): Promise<void> {\n        await CoreUtils.ignoreErrors(this.invalidateComments());\n\n        const promises: Promise<unknown>[] = [];\n\n        for (let i = 0; i <= this.page; i++) {\n            promises.push(CoreComments.getComments(\n                this.contextLevel,\n                this.instanceId,\n                this.componentName,\n                this.itemId,\n                this.area,\n                i,\n            ));\n        }\n\n        await Promise.all(promises);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    ngOnDestroy(): void {\n        this.syncObserver?.off();\n        this.onlineObserver.unsubscribe();\n        this.viewDestroyed = true;\n    }\n\n}\n\nexport type CoreCommentsDataToDisplay = CoreCommentsData & {\n    profileimageurl?: string;\n    fullname?: string;\n    deleted?: boolean;\n    showDate?: boolean;\n    showTail?: boolean;\n    showUserData?: boolean;\n};\n\nexport type CoreCommentsOfflineWithUser = CoreCommentsDBRecord & {\n    profileimageurl?: string;\n    fullname?: string;\n    userid?: number;\n    deleted?: boolean;\n};\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1>\n                <core-format-text [text]=\"title\" [contextLevel]=\"contextLevel\" [contextInstanceId]=\"instanceId\" [courseId]=\"courseId\" />\n            </h1>\n        </ion-title>\n        <ion-buttons slot=\"end\">\n            <ion-button *ngIf=\"canDeleteComments\" slot=\"end\" fill=\"clear\" (click)=\"toggleDelete()\"\n                [attr.aria-label]=\"'core.toggledelete' | translate\">\n                <ion-icon *ngIf=\"!showDelete\" name=\"fas-pen\" slot=\"icon-only\" aria-hidden=\"true\" />\n                <ion-icon *ngIf=\"showDelete\" name=\"fas-check\" slot=\"icon-only\" aria-hidden=\"true\" />\n            </ion-button>\n            <core-context-menu>\n                <core-context-menu-item [hidden]=\"!(commentsLoaded && !hasOffline)\" [priority]=\"100\" [content]=\"'core.refresh' | translate\"\n                    (action)=\"refreshComments(false)\" [iconAction]=\"refreshIcon\" [closeOnClick]=\"true\" />\n                <core-context-menu-item [hidden]=\"!(commentsLoaded && hasOffline && isOnline)\" [priority]=\"100\"\n                    [content]=\"'core.settings.synchronizenow' | translate\" (action)=\"refreshComments(true)\" [iconAction]=\"syncIcon\"\n                    [closeOnClick]=\"false\" />\n            </core-context-menu>\n        </ion-buttons>\n    </ion-toolbar>\n</ion-header>\n<ion-content>\n    <ion-refresher slot=\"fixed\" [disabled]=\"!commentsLoaded\" (ionRefresh)=\"refreshComments(false, $event.target)\">\n        <ion-refresher-content pullingText=\"{{ 'core.pulltorefresh' | translate }}\" />\n    </ion-refresher>\n    <core-loading [hideUntil]=\"commentsLoaded\">\n        <core-empty-box *ngIf=\"!comments?.length && !offlineComment\" icon=\"fas-comments\"\n            [message]=\"'core.comments.nocomments' | translate\" />\n\n        <!-- Load previous messages. -->\n        <core-infinite-loading [enabled]=\"canLoadMore\" position=\"top\" (action)=\"loadPrevious($event)\" [error]=\"loadMoreError\" />\n\n        <ion-list class=\"addon-messages-discussion-container\">\n            <ng-container *ngFor=\"let comment of comments; index as index; last as last\">\n\n                <p class=\"ion-text-center addon-messages-date\" *ngIf=\"comment.showDate\">\n                    {{ comment.timecreated * 1000 | coreFormatDate: \"strftimedayshort\" }}\n                </p>\n\n                <core-message [message]=\"comment\" [text]=\"comment.content\" [time]=\"comment.timecreated * 1000\" [user]=\"comment\"\n                    [showDelete]=\"showDelete\" [contextLevel]=\"contextLevel\" [instanceId]=\"instanceId\" [courseId]=\"courseId\"\n                    (onDeleteMessage)=\"deleteComment(comment)\" (onUndoDeleteMessage)=\"undoDeleteComment(comment)\" />\n            </ng-container>\n\n            <ion-badge class=\"ion-text-wrap\" color=\"info\" *ngIf=\"hasOffline\">\n                <ion-icon name=\"fas-triangle-exclamation\" aria-hidden=\"true\" />\n                {{ 'core.thereisdatatosync' | translate:{$a: 'core.comments.comments' | translate | lowercase } }}\n            </ion-badge>\n            <core-message *ngIf=\"hasOffline && offlineComment\" [message]=\"offlineComment\" [text]=\"offlineComment.content\"\n                [user]=\"offlineComment\" [showDelete]=\"showDelete\" [contextLevel]=\"contextLevel\" [instanceId]=\"instanceId\"\n                [courseId]=\"courseId\" (onDeleteMessage)=\"deleteComment(offlineComment)\" />\n        </ion-list>\n\n    </core-loading>\n</ion-content>\n<ion-footer class=\"footer-adjustable\" *ngIf=\"commentsLoaded && canAddComments\">\n    <ion-toolbar>\n        <core-send-message-form [sendDisabled]=\"sending\" [message]=\"newComment\" (onSubmit)=\"addComment($event)\"\n            [placeholder]=\"'core.comments.addcomment' | translate\" />\n    </ion-toolbar>\n</ion-footer>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}