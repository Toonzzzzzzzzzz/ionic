{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { EventEmitter } from '@angular/core';\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreSearchHistory } from '../../services/search-history.service';\nimport { Translate } from '@singletons';\nimport { CoreForms } from '@singletons/form';\nimport * as i0 from \"@angular/core\";\nfunction CoreSearchBoxComponent_ion_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-button\", 10);\n    i0.ɵɵlistener(\"click\", function CoreSearchBoxComponent_ion_button_8_Template_ion_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.clearForm());\n    });\n    i0.ɵɵpipe(1, \"translate\");\n    i0.ɵɵelement(2, \"ion-icon\", 11);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"disabled\", ctx_r1.searched === \"\" || ctx_r1.disabled);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(1, 2, \"core.clearsearch\"));\n  }\n}\nfunction CoreSearchBoxComponent_ion_item_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\", 12);\n    i0.ɵɵlistener(\"click\", function CoreSearchBoxComponent_ion_item_10_Template_ion_item_click_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const item_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.historyClicked($event, item_r5.searchedtext));\n    });\n    i0.ɵɵelement(1, \"ion-icon\", 13);\n    i0.ɵɵelementStart(2, \"ion-label\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"detail\", true);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r5.searchedtext);\n  }\n}\n/**\n * Component to display a \"search box\".\n *\n * @description\n * This component will display a standalone search box with its search button in order to have a better UX.\n *\n * Example usage:\n * <core-search-box (onSubmit)=\"search($event)\" [placeholder]=\"'core.courses.search' | translate\"\n *     [searchLabel]=\"'core.courses.search' | translate\" autoFocus=\"true\"></core-search-box>\n */\nexport class CoreSearchBoxComponent {\n  constructor() {\n    this.autocorrect = 'on'; // Enables/disable Autocorrection on search text input.\n    this.spellcheck = true; // Enables/disable Spellchecker on search text input.\n    this.autoFocus = false; // Enables/disable Autofocus when entering view.\n    this.lengthCheck = 3; // Check value length before submit. If 0, any string will be submitted.\n    this.showClear = true; // Show/hide clear button.\n    this.disabled = false; // Disables the input text.\n    this.initialSearch = ''; // Initial search text.\n    /* If provided. It will save and display a history of searches for this particular Id.\n     * To use different history lists, place different Id.\n     * I.e. AddonMessagesContacts or CoreUserParticipants-6 (using the course Id).*/\n    this.searchArea = '';\n    this.searched = ''; // Last search emitted.\n    this.searchText = '';\n    this.history = [];\n    this.historyShown = false;\n    this.onSubmit = new EventEmitter();\n    this.onClear = new EventEmitter();\n  }\n  ngOnInit() {\n    this.searchLabel = this.searchLabel || Translate.instant('core.search');\n    this.placeholder = this.placeholder || Translate.instant('core.search');\n    this.spellcheck = CoreUtils.isTrueOrOne(this.spellcheck);\n    this.showClear = CoreUtils.isTrueOrOne(this.showClear);\n    this.searchText = this.initialSearch;\n    if (this.searchArea) {\n      this.loadHistory();\n    }\n  }\n  /**\n   * Form submitted.\n   *\n   * @param e Event.\n   */\n  submitForm(e) {\n    e && e.preventDefault();\n    e && e.stopPropagation();\n    if (this.searchText.length < this.lengthCheck) {\n      // The view should handle this case, but we check it here too just in case.\n      return;\n    }\n    if (this.searchArea) {\n      this.saveSearchToHistory(this.searchText);\n    }\n    CoreForms.triggerFormSubmittedEvent(this.formElement, false, CoreSites.getCurrentSiteId());\n    this.historyShown = false;\n    this.searched = this.searchText;\n    this.onSubmit.emit(this.searchText);\n  }\n  /**\n   * Saves the search term onto the history.\n   *\n   * @param text Text to save.\n   * @returns Promise resolved when done.\n   */\n  saveSearchToHistory(text) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield CoreSearchHistory.insertOrUpdateSearchText(_this.searchArea, text.toLowerCase());\n      } finally {\n        _this.loadHistory();\n      }\n    })();\n  }\n  /**\n   * Loads search history.\n   *\n   * @returns Promise resolved when done.\n   */\n  loadHistory() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.history = yield CoreSearchHistory.getSearchHistory(_this2.searchArea);\n    })();\n  }\n  /**\n   * Select an item and use it for search text.\n   *\n   * @param e Event.\n   * @param text Selected text.\n   */\n  historyClicked(e, text) {\n    if (this.searched != text) {\n      this.searchText = text;\n      this.submitForm(e);\n    }\n  }\n  /**\n   * Form submitted.\n   */\n  clearForm() {\n    this.searched = '';\n    this.searchText = '';\n    this.onClear.emit();\n  }\n  /**\n   * @param event Focus event on input element.\n   */\n  focus(event) {\n    this.historyShown = true;\n    if (!this.formElement) {\n      var _this$formElement;\n      this.formElement = event.detail.target.closest('form');\n      (_this$formElement = this.formElement) === null || _this$formElement === void 0 || _this$formElement.addEventListener('blur', () => {\n        // Wait the new element to be focused.\n        setTimeout(() => {\n          var _document$activeEleme;\n          if (((_document$activeEleme = document.activeElement) === null || _document$activeEleme === void 0 ? void 0 : _document$activeEleme.closest('form')) != this.formElement) {\n            this.historyShown = false;\n          }\n        });\n      }, true);\n    }\n  }\n}\n_class = CoreSearchBoxComponent;\n_class.ɵfac = function CoreSearchBoxComponent_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"core-search-box\"]],\n  inputs: {\n    searchLabel: \"searchLabel\",\n    placeholder: \"placeholder\",\n    autocorrect: \"autocorrect\",\n    spellcheck: \"spellcheck\",\n    autoFocus: \"autoFocus\",\n    lengthCheck: \"lengthCheck\",\n    showClear: \"showClear\",\n    disabled: \"disabled\",\n    initialSearch: \"initialSearch\",\n    searchArea: \"searchArea\"\n  },\n  outputs: {\n    onSubmit: \"onSubmit\",\n    onClear: \"onClear\"\n  },\n  decls: 11,\n  vars: 12,\n  consts: [[\"role\", \"search\", 3, \"ngSubmit\"], [\"searchForm\", \"\"], [1, \"search-box\"], [1, \"sr-only\"], [\"type\", \"search\", \"name\", \"search\", \"role\", \"searchbox\", 3, \"ngModel\", \"placeholder\", \"autocorrect\", \"spellcheck\", \"core-auto-focus\", \"disabled\", \"ngModelChange\", \"ionFocus\"], [\"slot\", \"end\", \"fill\", \"clear\", \"type\", \"submit\", 3, \"disabled\"], [\"name\", \"fas-magnifying-glass\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\"], [\"slot\", \"end\", \"fill\", \"clear\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [1, \"core-search-history\", 3, \"hidden\"], [\"button\", \"\", \"class\", \"ion-text-wrap\", \"tabindex\", \"0\", 3, \"detail\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"slot\", \"end\", \"fill\", \"clear\", 3, \"disabled\", \"click\"], [\"name\", \"fas-delete-left\", \"slot\", \"icon-only\", \"aria-hidden\", \"true\", \"flip-rtl\", \"\"], [\"button\", \"\", \"tabindex\", \"0\", 1, \"ion-text-wrap\", 3, \"detail\", \"click\"], [\"name\", \"fas-clock-rotate-left\", \"slot\", \"start\", \"aria-hidden\", \"true\"]],\n  template: function CoreSearchBoxComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0, 1);\n      i0.ɵɵlistener(\"ngSubmit\", function CoreSearchBoxComponent_Template_form_ngSubmit_0_listener($event) {\n        return ctx.submitForm($event);\n      });\n      i0.ɵɵelementStart(2, \"ion-item\", 2)(3, \"ion-label\", 3);\n      i0.ɵɵtext(4);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-input\", 4);\n      i0.ɵɵlistener(\"ngModelChange\", function CoreSearchBoxComponent_Template_ion_input_ngModelChange_5_listener($event) {\n        return ctx.searchText = $event;\n      })(\"ionFocus\", function CoreSearchBoxComponent_Template_ion_input_ionFocus_5_listener($event) {\n        return ctx.focus($event);\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"ion-button\", 5);\n      i0.ɵɵelement(7, \"ion-icon\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(8, CoreSearchBoxComponent_ion_button_8_Template, 3, 4, \"ion-button\", 7);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"ion-list\", 8);\n      i0.ɵɵtemplate(10, CoreSearchBoxComponent_ion_item_10_Template, 4, 2, \"ion-item\", 9);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(ctx.placeholder);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngModel\", ctx.searchText)(\"placeholder\", ctx.placeholder)(\"autocorrect\", ctx.autocorrect)(\"spellcheck\", ctx.spellcheck)(\"core-auto-focus\", ctx.autoFocus)(\"disabled\", ctx.disabled);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", ctx.disabled || !ctx.searchText || ctx.searchText.length < ctx.lengthCheck);\n      i0.ɵɵattribute(\"aria-label\", ctx.searchLabel);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.showClear);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"hidden\", !ctx.historyShown);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.history);\n    }\n  },\n  styles: [\"[_nghost-%COMP%] {\\n  --height: var(--a11y-min-target-size);\\n  --search-height: calc(var(--height) - 2px);\\n  min-height: var(--height);\\n  display: block;\\n  position: relative;\\n  margin: 8px;\\n}\\n[_nghost-%COMP%]   form[_ngcontent-%COMP%] {\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  z-index: 4;\\n  margin: 0;\\n  border: 1px solid var(--core-search-box-border-color);\\n  border-radius: var(--core-search-box-border-radius);\\n  background: var(--core-search-box-background);\\n  color: var(--core-search-box-border-color);\\n}\\n[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%] {\\n  --min-height: var(--search-height);\\n  border-radius: var(--core-search-box-border-radius);\\n}\\n[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-button.button[_ngcontent-%COMP%] {\\n  margin: 0;\\n  --a11y-min-target-size: var(--search-height);\\n}\\n[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%] {\\n  max-height: calc(-120px + 80vh);\\n  overflow-y: auto;\\n  background: var(--core-search-box-background);\\n  border-radius: 0 0 var(--core-search-box-border-radius) var(--core-search-box-border-radius);\\n  --ion-item-background: var(--core-search-box-background);\\n}\\n[_nghost-%COMP%]   .core-search-history[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover {\\n  --background: var(--light);\\n  cursor: pointer;\\n}\\n[_nghost-%COMP%]   ion-label[_ngcontent-%COMP%] {\\n  margin: 0;\\n}\\n[_nghost-%COMP%]   ion-input[_ngcontent-%COMP%] {\\n  --padding-start: 0px;\\n  --padding-end: 0px;\\n  padding-left: 0;\\n  padding-right: 0;\\n}\\n[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%] {\\n  --min-height: var(--a11y-min-target-size);\\n  --border-width: 0px;\\n  --background: var(--core-search-box-background);\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9jb3JlL2ZlYXR1cmVzL3NlYXJjaC9jb21wb25lbnRzL3NlYXJjaC1ib3gvc2VhcmNoLWJveC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0kscUNBQUE7RUFDQSwwQ0FBQTtFQUNBLHlCQUFBO0VBQ0EsY0FBQTtFQUNBLGtCQUFBO0VBQ0EsV0FBQTtBQUNKO0FBQ0k7RUFDSSxrQkFBQTtFQUNBLE9BQUE7RUFDQSxRQUFBO0VBQ0EsVUFBQTtFQUNBLFNBQUE7RUFDQSxxREFBQTtFQUNBLG1EQUFBO0VBQ0EsNkNBQUE7RUFDQSwwQ0FBQTtBQUNSO0FBQ1E7RUFDSSxrQ0FBQTtFQUNBLG1EQUFBO0FBQ1o7QUFFUTtFQUNJLFNBQUE7RUFDQSw0Q0FBQTtBQUFaO0FBTUk7RUFDSSwrQkFBQTtFQUNBLGdCQUFBO0VBQ0EsNkNBQUE7RUFDQSw0RkFBQTtFQUNBLHdEQUFBO0FBSlI7QUFNUTtFQUNJLDBCQUFBO0VBQ0EsZUFBQTtBQUpaO0FBUUk7RUFDSSxTQUFBO0FBTlI7QUFTSTtFQUNJLG9CQUFBO0VBQ0Esa0JBQUE7RUFDQSxlQUFBO0VBQ0EsZ0JBQUE7QUFQUjtBQVdJO0VBQ0kseUNBQUE7RUFDQSxtQkFBQTtFQUNBLCtDQUFBO0FBVFIiLCJzb3VyY2VzQ29udGVudCI6WyI6aG9zdCB7XG4gICAgLS1oZWlnaHQ6IHZhcigtLWExMXktbWluLXRhcmdldC1zaXplKTtcbiAgICAtLXNlYXJjaC1oZWlnaHQ6IGNhbGModmFyKC0taGVpZ2h0KSAtIDJweCk7XG4gICAgbWluLWhlaWdodDogdmFyKC0taGVpZ2h0KTtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgbWFyZ2luOiA4cHg7XG5cbiAgICBmb3JtIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICBsZWZ0OiAwO1xuICAgICAgICByaWdodDogMDtcbiAgICAgICAgei1pbmRleDogNDtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1jb3JlLXNlYXJjaC1ib3gtYm9yZGVyLWNvbG9yKTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tY29yZS1zZWFyY2gtYm94LWJvcmRlci1yYWRpdXMpO1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jb3JlLXNlYXJjaC1ib3gtYmFja2dyb3VuZCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS1jb3JlLXNlYXJjaC1ib3gtYm9yZGVyLWNvbG9yKTtcblxuICAgICAgICAuc2VhcmNoLWJveCB7XG4gICAgICAgICAgICAtLW1pbi1oZWlnaHQ6IHZhcigtLXNlYXJjaC1oZWlnaHQpO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tY29yZS1zZWFyY2gtYm94LWJvcmRlci1yYWRpdXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW9uLWJ1dHRvbi5idXR0b24ge1xuICAgICAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICAgICAgLS1hMTF5LW1pbi10YXJnZXQtc2l6ZTogdmFyKC0tc2VhcmNoLWhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuXG4gICAgLmNvcmUtc2VhcmNoLWhpc3Rvcnkge1xuICAgICAgICBtYXgtaGVpZ2h0OiBjYWxjKC0xMjBweCArIDgwdmgpO1xuICAgICAgICBvdmVyZmxvdy15OiBhdXRvO1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jb3JlLXNlYXJjaC1ib3gtYmFja2dyb3VuZCk7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDAgMCB2YXIoLS1jb3JlLXNlYXJjaC1ib3gtYm9yZGVyLXJhZGl1cykgdmFyKC0tY29yZS1zZWFyY2gtYm94LWJvcmRlci1yYWRpdXMpO1xuICAgICAgICAtLWlvbi1pdGVtLWJhY2tncm91bmQ6IHZhcigtLWNvcmUtc2VhcmNoLWJveC1iYWNrZ3JvdW5kKTtcblxuICAgICAgICAuaXRlbTpob3ZlciB7XG4gICAgICAgICAgICAtLWJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlvbi1sYWJlbCB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICB9XG5cbiAgICBpb24taW5wdXQge1xuICAgICAgICAtLXBhZGRpbmctc3RhcnQ6IDBweDtcbiAgICAgICAgLS1wYWRkaW5nLWVuZDogMHB4O1xuICAgICAgICBwYWRkaW5nLWxlZnQ6IDA7XG4gICAgICAgIHBhZGRpbmctcmlnaHQ6IDA7XG4gICAgfVxuXG5cbiAgICBpb24taXRlbSB7XG4gICAgICAgIC0tbWluLWhlaWdodDogdmFyKC0tYTExeS1taW4tdGFyZ2V0LXNpemUpO1xuICAgICAgICAtLWJvcmRlci13aWR0aDogMHB4O1xuICAgICAgICAtLWJhY2tncm91bmQ6IHZhcigtLWNvcmUtc2VhcmNoLWJveC1iYWNrZ3JvdW5kKTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"names":["EventEmitter","CoreSites","CoreUtils","CoreSearchHistory","Translate","CoreForms","i0","ɵɵelementStart","ɵɵlistener","CoreSearchBoxComponent_ion_button_8_Template_ion_button_click_0_listener","ɵɵrestoreView","_r4","ctx_r3","ɵɵnextContext","ɵɵresetView","clearForm","ɵɵelement","ɵɵelementEnd","ɵɵproperty","ctx_r1","searched","disabled","ɵɵattribute","ɵɵpipeBind1","CoreSearchBoxComponent_ion_item_10_Template_ion_item_click_0_listener","$event","restoredCtx","_r7","item_r5","$implicit","ctx_r6","historyClicked","searchedtext","ɵɵtext","ɵɵadvance","ɵɵtextInterpolate","CoreSearchBoxComponent","constructor","autocorrect","spellcheck","autoFocus","lengthCheck","showClear","initialSearch","searchArea","searchText","history","historyShown","onSubmit","onClear","ngOnInit","searchLabel","instant","placeholder","isTrueOrOne","loadHistory","submitForm","e","preventDefault","stopPropagation","length","saveSearchToHistory","triggerFormSubmittedEvent","formElement","getCurrentSiteId","emit","text","_this","_asyncToGenerator","insertOrUpdateSearchText","toLowerCase","_this2","getSearchHistory","focus","event","_this$formElement","detail","target","closest","addEventListener","setTimeout","_document$activeEleme","document","activeElement","selectors","inputs","outputs","decls","vars","consts","template","CoreSearchBoxComponent_Template","rf","ctx","CoreSearchBoxComponent_Template_form_ngSubmit_0_listener","CoreSearchBoxComponent_Template_ion_input_ngModelChange_5_listener","CoreSearchBoxComponent_Template_ion_input_ionFocus_5_listener","ɵɵtemplate","CoreSearchBoxComponent_ion_button_8_Template","CoreSearchBoxComponent_ion_item_10_Template"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/search/components/search-box/search-box.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/search/components/search-box/core-search-box.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\n\nimport { CoreSites } from '@services/sites';\nimport { CoreUtils } from '@services/utils/utils';\nimport { CoreSearchHistory } from '../../services/search-history.service';\nimport { Translate } from '@singletons';\nimport { CoreSearchHistoryDBRecord } from '../../services/search-history-db';\nimport { CoreForms } from '@singletons/form';\n\n/**\n * Component to display a \"search box\".\n *\n * @description\n * This component will display a standalone search box with its search button in order to have a better UX.\n *\n * Example usage:\n * <core-search-box (onSubmit)=\"search($event)\" [placeholder]=\"'core.courses.search' | translate\"\n *     [searchLabel]=\"'core.courses.search' | translate\" autoFocus=\"true\"></core-search-box>\n */\n@Component({\n    selector: 'core-search-box',\n    templateUrl: 'core-search-box.html',\n    styleUrls: ['search-box.scss'],\n})\nexport class CoreSearchBoxComponent implements OnInit {\n\n    @Input() searchLabel?: string; // Label to be used on action button.\n    @Input() placeholder?: string; // Placeholder text for search text input.\n    @Input() autocorrect = 'on'; // Enables/disable Autocorrection on search text input.\n    @Input() spellcheck: string | boolean = true; // Enables/disable Spellchecker on search text input.\n    @Input() autoFocus: string | boolean = false; // Enables/disable Autofocus when entering view.\n    @Input() lengthCheck = 3; // Check value length before submit. If 0, any string will be submitted.\n    @Input() showClear = true; // Show/hide clear button.\n    @Input() disabled = false; // Disables the input text.\n    @Input() initialSearch = ''; // Initial search text.\n\n    /* If provided. It will save and display a history of searches for this particular Id.\n     * To use different history lists, place different Id.\n     * I.e. AddonMessagesContacts or CoreUserParticipants-6 (using the course Id).*/\n    @Input() searchArea = '';\n\n    @Output() onSubmit: EventEmitter<string>; // Send data when submitting the search form.\n    @Output() onClear: EventEmitter<void>; // Send event when clearing the search form.\n\n    formElement?: HTMLFormElement;\n\n    searched = ''; // Last search emitted.\n    searchText = '';\n    history: CoreSearchHistoryDBRecord[] = [];\n    historyShown = false;\n\n    constructor() {\n        this.onSubmit = new EventEmitter<string>();\n        this.onClear = new EventEmitter<void>();\n    }\n\n    ngOnInit(): void {\n        this.searchLabel = this.searchLabel || Translate.instant('core.search');\n        this.placeholder = this.placeholder || Translate.instant('core.search');\n        this.spellcheck = CoreUtils.isTrueOrOne(this.spellcheck);\n        this.showClear = CoreUtils.isTrueOrOne(this.showClear);\n        this.searchText = this.initialSearch;\n\n        if (this.searchArea) {\n            this.loadHistory();\n        }\n    }\n\n    /**\n     * Form submitted.\n     *\n     * @param e Event.\n     */\n    submitForm(e?: Event): void {\n        e && e.preventDefault();\n        e && e.stopPropagation();\n\n        if (this.searchText.length < this.lengthCheck) {\n            // The view should handle this case, but we check it here too just in case.\n            return;\n        }\n\n        if (this.searchArea) {\n            this.saveSearchToHistory(this.searchText);\n        }\n\n        CoreForms.triggerFormSubmittedEvent(this.formElement, false, CoreSites.getCurrentSiteId());\n\n        this.historyShown = false;\n        this.searched = this.searchText;\n        this.onSubmit.emit(this.searchText);\n    }\n\n    /**\n     * Saves the search term onto the history.\n     *\n     * @param text Text to save.\n     * @returns Promise resolved when done.\n     */\n    protected async saveSearchToHistory(text: string): Promise<void> {\n        try {\n            await CoreSearchHistory.insertOrUpdateSearchText(this.searchArea, text.toLowerCase());\n        } finally {\n            this.loadHistory();\n        }\n    }\n\n    /**\n     * Loads search history.\n     *\n     * @returns Promise resolved when done.\n     */\n    protected async loadHistory(): Promise<void> {\n        this.history = await CoreSearchHistory.getSearchHistory(this.searchArea);\n    }\n\n    /**\n     * Select an item and use it for search text.\n     *\n     * @param e Event.\n     * @param text Selected text.\n     */\n    historyClicked(e: Event, text: string): void {\n        if (this.searched != text) {\n            this.searchText = text;\n            this.submitForm(e);\n        }\n    }\n\n    /**\n     * Form submitted.\n     */\n    clearForm(): void {\n        this.searched = '';\n        this.searchText = '';\n        this.onClear.emit();\n    }\n\n    /**\n     * @param event Focus event on input element.\n     */\n    focus(event: CustomEvent): void {\n        this.historyShown = true;\n\n        if (!this.formElement) {\n            this.formElement = event.detail.target.closest('form');\n\n            this.formElement?.addEventListener('blur', () => {\n                // Wait the new element to be focused.\n                setTimeout(() => {\n                    if (document.activeElement?.closest('form') != this.formElement) {\n                        this.historyShown = false;\n                    }\n                });\n            }, true);\n        }\n    }\n\n}\n","<form (ngSubmit)=\"submitForm($event)\" role=\"search\" #searchForm>\n    <ion-item class=\"search-box\">\n        <ion-label class=\"sr-only\">{{ placeholder }}</ion-label>\n        <ion-input type=\"search\" name=\"search\" [(ngModel)]=\"searchText\" [placeholder]=\"placeholder\" [autocorrect]=\"autocorrect\"\n            [spellcheck]=\"spellcheck\" [core-auto-focus]=\"autoFocus\" [disabled]=\"disabled\" role=\"searchbox\" (ionFocus)=\"focus($event)\" />\n        <ion-button slot=\"end\" fill=\"clear\" type=\"submit\" [attr.aria-label]=\"searchLabel\"\n            [disabled]=\"disabled || !searchText || (searchText.length < lengthCheck)\">\n            <ion-icon name=\"fas-magnifying-glass\" slot=\"icon-only\" aria-hidden=\"true\" />\n        </ion-button>\n        <ion-button *ngIf=\"showClear\" slot=\"end\" fill=\"clear\" [attr.aria-label]=\"'core.clearsearch' | translate\"\n            [disabled]=\"searched === '' || disabled\" (click)=\"clearForm()\">\n            <ion-icon name=\"fas-delete-left\" slot=\"icon-only\" aria-hidden=\"true\" flip-rtl />\n        </ion-button>\n    </ion-item>\n    <ion-list class=\"core-search-history\" [hidden]=\"!historyShown\">\n        <ion-item button class=\"ion-text-wrap\" *ngFor=\"let item of history\" (click)=\"historyClicked($event, item.searchedtext)\" tabindex=\"0\"\n            [detail]=\"true\">\n            <ion-icon name=\"fas-clock-rotate-left\" slot=\"start\" aria-hidden=\"true\" />\n            <ion-label>{{item.searchedtext}}</ion-label>\n        </ion-item>\n    </ion-list>\n</form>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}