{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreConstants } from '@/core/constants';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreCourseHelper } from '@features/course/services/course-helper';\nimport { CoreSitePluginsModuleIndexComponent } from '@features/siteplugins/components/module-index/module-index';\nimport { CoreSitePlugins, CoreSitePluginsProvider } from '@features/siteplugins/services/siteplugins';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\nimport { CoreEvents } from '@singletons/events';\nimport { CoreUtils } from '@services/utils/utils';\n/**\n * Handler to support a module using a site plugin.\n */\nexport class CoreSitePluginsModuleHandler extends CoreSitePluginsBaseHandler {\n  constructor(name, modName, plugin, handlerSchema, initResult) {\n    super(name);\n    this.modName = modName;\n    this.plugin = plugin;\n    this.handlerSchema = handlerSchema;\n    this.initResult = initResult;\n    this.logger = CoreLogger.getInstance('CoreSitePluginsModuleHandler');\n    this.supportedFeatures = handlerSchema.supportedfeatures;\n    if (initResult !== null && initResult !== void 0 && initResult.jsResult && initResult.jsResult.supportsFeature) {\n      // The init result defines a function to check if a feature is supported, use it.\n      this.supportsFeature = feature => initResult.jsResult.supportsFeature(feature);\n    }\n  }\n  /**\n   * @inheritdoc\n   */\n  getData(module, courseId, sectionId, forCoursePage) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      var _this$handlerSchema$d, _this$handlerSchema$d3, _this$handlerSchema$h;\n      const icon = module.modicon || ((_this$handlerSchema$d = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d === void 0 ? void 0 : _this$handlerSchema$d.icon); // Prioritize theme icon over handler icon.\n      if (_this.shouldOnlyDisplayDescription(module, forCoursePage)) {\n        var _this$handlerSchema$d2;\n        const title = module.description;\n        module.description = '';\n        return {\n          icon: CoreCourse.getModuleIconSrc(module.modname, icon),\n          title: title || '',\n          a11yTitle: '',\n          class: (_this$handlerSchema$d2 = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d2 === void 0 ? void 0 : _this$handlerSchema$d2.class\n        };\n      }\n      const hasOffline = !!(_this.handlerSchema.offlinefunctions && Object.keys(_this.handlerSchema.offlinefunctions).length);\n      const showDowloadButton = _this.handlerSchema.downloadbutton;\n      const handlerData = {\n        title: module.name,\n        icon: CoreCourse.getModuleIconSrc(module.modname, icon),\n        class: (_this$handlerSchema$d3 = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d3 === void 0 ? void 0 : _this$handlerSchema$d3.class,\n        showDownloadButton: showDowloadButton !== undefined ? showDowloadButton : hasOffline,\n        hasCustomCmListItem: (_this$handlerSchema$h = _this.handlerSchema.hascustomcmlistitem) !== null && _this$handlerSchema$h !== void 0 ? _this$handlerSchema$h : false\n      };\n      if (_this.handlerSchema.method) {\n        // There is a method, add an action.\n        handlerData.action = /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (event, module, courseId, options) {\n            event.preventDefault();\n            event.stopPropagation();\n            yield _this.openActivityPage(module, courseId, options);\n          });\n          return function (_x, _x2, _x3, _x4) {\n            return _ref.apply(this, arguments);\n          };\n        }();\n      }\n      if (forCoursePage && _this.handlerSchema.coursepagemethod && !CoreCourseHelper.isModuleStealth(module)) {\n        // Call the method to get the course page template.\n        const method = _this.handlerSchema.coursepagemethod;\n        _this.loadCoursePageTemplate(module, courseId, handlerData, method);\n        // Allow updating the data via event.\n        CoreEvents.on(CoreSitePluginsProvider.UPDATE_COURSE_CONTENT, data => {\n          if (data.cmId === module.id) {\n            _this.loadCoursePageTemplate(module, courseId, handlerData, method, !data.alreadyFetched);\n          }\n        });\n      }\n      return handlerData;\n    })();\n  }\n  /**\n   * Check whether the plugin should only display the description, similar to mod_label.\n   *\n   * @param module Module.\n   * @param forCoursePage Whether the data will be used to render the course page.\n   * @returns Bool.\n   */\n  shouldOnlyDisplayDescription(module, forCoursePage) {\n    if (forCoursePage && this.handlerSchema.coursepagemethod) {\n      // The plugin defines a method for course page, don't display just the description.\n      return false;\n    }\n    // Check if the plugin specifies if FEATURE_NO_VIEW_LINK is supported.\n    const noViewLink = this.supportsNoViewLink();\n    if (noViewLink !== undefined) {\n      return noViewLink;\n    }\n    // The plugin doesn't specify it. Use the value returned by the site.\n    return 'noviewlink' in module && !!module.noviewlink;\n  }\n  /**\n   * Check whether the module supports NO_VIEW_LINK.\n   *\n   * @returns Bool if defined, undefined if not specified.\n   */\n  supportsNoViewLink() {\n    var _this$supportedFeatur;\n    return this.supportsFeature ? this.supportsFeature(CoreConstants.FEATURE_NO_VIEW_LINK) : (_this$supportedFeatur = this.supportedFeatures) === null || _this$supportedFeatur === void 0 ? void 0 : _this$supportedFeatur[CoreConstants.FEATURE_NO_VIEW_LINK];\n  }\n  /**\n   * Load and use template for course page.\n   *\n   * @param module Module.\n   * @param courseId Course ID.\n   * @param handlerData Handler data.\n   * @param method Method to call.\n   * @param refresh Whether to refresh the data.\n   * @returns Promise resolved when done.\n   */\n  loadCoursePageTemplate(module, courseId, handlerData, method, refresh) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      // Call the method to get the course page template.\n      handlerData.loading = true;\n      const args = {\n        courseid: courseId,\n        cmid: module.id\n      };\n      if (refresh) {\n        yield CoreUtils.ignoreErrors(CoreSitePlugins.invalidateContent(_this2.plugin.component, method, args));\n      }\n      try {\n        var _result$templates$0$h, _result$templates$;\n        const result = yield CoreSitePlugins.getContent(_this2.plugin.component, method, args);\n        // Use the html returned.\n        handlerData.title = (_result$templates$0$h = (_result$templates$ = result.templates[0]) === null || _result$templates$ === void 0 ? void 0 : _result$templates$.html) !== null && _result$templates$0$h !== void 0 ? _result$templates$0$h : '';\n        module.description = '';\n      } catch (error) {\n        _this2.logger.error('Error calling course page method:', error);\n      } finally {\n        handlerData.loading = false;\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getMainComponent() {\n    return _asyncToGenerator(function* () {\n      return CoreSitePluginsModuleIndexComponent;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  manualCompletionAlwaysShown(module) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      var _this3$initResult;\n      if (_this3.handlerSchema.manualcompletionalwaysshown !== undefined) {\n        return _this3.handlerSchema.manualcompletionalwaysshown;\n      }\n      if ((_this3$initResult = _this3.initResult) !== null && _this3$initResult !== void 0 && _this3$initResult.jsResult && _this3.initResult.jsResult.manualCompletionAlwaysShown) {\n        // The init result defines a function to check if a feature is supported, use it.\n        return _this3.initResult.jsResult.manualCompletionAlwaysShown(module);\n      }\n      return false;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  openActivityPage(module, courseId, options) {\n    return _asyncToGenerator(function* () {\n      if (!CoreCourse.moduleHasView(module)) {\n        return;\n      }\n      options = options || {};\n      options.params = options.params || {};\n      Object.assign(options.params, {\n        title: module.name,\n        module\n      });\n      CoreNavigator.navigateToSitePath(`siteplugins/module/${courseId}/${module.id}`, options);\n    })();\n  }\n}","map":{"version":3,"names":["CoreConstants","CoreCourse","CoreCourseHelper","CoreSitePluginsModuleIndexComponent","CoreSitePlugins","CoreSitePluginsProvider","CoreNavigator","CoreLogger","CoreSitePluginsBaseHandler","CoreEvents","CoreUtils","CoreSitePluginsModuleHandler","constructor","name","modName","plugin","handlerSchema","initResult","logger","getInstance","supportedFeatures","supportedfeatures","jsResult","supportsFeature","feature","getData","module","courseId","sectionId","forCoursePage","_this","_asyncToGenerator","_this$handlerSchema$d","_this$handlerSchema$d3","_this$handlerSchema$h","icon","modicon","displaydata","shouldOnlyDisplayDescription","_this$handlerSchema$d2","title","description","getModuleIconSrc","modname","a11yTitle","class","hasOffline","offlinefunctions","Object","keys","length","showDowloadButton","downloadbutton","handlerData","showDownloadButton","undefined","hasCustomCmListItem","hascustomcmlistitem","method","action","_ref","event","options","preventDefault","stopPropagation","openActivityPage","_x","_x2","_x3","_x4","apply","arguments","coursepagemethod","isModuleStealth","loadCoursePageTemplate","on","UPDATE_COURSE_CONTENT","data","cmId","id","alreadyFetched","noViewLink","supportsNoViewLink","noviewlink","_this$supportedFeatur","FEATURE_NO_VIEW_LINK","refresh","_this2","loading","args","courseid","cmid","ignoreErrors","invalidateContent","component","_result$templates$0$h","_result$templates$","result","getContent","templates","html","error","getMainComponent","manualCompletionAlwaysShown","_this3","_this3$initResult","manualcompletionalwaysshown","moduleHasView","params","assign","navigateToSitePath"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/siteplugins/classes/handlers/module-handler.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Type } from '@angular/core';\n\nimport { CoreConstants } from '@/core/constants';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreCourseHelper, CoreCourseModuleData } from '@features/course/services/course-helper';\nimport { CoreCourseModuleHandler, CoreCourseModuleHandlerData } from '@features/course/services/module-delegate';\nimport { CoreSitePluginsModuleIndexComponent } from '@features/siteplugins/components/module-index/module-index';\nimport {\n    CoreSitePlugins,\n    CoreSitePluginsContent,\n    CoreSitePluginsCourseModuleHandlerData,\n    CoreSitePluginsPlugin,\n    CoreSitePluginsProvider,\n} from '@features/siteplugins/services/siteplugins';\nimport { CoreNavigationOptions, CoreNavigator } from '@services/navigator';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\nimport { CoreEvents } from '@singletons/events';\nimport { CoreUtils } from '@services/utils/utils';\n\n/**\n * Handler to support a module using a site plugin.\n */\nexport class CoreSitePluginsModuleHandler extends CoreSitePluginsBaseHandler implements CoreCourseModuleHandler {\n\n    supportedFeatures?: Record<string, unknown>;\n    supportsFeature?: (feature: string) => unknown;\n\n    protected logger: CoreLogger;\n\n    constructor(\n        name: string,\n        public modName: string,\n        protected plugin: CoreSitePluginsPlugin,\n        protected handlerSchema: CoreSitePluginsCourseModuleHandlerData,\n        protected initResult: CoreSitePluginsContent | null,\n    ) {\n        super(name);\n\n        this.logger = CoreLogger.getInstance('CoreSitePluginsModuleHandler');\n        this.supportedFeatures = handlerSchema.supportedfeatures;\n\n        if (initResult?.jsResult && initResult.jsResult.supportsFeature) {\n            // The init result defines a function to check if a feature is supported, use it.\n            this.supportsFeature = (feature) => initResult.jsResult.supportsFeature(feature);\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getData(\n        module: CoreCourseModuleData,\n        courseId: number,\n        sectionId?: number,\n        forCoursePage?: boolean,\n    ): Promise<CoreCourseModuleHandlerData> {\n        const icon = module.modicon || this.handlerSchema.displaydata?.icon; // Prioritize theme icon over handler icon.\n\n        if (this.shouldOnlyDisplayDescription(module, forCoursePage)) {\n            const title = module.description;\n            module.description = '';\n\n            return {\n                icon: CoreCourse.getModuleIconSrc(module.modname, icon),\n                title: title || '',\n                a11yTitle: '',\n                class: this.handlerSchema.displaydata?.class,\n            };\n        }\n\n        const hasOffline = !!(this.handlerSchema.offlinefunctions && Object.keys(this.handlerSchema.offlinefunctions).length);\n        const showDowloadButton = this.handlerSchema.downloadbutton;\n        const handlerData: CoreCourseModuleHandlerData = {\n            title: module.name,\n            icon: CoreCourse.getModuleIconSrc(module.modname, icon),\n            class: this.handlerSchema.displaydata?.class,\n            showDownloadButton: showDowloadButton !== undefined ? showDowloadButton : hasOffline,\n            hasCustomCmListItem: this.handlerSchema.hascustomcmlistitem ?? false,\n        };\n\n        if (this.handlerSchema.method) {\n            // There is a method, add an action.\n            handlerData.action = async (\n                event: Event,\n                module: CoreCourseModuleData,\n                courseId: number,\n                options?: CoreNavigationOptions,\n            ) => {\n                event.preventDefault();\n                event.stopPropagation();\n\n                await this.openActivityPage(module, courseId, options);\n            };\n        }\n\n        if (forCoursePage && this.handlerSchema.coursepagemethod && !CoreCourseHelper.isModuleStealth(module)) {\n            // Call the method to get the course page template.\n            const method = this.handlerSchema.coursepagemethod;\n            this.loadCoursePageTemplate(module, courseId, handlerData, method);\n\n            // Allow updating the data via event.\n            CoreEvents.on(CoreSitePluginsProvider.UPDATE_COURSE_CONTENT, (data) => {\n                if (data.cmId === module.id) {\n                    this.loadCoursePageTemplate(module, courseId, handlerData, method, !data.alreadyFetched);\n                }\n            });\n        }\n\n        return handlerData;\n    }\n\n    /**\n     * Check whether the plugin should only display the description, similar to mod_label.\n     *\n     * @param module Module.\n     * @param forCoursePage Whether the data will be used to render the course page.\n     * @returns Bool.\n     */\n    protected shouldOnlyDisplayDescription(module: CoreCourseModuleData, forCoursePage?: boolean): boolean {\n        if (forCoursePage && this.handlerSchema.coursepagemethod) {\n            // The plugin defines a method for course page, don't display just the description.\n            return false;\n        }\n\n        // Check if the plugin specifies if FEATURE_NO_VIEW_LINK is supported.\n        const noViewLink = this.supportsNoViewLink();\n\n        if (noViewLink !== undefined) {\n            return noViewLink;\n        }\n\n        // The plugin doesn't specify it. Use the value returned by the site.\n        return 'noviewlink' in module && !!module.noviewlink;\n    }\n\n    /**\n     * Check whether the module supports NO_VIEW_LINK.\n     *\n     * @returns Bool if defined, undefined if not specified.\n     */\n    supportsNoViewLink(): boolean | undefined {\n        return <boolean | undefined> (this.supportsFeature ?\n            this.supportsFeature(CoreConstants.FEATURE_NO_VIEW_LINK) :\n            this.supportedFeatures?.[CoreConstants.FEATURE_NO_VIEW_LINK]);\n    }\n\n    /**\n     * Load and use template for course page.\n     *\n     * @param module Module.\n     * @param courseId Course ID.\n     * @param handlerData Handler data.\n     * @param method Method to call.\n     * @param refresh Whether to refresh the data.\n     * @returns Promise resolved when done.\n     */\n    protected async loadCoursePageTemplate(\n        module: CoreCourseModuleData,\n        courseId: number,\n        handlerData: CoreCourseModuleHandlerData,\n        method: string,\n        refresh?: boolean,\n    ): Promise<void> {\n        // Call the method to get the course page template.\n        handlerData.loading = true;\n\n        const args = {\n            courseid: courseId,\n            cmid: module.id,\n        };\n\n        if (refresh) {\n            await CoreUtils.ignoreErrors(CoreSitePlugins.invalidateContent(this.plugin.component, method, args));\n        }\n\n        try {\n            const result = await CoreSitePlugins.getContent(this.plugin.component, method, args);\n\n            // Use the html returned.\n            handlerData.title = result.templates[0]?.html ?? '';\n            (<CoreCourseModuleData> module).description = '';\n        } catch (error) {\n            this.logger.error('Error calling course page method:', error);\n        } finally {\n            handlerData.loading = false;\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getMainComponent(): Promise<Type<unknown>> {\n        return CoreSitePluginsModuleIndexComponent;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async manualCompletionAlwaysShown(module: CoreCourseModuleData): Promise<boolean> {\n        if (this.handlerSchema.manualcompletionalwaysshown !== undefined) {\n            return this.handlerSchema.manualcompletionalwaysshown;\n        }\n\n        if (this.initResult?.jsResult && this.initResult.jsResult.manualCompletionAlwaysShown) {\n            // The init result defines a function to check if a feature is supported, use it.\n            return this.initResult.jsResult.manualCompletionAlwaysShown(module);\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async openActivityPage(module: CoreCourseModuleData, courseId: number, options?: CoreNavigationOptions): Promise<void> {\n        if (!CoreCourse.moduleHasView(module)) {\n            return;\n        }\n\n        options = options || {};\n        options.params = options.params || {};\n        Object.assign(options.params, {\n            title: module.name,\n            module,\n        });\n\n        CoreNavigator.navigateToSitePath(`siteplugins/module/${courseId}/${module.id}`, options);\n    }\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}