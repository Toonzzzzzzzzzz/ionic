{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { CoreError } from '@classes/errors/error';\nimport { CoreBlockPreRenderedComponent } from '@features/block/components/pre-rendered-block/pre-rendered-block';\nimport { CoreBlockDelegate } from '@features/block/services/block-delegate';\nimport { CoreSitePluginsBlockComponent } from '@features/siteplugins/components/block/block';\nimport { CoreSitePluginsOnlyTitleBlockComponent } from '@features/siteplugins/components/only-title-block/only-title-block';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\n/**\n * Handler to support a block using a site plugin.\n */\nexport class CoreSitePluginsBlockHandler extends CoreSitePluginsBaseHandler {\n  constructor(name, title, blockName, handlerSchema, initResult) {\n    super(name);\n    this.title = title;\n    this.blockName = blockName;\n    this.handlerSchema = handlerSchema;\n    this.initResult = initResult;\n    this.logger = CoreLogger.getInstance('CoreSitePluginsBlockHandler');\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData(block, contextLevel, instanceId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      var _this$handlerSchema$d, _this$handlerSchema$d2, _this$handlerSchema$d3;\n      const className = ((_this$handlerSchema$d = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d === void 0 ? void 0 : _this$handlerSchema$d.class) || 'block_' + block.name;\n      let component;\n      if (((_this$handlerSchema$d2 = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d2 === void 0 ? void 0 : _this$handlerSchema$d2.type) == 'title') {\n        component = CoreSitePluginsOnlyTitleBlockComponent;\n      } else if (((_this$handlerSchema$d3 = _this.handlerSchema.displaydata) === null || _this$handlerSchema$d3 === void 0 ? void 0 : _this$handlerSchema$d3.type) == 'prerendered') {\n        component = CoreBlockPreRenderedComponent;\n      } else if (_this.handlerSchema.fallback && !_this.handlerSchema.method) {\n        // Try to use the fallback block.\n        const originalName = block.name;\n        block.name = _this.handlerSchema.fallback;\n        try {\n          const displayData = yield CoreBlockDelegate.getBlockDisplayData(block, contextLevel, instanceId);\n          if (!displayData) {\n            throw new CoreError('Cannot get display data for fallback block.');\n          }\n          _this.logger.debug(`Using fallback \"${_this.handlerSchema.fallback}\" for block \"${originalName}\"`);\n          component = displayData.component;\n        } catch (error) {\n          _this.logger.error(`Error using fallback \"${_this.handlerSchema.fallback}\" for block \"${originalName}\", ` + 'maybe it doesn\\'t exist or isn\\'t enabled.', error);\n          throw error;\n        }\n      } else {\n        component = CoreSitePluginsBlockComponent;\n      }\n      return {\n        title: _this.title,\n        class: className,\n        component\n      };\n    })();\n  }\n}","map":{"version":3,"names":["CoreError","CoreBlockPreRenderedComponent","CoreBlockDelegate","CoreSitePluginsBlockComponent","CoreSitePluginsOnlyTitleBlockComponent","CoreLogger","CoreSitePluginsBaseHandler","CoreSitePluginsBlockHandler","constructor","name","title","blockName","handlerSchema","initResult","logger","getInstance","getDisplayData","block","contextLevel","instanceId","_this","_asyncToGenerator","_this$handlerSchema$d","_this$handlerSchema$d2","_this$handlerSchema$d3","className","displaydata","class","component","type","fallback","method","originalName","displayData","getBlockDisplayData","debug","error"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/core/features/siteplugins/classes/handlers/block-handler.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Type } from '@angular/core';\nimport { CoreError } from '@classes/errors/error';\nimport type { ICoreBlockComponent } from '@features/block/classes/base-block-component';\nimport { CoreBlockPreRenderedComponent } from '@features/block/components/pre-rendered-block/pre-rendered-block';\nimport { CoreBlockDelegate, CoreBlockHandler, CoreBlockHandlerData } from '@features/block/services/block-delegate';\nimport { CoreCourseBlock } from '@features/course/services/course';\nimport { CoreSitePluginsBlockComponent } from '@features/siteplugins/components/block/block';\nimport { CoreSitePluginsOnlyTitleBlockComponent } from '@features/siteplugins/components/only-title-block/only-title-block';\nimport { CoreSitePluginsBlockHandlerData, CoreSitePluginsContent } from '@features/siteplugins/services/siteplugins';\nimport { CoreLogger } from '@singletons/logger';\nimport { CoreSitePluginsBaseHandler } from './base-handler';\n\n/**\n * Handler to support a block using a site plugin.\n */\nexport class CoreSitePluginsBlockHandler extends CoreSitePluginsBaseHandler implements CoreBlockHandler {\n\n    protected logger: CoreLogger;\n\n    constructor(\n        name: string,\n        public title: string,\n        public blockName: string,\n        protected handlerSchema: CoreSitePluginsBlockHandlerData,\n        protected initResult: CoreSitePluginsContent | null,\n    ) {\n        super(name);\n\n        this.logger = CoreLogger.getInstance('CoreSitePluginsBlockHandler');\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async getDisplayData(\n        block: CoreCourseBlock,\n        contextLevel: string,\n        instanceId: number,\n    ): Promise<CoreBlockHandlerData> {\n        const className = this.handlerSchema.displaydata?.class || 'block_' + block.name;\n        let component: Type<ICoreBlockComponent> | undefined;\n\n        if (this.handlerSchema.displaydata?.type == 'title') {\n            component = CoreSitePluginsOnlyTitleBlockComponent;\n        } else if (this.handlerSchema.displaydata?.type == 'prerendered') {\n            component = CoreBlockPreRenderedComponent;\n        } else if (this.handlerSchema.fallback && !this.handlerSchema.method) {\n            // Try to use the fallback block.\n            const originalName = block.name;\n            block.name = this.handlerSchema.fallback;\n\n            try {\n                const displayData = await CoreBlockDelegate.getBlockDisplayData(block, contextLevel, instanceId);\n\n                if (!displayData) {\n                    throw new CoreError('Cannot get display data for fallback block.');\n                }\n\n                this.logger.debug(`Using fallback \"${this.handlerSchema.fallback}\" for block \"${originalName}\"`);\n                component = displayData.component;\n            } catch (error) {\n                this.logger.error(`Error using fallback \"${this.handlerSchema.fallback}\" for block \"${originalName}\", ` +\n                        'maybe it doesn\\'t exist or isn\\'t enabled.', error);\n\n                throw error;\n            }\n        } else {\n            component = CoreSitePluginsBlockComponent;\n        }\n\n        return {\n            title: this.title,\n            class: className,\n            component,\n        };\n    }\n\n}\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,SAASA,SAAS,QAAQ,uBAAuB;AAEjD,SAASC,6BAA6B,QAAQ,kEAAkE;AAChH,SAASC,iBAAiB,QAAgD,yCAAyC;AAEnH,SAASC,6BAA6B,QAAQ,8CAA8C;AAC5F,SAASC,sCAAsC,QAAQ,oEAAoE;AAE3H,SAASC,UAAU,QAAQ,oBAAoB;AAC/C,SAASC,0BAA0B,QAAQ,gBAAgB;AAE3D;;;AAGA,OAAM,MAAOC,2BAA4B,SAAQD,0BAA0B;EAIvEE,YACIC,IAAY,EACLC,KAAa,EACbC,SAAiB,EACdC,aAA8C,EAC9CC,UAAyC;IAEnD,KAAK,CAACJ,IAAI,CAAC;IALJ,KAAAC,KAAK,GAALA,KAAK;IACL,KAAAC,SAAS,GAATA,SAAS;IACN,KAAAC,aAAa,GAAbA,aAAa;IACb,KAAAC,UAAU,GAAVA,UAAU;IAIpB,IAAI,CAACC,MAAM,GAAGT,UAAU,CAACU,WAAW,CAAC,6BAA6B,CAAC;EACvE;EAEA;;;EAGMC,cAAcA,CAChBC,KAAsB,EACtBC,YAAoB,EACpBC,UAAkB;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MAAA,IAAAC,qBAAA,EAAAC,sBAAA,EAAAC,sBAAA;MAElB,MAAMC,SAAS,GAAG,EAAAH,qBAAA,GAAAF,KAAI,CAACR,aAAa,CAACc,WAAW,cAAAJ,qBAAA,uBAA9BA,qBAAA,CAAgCK,KAAK,KAAI,QAAQ,GAAGV,KAAK,CAACR,IAAI;MAChF,IAAImB,SAAgD;MAEpD,IAAI,EAAAL,sBAAA,GAAAH,KAAI,CAACR,aAAa,CAACc,WAAW,cAAAH,sBAAA,uBAA9BA,sBAAA,CAAgCM,IAAI,KAAI,OAAO,EAAE;QACjDD,SAAS,GAAGxB,sCAAsC;OACrD,MAAM,IAAI,EAAAoB,sBAAA,GAAAJ,KAAI,CAACR,aAAa,CAACc,WAAW,cAAAF,sBAAA,uBAA9BA,sBAAA,CAAgCK,IAAI,KAAI,aAAa,EAAE;QAC9DD,SAAS,GAAG3B,6BAA6B;OAC5C,MAAM,IAAImB,KAAI,CAACR,aAAa,CAACkB,QAAQ,IAAI,CAACV,KAAI,CAACR,aAAa,CAACmB,MAAM,EAAE;QAClE;QACA,MAAMC,YAAY,GAAGf,KAAK,CAACR,IAAI;QAC/BQ,KAAK,CAACR,IAAI,GAAGW,KAAI,CAACR,aAAa,CAACkB,QAAQ;QAExC,IAAI;UACA,MAAMG,WAAW,SAAS/B,iBAAiB,CAACgC,mBAAmB,CAACjB,KAAK,EAAEC,YAAY,EAAEC,UAAU,CAAC;UAEhG,IAAI,CAACc,WAAW,EAAE;YACd,MAAM,IAAIjC,SAAS,CAAC,6CAA6C,CAAC;;UAGtEoB,KAAI,CAACN,MAAM,CAACqB,KAAK,CAAC,mBAAmBf,KAAI,CAACR,aAAa,CAACkB,QAAQ,gBAAgBE,YAAY,GAAG,CAAC;UAChGJ,SAAS,GAAGK,WAAW,CAACL,SAAS;SACpC,CAAC,OAAOQ,KAAK,EAAE;UACZhB,KAAI,CAACN,MAAM,CAACsB,KAAK,CAAC,yBAAyBhB,KAAI,CAACR,aAAa,CAACkB,QAAQ,gBAAgBE,YAAY,KAAK,GAC/F,4CAA4C,EAAEI,KAAK,CAAC;UAE5D,MAAMA,KAAK;;OAElB,MAAM;QACHR,SAAS,GAAGzB,6BAA6B;;MAG7C,OAAO;QACHO,KAAK,EAAEU,KAAI,CAACV,KAAK;QACjBiB,KAAK,EAAEF,SAAS;QAChBG;OACH;IAAC;EACN"},"metadata":{},"sourceType":"module","externalDependencies":[]}