{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\nimport { CoreCourseProvider } from '@features/course/services/course';\nimport { makeSingleton } from '@singletons';\nimport { AddonCompetency } from '../competency';\nimport { CoreFilterHelper } from '@features/filter/services/filter-helper';\nimport { ADDON_COMPETENCY_COMPETENCIES_PAGE } from '@addons/competency/competency.module';\nimport * as i0 from \"@angular/core\";\n/**\n * Course nav handler.\n */\nexport class AddonCompetencyCourseOptionHandlerService {\n  constructor() {\n    this.name = 'AddonCompetency';\n    this.priority = 300;\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabled() {\n    return _asyncToGenerator(function* () {\n      return true;\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  isEnabledForCourse(courseId, accessData, navOptions) {\n    return _asyncToGenerator(function* () {\n      if (accessData && accessData.type === CoreCourseProvider.ACCESS_GUEST) {\n        return false; // Not enabled for guest access.\n      }\n\n      if (navOptions && navOptions.competencies !== undefined) {\n        return navOptions.competencies;\n      }\n      try {\n        const competencies = yield AddonCompetency.getCourseCompetencies(courseId);\n        return competencies ? !competencies.canmanagecoursecompetencies : false;\n      } catch (_unused) {\n        return false;\n      }\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  getDisplayData() {\n    return {\n      title: 'addon.competency.competencies',\n      class: 'addon-competency-course-handler',\n      page: ADDON_COMPETENCY_COMPETENCIES_PAGE\n    };\n  }\n  /**\n   * @inheritdoc\n   */\n  invalidateEnabledForCourse(courseId, navOptions) {\n    return _asyncToGenerator(function* () {\n      if (navOptions && navOptions.competencies !== undefined) {\n        // No need to invalidate anything.\n        return;\n      }\n      return AddonCompetency.invalidateCourseCompetencies(courseId);\n    })();\n  }\n  /**\n   * @inheritdoc\n   */\n  prefetch(course) {\n    return _asyncToGenerator(function* () {\n      // Get the competencies in the course.\n      const competencies = yield AddonCompetency.getCourseCompetencies(course.id, undefined, undefined, true);\n      if (!competencies || !competencies.competencies) {\n        return;\n      }\n      const promises = [];\n      // Prefetch all the competencies.\n      competencies.competencies.forEach(competency => {\n        promises.push(AddonCompetency.getCompetencyInCourse(course.id, competency.competency.id, undefined, undefined, true));\n        promises.push(AddonCompetency.getCompetencySummary(competency.competency.id, undefined, undefined, true));\n        if (competency.coursemodules) {\n          competency.coursemodules.forEach(module => {\n            promises.push(CoreFilterHelper.getFilters(\"module\" /* ContextLevel.MODULE */, module.id, {\n              courseId: course.id\n            }));\n          });\n        }\n        if (competency.plans) {\n          competency.plans.forEach(plan => {\n            promises.push(CoreFilterHelper.getFilters(\"user\" /* ContextLevel.USER */, plan.userid));\n          });\n        }\n      });\n      yield Promise.all(promises);\n    })();\n  }\n}\n_class = AddonCompetencyCourseOptionHandlerService;\n_class.ɵfac = function AddonCompetencyCourseOptionHandlerService_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});\nexport const AddonCompetencyCourseOptionHandler = makeSingleton(AddonCompetencyCourseOptionHandlerService);","map":{"version":3,"names":["CoreCourseProvider","makeSingleton","AddonCompetency","CoreFilterHelper","ADDON_COMPETENCY_COMPETENCIES_PAGE","AddonCompetencyCourseOptionHandlerService","constructor","name","priority","isEnabled","_asyncToGenerator","isEnabledForCourse","courseId","accessData","navOptions","type","ACCESS_GUEST","competencies","undefined","getCourseCompetencies","canmanagecoursecompetencies","_unused","getDisplayData","title","class","page","invalidateEnabledForCourse","invalidateCourseCompetencies","prefetch","course","id","promises","forEach","competency","push","getCompetencyInCourse","getCompetencySummary","coursemodules","module","getFilters","plans","plan","userid","Promise","all","factory","ɵfac","providedIn","AddonCompetencyCourseOptionHandler"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/competency/services/handlers/course-option.ts"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Injectable } from '@angular/core';\nimport { CoreCourseProvider } from '@features/course/services/course';\nimport {\n    CoreCourseAccess,\n    CoreCourseOptionsHandler,\n    CoreCourseOptionsHandlerData,\n} from '@features/course/services/course-options-delegate';\nimport { makeSingleton } from '@singletons';\nimport { AddonCompetency } from '../competency';\nimport { CoreCourseAnyCourseData, CoreCourseUserAdminOrNavOptionIndexed } from '@features/courses/services/courses';\nimport { CoreFilterHelper } from '@features/filter/services/filter-helper';\nimport { ContextLevel } from '@/core/constants';\nimport { ADDON_COMPETENCY_COMPETENCIES_PAGE } from '@addons/competency/competency.module';\n\n/**\n * Course nav handler.\n */\n@Injectable( { providedIn: 'root' })\nexport class AddonCompetencyCourseOptionHandlerService implements CoreCourseOptionsHandler {\n\n    name = 'AddonCompetency';\n    priority = 300;\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabled(): Promise<boolean> {\n        return true;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async isEnabledForCourse(\n        courseId: number,\n        accessData: CoreCourseAccess,\n        navOptions?: CoreCourseUserAdminOrNavOptionIndexed,\n    ): Promise<boolean> {\n        if (accessData && accessData.type === CoreCourseProvider.ACCESS_GUEST) {\n            return false; // Not enabled for guest access.\n        }\n\n        if (navOptions && navOptions.competencies !== undefined) {\n            return navOptions.competencies;\n        }\n\n        try {\n            const competencies = await AddonCompetency.getCourseCompetencies(courseId);\n\n            return competencies ? !competencies.canmanagecoursecompetencies : false;\n        } catch {\n            return false;\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    getDisplayData(): CoreCourseOptionsHandlerData {\n        return {\n            title: 'addon.competency.competencies',\n            class: 'addon-competency-course-handler',\n            page: ADDON_COMPETENCY_COMPETENCIES_PAGE,\n        };\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async invalidateEnabledForCourse(courseId: number, navOptions?: CoreCourseUserAdminOrNavOptionIndexed): Promise<void> {\n        if (navOptions && navOptions.competencies !== undefined) {\n            // No need to invalidate anything.\n            return;\n        }\n\n        return AddonCompetency.invalidateCourseCompetencies(courseId);\n    }\n\n    /**\n     * @inheritdoc\n     */\n    async prefetch(course: CoreCourseAnyCourseData): Promise<void> {\n        // Get the competencies in the course.\n        const competencies = await AddonCompetency.getCourseCompetencies(course.id, undefined, undefined, true);\n\n        if (!competencies || !competencies.competencies) {\n            return;\n        }\n\n        const promises: Promise<unknown>[] = [];\n\n        // Prefetch all the competencies.\n        competencies.competencies.forEach((competency) => {\n            promises.push(AddonCompetency.getCompetencyInCourse(\n                course.id,\n                competency.competency.id,\n                undefined,\n                undefined,\n                true,\n            ));\n\n            promises.push(AddonCompetency.getCompetencySummary(\n                competency.competency.id,\n                undefined,\n                undefined,\n                true,\n            ));\n\n            if (competency.coursemodules) {\n                competency.coursemodules.forEach((module) => {\n                    promises.push(CoreFilterHelper.getFilters(ContextLevel.MODULE, module.id, { courseId: course.id }));\n                });\n            }\n\n            if (competency.plans) {\n                competency.plans.forEach((plan) => {\n                    promises.push(CoreFilterHelper.getFilters(ContextLevel.USER, plan.userid));\n                });\n            }\n        });\n\n        await Promise.all(promises);\n    }\n\n}\nexport const AddonCompetencyCourseOptionHandler = makeSingleton(AddonCompetencyCourseOptionHandlerService);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}