{"ast":null,"code":"import _asyncToGenerator from \"/home/toon/works/gitionic7/ionic-github/ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar _class;\n// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { AddonModForum } from '@addons/mod/forum/services/forum';\nimport { CorePromisedValue } from '@classes/promised-value';\nimport { CoreContentLinksHelper } from '@features/contentlinks/services/contentlinks-helper';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreSearchGlobalSearchResultsSource } from '@features/search/classes/global-search-results-source';\nimport { CoreSearchGlobalSearch } from '@features/search/services/global-search';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate } from '@singletons';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../../core/components/empty-box/empty-box\";\nimport * as i3 from \"../../../../../core/components/infinite-loading/infinite-loading\";\nimport * as i4 from \"../../../../../core/directives/fa-icon\";\nimport * as i5 from \"../../../../../core/directives/format-text\";\nimport * as i6 from \"../../../../../core/directives/content\";\nimport * as i7 from \"@ionic/angular\";\nimport * as i8 from \"../../../../../core/features/search/components/search-box/search-box\";\nimport * as i9 from \"@features/search/components/global-search-result/global-search-result\";\nimport * as i10 from \"@ngx-translate/core\";\nfunction AddonModForumSearchPage_h1_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.forum.name);\n  }\n}\nfunction AddonModForumSearchPage_h1_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, \"addon.block_searchforums.pluginname\"));\n  }\n}\nfunction AddonModForumSearchPage_ion_card_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\", 8)(1, \"ion-item\");\n    i0.ɵɵelement(2, \"ion-icon\", 9);\n    i0.ɵɵelementStart(3, \"ion-label\");\n    i0.ɵɵelement(4, \"core-format-text\", 1);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"text\", ctx_r2.searchBanner);\n  }\n}\nfunction AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"core-search-global-search-result\", 11);\n    i0.ɵɵlistener(\"onClick\", function AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const result_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.visitResult(result_r6));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const result_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"result\", result_r6)(\"showCourse\", false);\n  }\n}\nfunction AddonModForumSearchPage_ion_list_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵtemplate(1, AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template, 1, 2, \"core-search-global-search-result\", 10);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.resultsSource.getItems());\n  }\n}\nfunction AddonModForumSearchPage_core_empty_box_16_p_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, \"core.search.empty\"));\n  }\n}\nconst _c0 = function (a0) {\n  return {\n    $a: a0\n  };\n};\nfunction AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"p\")(6, \"small\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(4, 2, \"core.search.noresults\", i0.ɵɵpureFunction1(7, _c0, ctx_r10.resultsSource.getQuery())));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(8, 5, \"core.search.noresultshelp\"));\n  }\n}\nfunction AddonModForumSearchPage_core_empty_box_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"core-empty-box\", 12);\n    i0.ɵɵtemplate(1, AddonModForumSearchPage_core_empty_box_16_p_1_Template, 3, 3, \"p\", 2);\n    i0.ɵɵtemplate(2, AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template, 9, 9, \"ng-container\", 2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"dimmed\", !ctx_r4.resultsSource.isLoaded());\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r4.resultsSource.isLoaded());\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.resultsSource.isLoaded());\n  }\n}\nexport class AddonModForumSearchPage {\n  constructor() {\n    this.loadMoreError = null;\n    this.searchBanner = null;\n    this.resultsSource = new CoreSearchGlobalSearchResultsSource('', {});\n    this.ready = new CorePromisedValue();\n  }\n  /**\n   * @inheritdoc\n   */\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        var _site$config$searchba, _site$config, _site$config2;\n        const site = CoreSites.getRequiredCurrentSite();\n        const searchBanner = (_site$config$searchba = (_site$config = site.config) === null || _site$config === void 0 || (_site$config = _site$config.searchbanner) === null || _site$config === void 0 ? void 0 : _site$config.trim()) !== null && _site$config$searchba !== void 0 ? _site$config$searchba : '';\n        const courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n        const forumId = CoreNavigator.getRouteNumberParam('forumId');\n        const filters = {\n          courseIds: [courseId]\n        };\n        if (CoreUtils.isTrueOrOne((_site$config2 = site.config) === null || _site$config2 === void 0 ? void 0 : _site$config2.searchbannerenable) && searchBanner.length > 0) {\n          _this.searchBanner = searchBanner;\n        }\n        if (forumId) {\n          _this.forum = yield AddonModForum.getForumById(courseId, forumId);\n          const module = yield CoreCourse.getModule(_this.forum.cmid, courseId);\n          filters.searchAreaIds = ['mod_forum-post'];\n          if (module.contextid) {\n            filters.contextIds = [module.contextid];\n          }\n          _this.searchAreaId = `AddonModForumSearch-${courseId}-${_this.forum.id}`;\n        } else {\n          filters.searchAreaIds = ['mod_forum-activity', 'mod_forum-post'];\n          _this.searchAreaId = `AddonModForumSearch-${courseId}`;\n        }\n        _this.resultsSource.setFilters(filters);\n        _this.ready.resolve();\n      } catch (error) {\n        CoreDomUtils.showErrorModal(error);\n        CoreNavigator.back();\n        return;\n      }\n    })();\n  }\n  /**\n   * Perform a new search.\n   *\n   * @param query Search query.\n   */\n  search(query) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      yield _this2.ready;\n      _this2.resultsSource.setQuery(query);\n      if (_this2.resultsSource.hasEmptyQuery()) {\n        return;\n      }\n      yield CoreDomUtils.showOperationModals('core.searching', true, /*#__PURE__*/_asyncToGenerator(function* () {\n        yield _this2.resultsSource.reload();\n        yield CoreUtils.ignoreErrors(CoreSearchGlobalSearch.logViewResults(_this2.resultsSource.getQuery(), _this2.resultsSource.getFilters()));\n        CoreAnalytics.logEvent({\n          type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n          ws: 'core_search_view_results',\n          name: Translate.instant('core.search.globalsearch'),\n          data: {\n            query,\n            filters: JSON.stringify(_this2.resultsSource.getFilters())\n          },\n          url: CoreUrlUtils.addParamsToUrl('/search/index.php', {\n            q: query\n          })\n        });\n      }));\n    })();\n  }\n  /**\n   * Clear search results.\n   */\n  clearSearch() {\n    this.loadMoreError = null;\n    this.resultsSource.setQuery('');\n    this.resultsSource.reset();\n  }\n  /**\n   * Visit a result's origin.\n   *\n   * @param result Result to visit.\n   */\n  visitResult(result) {\n    return _asyncToGenerator(function* () {\n      yield CoreContentLinksHelper.handleLink(result.url);\n    })();\n  }\n  /**\n   * Load more results.\n   *\n   * @param complete Notify completion.\n   */\n  loadMoreResults(complete) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        var _this3$resultsSource;\n        yield (_this3$resultsSource = _this3.resultsSource) === null || _this3$resultsSource === void 0 ? void 0 : _this3$resultsSource.load();\n      } catch (error) {\n        _this3.loadMoreError = CoreDomUtils.getErrorMessage(error);\n      } finally {\n        complete();\n      }\n    })();\n  }\n}\n_class = AddonModForumSearchPage;\n_class.ɵfac = function AddonModForumSearchPage_Factory(t) {\n  return new (t || _class)();\n};\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"page-addon-mod-forum-search\"]],\n  decls: 17,\n  vars: 18,\n  consts: [[\"slot\", \"start\"], [3, \"text\"], [4, \"ngIf\"], [1, \"limited-width\"], [\"class\", \"core-danger-card\", 4, \"ngIf\"], [3, \"placeholder\", \"searchLabel\", \"autoFocus\", \"searchArea\", \"onSubmit\", \"onClear\"], [3, \"enabled\", \"error\", \"action\"], [\"icon\", \"fas-magnifying-glass\", 3, \"dimmed\", 4, \"ngIf\"], [1, \"core-danger-card\"], [\"name\", \"fas-triangle-exclamation\", \"slot\", \"start\", \"aria-hidden\", \"true\"], [3, \"result\", \"showCourse\", \"onClick\", 4, \"ngFor\", \"ngForOf\"], [3, \"result\", \"showCourse\", \"onClick\"], [\"icon\", \"fas-magnifying-glass\", 3, \"dimmed\"]],\n  template: function AddonModForumSearchPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n      i0.ɵɵelement(3, \"ion-back-button\", 1);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"ion-title\");\n      i0.ɵɵtemplate(6, AddonModForumSearchPage_h1_6_Template, 2, 1, \"h1\", 2);\n      i0.ɵɵtemplate(7, AddonModForumSearchPage_h1_7_Template, 3, 3, \"h1\", 2);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(8, \"ion-content\", 3)(9, \"div\");\n      i0.ɵɵtemplate(10, AddonModForumSearchPage_ion_card_10_Template, 5, 1, \"ion-card\", 4);\n      i0.ɵɵelementStart(11, \"core-search-box\", 5);\n      i0.ɵɵlistener(\"onSubmit\", function AddonModForumSearchPage_Template_core_search_box_onSubmit_11_listener($event) {\n        return ctx.search($event);\n      })(\"onClear\", function AddonModForumSearchPage_Template_core_search_box_onClear_11_listener() {\n        return ctx.clearSearch();\n      });\n      i0.ɵɵpipe(12, \"translate\");\n      i0.ɵɵpipe(13, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(14, AddonModForumSearchPage_ion_list_14_Template, 2, 1, \"ion-list\", 2);\n      i0.ɵɵelementStart(15, \"core-infinite-loading\", 6);\n      i0.ɵɵlistener(\"action\", function AddonModForumSearchPage_Template_core_infinite_loading_action_15_listener($event) {\n        return ctx.loadMoreResults($event);\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(16, AddonModForumSearchPage_core_empty_box_16_Template, 3, 3, \"core-empty-box\", 7);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(4, 12, \"core.back\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.forum);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.forum);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.searchBanner);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(12, 14, \"core.search\"))(\"searchLabel\", i0.ɵɵpipeBind1(13, 16, \"core.search\"))(\"autoFocus\", true)(\"searchArea\", ctx.searchAreaId);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.resultsSource.isLoaded());\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"enabled\", ctx.resultsSource.isLoaded() && !ctx.resultsSource.isCompleted())(\"error\", ctx.loadMoreError);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.resultsSource.isEmpty());\n    }\n  },\n  dependencies: [i1.NgForOf, i1.NgIf, i2.CoreEmptyBoxComponent, i3.CoreInfiniteLoadingComponent, i4.CoreFaIconDirective, i5.CoreFormatTextDirective, i6.CoreContentDirective, i7.IonButtons, i7.IonCard, i7.IonContent, i7.IonHeader, i7.IonIcon, i7.IonItem, i7.IonLabel, i7.IonList, i7.IonTitle, i7.IonToolbar, i7.IonBackButton, i8.CoreSearchBoxComponent, i9.CoreSearchGlobalSearchResultComponent, i10.TranslatePipe],\n  styles: [\"[_nghost-%COMP%] {\\n  --results-count-text-color: var(--gray-700);\\n}\\n[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%] {\\n  color: var(--results-count-text-color);\\n  min-height: 0px;\\n  margin: 8px 16px;\\n  font-size: 14px;\\n}\\n\\nhtml.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%] {\\n  --results-count-text-color: var(--gray-400);\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hZGRvbnMvbW9kL2ZvcnVtL3BhZ2VzL3NlYXJjaC9zZWFyY2guc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLDJDQUFBO0FBQ0o7QUFDSTtFQUNJLHNDQUFBO0VBQ0EsZUFBQTtFQUNBLGdCQUFBO0VBQ0EsZUFBQTtBQUNSOztBQUlBO0VBQ0ksMkNBQUE7QUFESiIsInNvdXJjZXNDb250ZW50IjpbIjpob3N0IHtcbiAgICAtLXJlc3VsdHMtY291bnQtdGV4dC1jb2xvcjogdmFyKC0tZ3JheS03MDApO1xuXG4gICAgLnJlc3VsdHMtY291bnQge1xuICAgICAgICBjb2xvcjogdmFyKC0tcmVzdWx0cy1jb3VudC10ZXh0LWNvbG9yKTtcbiAgICAgICAgbWluLWhlaWdodDogMHB4O1xuICAgICAgICBtYXJnaW46IDhweCAxNnB4O1xuICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgfVxuXG59XG5cbjpob3N0LWNvbnRleHQoaHRtbC5kYXJrKSB7XG4gICAgLS1yZXN1bHRzLWNvdW50LXRleHQtY29sb3I6IHZhcigtLWdyYXktNDAwKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"names":["AddonModForum","CorePromisedValue","CoreContentLinksHelper","CoreCourse","CoreSearchGlobalSearchResultsSource","CoreSearchGlobalSearch","CoreAnalytics","CoreAnalyticsEventType","CoreNavigator","CoreSites","CoreDomUtils","CoreUrlUtils","CoreUtils","Translate","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate","ctx_r0","forum","name","ɵɵpipeBind1","ɵɵelement","ɵɵproperty","ctx_r2","searchBanner","ɵɵlistener","AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener","restoredCtx","ɵɵrestoreView","_r8","result_r6","$implicit","ctx_r7","ɵɵnextContext","ɵɵresetView","visitResult","ɵɵtemplate","AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template","ctx_r3","resultsSource","getItems","ɵɵelementContainerStart","ɵɵelementContainerEnd","ɵɵpipeBind2","ɵɵpureFunction1","_c0","ctx_r10","getQuery","AddonModForumSearchPage_core_empty_box_16_p_1_Template","AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template","ctx_r4","isLoaded","AddonModForumSearchPage","constructor","loadMoreError","ready","ngOnInit","_this","_asyncToGenerator","_site$config$searchba","_site$config","_site$config2","site","getRequiredCurrentSite","config","searchbanner","trim","courseId","getRequiredRouteNumberParam","forumId","getRouteNumberParam","filters","courseIds","isTrueOrOne","searchbannerenable","length","getForumById","module","getModule","cmid","searchAreaIds","contextid","contextIds","searchAreaId","id","setFilters","resolve","error","showErrorModal","back","search","query","_this2","setQuery","hasEmptyQuery","showOperationModals","reload","ignoreErrors","logViewResults","getFilters","logEvent","type","VIEW_ITEM_LIST","ws","instant","data","JSON","stringify","url","addParamsToUrl","q","clearSearch","reset","result","handleLink","loadMoreResults","complete","_this3","_this3$resultsSource","load","getErrorMessage","selectors","decls","vars","consts","template","AddonModForumSearchPage_Template","rf","ctx","AddonModForumSearchPage_h1_6_Template","AddonModForumSearchPage_h1_7_Template","AddonModForumSearchPage_ion_card_10_Template","AddonModForumSearchPage_Template_core_search_box_onSubmit_11_listener","$event","AddonModForumSearchPage_Template_core_search_box_onClear_11_listener","AddonModForumSearchPage_ion_list_14_Template","AddonModForumSearchPage_Template_core_infinite_loading_action_15_listener","AddonModForumSearchPage_core_empty_box_16_Template","isCompleted","isEmpty"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/forum/pages/search/search.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/forum/pages/search/search.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { AddonModForum, AddonModForumData } from '@addons/mod/forum/services/forum';\nimport { Component, OnInit } from '@angular/core';\nimport { CorePromisedValue } from '@classes/promised-value';\nimport { CoreContentLinksHelper } from '@features/contentlinks/services/contentlinks-helper';\nimport { CoreCourse } from '@features/course/services/course';\nimport { CoreSearchGlobalSearchResultsSource } from '@features/search/classes/global-search-results-source';\nimport {\n    CoreSearchGlobalSearch,\n    CoreSearchGlobalSearchFilters,\n    CoreSearchGlobalSearchResult,\n} from '@features/search/services/global-search';\nimport { CoreAnalytics, CoreAnalyticsEventType } from '@services/analytics';\nimport { CoreNavigator } from '@services/navigator';\nimport { CoreSites } from '@services/sites';\nimport { CoreDomUtils } from '@services/utils/dom';\nimport { CoreUrlUtils } from '@services/utils/url';\nimport { CoreUtils } from '@services/utils/utils';\nimport { Translate } from '@singletons';\n\n@Component({\n    selector: 'page-addon-mod-forum-search',\n    templateUrl: 'search.html',\n    styleUrls: ['search.scss'],\n})\nexport class AddonModForumSearchPage implements OnInit {\n\n    loadMoreError: string | null = null;\n    searchBanner: string | null = null;\n    resultsSource = new CoreSearchGlobalSearchResultsSource('', {});\n    forum?: AddonModForumData;\n    searchAreaId?: string;\n\n    private ready = new CorePromisedValue<void>();\n\n    /**\n     * @inheritdoc\n     */\n    async ngOnInit(): Promise<void> {\n        try {\n            const site = CoreSites.getRequiredCurrentSite();\n            const searchBanner = site.config?.searchbanner?.trim() ?? '';\n            const courseId = CoreNavigator.getRequiredRouteNumberParam('courseId');\n            const forumId = CoreNavigator.getRouteNumberParam('forumId');\n            const filters: CoreSearchGlobalSearchFilters = {\n                courseIds: [courseId],\n            };\n\n            if (CoreUtils.isTrueOrOne(site.config?.searchbannerenable) && searchBanner.length > 0) {\n                this.searchBanner = searchBanner;\n            }\n\n            if (forumId) {\n                this.forum = await AddonModForum.getForumById(courseId, forumId);\n                const module = await CoreCourse.getModule(this.forum.cmid, courseId);\n\n                filters.searchAreaIds = ['mod_forum-post'];\n\n                if (module.contextid) {\n                    filters.contextIds = [module.contextid];\n                }\n\n                this.searchAreaId = `AddonModForumSearch-${courseId}-${this.forum.id}`;\n            } else {\n                filters.searchAreaIds = ['mod_forum-activity', 'mod_forum-post'];\n                this.searchAreaId = `AddonModForumSearch-${courseId}`;\n            }\n\n            this.resultsSource.setFilters(filters);\n            this.ready.resolve();\n        } catch (error) {\n            CoreDomUtils.showErrorModal(error);\n            CoreNavigator.back();\n\n            return;\n        }\n    }\n\n    /**\n     * Perform a new search.\n     *\n     * @param query Search query.\n     */\n    async search(query: string): Promise<void> {\n        await this.ready;\n\n        this.resultsSource.setQuery(query);\n\n        if (this.resultsSource.hasEmptyQuery()) {\n            return;\n        }\n\n        await CoreDomUtils.showOperationModals('core.searching', true, async () => {\n            await this.resultsSource.reload();\n            await CoreUtils.ignoreErrors(\n                CoreSearchGlobalSearch.logViewResults(this.resultsSource.getQuery(), this.resultsSource.getFilters()),\n            );\n\n            CoreAnalytics.logEvent({\n                type: CoreAnalyticsEventType.VIEW_ITEM_LIST,\n                ws: 'core_search_view_results',\n                name: Translate.instant('core.search.globalsearch'),\n                data: {\n                    query,\n                    filters: JSON.stringify(this.resultsSource.getFilters()),\n                },\n                url: CoreUrlUtils.addParamsToUrl('/search/index.php', {\n                    q: query,\n                }),\n            });\n        });\n    }\n\n    /**\n     * Clear search results.\n     */\n    clearSearch(): void {\n        this.loadMoreError = null;\n\n        this.resultsSource.setQuery('');\n        this.resultsSource.reset();\n    }\n\n    /**\n     * Visit a result's origin.\n     *\n     * @param result Result to visit.\n     */\n    async visitResult(result: CoreSearchGlobalSearchResult): Promise<void> {\n        await CoreContentLinksHelper.handleLink(result.url);\n    }\n\n    /**\n     * Load more results.\n     *\n     * @param complete Notify completion.\n     */\n    async loadMoreResults(complete: () => void ): Promise<void> {\n        try {\n            await this.resultsSource?.load();\n        } catch (error) {\n            this.loadMoreError = CoreDomUtils.getErrorMessage(error);\n        } finally {\n            complete();\n        }\n    }\n\n}\n","<ion-header>\n    <ion-toolbar>\n        <ion-buttons slot=\"start\">\n            <ion-back-button [text]=\"'core.back' | translate\" />\n        </ion-buttons>\n        <ion-title>\n            <h1 *ngIf=\"forum\">{{ forum.name }}</h1>\n            <h1 *ngIf=\"!forum\">{{ 'addon.block_searchforums.pluginname' | translate }}</h1>\n        </ion-title>\n    </ion-toolbar>\n</ion-header>\n<ion-content class=\"limited-width\">\n    <div>\n        <ion-card class=\"core-danger-card\" *ngIf=\"searchBanner\">\n            <ion-item>\n                <ion-icon name=\"fas-triangle-exclamation\" slot=\"start\" aria-hidden=\"true\" />\n                <ion-label>\n                    <core-format-text [text]=\"searchBanner\" />\n                </ion-label>\n            </ion-item>\n        </ion-card>\n\n        <core-search-box (onSubmit)=\"search($event)\" (onClear)=\"clearSearch()\" [placeholder]=\"'core.search' | translate\"\n            [searchLabel]=\"'core.search' | translate\" [autoFocus]=\"true\" [searchArea]=\"searchAreaId\" />\n\n        <ion-list *ngIf=\"resultsSource.isLoaded()\">\n            <core-search-global-search-result *ngFor=\"let result of resultsSource.getItems()\" [result]=\"result\" [showCourse]=\"false\"\n                (onClick)=\"visitResult(result)\" />\n        </ion-list>\n\n        <core-infinite-loading [enabled]=\"resultsSource.isLoaded() && !resultsSource.isCompleted()\" (action)=\"loadMoreResults($event)\"\n            [error]=\"loadMoreError\" />\n\n        <core-empty-box *ngIf=\"resultsSource.isEmpty()\" icon=\"fas-magnifying-glass\" [dimmed]=\"!resultsSource.isLoaded()\">\n            <p *ngIf=\"!resultsSource.isLoaded()\">{{ 'core.search.empty' | translate }}</p>\n            <ng-container *ngIf=\"resultsSource.isLoaded()\">\n                <p><strong>{{ 'core.search.noresults' | translate: { $a: resultsSource.getQuery() } }}</strong></p>\n                <p><small>{{ 'core.search.noresultshelp' | translate }}</small></p>\n            </ng-container>\n        </core-empty-box>\n    </div>\n</ion-content>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}