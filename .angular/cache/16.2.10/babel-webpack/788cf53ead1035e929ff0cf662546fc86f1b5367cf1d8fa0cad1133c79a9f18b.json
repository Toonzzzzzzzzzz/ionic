{"ast":null,"code":"var _class;\nimport { AddonModDataProvider } from '@addons/mod/data/services/data';\nimport { AddonModDataFieldPluginBaseComponent } from '@addons/mod/data/classes/base-field-plugin-component';\nimport { CoreFileSession } from '@services/file-session';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../../../../../../core/components/attachments/attachments\";\nimport * as i3 from \"../../../../../../core/components/files/files\";\nimport * as i4 from \"../../../../../../core/components/input-errors/input-errors\";\nimport * as i5 from \"../../../../../../core/components/mark-required/mark-required\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@ionic/angular\";\nfunction AddonModDataFieldFileComponent_span_0_core_input_errors_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"core-input-errors\", 5);\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"errorText\", ctx_r3.error);\n  }\n}\nfunction AddonModDataFieldFileComponent_span_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelement(1, \"span\", 2)(2, \"core-attachments\", 3);\n    i0.ɵɵtemplate(3, AddonModDataFieldFileComponent_span_0_core_input_errors_3_Template, 1, 1, \"core-input-errors\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"core-mark-required\", ctx_r0.field.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"files\", ctx_r0.files)(\"maxSize\", ctx_r0.maxSizeBytes)(\"component\", ctx_r0.component)(\"componentId\", ctx_r0.componentId)(\"allowOffline\", true)(\"courseId\", ctx_r0.database == null ? null : ctx_r0.database.course);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.error);\n  }\n}\nfunction AddonModDataFieldFileComponent_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 6);\n    i0.ɵɵelement(1, \"ion-input\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.form);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControlName\", \"f_\" + ctx_r1.field.id)(\"placeholder\", ctx_r1.field.name);\n  }\n}\nfunction AddonModDataFieldFileComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\");\n    i0.ɵɵelement(2, \"core-files\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"files\", ctx_r2.files)(\"component\", ctx_r2.component)(\"componentId\", ctx_r2.componentId)(\"alwaysDownload\", true);\n  }\n}\n/**\n * Component to render data file field.\n */\nexport class AddonModDataFieldFileComponent extends AddonModDataFieldPluginBaseComponent {\n  constructor() {\n    super(...arguments);\n    this.files = [];\n  }\n  /**\n   * Get the files from the input value.\n   *\n   * @param value Input value.\n   * @returns List of files.\n   */\n  getFiles(value) {\n    let files = (value === null || value === void 0 ? void 0 : value.files) || [];\n    // Reduce to first element.\n    if (files.length > 0) {\n      files = [files[0]];\n    }\n    return files;\n  }\n  /**\n   * @inheritdoc\n   */\n  init() {\n    if (this.searchMode) {\n      this.addControl('f_' + this.field.id);\n      return;\n    }\n    this.component = AddonModDataProvider.COMPONENT;\n    this.componentId = this.database.coursemodule;\n    this.updateValue(this.value);\n    if (this.editMode) {\n      this.maxSizeBytes = parseInt(this.field.param3, 10);\n      CoreFileSession.setFiles(this.component, this.database.id + '_' + this.field.id, this.files);\n    }\n  }\n  /**\n   * @inheritdoc\n   */\n  updateValue(value) {\n    this.value = value;\n    this.files = this.getFiles(value);\n  }\n}\n_class = AddonModDataFieldFileComponent;\n_class.ɵfac = /*@__PURE__*/function () {\n  let ɵAddonModDataFieldFileComponent_BaseFactory;\n  return function AddonModDataFieldFileComponent_Factory(t) {\n    return (ɵAddonModDataFieldFileComponent_BaseFactory || (ɵAddonModDataFieldFileComponent_BaseFactory = i0.ɵɵgetInheritedFactory(_class)))(t || _class);\n  };\n}();\n_class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: _class,\n  selectors: [[\"addon-mod-data-field-file\"]],\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 3,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [3, \"formGroup\", 4, \"ngIf\"], [1, \"core-mark-required\", 3, \"core-mark-required\"], [\"maxSubmissions\", \"1\", 3, \"files\", \"maxSize\", \"component\", \"componentId\", \"allowOffline\", \"courseId\"], [3, \"errorText\", 4, \"ngIf\"], [3, \"errorText\"], [3, \"formGroup\"], [\"type\", \"text\", 3, \"formControlName\", \"placeholder\"], [3, \"files\", \"component\", \"componentId\", \"alwaysDownload\"]],\n  template: function AddonModDataFieldFileComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, AddonModDataFieldFileComponent_span_0_Template, 4, 8, \"span\", 0);\n      i0.ɵɵtemplate(1, AddonModDataFieldFileComponent_span_1_Template, 2, 3, \"span\", 1);\n      i0.ɵɵtemplate(2, AddonModDataFieldFileComponent_ng_container_2_Template, 3, 4, \"ng-container\", 0);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.editMode && ctx.form);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.searchMode && ctx.form);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.displayMode);\n    }\n  },\n  dependencies: [i1.NgIf, i2.CoreAttachmentsComponent, i3.CoreFilesComponent, i4.CoreInputErrorsComponent, i5.CoreMarkRequiredComponent, i6.NgControlStatus, i6.NgControlStatusGroup, i7.IonInput, i7.TextValueAccessor, i6.FormGroupDirective, i6.FormControlName],\n  encapsulation: 2\n});","map":{"version":3,"names":["AddonModDataProvider","AddonModDataFieldPluginBaseComponent","CoreFileSession","i0","ɵɵelement","ɵɵproperty","ctx_r3","error","ɵɵelementStart","ɵɵtemplate","AddonModDataFieldFileComponent_span_0_core_input_errors_3_Template","ɵɵelementEnd","ɵɵadvance","ctx_r0","field","required","files","maxSizeBytes","component","componentId","database","course","ctx_r1","form","id","name","ɵɵelementContainerStart","ɵɵelementContainerEnd","ctx_r2","AddonModDataFieldFileComponent","constructor","getFiles","value","length","init","searchMode","addControl","COMPONENT","coursemodule","updateValue","editMode","parseInt","param3","setFiles","t","selectors","features","ɵɵInheritDefinitionFeature","decls","vars","consts","template","AddonModDataFieldFileComponent_Template","rf","ctx","AddonModDataFieldFileComponent_span_0_Template","AddonModDataFieldFileComponent_span_1_Template","AddonModDataFieldFileComponent_ng_container_2_Template","displayMode"],"sources":["/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/data/fields/file/component/file.ts","/home/toon/works/gitionic7/ionic-github/ionic/src/addons/mod/data/fields/file/component/addon-mod-data-field-file.html"],"sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component } from '@angular/core';\nimport { AddonModDataEntryField, AddonModDataProvider } from '@addons/mod/data/services/data';\nimport { AddonModDataFieldPluginBaseComponent } from '@addons/mod/data/classes/base-field-plugin-component';\nimport { CoreFileSession } from '@services/file-session';\nimport { CoreFileEntry } from '@services/file-helper';\n\n/**\n * Component to render data file field.\n */\n@Component({\n    selector: 'addon-mod-data-field-file',\n    templateUrl: 'addon-mod-data-field-file.html',\n})\nexport class AddonModDataFieldFileComponent extends AddonModDataFieldPluginBaseComponent {\n\n    files: CoreFileEntry[] = [];\n    component?: string;\n    componentId?: number;\n    maxSizeBytes?: number;\n\n    /**\n     * Get the files from the input value.\n     *\n     * @param value Input value.\n     * @returns List of files.\n     */\n    protected getFiles(value?: Partial<AddonModDataEntryField>): CoreFileEntry[] {\n        let files = value?.files || [];\n\n        // Reduce to first element.\n        if (files.length > 0) {\n            files = [files[0]];\n        }\n\n        return files;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected init(): void {\n        if (this.searchMode) {\n            this.addControl('f_' + this.field.id);\n\n            return;\n        }\n\n        this.component = AddonModDataProvider.COMPONENT;\n        this.componentId = this.database!.coursemodule;\n\n        this.updateValue(this.value);\n\n        if (this.editMode) {\n            this.maxSizeBytes = parseInt(this.field.param3, 10);\n            CoreFileSession.setFiles(this.component, this.database!.id + '_' + this.field.id, this.files);\n        }\n    }\n\n    /**\n     * @inheritdoc\n     */\n    protected updateValue(value?: Partial<AddonModDataEntryField>): void {\n        this.value = value;\n        this.files = this.getFiles(value);\n    }\n\n}\n","<span *ngIf=\"editMode && form\">\n    <span [core-mark-required]=\"field.required\" class=\"core-mark-required\"></span>\n    <core-attachments [files]=\"files\" [maxSize]=\"maxSizeBytes\" maxSubmissions=\"1\" [component]=\"component\" [componentId]=\"componentId\"\n        [allowOffline]=\"true\" [courseId]=\"database?.course\" />\n    <core-input-errors *ngIf=\"error\" [errorText]=\"error\" />\n</span>\n\n<span *ngIf=\"searchMode && form\" [formGroup]=\"form\">\n    <ion-input type=\"text\" [formControlName]=\"'f_'+field.id\" [placeholder]=\"field.name\" />\n</span>\n\n<ng-container *ngIf=\"displayMode\">\n    <div>\n        <core-files [files]=\"files\" [component]=\"component\" [componentId]=\"componentId\" [alwaysDownload]=\"true\" />\n    </div>\n</ng-container>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}